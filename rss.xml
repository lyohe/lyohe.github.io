<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Koko-ni-kaku RSS Feed]]></title><description><![CDATA[A blog about accounting and programming]]></description><link>https://lyohe.github.io</link><generator>GatsbyJS</generator><lastBuildDate>Sun, 28 May 2023 05:17:48 GMT</lastBuildDate><item><title><![CDATA[Python ではじめる会計データサイエンスを読んだ話]]></title><description><![CDATA[「Python ではじめる会計データサイエンス」という本を買って読んだので感想を書く。 https://www.amazon.co.jp/dp/4502438111 表紙が可愛い。  背景 私は…]]></description><link>https://lyohe.github.io/2023-05-28-py-haji/</link><guid isPermaLink="false">https://lyohe.github.io/2023-05-28-py-haji/</guid><pubDate>Sat, 27 May 2023 15:01:01 GMT</pubDate><content:encoded>&lt;p&gt;「Python ではじめる会計データサイエンス」という本を買って読んだので感想を書く。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.amazon.co.jp/dp/4502438111&quot;&gt;https://www.amazon.co.jp/dp/4502438111&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;表紙が可愛い。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/9dd321b101bab1a87dcbf5dbfc401fff/9568a/hebi-kawa.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 133.54430379746836%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAbABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAIBAwT/xAAWAQEBAQAAAAAAAAAAAAAAAAACBAP/2gAMAwEAAhADEAAAAfRU3ItYj1c6ugQMX//EABsQAAICAwEAAAAAAAAAAAAAAAABEBEhMUJB/9oACAEBAAEFAqo0jns8WIQo/8QAFxEAAwEAAAAAAAAAAAAAAAAAARASQf/aAAgBAwEBPwGkRq//xAAZEQEAAgMAAAAAAAAAAAAAAAABAAIQEhP/2gAIAQIBAT8B5mK3U0jP/8QAGhAAAAcAAAAAAAAAAAAAAAAAAAEQETBxgf/aAAgBAQAGPwJSsY0H/8QAGhABAAIDAQAAAAAAAAAAAAAAAQARITFBEP/aAAgBAQABPyFsB3yVkTxu523hlnDwU5yNkvk7W5c0hzHc/9oADAMBAAIAAwAAABCQ1XL/xAAYEQEAAwEAAAAAAAAAAAAAAAABABEhEP/aAAgBAwEBPxAblbwbkn//xAAZEQEBAQADAAAAAAAAAAAAAAABEQAxwdH/2gAIAQIBAT8QTbVO/K6YguNFd//EAB0QAQADAAMAAwAAAAAAAAAAAAEAESFBUXFhocH/2gAIAQEAAT8QRoCzH1EmSjn9l3Dwur1i+PT12XAIUgDtit0Yq7nliV23sB0XMqf/2Q==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;hebi-kawa&quot;
        title=&quot;hebi-kawa&quot;
        src=&quot;/static/9dd321b101bab1a87dcbf5dbfc401fff/828fb/hebi-kawa.jpg&quot;
        srcset=&quot;/static/9dd321b101bab1a87dcbf5dbfc401fff/ff44c/hebi-kawa.jpg 158w,
/static/9dd321b101bab1a87dcbf5dbfc401fff/a6688/hebi-kawa.jpg 315w,
/static/9dd321b101bab1a87dcbf5dbfc401fff/828fb/hebi-kawa.jpg 630w,
/static/9dd321b101bab1a87dcbf5dbfc401fff/0ede0/hebi-kawa.jpg 945w,
/static/9dd321b101bab1a87dcbf5dbfc401fff/3ac88/hebi-kawa.jpg 1260w,
/static/9dd321b101bab1a87dcbf5dbfc401fff/9568a/hebi-kawa.jpg 3024w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 id=&quot;背景&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%83%8C%E6%99%AF&quot; aria-label=&quot;背景 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;背景&lt;/h2&gt;
&lt;p&gt;私は 8 年ほど経理をやっていて今はプログラマーとして働いており、将来的にも会計とプログラミングの間で仕事をしていこうと考えている。また、過去に著者の主催する PyCPA というイベントに参加したことがあり、会計の課題をプログラミングで解決することに興味を持っていた。&lt;/p&gt;
&lt;p&gt;Python もデータ分析も完全に素人なのだが、それを言い訳にしていたら一生やらなさそうな気がしたので勢いで買って読んでみることにした。自分の前提知識は以下の通り。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Python: 何も分からない。普段は仕事で TypeScript、個人で Go を書いている&lt;/li&gt;
&lt;li&gt;数学: 高校までしかやってない。統計は大学の教養課程でやった程度&lt;/li&gt;
&lt;li&gt;データ分析: SQL でデータを取ってきて簡単な可視化や分析をする仕事をやった経験はあるが、分析手法の専門的な知識はない&lt;/li&gt;
&lt;li&gt;会計: だいたい理解しているつもりだが、専門的な資格は一切持っていない&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;書籍の概要&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%9B%B8%E7%B1%8D%E3%81%AE%E6%A6%82%E8%A6%81&quot; aria-label=&quot;書籍の概要 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;書籍の概要&lt;/h2&gt;
&lt;p&gt;前半の第 1 部はデータ分析の前提知識となる Python や数学、統計の基礎知識をまとめておさらいし、後半の第 2 部ではそれを使って実際にデータ分析を行うという構成になっている。分量としては 2:3 くらいの割合で第 2 部が多めで、書籍全体で 250 ページくらい。&lt;/p&gt;
&lt;h3 id=&quot;第-1-部&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%AC%AC-1-%E9%83%A8&quot; aria-label=&quot;第 1 部 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;第 1 部&lt;/h3&gt;
&lt;p&gt;Python については基礎的な文法と NumPy, pandas, Matplotlib, scikit-learn など重要なライブラリの使い方が紹介されており、数学・統計も本書で使う範囲の確率や探索・推論手法が説明されている。&lt;/p&gt;
&lt;p&gt;100 ページ程度の駆け足で説明するため、本書で利用する最低限の記載に絞っているという印象を受けた。しかし、Python や各種ライブラリは膨大な公式ドキュメントがあるし数学や統計も広く読まれている教科書（本書でもいくつか紹介されている）があるので、深掘りしたくなったらそれを読めばいい。書籍のタイトル通り、まずは自分の手を動かしてはじめてみるのが重要ということだろう。&lt;/p&gt;
&lt;h3 id=&quot;第-2-部&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%AC%AC-2-%E9%83%A8&quot; aria-label=&quot;第 2 部 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;第 2 部&lt;/h3&gt;
&lt;p&gt;第 1 部の知識を使って財務諸表監査のための統計的サンプリングツールを作ったり、簡単な機械学習で将来売上、貸倒、在庫などの予測や会計データの異常検知を実装する。最後にそれらを支えるデータ分析基盤について概要を説明して終わる。&lt;/p&gt;
&lt;p&gt;自分が本書で紹介されている k-means 法やランダムフォレストや SVM などの手法を正確に理解できているか怪しいが、会計のデータが題材なので元々経理をやっていた自分には親しみやすかった。「機械学習で使われている手法を勉強する！」というつもりで読むのではなく、日常的な会計の課題と結びつけて「こういった課題にはこういった手法が適していそうだ」という感覚を養い、自分で手を動かすためのきっかけとして読むと役に立つ知識として身につきそう。&lt;/p&gt;
&lt;p&gt;コードや手法について分からないことがあった際は ChatGPT に聞くようにした。例えば本書で SVM（サポートベクターマシン）と言う学習モデルが紹介されており本書記載の具体例ではあまり納得できていなかったのだが、ChatGPT に理論的背景や他の手法との相違点、使い方に関する質問をした結果として理解が進み使い方や利点・欠点が分かってきた。&lt;/p&gt;
&lt;h2 id=&quot;書籍全体への感想&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%9B%B8%E7%B1%8D%E5%85%A8%E4%BD%93%E3%81%B8%E3%81%AE%E6%84%9F%E6%83%B3&quot; aria-label=&quot;書籍全体への感想 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;書籍全体への感想&lt;/h2&gt;
&lt;p&gt;「Python ではじめる」というタイトル通り、自分で手を動かして問題を解決する人（が手を動かし始めるためのきっかけとなる）本だという印象を受けた。&lt;/p&gt;
&lt;p&gt;Python や数学・統計、それらを使ったデータ分析は学習する内容が多岐にわたり、「重要そうなのは理解できるし手をつけてみたけど途中で挫折した」という方も多いのではないだろうか。本書は経理や監査などを仕事でやっていてプログラミングやデータ分析で仕事上の課題を解決したい人がそれを「Python ではじめる」きっかけになる本だと感じた。&lt;/p&gt;
&lt;p&gt;全体の分量は約 250 ページで、速い人なら 1 ~ 2 日で読み切れると思う。本書を一通り読んでみて自分の手を動かして身近な課題を解き、そこから不足している知識を補強して増やしていく、という進め方が良さそう。&lt;/p&gt;
&lt;p&gt;本書の最後でデータ分析基盤の話に触れているが、実際に仕事でデータを分析して意思決定に役立てるとなるとまず最初に「正確なデータを適時に入手できるようにする」体制を作るのが大変なので、その考え方が紹介されているのは実務者に寄り添っている印象を受けた。本書の内容を一通り学んだ上で目的に沿った分析を行うためにどのようなデータが必要かを考え、それに沿ってデータ基盤を作るとよい（という視点で最後の章に書いてありそう）。&lt;/p&gt;
&lt;h2 id=&quot;余談-公認会計士とデータ分析&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BD%99%E8%AB%87-%E5%85%AC%E8%AA%8D%E4%BC%9A%E8%A8%88%E5%A3%AB%E3%81%A8%E3%83%87%E3%83%BC%E3%82%BF%E5%88%86%E6%9E%90&quot; aria-label=&quot;余談 公認会計士とデータ分析 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;余談: 公認会計士とデータ分析&lt;/h2&gt;
&lt;p&gt;本書の内容とは関係ないが、公認会計士の方がプログラミングを学んで本を出版するという行為自体が興味深い。&lt;/p&gt;
&lt;p&gt;公認会計士（勅許会計士）という職業が生まれた背景には 19 世紀後半にアメリカやイギリスで鉄鋼業や鉄道業など大規模な資本を必要とする産業が成長し、そういった大規模な会社の複雑な会計処理をもとに作られた財務諸表の正確性を素人が評価するのは不可能だから適切な知識を備えた専門家が必要になったという歴史がある。&lt;/p&gt;
&lt;p&gt;歴史的には、複雑で大規模なデータを分析して意思決定に役立てるというのは公認会計士の本分と言えるかもしれない。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[2022年に読んだ本 BEST 5]]></title><description><![CDATA[2022年に読んで面白かった本 BEST 5 1. 教誨師　|　堀川惠子 https://www.amazon.co.jp/dp/B07BVG18DR…]]></description><link>https://lyohe.github.io/2022-12-30-best-reading/</link><guid isPermaLink="false">https://lyohe.github.io/2022-12-30-best-reading/</guid><pubDate>Fri, 30 Dec 2022 00:01:01 GMT</pubDate><content:encoded>&lt;p&gt;2022年に読んで面白かった本 BEST 5&lt;/p&gt;
&lt;h2 id=&quot;1-教誨師堀川惠子&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1-%E6%95%99%E8%AA%A8%E5%B8%AB%E5%A0%80%E5%B7%9D%E6%83%A0%E5%AD%90&quot; aria-label=&quot;1 教誨師堀川惠子 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;1. 教誨師　|　堀川惠子&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://www.amazon.co.jp/dp/B07BVG18DR&quot;&gt;https://www.amazon.co.jp/dp/B07BVG18DR&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;半世紀にわたり、死刑囚と対話を重ね、死刑執行に立ち会い続けた教誨師・渡邉普相。「わしが死んでから世に出して下さいの」という約束のもと、初めて語られた死刑の現場とは？　死刑制度が持つ矛盾と苦しみを一身に背負って生きた僧侶の人生を通して、死刑の内実を描いた問題作！　第1回城山三郎賞受賞。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;今年1冊目に読んだ本だが、一年の間ずっと心に残りふとした瞬間に思い出すことがあった。大学の先輩に死刑囚がいて（執行済み）その支援をやっている人も知っていたので、死刑という制度そのものに関心があった。&lt;/p&gt;
&lt;p&gt;死刑制度には賛否両論あるが、どちらの立場であっても或いは死刑制度に関心がなくても読んでほしい本だ。なぜなら日本では死刑囚と面会できる民間人は少なく、死刑判決を受けた人間が執行に至るまで拘置所で何を考えていたかを知る機会がほとんどないからだ。死刑に賛成であっても反対であっても関心がなくても、一人の人間を国家権力によって殺す選択をするのだから、その責任を意識しないわけにはいかない。&lt;/p&gt;
&lt;p&gt;一般的に、刑罰が存在する思想的根拠には大きく分けて教育刑（その人が再び罪を犯すことのないように教育する目的）と応報刑（罪に対して報復をすることで他の人も含めて犯罪行為に及ぶことを抑止する目的）の2種類がある。死刑が確定すると拘置所から出ることはない、つまり教育効果がないのは明らかだから、応報刑としての効果があるかを国民一人一人の責任において考え続けることが重要になる。&lt;/p&gt;
&lt;p&gt;「教誨師」とはその名の通り人を教えさとす仕事であり、僧侶や牧師などの宗教者が担っている。彼らは囚人と面会して対話を重ね、その執行にも立ち会う。本書には様々な死刑囚が登場し、どのような事件をどのような理由で起こしたか、その後何を考えどう生きたかが描写されている。宗教を信じる者もいれば信じない者もいるが、渡邉は時に失敗しながらも一人一人と対話を重ね、自分自身も悩み苦しみながら死刑囚を導いていく。&lt;/p&gt;
&lt;p&gt;近い将来に国家の手で死ぬことが確定している人間を教えさとすという活動は心身ともに過酷で、長く続けられる人はなかなかいないそうだ（ちなみに教誨師は給料も出ず、完全にボランティアである）。そんな中で半世紀にわたって人の（国家による）死に立ち会ってきただけあって、死刑だけでなく人に訪れる死そのものについて考えるきっかけとなる本だった。&lt;/p&gt;
&lt;p&gt;強烈にお勧めしたいが、未だに自分がこの本を読んでほしい気持ちをうまく言語化できずにいる。&lt;/p&gt;
&lt;h2 id=&quot;2-コードガールズ日独の暗号を解き明かした女性たちライザマンディ&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#2-%E3%82%B3%E3%83%BC%E3%83%89%E3%82%AC%E3%83%BC%E3%83%AB%E3%82%BA%E6%97%A5%E7%8B%AC%E3%81%AE%E6%9A%97%E5%8F%B7%E3%82%92%E8%A7%A3%E3%81%8D%E6%98%8E%E3%81%8B%E3%81%97%E3%81%9F%E5%A5%B3%E6%80%A7%E3%81%9F%E3%81%A1%E3%83%A9%E3%82%A4%E3%82%B6%E3%83%9E%E3%83%B3%E3%83%87%E3%82%A3&quot; aria-label=&quot;2 コードガールズ日独の暗号を解き明かした女性たちライザマンディ permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;2. コード・ガールズ――日独の暗号を解き明かした女性たち　|　ライザ・マンディ&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://www.amazon.co.jp/dp/4622090198&quot;&gt;https://www.amazon.co.jp/dp/4622090198&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;日本軍の真珠湾攻撃が迫る1941年11月、アメリカ海軍から東部の名門女子大に宛てて「秘密の手紙」が送られはじめた。そこには、敵国の暗号解読に当たれる優秀な学生がほしいと記されていた――。&lt;/p&gt;
&lt;p&gt;第二次世界大戦中、米陸・海軍に雇われ、日本やドイツなど枢軸国の暗号解読を担ったアメリカ人女性たちがいた。外国語や数学をはじめとする高等教育を受けた新卒者や元教師らが全米各地から首都ワシントンに集い、大戦末期には男性をしのぐ1万人以上の女性が解読作業に従事した。
その働きにより、日本の外交暗号(通称パープル)や陸軍の船舶輸送暗号が破られ、枢軸国側に壊滅的な打撃を与えた。ミッドウェー海戦での米軍の勝利、山本五十六連合艦隊司令長官の殺害作戦の陰にも彼女らがいた。一方、大西洋戦域においてはドイツのエニグマ暗号を解明してUボートの脅威を排除し、ノルマンディー上陸時の欺瞞作戦でも活躍した。こうした功績がきっかけとなり、それまで女性には閉ざされていた政府高官や大学教授など高いキャリアへの道が切り拓かれることになる。&lt;/p&gt;
&lt;p&gt;戦後も守秘義務を守り、口を閉ざしてきた当事者らへのインタビュー、当時の手紙、機密解除された史料などをもとに、情報戦の一翼を担った女性たちに光をあて、ベストセラーとなったノンフィクション。口絵写真33点を収録。解説・小谷賢。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;女性の高等教育が奨励されておらずその見返りも少なかった1940年代前半のアメリカで、枢軸国や中立国の暗号解読を通じて第二次世界大戦での米国の勝利に大きく貢献した女性たち “コード・ガールズ” の話。&lt;/p&gt;
&lt;p&gt;二度の世界大戦は各国で女性の社会的地位を向上させた。20世紀初頭までは「男性は外で働き、女性は家を守る」という価値観が支配的だった。しかし、第一次世界大戦によって男性が兵士として出国して人手不足となる中で、それまで男性の仕事とされていた工場労働や郵便配達など社会の維持に不可欠な分野で女性が仕事をするようになった。その結果として人々の価値観が大きく変わり、イギリスでは1918年、アメリカでは1920年には女性に選挙権が認められた。&lt;/p&gt;
&lt;p&gt;第二次世界大戦が始まると、男性が軍隊に召集されたことで再び社会に女性の力が求められるようになった。当時のアメリカは太平洋での日本との戦争を見据えて暗号解読に力を入れていた。海上での作戦では戦力を集結するために広範囲で連絡を取る必要があり、必然的にお互いに敵側に通信を傍聴されるため暗号技術が非常に重要だった。さらに、真珠湾攻撃で米国の太平洋艦隊が大打撃を受けたこともあり、敵を叩くだけでなく敵側の攻撃を防いで自国兵士の命を守る面でも暗号解読の重要性は高まった。&lt;/p&gt;
&lt;p&gt;暗号解読は地道な作業で、暗号文を整理・分類してそこから法則性を見つけ出し、別の暗号文にそれを適用していく。これには数学や外国の基礎能力や集中力を持つ大勢の人間が必要だった。多人数の暗号解読者を欲していたアメリカ海軍と、数学や外国語の高等教育を受けながらその能力を活かす道が教師くらいしかなく不満を抱えていた女性たちとは利害が一致していた。&lt;/p&gt;
&lt;p&gt;コード・ガールズとして活躍した女性たちの一部は戦後も（戦前は男性の仕事とされていた）軍の士官や大学教授、政府職員として働くようになり、女性のキャリア多様化につながった。&lt;/p&gt;
&lt;p&gt;女性は理数系に向いていないといったような差別や偏見は現代でも存在しているが、彼女らが残した実績を見れば（アラン・チューリングのような伝説的な人物と比較しても）全く劣ってはいないのだから、性別による差は存在しておらず周囲の人間の思い込みや環境によって単純な機会が不足することが実績の性差として現れそれが人々の思い込みを補強する負の循環があるのではないかと感じた。&lt;/p&gt;
&lt;p&gt;参考: &lt;a href=&quot;https://www.youtube.com/watch?v=D9sYm32TR8A&quot;&gt;YouTube: Secret Code Girls of World War II | Liza Mundy | Talks at Google&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;3-深海の使者吉村昭&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#3-%E6%B7%B1%E6%B5%B7%E3%81%AE%E4%BD%BF%E8%80%85%E5%90%89%E6%9D%91%E6%98%AD&quot; aria-label=&quot;3 深海の使者吉村昭 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;3. 深海の使者　|　吉村昭&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://www.amazon.co.jp/dp/4167169495&quot;&gt;https://www.amazon.co.jp/dp/4167169495&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;太平洋戦争が勃発して間もない昭和17年4月22日未明、一隻の大型潜水艦がひそかにマレー半島のペナンを出港した。3万キロも彼方のドイツをめざして…。
大戦中、杜絶した日独両国を結ぶ連絡路を求めて、連合国の封鎖下にあった大西洋に、数次にわたって潜入した日本潜水艦の決死の苦闘を描いた力作長篇。&lt;/p&gt;
&lt;p&gt;昭和17年秋、新聞に大本営発表として一隻の日本潜水艦が訪独したという記事が掲載された。当時中学生であった著者は、それを読み、苛酷な戦局の中、遥かドイツにどのようにして赴くことができたか、夢物語のように感じたという。
時を経て、記事の裏面にひそむ史実を調査することを思い立った著者は、その潜水艦の行動を追うが……戦史にあらわれることのなかった新たなる史実に迫る。
解説・半藤一利&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;上記の「コード・ガールズ」による暗号解読によって苦境に陥った旧日本軍潜水艦の実話を基にした小説。&lt;/p&gt;
&lt;p&gt;第二次世界大戦において日本はドイツと軍事同盟を結んでいた。しかし、その間には直線距離で 10,000 km 近くの距離があり連絡は容易ではなかった。両国の間にはソ連があり、開戦当時は敵国ではなかったものの緊張状態にあったため、陸路や空路での移動は不要な刺激を与え日本への敵対的行動を招く可能性があった。&lt;/p&gt;
&lt;p&gt;また、海路ではスエズをイギリスが抑えており、日本とドイツの連絡は電信に頼るか数ヶ月かけて潜水艦でインド洋を横断し喜望峰を迂回するしかなかった。日本はドイツ兵器の技術情報やドイツに派遣した武官の持つ資料や情報を欲しており、ドイツはスエズや中近東、エジプトの制圧を進めるためにイギリスのアフリカ経由の補給路を攻撃するよう日本に要望していた。そのため、日本から潜水艦で喜望峰を経由してヨーロッパへ向かい、途中で補給船を叩くことは両国の利害が一致していた。&lt;/p&gt;
&lt;p&gt;しかし、「コード・ガールズ」にも描かれている通り第二次大戦が進むに従って日本軍の暗号はほぼ解読されており、日独間を潜水艦が往復することもその日程や目的、積載物もほぼ明らかになっていた。その中で多くの潜水艦は任務の途中で攻撃を受け苦境に陥り、生還できない艦も多かった。著者の吉村昭はさまざまな作品を残しているがどれも綿密な取材に基づいて執筆されており、臨場感がある。&lt;/p&gt;
&lt;p&gt;印象的なエピソードとして、日独伊三国同盟の軍事委員だった野村直邦がドイツから日本に帰国した際のスケジュール確認をアメリカに盗聴されていることを前提に国際電話で行ったという話が登場する。ベルリンと東京の双方で野村と同じ鹿児島出身の外交官が早口の薩摩弁で喋ることで、平文ながら盗聴者にはその意味を直ぐには判別することができなかった（いわゆるコード・トーカー）。&lt;/p&gt;
&lt;h2 id=&quot;4-カッコウはコンピュータに卵を産むクリフォードストール&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#4-%E3%82%AB%E3%83%83%E3%82%B3%E3%82%A6%E3%81%AF%E3%82%B3%E3%83%B3%E3%83%94%E3%83%A5%E3%83%BC%E3%82%BF%E3%81%AB%E5%8D%B5%E3%82%92%E7%94%A3%E3%82%80%E3%82%AF%E3%83%AA%E3%83%95%E3%82%A9%E3%83%BC%E3%83%89%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB&quot; aria-label=&quot;4 カッコウはコンピュータに卵を産むクリフォードストール permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;4. カッコウはコンピュータに卵を産む　|　クリフォード・ストール&lt;/h2&gt;
&lt;p&gt;上巻: &lt;a href=&quot;https://www.amazon.co.jp/dp/4794223099&quot;&gt;https://www.amazon.co.jp/dp/4794223099&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;下巻: &lt;a href=&quot;https://www.amazon.co.jp/dp/4794223102&quot;&gt;https://www.amazon.co.jp/dp/4794223102&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;1986年、まだネット黎明期のカリフォルニア・バークレー。事件の発端は75セントだった。ローレンス・バークレー研究所のコンピュータ・システムの使用料金が75セントだけ合致しない。天文学研究のかたわらシステム管理者をつとめる著者の初仕事はその原因の究明だった。調査を進めるうちに、正体不明のユーザが浮かび上がってきた。その人物は研究所のサーバを足場に、国防総省のネットワークをかいくぐり、米国各地の軍事施設や陸軍、はてはCIAにまで手を伸ばしていたのだ!&lt;/p&gt;
&lt;p&gt;――インターネットが世界を覆いはじめる前夜、「ハッカー」の存在を世に知らしめた国際ハッカー事件。その全容を当事者本人が小説のような筆致で描く。トム・クランシーも絶賛した世界的ベストセラー、待望の復刊!&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;実際に起きたハッカー事件を基にした当事者によるノンフィクション。&lt;/p&gt;
&lt;p&gt;主人公クリフは新人天文学者として望遠鏡の光学系を設計していたが、政府の助成金が切れたことで天文学者の仕事を続けられなくなり同じ研究所内のコンピュータ管理部門で働くことになった。当時のローレンス・バークレー研究所では 4,000 人の研究者が物理計算用の大型コンピュータを使っており、演算装置やディスクの使用量に応じて利用した研究者の所属する部門に請求書が送られる仕組みだった。&lt;/p&gt;
&lt;p&gt;働き始めて2日目、その請求合計額と実際のコンピュータ利用料から計算した額に75セントの差が生じていることが明らかになり、その原因調査がクリフの最初の仕事になった。クリフはデータやプログラムを調査し、1日で原因を突き止める。ハンターという名前のアカウントがコンピュータを利用していたが、請求書の宛先が登録されておらずそれが75セント分の差額として現れていたのだった。&lt;/p&gt;
&lt;p&gt;誰もハンターという人間を知らないことからクリフはハンターのアカウントを削除したが、それ以降も異なる名前の（請求書の宛先が登録されていない）アカウントで研究所のコンピュータに接続されることがあり、外部からの侵入であることが明らかになるとクリフはその調査に追われることになった。その侵入者は研究所のコンピュータを介して米国内の軍事施設のネットワークへ侵入している形跡があったことから、事件は次第に国防総省や CIA も巻き込んだ大騒動に発展していく。&lt;/p&gt;
&lt;p&gt;クリフが周囲の協力を得ながらハッカーに迫っていく過程はミステリーとして面白い。例えば、クリフの先輩デイヴは早い段階でハッカーがバークレーや近所のいたずら好きの学生ではなく、西海岸以外の場所でそれなりの経験を積んだ技術者であると予想する。ハッカーが研究所のコンピュータに残していった UNIX コマンドの履歴には旧世代の AT&amp;#x26;T UNIX 特有のオプションが使われており、それはバークレー UNIX（BSD）では自動でやってくれるために使われていなかったからだ。&lt;/p&gt;
&lt;p&gt;現代ではコンピュータやインターネットが一般家庭で当たり前に使われているにも関わらず、その裏で動いているソフトウェアや各端末を結ぶネットワークがどのような仕組みで動いているか、どのような脆弱性が隠れているのかを意識することは少ないように思える。しかし、それは自分の手を動かしてデータを調査したりソフトウェアを書いていく人がコンピュータやネットワークの安全や自由を守っているからであって、そういった人が減っていけばインターネットはより危険で不自由になっていくかもしれない。&lt;/p&gt;
&lt;p&gt;自分も一人のプログラマーとしてそういった自由な世界を守る方向に進んでいきたいと思った。&lt;/p&gt;
&lt;h2 id=&quot;5-カースト---アメリカに渦巻く不満の根源イザベルウィルカーソン&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#5-%E3%82%AB%E3%83%BC%E3%82%B9%E3%83%88---%E3%82%A2%E3%83%A1%E3%83%AA%E3%82%AB%E3%81%AB%E6%B8%A6%E5%B7%BB%E3%81%8F%E4%B8%8D%E6%BA%80%E3%81%AE%E6%A0%B9%E6%BA%90%E3%82%A4%E3%82%B6%E3%83%99%E3%83%AB%E3%82%A6%E3%82%A3%E3%83%AB%E3%82%AB%E3%83%BC%E3%82%BD%E3%83%B3&quot; aria-label=&quot;5 カースト   アメリカに渦巻く不満の根源イザベルウィルカーソン permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;5. カースト - アメリカに渦巻く不満の根源　|　イザベル・ウィルカーソン&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://www.amazon.co.jp/dp/4000615564&quot;&gt;https://www.amazon.co.jp/dp/4000615564&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;アメリカの日常にはびこる黒人差別は決して根絶されず再燃する。ピューリツァー賞受賞・黒人女性作家が自らの体験をもとに、差別の底に潜む、白人、バラモン、アーリア人の「優越」を保持するカースト制のメカニズムを探る。アメリカの民主主義を蝕むカーストの恐るべき悪とは。世界的ベストセラー、待望の邦訳。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;アフリカ系アメリカ人が過去に受けてきた（現在も受けている）差別や偏見をインドのヴァルナやジャーティ、ナチスドイツにおけるユダヤ人迫害と比較し、その共通点を「カースト」と呼ばれる社会的階級制度の「柱」として整理してそれらの歴史や制度・慣習が人間にもたらす影響を考察する本。&lt;/p&gt;
&lt;p&gt;カーストを支える柱には次の8つがある。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;神の意思と自然の法則: 旧約聖書でノアから呪われたハムのように、神話や宗教によって差別を正当化する&lt;/li&gt;
&lt;li&gt;遺伝性: 肌の色や姓のように、一見して分かり先祖から受け継ぐ特徴によって差別する&lt;/li&gt;
&lt;li&gt;族内婚と、結婚と子作りの制御: 異なるカースト間の婚姻や子作りを禁止する&lt;/li&gt;
&lt;li&gt;純潔 vs. 汚染: 下層カーストに対して特定の場所（例えば寺院やプールなど）に入ることを禁止する&lt;/li&gt;
&lt;li&gt;職業のヒエラルキー: 運転手や家事労働、小作人など特定の職業は下層カーストに限られ、それ以外の職業につくことを禁止する&lt;/li&gt;
&lt;li&gt;非人間化と烙印: 下層カーストの人間から個性を剥ぎ取り、集団ごと搾取や残虐行為の対象とする&lt;/li&gt;
&lt;li&gt;実施手段としての恐怖、支配手段としての残酷: カーストの規範に逆らった者を私刑にかけ、それを周囲に見せつける&lt;/li&gt;
&lt;li&gt;生まれつきの優越 vs. 生まれつきの劣等: カーストは生まれつき決まっておりそれが変わることがないことを社会の様々な箇所で思い知らせる&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;著者はニューヨーク・タイムズの記者として長年働き権威ある賞も受賞しているが、仕事と私生活の双方で黒人女性ならではの差別や偏見を受けてきた。例えば、取材に行ったのに記者だと信じてもらえなかったり、大荷物で移動しているときに自分だけ麻薬の売人と間違われたり、ファーストクラスに乗ったのに乗務員が自分だけ荷物の運搬を手伝ってくれなかったり…&lt;/p&gt;
&lt;p&gt;アメリカでは奴隷解放や公民権運動を経て憲法上は人種間の差異がないものの、人々の中には意識的・無意識的に肌の色で相手に対する思い込みがインストールされており、それが統計上にも警察によるアフリカ系アメリカ人の殺害件数のような形で表出してきた。容易に変えられない身体的、社会的特徴を基に集団を序列化しその序列に基づいて行動規範が形成されそれに従って行動してきた人がいる限り、書類上は平等であっても実際には社会的な階級制度がなくなることはない。&lt;/p&gt;
&lt;p&gt;それを変えるには社会の全員がカーストの歴史やそれに基づく意識的・無意識的な差別・偏見の存在を知り、解決に向けて動き続けることが重要になる…ということを意識することになった一冊だった。&lt;/p&gt;
&lt;h2 id=&quot;番外編-gits-database-internals&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%95%AA%E5%A4%96%E7%B7%A8-gits-database-internals&quot; aria-label=&quot;番外編 gits database internals permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;番外編: Git’s database internals&lt;/h2&gt;
&lt;p&gt;GitHub 社が &lt;a href=&quot;https://github.blog/2022-08-29-gits-database-internals-i-packed-object-store/&quot;&gt;Git’s database internals&lt;/a&gt; という連載記事で Git の内部構造を解説していた。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;リポジトリのバージョン管理に必要なデータをどのように保存し取り出しているのか&lt;/li&gt;
&lt;li&gt;コミット履歴を効率的に保存し高速に探索するためにどのようなデータ構造を採用しているのか&lt;/li&gt;
&lt;li&gt;あるファイルが変更されていることをどのように検知しているのか&lt;/li&gt;
&lt;li&gt;ローカルとリモートの間でどのようにデータを同期しているのか&lt;/li&gt;
&lt;li&gt;巨大なリポジトリを管理するためにどのような工夫をしているのか&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;…などなど、自分が趣味や仕事で Git を使う中で日々「この辺ってどうなってるんだろうな」という疑問の大部分を一度に解消してくれる素晴らしい記事だった。まとめ記事も書いたのでご興味のある方はぜひ。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://zenn.dev/username/articles/2022-09-19-8118755d3cd9291907ee&quot;&gt;https://zenn.dev/username/articles/2022-09-19-8118755d3cd9291907ee&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Fastly と Cloudflare の財務数値比較メモ]]></title><description><![CDATA[これは Fastly と Cloudflare の財務諸表を読んで数字を比較するだけの記事です。機能や仕様については一切触れません。 金額や数量は 1M = 1,000,000, 1K = 1,00…]]></description><link>https://lyohe.github.io/2022-08-26-fastly-cloudflare-accounting/</link><guid isPermaLink="false">https://lyohe.github.io/2022-08-26-fastly-cloudflare-accounting/</guid><pubDate>Fri, 26 Aug 2022 14:01:31 GMT</pubDate><content:encoded>&lt;p&gt;これは &lt;a href=&quot;https://www.fastly.com/&quot;&gt;Fastly&lt;/a&gt; と &lt;a href=&quot;https://www.cloudflare.com/&quot;&gt;Cloudflare&lt;/a&gt; の財務諸表を読んで数字を比較する&lt;strong&gt;だけ&lt;/strong&gt;の記事です。機能や仕様については&lt;strong&gt;一切触れません&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;金額や数量は 1M = 1,000,000, 1K = 1,000 と表記します。私は財務の専門家ではないので記述に誤りがあったらすみません。&lt;/p&gt;
&lt;h2 id=&quot;情報源&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%83%85%E5%A0%B1%E6%BA%90&quot; aria-label=&quot;情報源 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;情報源&lt;/h2&gt;
&lt;h3 id=&quot;fastly&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#fastly&quot; aria-label=&quot;fastly permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Fastly&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://cloudflare.net/financials/sec-filings/sec-filings-details/default.aspx?FilingId=15620186&quot;&gt;Form 10-K FY2021/12&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://cloudflare.net/financials/sec-filings/sec-filings-details/default.aspx?FilingId=15993242&quot;&gt;Form 10-Q FY2022/12 Q2&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://investors.fastly.com/files/doc_financials/2022/q2/FSLY_Corrected_Transcript-(1).pdf&quot;&gt;Fastly Q2 2022 Earnings Call Transcript&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;cloudflare&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#cloudflare&quot; aria-label=&quot;cloudflare permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Cloudflare&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://investors.fastly.com/financials/sec-filings/sec-filings-details/default.aspx?FilingId=15621389&quot;&gt;Form 10-K FY2021/12&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://investors.fastly.com/financials/sec-filings/sec-filings-details/default.aspx?FilingId=15994503&quot;&gt;Form 10-Q FY2022/12 Q2&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://cloudflare.net/files/doc_downloads/Presentations/2022/05/Cloudflare-Investor-Day-2022-%5BPublished-Deck%5D-FINAL.pdf&quot;&gt;Cloudflare Investor Day 2022 - CFO Session Slides&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://cloudflare.net/files/doc_financials/2022/q2/Q2-2022-Investor-Presentation.pdf&quot;&gt;Cloudflare Q2 2022 Investor Presentation&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://cloudflare.net/files/doc_financials/2022/q2/CORRECTED-TRANSCRIPT_-Cloudflare-Inc.(NET-US)-Q2-2022-Earnings-Call-4-August-2022-5_00-PM-ET.pdf&quot;&gt;Cloudflare Q2 2022 Earnings Call Transcript&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;最近の決算概要&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%9C%80%E8%BF%91%E3%81%AE%E6%B1%BA%E7%AE%97%E6%A6%82%E8%A6%81&quot; aria-label=&quot;最近の決算概要 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;最近の決算概要&lt;/h2&gt;
&lt;p&gt;両社の最近の決算から損益、財政状態、キャッシュ・フローの状況を比較する。&lt;/p&gt;
&lt;h3 id=&quot;損益&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%90%8D%E7%9B%8A&quot; aria-label=&quot;損益 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;損益&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;FY2021/12 の売上と当期純損失&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Fastly:
&lt;ul&gt;
&lt;li&gt;売上: $354M - YoY +21.8%&lt;/li&gt;
&lt;li&gt;損失: $(222M)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Cloudflare:
&lt;ul&gt;
&lt;li&gt;売上: $656M - YoY +52.3%&lt;/li&gt;
&lt;li&gt;損失: $(260M)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;FY2022/12 Q2 （2022年1月 ~ 6月）の売上と当期純損失&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Fastly:
&lt;ul&gt;
&lt;li&gt;売上: $204M - YoY +20.6%&lt;/li&gt;
&lt;li&gt;損失: $(80M)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Cloudflare:
&lt;ul&gt;
&lt;li&gt;売上: $446M - YoY +53.8%&lt;/li&gt;
&lt;li&gt;損失: $(104M)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;どちらも成長しているが、特に Cloudflare の成長率が高い。&lt;/p&gt;
&lt;p&gt;Cloudflare は FY2016 - FY2021 の6年間で年平均 +51% の驚異的な成長を続けている。特に年間利用料 $100K 以上の大口顧客への売上が伸びていて、 FY2018 では $62M だったのが FY2022 には $492M となる見込み（冒頭の Cloudflare Investor Day 2022 CFO Session Slides を参照）。&lt;/p&gt;
&lt;h4 id=&quot;dollar-based-net-retention-rate&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#dollar-based-net-retention-rate&quot; aria-label=&quot;dollar based net retention rate permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Dollar-based Net Retention Rate&lt;/h4&gt;
&lt;p&gt;これらの売上の差はどこから生じているのか確かめるために、既存顧客からの売上増加率について比較してみる。両社で定義が異なるのだが、参考までに。&lt;/p&gt;
&lt;p&gt;Fastly は前年同月に有料顧客だった顧客の売上を決算月と比較して算出しており、Cloudflare は決算期の4四半期前時点で有料顧客だった顧客の売上を四半期で比較して算出している。両社ともその年にお金を払い初めた新規有料顧客を含まず、前年同期の顧客による解約を含んでいる。&lt;/p&gt;
&lt;p&gt;つまり、その年に新規顧客が増えても Retention Rate には加算されないが、既存顧客に解約されれば Retention Rate は減る。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;FY2021/12 の Net Retention&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Fastly: 106.6%&lt;/li&gt;
&lt;li&gt;Cloudflare: 125%&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;FY2022/12 Q2 の Net Retention&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Fastly: 127.5%&lt;/li&gt;
&lt;li&gt;Cloudflare: 126%&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Fastly と Cloudflare の売上成長率には大きな差があるが、FY2021 では Net Retention に大きな差がありこれがそのまま成長率に影響していそうに見える。しかし、Fastly は LTM NRR という12ヶ月間同士で算出した NRR も開示しているが、これは FY2021/12 で 117.6% とそれ程凹んでんでいないので、たまたま2021年12月に既存顧客の利用料が伸び悩んだのかもしれない。解約率は 1% 未満とのことだが、 Fastly は大口顧客への依存度が高いので解約の影響もあるかもしれない。&lt;/p&gt;
&lt;p&gt;Fastly の FY2021 の LTM NRR や両社の FY2022/Q2 の Net Retention を見る限りでは既存顧客からの売上増加率に大きな差は見受けられないので、実質的には新規顧客からの売上によって成長率に大きな差が生じていると言えそう。&lt;/p&gt;
&lt;h3 id=&quot;財政状態&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%B2%A1%E6%94%BF%E7%8A%B6%E6%85%8B&quot; aria-label=&quot;財政状態 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;財政状態&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;FY2021/12 の総資産&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Fastly: $2,159M&lt;/li&gt;
&lt;li&gt;Cloudflare: $2,372M&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;FY2022/12 Q2 の総資産&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Fastly: $1,932M&lt;/li&gt;
&lt;li&gt;Cloudflare: $2,468M&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Fastly は&lt;a href=&quot;https://lyohe.github.io/2021-07-11-fastly-2/&quot;&gt;以前の記事&lt;/a&gt;で取り上げたように大規模な買収を行っており Goodwill（のれん）が資産の3割ほどを占めている。一方の Cloudflare の資産は9割が現預金や短期売買目的の証券で買収は行っておらず、非常に単純な BS になっている。&lt;/p&gt;
&lt;p&gt;Fastly は FY2021 → FY2022/Q2 で総資産が減っているが、これは固定資産として計上していた証券 $243M を売却したため。&lt;/p&gt;
&lt;h3 id=&quot;営業キャッシュフロー&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%96%B6%E6%A5%AD%E3%82%AD%E3%83%A3%E3%83%83%E3%82%B7%E3%83%A5%E3%83%95%E3%83%AD%E3%83%BC&quot; aria-label=&quot;営業キャッシュフロー permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;営業キャッシュ・フロー&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;FY2021/12 の営業キャッシュ・フロー&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Fastly: $(38M)&lt;/li&gt;
&lt;li&gt;Cloudflare: $64M&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;FY2022/12 Q2 の営業キャッシュ・フロー&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Fastly: $(29M)&lt;/li&gt;
&lt;li&gt;Cloudflare: $2M&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;FY2021 の損益で Fastly は $(222M)、 Cloudflare は $(260M) の赤字を計上しているが、営業キャッシュ・フローはそれほど大きなマイナスにはなっていない。これは両社とも減価償却や株式報酬などキャッシュアウトしない費用が多いため。株式報酬については後述する。&lt;/p&gt;
&lt;h2 id=&quot;convertible-notes-での資金調達&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#convertible-notes-%E3%81%A7%E3%81%AE%E8%B3%87%E9%87%91%E8%AA%BF%E9%81%94&quot; aria-label=&quot;convertible notes での資金調達 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Convertible Notes での資金調達&lt;/h2&gt;
&lt;p&gt;資金調達に関しては、両社とも Convertible Notes つまり転換社債を利用している。&lt;/p&gt;
&lt;p&gt;両社の投資キャッシュ・フローを見ると、短期で売買目的の証券をやりくりしてるだけで大きな動きはない。Fastly は&lt;a href=&quot;https://lyohe.github.io/2021-07-11-fastly-2/&quot;&gt;以前の記事&lt;/a&gt;で取り上げた通り FY2020 に Signal Sciences を買収しており、 $200M の現金を支出している（残り $550M は Fastly の普通株式）。&lt;/p&gt;
&lt;p&gt;財務キャッシュ・フローを見ると FY2021 に Fastly は $930M を、Cloudflare は $1,293M を転換社債で調達している。私は財務の専門家ではないのだが、米国の急成長中のテック企業は特に上場後に株式より転換社債で調達する方が多い気がする。&lt;/p&gt;
&lt;p&gt;転換社債は債権として額面で償還を受けることができ、株価が転換価格より上昇すればその分だけ時価も上がる。また、株価のボラティリティ等の状況にもよるが利息がつくこともある。投資家からすると、株価下落のリスクを抑えつつ株価が上昇したり利息があればその分だけ利益を得ることができるというメリットがある。当然デフォルトのリスクはある。&lt;/p&gt;
&lt;p&gt;一方で、発行体である会社からすると転換価格を現状の株価より高い水準に設定することができ、実質的に&lt;strong&gt;将来の企業価値で現在の資金を調達する&lt;/strong&gt;のと同等の効果を得られる。もちろん転換価格が高過ぎて投資家にとって現実的でなければ転換オプションの価値は無いので、利息など魅力的な条件がついてなければ誰も買ってくれないだろう。また、株価が下落すれば転換はされないので、その場合は実質的にただの借入となる。&lt;/p&gt;
&lt;p&gt;成長中の会社はお金があれば成長に投資するため基本的に赤字決算が続くので、金融機関から借入をする場合はリスクに見合った高い金利を負担しなければならない。そのリスクとリターンを投資家と分け合いながら成長に必要な資金を調達できるのが転換社債のメリットと言える。&lt;/p&gt;
&lt;p&gt;これだけ見るととても便利で何故日本のベンチャーやスタートアップと呼ばれる会社で流行ってないのか分からないのだが、自分の知らないところで流行ってるだけかもしれない。&lt;/p&gt;
&lt;h2 id=&quot;株式報酬-stock-based-compensation&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%A0%AA%E5%BC%8F%E5%A0%B1%E9%85%AC-stock-based-compensation&quot; aria-label=&quot;株式報酬 stock based compensation permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;株式報酬 Stock-based Compensation&lt;/h2&gt;
&lt;p&gt;両社とも共通して多大な株式報酬を役員や従業員に支払っている。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;FY2021/12 の株式報酬&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Fastly: $140M&lt;/li&gt;
&lt;li&gt;Cloudflare: $90M&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;FY2022/12 Q2 の株式報酬&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Fastly: $75M&lt;/li&gt;
&lt;li&gt;Cloudflare: $88M&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Fastly は販管費の約3割、 Cloudflare では約2割を株式報酬が占めている。これは会計上では費用として計上されるが現金支出を伴わないため、キャッシュ・フロー️計算書上はプラスの効果がある。報酬の受け取り側からするとボーナスをもらってそのお金で会社の株を買うのと同じ影響がある。この株式には一般的に譲渡制限が付けられていて、税制にもよるが基本的にはその譲渡制限が解除された時点の時価で所得税が計算される。&lt;/p&gt;
&lt;p&gt;RSU 等の株式報酬を活用することで、優秀な人間を高い報酬で雇いつつ現金支出を減らすことができ、その分だけ資金を別の成長投資に注ぎ込むことができる。当然だが株価が下落傾向にあればその分だけ報酬の魅力は薄れるので、いいことばかりではない。&lt;/p&gt;
&lt;h3 id=&quot;従業員数&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%BE%93%E6%A5%AD%E5%93%A1%E6%95%B0&quot; aria-label=&quot;従業員数 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;従業員数&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;FY2021 末時点の従業員数&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Fastly: 976 人（うち 188 人が米国外）&lt;/li&gt;
&lt;li&gt;Cloudflare: 2,440 人（うち 975 人が米国外）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;従業員1人あたりの株式報酬について。&lt;/p&gt;
&lt;p&gt;Fastly は2021年12月末時点の従業員が 976 人であり、前述の通りこの年の株式報酬だけで $140M を支払っているので単純に一人当たりに換算すると日本円で平均 2,000 万円程度になる。もちろん全員がこれだけ貰えるということではなく、決算を見ると Cost of revenue として計上されるカスタマーサポートやインフラの管理人員の方々はほとんど貰えていないようだ（人数が少ない可能性もある）。&lt;/p&gt;
&lt;p&gt;FY2021 の Fastly の原価、販管費の内訳は次の通り。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Cost of revenue: $167M&lt;/li&gt;
&lt;li&gt;Research and development: $126M&lt;/li&gt;
&lt;li&gt;Sales and marketing: $152M&lt;/li&gt;
&lt;li&gt;General and administrative: $126M&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;株式報酬の内訳は次の通り。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Cost of revenue: $7M&lt;/li&gt;
&lt;li&gt;Research and development: $47M&lt;/li&gt;
&lt;li&gt;Sales and marketing: $31M&lt;/li&gt;
&lt;li&gt;General and administrative: $55M&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;それぞれに含まれる人件費は次の通り。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Cost of revenue: サーバーやネットワーク機器の調査・設計・配備・保守を行うインフラチーム、顧客向けの技術サポートを行うカスタマーサポート&lt;/li&gt;
&lt;li&gt;Research and development: エッジクラウドプラットフォームの設計・開発・信頼性担保に責任を負う開発者&lt;/li&gt;
&lt;li&gt;Sales and marketing: 営業とマーケティングのチーム&lt;/li&gt;
&lt;li&gt;General and administrative: 経理や法務、人事など管理部門 + 役員&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Research and development の費用に属する人員の数だけ公開されている（321名）。&lt;/p&gt;
&lt;h2 id=&quot;株価が会社に与える影響&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%A0%AA%E4%BE%A1%E3%81%8C%E4%BC%9A%E7%A4%BE%E3%81%AB%E4%B8%8E%E3%81%88%E3%82%8B%E5%BD%B1%E9%9F%BF&quot; aria-label=&quot;株価が会社に与える影響 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;株価が会社に与える影響&lt;/h2&gt;
&lt;p&gt;役員や従業員に株式で多額の報酬を支払っている場合、株価の上昇や下落が彼らに大きな影響を与えることになる。&lt;/p&gt;
&lt;p&gt;株式報酬にも様々な形があるが、一般的な RSU なら譲渡制限が解除された時点で給与所得として課税されるため解除後に株価が下落すると「キャピタルゲインをほぼ得られないのに税金をたくさん払わなければならない」という状況が生まれる可能性がある。一方で株価が上昇していけば所得が多いほど（税制にもよるが）給与所得より株式譲渡所得の方が税率が低いので、多大なキャピタルゲインを得つつ同額の給与所得より課税を抑えることができる。&lt;/p&gt;
&lt;p&gt;また、株価の上昇や下落は資金調達にも大きく影響する。&lt;/p&gt;
&lt;p&gt;転換社債であれば、株価が上昇していれば実質的に未来の企業価値で資金を調達できるので、より希薄化を抑えつつ成長に投資できる。また、新たに転換社債で資金を調達する際も転換価格や利息などの条件を会社や既存株主の側に有利に設定することもできる。一方で、株価が下落していけばより魅力的な条件をつけないと誰も社債を買ってくれないだろう。新株発行して調達しようにも既存株主はより大きな希薄化を受け入れなければならなくなる。&lt;/p&gt;
&lt;p&gt;このように会社が報酬や資金調達において株価に大きく依存している場合、株価が中長期的に下落する傾向に入ると成長のエンジンが失われてしまうので経営陣の刷新やレイオフ、IR 等で早めに市場に対してアピールしつつ成長の見込みや実績を出していくことが重要になると考えられる。&lt;/p&gt;
&lt;h2 id=&quot;客層の違い&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%AE%A2%E5%B1%A4%E3%81%AE%E9%81%95%E3%81%84&quot; aria-label=&quot;客層の違い permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;客層の違い&lt;/h2&gt;
&lt;h3 id=&quot;ar-annualized-revenue--100kの顧客数と売上&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#ar-annualized-revenue--100k%E3%81%AE%E9%A1%A7%E5%AE%A2%E6%95%B0%E3%81%A8%E5%A3%B2%E4%B8%8A&quot; aria-label=&quot;ar annualized revenue  100kの顧客数と売上 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;AR: Annualized Revenue &gt; $100K　の顧客数と売上&lt;/h3&gt;
&lt;p&gt;両社で定義が異なるので単純に比較はできないのだが、参考までに。&lt;/p&gt;
&lt;p&gt;Fastly では過去12ヶ月の売上が $100K を超えている顧客を、Cloudflare では顧客ごとに直近四半期の売上を4倍して $100K を超えている顧客を数えている。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;FY2021/12 の AR &gt; $100K の顧客数&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Fastly: 445社 - YoY +18%&lt;/li&gt;
&lt;li&gt;Cloudflare: 1,416社 - YoY +71%&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;FY2021/12 の AR &gt; $100K の顧客からの売上&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Fastly: $313M - 売上全体の 88%&lt;/li&gt;
&lt;li&gt;Cloudflare: $353M - 売上全体の 54%&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;FY2022/12 Q2 時点の AR &gt; $100K の顧客数&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Fastly: 471社 - YoY +15%&lt;/li&gt;
&lt;li&gt;Cloudflare: 1,749社 - YoY +61%&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;FY2022/12 Q2 時点の AR &gt; $100K の顧客からの売上&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Fastly: $182M - 売上全体の 89%&lt;/li&gt;
&lt;li&gt;Cloudflare: 開示なし？ CEO の発言によれば 60% 近くとのこと&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Fastly は AR &gt; $100K の顧客からの売上が全体の9割近くを占めている。FY2021 では上位10社の売上が全体の 33% 、FY2022/Q2 では 34% を占め、（おそらく Salesforce や PayPal などの）大口顧客への依存度が非常に高い。Q2 の Earnings Call によれば AR &gt; $100K の顧客は平均して $730K を支出しているそうだ。一方の Cloudflare は上位100社で全体の 29% なので、Fastly と比べると分散している。Cloudflare は無料枠がたくさんあるので小口の利用でも始めやすいという事情もあるのかもしれない。&lt;/p&gt;
&lt;p&gt;しかし、 Cloudflare は近年急速に AR &gt; $100K の顧客数及び売上に占める割合が増加している。FY2022/12 Q2 については Earnings Call の Transcript を見たところ CEO が次のような発言をしており、FY2021 の 54% からさらに上昇しているようだ。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;We added a record 212 new large customers, those paying us more than $100,000 per year and now have 1,749 customers over this threshold. These large customers now represent 60% of our revenue, up from 50% six quarters ago. This trend illustrates how large, established enterprises increasingly formed the foundation of Cloudflare’s business. In fact, today, 29% of the Fortune 1000 are already paying Cloudflare customers, a nearly threefold increase over when we went public less than three years ago.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;どの地域で売れているか&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%81%A9%E3%81%AE%E5%9C%B0%E5%9F%9F%E3%81%A7%E5%A3%B2%E3%82%8C%E3%81%A6%E3%81%84%E3%82%8B%E3%81%8B&quot; aria-label=&quot;どの地域で売れているか permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;どの地域で売れているか&lt;/h3&gt;
&lt;p&gt;（）内は売上全体に占めるその地域の割合&lt;/p&gt;
&lt;p&gt;FY2021/12&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;region&lt;/th&gt;
&lt;th align=&quot;left&quot;&gt;Fastly&lt;/th&gt;
&lt;th align=&quot;left&quot;&gt;Cloudflare&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;United States&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;$ 260 M (74%)&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;$ 342 M (52%)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Asia Pacific&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;$ 39 M (11%)&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;$ 96 M (15%)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Europe&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;$ 35 M (10%)&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;$ 172 M (26%)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;All other countries&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;$ 19 M (5%)&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;$ 45 M (7%)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Total revenue&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;$ 354 M&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;$ 656 M&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;FY2022/12 Q2&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;region&lt;/th&gt;
&lt;th align=&quot;left&quot;&gt;Fastly&lt;/th&gt;
&lt;th align=&quot;left&quot;&gt;Cloudflare&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;United States&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;$ 151 M (74%)&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;$ 235 M (53%)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Asia Pacific&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;$ 24 M (12%)&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;$ 62 M (14%)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Europe&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;$ 18 M (9%)&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;$ 116 M (26%)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;All other countries&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;$ 10 M (5%)&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;$ 31 M (7%)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Total revenue&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;$ 204 M&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;$ 446 M&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Fastly と比べて Cloudflare はヨーロッパの売上割合が高く、全体の 1/4 を占めている。&lt;/p&gt;
&lt;p&gt;Asia Pacific ではどちらも伸び悩んでいるようだ。Fastly は FY2020 に Asia Pacific での売上が $44M だったのが FY2021 では $39M に減少しており、 Cloudflare は売上こそ伸びているが売上全体に占める構成比は FY2019 の 19% から FY2021 では 15% に下落している。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[プロを目指す人のための TypeScript 入門を読んだ話]]></title><description><![CDATA[「プロを目指す人のための TypeScript 入門　安全なコードの書き方から高度な型の使い方まで」、通称ブルーベリー本を読んだので読書メモを書いておく。 https://www.amazon.co.jp/dp/B09Y527YPV…]]></description><link>https://lyohe.github.io/2022-08-20-typescript-pro/</link><guid isPermaLink="false">https://lyohe.github.io/2022-08-20-typescript-pro/</guid><pubDate>Sat, 20 Aug 2022 00:01:31 GMT</pubDate><content:encoded>&lt;p&gt;「プロを目指す人のための TypeScript 入門　安全なコードの書き方から高度な型の使い方まで」、通称ブルーベリー本を読んだので読書メモを書いておく。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.amazon.co.jp/dp/B09Y527YPV&quot;&gt;https://www.amazon.co.jp/dp/B09Y527YPV&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;読者である私自身の技術レベルは以下の通り。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;2020年からプログラミングを始めたので、最近の垢抜けた TypeScript/JavaScript しか知らない&lt;/li&gt;
&lt;li&gt;2年くらい仕事で React/Node.js を使っており TypeScript を書いている&lt;/li&gt;
&lt;li&gt;型の表現に自信がないので、自分ではあまり複雑な型を書かない&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;入門とはいえ分厚い本なので全てを紹介することはできず、自分の印象に残った箇所に止める。&lt;/p&gt;
&lt;h2 id=&quot;この本の位置付け&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%81%93%E3%81%AE%E6%9C%AC%E3%81%AE%E4%BD%8D%E7%BD%AE%E4%BB%98%E3%81%91&quot; aria-label=&quot;この本の位置付け permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;この本の位置付け&lt;/h2&gt;
&lt;p&gt;TypeScript（や React, Node.js）で実践的なアプリケーションを作ろう！という書籍&lt;strong&gt;ではなく&lt;/strong&gt;、その仕様や使い方を詳細に紹介する書籍。&lt;/p&gt;
&lt;p&gt;基本的な文法の解説もされているが、プログラミング初学者が読む本ではないと思う。というのも、この本が提供する「TypeScript を使って型安全なプログラムを書くにはどうしたらいいか」という情報そのものが初学者にとって興味が湧かないと考えられるためだ（初学者であっても型安全の恩恵は受けるに違いないのだが）。&lt;/p&gt;
&lt;p&gt;一方で、仕事や趣味である程度 TypeScript を書いており「何となく動いてるけどこれ裏側ではどうなってるのかな」と気になっている人、「TypeScript でより型安全なプログラムを書きたい」と思ってる人、もしくは JavaScript を書いており「TypeScript ってどういう言語なのか知りたい」という人に非常に役に立つ本であることは間違いない。&lt;/p&gt;
&lt;p&gt;JavaScript を読み書きしたことがない人はまず &lt;a href=&quot;https://jsprimer.net/&quot;&gt;JavaScript Primer&lt;/a&gt; などを読んでからこの本を読んだ方が良い。&lt;/p&gt;
&lt;p&gt;6章を中心に TypeScript の特徴である型システムで高度な型を表現する方法を紹介している。「プロを目指す人のための〜」というタイトルにふさわしい。&lt;/p&gt;
&lt;h2 id=&quot;第1章-イントロダクション&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%AC%AC1%E7%AB%A0-%E3%82%A4%E3%83%B3%E3%83%88%E3%83%AD%E3%83%80%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3&quot; aria-label=&quot;第1章 イントロダクション permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;第1章: イントロダクション&lt;/h2&gt;
&lt;p&gt;TypeScript の特徴や歴史の紹介、開発環境の整備。&lt;/p&gt;
&lt;p&gt;TypeScript の型システムを利用することで、型チェックによるコンパイルエラー、ソースコードのドキュメント化、エディタや IDE による入力補完など様々なメリットを享受することができる。&lt;/p&gt;
&lt;p&gt;TypeScript コンパイラは型チェックによりソースコードの文面から静的にプログラマの型注釈との矛盾をチェックし、JavaScript へトランスパイルする。静的チェックによりエディタや IDE での開発中に簡単にミスを発見し修正することができる。&lt;/p&gt;
&lt;p&gt;JavaScript には静的な型チェックはなく、ランタイムの挙動は型情報に依存しない。JavaScript へのトランスパイルでは基本的に型情報を取り除く（後は一部の新しい構文を古い構文に変換する）だけで、プログラムの挙動は型によって変わることはない。つまり、ある程度 JavaScript の経験があるプログラマーにとっては型の扱いを覚えるだけでよいため非常に使いやすい言語となっている。&lt;/p&gt;
&lt;p&gt;Node.js をインストールして簡単な環境設定（tsconfig）をする箇所については、tsconfig 自体が膨大なオプションがあり初学者にわかりづらい中で簡単な説明と後で詳しく解説する箇所へのリファレンスがついていて素晴らしかった。&lt;/p&gt;
&lt;h2 id=&quot;第2章--第5章&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%AC%AC2%E7%AB%A0--%E7%AC%AC5%E7%AB%A0&quot; aria-label=&quot;第2章  第5章 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;第2章 ~ 第5章&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;第2章: 基本的な文法・基本的な型&lt;/li&gt;
&lt;li&gt;第3章: オブジェクトの基本とオブジェクトの型&lt;/li&gt;
&lt;li&gt;第4章: TypeScript の関数&lt;/li&gt;
&lt;li&gt;第5章: TypeScript のクラス&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;TypeScript の文法や型、オブジェクト、関数、クラスなど基本的な知識に関する章。&lt;/p&gt;
&lt;p&gt;既に仕事や趣味で TypeScript を書いていればこれらの章に書いてあることは基本的に日常のプログラミングで使っているので、退屈な章に見えるかもしれない。しかし、新たな再発見があるかもしれないし第6章の高度な型の前提となる知識でもあるので読み飛ばさず、ささっと読んでみることをおすすめしたい。&lt;/p&gt;
&lt;p&gt;例えば自分の場合、第3章の computed property name （オブジェクトのプロパティ名を動的に決めるための構文）については全く知らなかった。他にもこんな機能があったのか！という記述がそこかしこにあり、自分の知識の欠けていた箇所を見つけ出すことができた。&lt;/p&gt;
&lt;p&gt;「4.2.3 返り値の型注釈は省略すべきか」という項も面白かった。TypeScript では型推論によって関数の返り値を調べており、もし返り値の型が代入先と合わない（例えば &lt;code class=&quot;language-text&quot;&gt;number[]&lt;/code&gt; を返さなければいけないのに何も返してなかった）時には当然コンパイルエラーを出してくれる。しかし、関数の返り値の型注釈を書いていれば関数内部でコンパイルエラーを出すことができるのに対し、書かない場合は関数を呼び出して結果を使う側でコンパイルエラーが出る。基本的には関数の返り値の型注釈を書く方がエラーを発見しやすくなるので望ましいだろう。&lt;/p&gt;
&lt;p&gt;このように、TypeScript における型注釈には「開発者による真実の源としての型の表明」という意図を表している。つまり、型を明示しないということは呼び出し側が型や実行時の動作に責任を持つことを意味する。型注釈や型定義を書くときはプログラムの構造における真実の源をどこに置くべきか考えながら書くのが良さそうだ。&lt;/p&gt;
&lt;p&gt;型以外にも式と文の違いなど、普段プログラミングをする上ではあまり意識しない（？）ような前提となる事柄も丹念に説明されており、「プロを目指す人のための〜」というタイトルを思い起こさせる。「プロ」という言葉をどう捉えるかはその人次第だが、自分は「基礎から応用まで幅広い知識を持ち状況に応じて問題を解決するための最適な選択肢を導き出せる人」だと考えているので、この本に垣間見える用語の正確さへのこだわりであったり基礎的な部分を疎かにしない姿勢にはプロを感じる。&lt;/p&gt;
&lt;p&gt;プログラマー歴2年かそこらの自分が偉そうに語れる話でもないのだが…&lt;/p&gt;
&lt;h2 id=&quot;第6章-高度な型&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%AC%AC6%E7%AB%A0-%E9%AB%98%E5%BA%A6%E3%81%AA%E5%9E%8B&quot; aria-label=&quot;第6章 高度な型 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;第6章: 高度な型&lt;/h2&gt;
&lt;p&gt;この本で最も重要な章かもしれない。ユニオン型とインターセクション型、リテラル型、代数的データ型などの解説。&lt;/p&gt;
&lt;p&gt;関数のオプショナルチェイニング（&lt;code class=&quot;language-text&quot;&gt;getTimeFunc?.()&lt;/code&gt; のような書き方）が紹介されてたのだが、これできるの初めて知った（変数でしか使ったことなかった）。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;keyof&lt;/code&gt; や &lt;code class=&quot;language-text&quot;&gt;typeof&lt;/code&gt; を使った型レベルの計算はなかなか面白い。TypeScript 以外の言語ではあまり見たことない気がする（あったらすみません）。これによって型の表現力が大きく高まっているように見える。&lt;/p&gt;
&lt;p&gt;オブジェクトにリテラル型の tag プロパティを用意して扱うデータの形と可能性を型として正確に表現する、そしてそれを使って if や switch 文で型の絞り込みを行うという方法は便利そうなので覚えておきたい。&lt;/p&gt;
&lt;p&gt;型アサーション（&lt;code class=&quot;language-text&quot;&gt;as&lt;/code&gt; で型を上書きするやつ）はランタイムエラーを引き起こす可能性があるのでなるべく使わない。使う場合は不正確な型を正しく直すために使うべきである（つまり、TypeScript の型推論を補助するために使うべきで刃向かうために使うべきではない）。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;any&lt;/code&gt; 型は型安全性を破壊するので避けるべき。型チェックが行われないのでコンパイルで発見できたはずのエラーもランタイムエラーとなり、 TypeScript を使う意味が薄れてしまう。依存先が JavaScript から TypeScript に移行中で any を使っていたのが型を付けるようになりその型を使わないとコンパイルで引っかかるという落とし穴もあるので迷惑な存在だが、これによって TypeScript への移行が早まったという背景もあると思うので必要悪的な存在なのかもしれない。&lt;/p&gt;
&lt;p&gt;ユーザー定義型ガードや型アサーションも同様だが、TypeScript が提供する型安全性を犠牲にしてプログラマの責任とすることを十分に意識すべき。&lt;/p&gt;
&lt;h2 id=&quot;第7章-typescript-のモジュールシステム&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%AC%AC7%E7%AB%A0-typescript-%E3%81%AE%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0&quot; aria-label=&quot;第7章 typescript のモジュールシステム permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;第7章: TypeScript のモジュールシステム&lt;/h2&gt;
&lt;p&gt;Import / export でデータや関数を受け渡す方法について。&lt;/p&gt;
&lt;p&gt;簡単な変数や関数、型の export から始めて、モジュール間でデータや関数を受け渡す方法が解説されている。&lt;/p&gt;
&lt;p&gt;Default export 使わない理由（明確な名前がないので補完が働かない）というのは確かになと思った（私も基本的に使わないのだが）。&lt;/p&gt;
&lt;p&gt;スクリプトとモジュールの違い、ES Modules と CommonJS Modules の違いなど、普段意識しないところまで書かれていてありがたい。特に ES Modules は最近会社のプロジェクトの依存関係を更新していて詰まることが多かったので個人的にタイムリーな話題だった。具体的には今まで CommonJS だったモジュールがあるバージョンから ESM only になるとか。&lt;/p&gt;
&lt;h2 id=&quot;第8章-非同期処理&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%AC%AC8%E7%AB%A0-%E9%9D%9E%E5%90%8C%E6%9C%9F%E5%87%A6%E7%90%86&quot; aria-label=&quot;第8章 非同期処理 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;第8章: 非同期処理&lt;/h2&gt;
&lt;p&gt;この章については JavaScript における非同期処理（通信など時間がかかったり、ファイルへの保存など I/O を伴うため即時に完了できない処理）を基本から説明している。&lt;/p&gt;
&lt;p&gt;Promise の理解があやしい人は &lt;a href=&quot;https://azu.github.io/promises-book/&quot;&gt;JavaScript Promise の本&lt;/a&gt; もあわせて読むのがおすすめ。&lt;/p&gt;
&lt;p&gt;TypeScript 特有の注意点として挙げられていたのが、 Promise 失敗時のコールバック関数に渡される引数 error の型が &lt;code class=&quot;language-text&quot;&gt;any&lt;/code&gt; となってしまい型システム上はどのようなエラーが生じるか明らかでないという仕様がある。なんで unknown じゃなくて any なんだろうと疑問だが、歴史的経緯によるものだそうだ。&lt;/p&gt;
&lt;p&gt;何でも入るという点では &lt;code class=&quot;language-text&quot;&gt;any&lt;/code&gt; と同じだができることが限られる（プロパティアクセスができなくなる） &lt;code class=&quot;language-text&quot;&gt;unknown&lt;/code&gt; 型を注釈に入れることで少しだけ安全になる。これも意識したことなかったけど型安全性を意識するなら可能な限り any を使うべきではないので覚えておきたい。&lt;/p&gt;
&lt;h2 id=&quot;第9章-typescript-のコンパイラオプション&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%AC%AC9%E7%AB%A0-typescript-%E3%81%AE%E3%82%B3%E3%83%B3%E3%83%91%E3%82%A4%E3%83%A9%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3&quot; aria-label=&quot;第9章 typescript のコンパイラオプション permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;第9章: TypeScript のコンパイラオプション&lt;/h2&gt;
&lt;p&gt;TypeScript のコンパイル時の挙動を制御するオプション（tsconfig.json）について。&lt;/p&gt;
&lt;p&gt;環境構築する際に package.json や tsconfig.json を書くのだが、基本的に他のプロジェクトやよくある設定のやつをコピペしてドキュメントを軽く読むだけであまり幅広いオプションを利用してこなかった。strict を絶対 true にするくらい。&lt;/p&gt;
&lt;p&gt;TypeScript の型チェックは後方互換性を重視しており、厳しいオプションは明示的に設定しなければ有効とならない。つまり、既存のプロジェクトからコピペすると（後方互換性を考えなくていいにも関わらず）古い書き方をそのまま使ってしまうので、コンパイラオプションが緩くなりがちになるなーと思った。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;noUncheckedIndexedAccess&lt;/code&gt;（インデックスシグネチャを通じたプロパティアクセスで得られる値を常に &lt;code class=&quot;language-text&quot;&gt;undefined&lt;/code&gt; とのユニオン型にする）と &lt;code class=&quot;language-text&quot;&gt;exactOptionalPropertyTypes&lt;/code&gt; （オプショナルプロパティに明示的に &lt;code class=&quot;language-text&quot;&gt;undefined&lt;/code&gt; を代入することができなくなる）についても知らなかった。&lt;/p&gt;
&lt;p&gt;コンパイラオプションを羅列して解説するというよりは、基本的な有効にすべきオプションの挙動の説明とコンパイラオプションの立ち位置を。後から厳しくするのは難しいので最初から厳しくしておくというのは良さそう。実際、コンパイルエラーをちゃんと出してくれた方が結果的に速く開発が進むため。&lt;/p&gt;
&lt;h2 id=&quot;感想&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%84%9F%E6%83%B3&quot; aria-label=&quot;感想 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;感想&lt;/h2&gt;
&lt;p&gt;この本を読んで TypeScript の型との向き合い方が変わったかもしれない。&lt;/p&gt;
&lt;p&gt;今まではプロジェクトの既存のコンパイラオプションや型定義、開発メンバーで定めたガイドラインに沿ってプログラムを書いていたが、積極的に新情報を調べたりより型安全なプログラムを書くための工夫を探求していこうと思った。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[PyCPA: 会計データ基盤の話]]></title><description><![CDATA[6月4日に PyCPA という勉強会で大規模サービスにおける会計データ基盤について話した。 https://pycpa.connpass.com/event/246420/ MAU 1,00…]]></description><link>https://lyohe.github.io/2022-08-12-accounting-data/</link><guid isPermaLink="false">https://lyohe.github.io/2022-08-12-accounting-data/</guid><pubDate>Fri, 12 Aug 2022 00:01:31 GMT</pubDate><content:encoded>&lt;p&gt;6月4日に PyCPA という勉強会で大規模サービスにおける会計データ基盤について話した。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://pycpa.connpass.com/event/246420/&quot;&gt;https://pycpa.connpass.com/event/246420/&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;MAU 1,000万人超の消費者向け大規模サービスにおいて、会計データの収集・集計を目的とした社内向けシステムの開発運用に携わった経験をもとに、会計データを処理するシステムに特有の課題、およびその解決方法の選択肢とトレードオフについてお話しします。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;人数の制限や当日の都合で参加できなかった方のために、話した内容とその背景、補足をここに書き残しておく。随分と時間が経ってしまってすみません。&lt;/p&gt;
&lt;p&gt;より詳しく聞きたいという方がいたらご連絡ください。&lt;/p&gt;
&lt;h2 id=&quot;概要&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%A6%82%E8%A6%81&quot; aria-label=&quot;概要 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;概要&lt;/h2&gt;
&lt;p&gt;複雑な「お金の動き」を伴うサービスを開発・運用するとき、それをどのような方法で正確・迅速に捕捉し財務会計や管理会計に必要なデータとして収集・保存・集計するべきかという課題がある。&lt;/p&gt;
&lt;p&gt;この課題を解決するための既製品がない場合、会計データ基盤を自社または外注で開発・運用することになる。このとき、資金や人員等の制約、サービスの置かれた状況に応じて様々な選択肢が考えられる。&lt;/p&gt;
&lt;p&gt;ここでいう「会計データ基盤」とは、弥生会計や freee、マネーフォワードのような財務会計システムではなく、それらに入力するための会計処理データを基幹システム等から収集・集計・保存・出力するシステムを指すものとする。会社によっては会計 I/F とか会計システムとか様々な名前で呼ばれているようだ。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/ead0dc8b888147a14db02abed0e6e341/afa26/overview.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 29.746835443037973%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAzElEQVQY022Qx4qFQBBF+///zK0gbnQhCoo5YdYaTkGJD6bhYvcNFXTyz1nXVdq2lXme9f08z/uFB13XyXmePzrH2eVLYty2TfZ9V/6+7xc0A+jfRga3LIsajuPQAtwJ2qR1XUvf9zKOozRNo5wVYQPL2gAujmPxfV/SNJUwDCVJEjUMw6CBqqpeLc9z5dAoEASBeJ4nURSpB87RvSgKnYBVAZ0QCZdlqYWyLFMfHBpNmZ6G+K/r0qxDMFgxW5kg00zT9DMZB8+3kP2yP6tl0D5mqECtAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;overview&quot;
        title=&quot;overview&quot;
        src=&quot;/static/ead0dc8b888147a14db02abed0e6e341/f058b/overview.png&quot;
        srcset=&quot;/static/ead0dc8b888147a14db02abed0e6e341/c26ae/overview.png 158w,
/static/ead0dc8b888147a14db02abed0e6e341/6bdcf/overview.png 315w,
/static/ead0dc8b888147a14db02abed0e6e341/f058b/overview.png 630w,
/static/ead0dc8b888147a14db02abed0e6e341/40601/overview.png 945w,
/static/ead0dc8b888147a14db02abed0e6e341/afa26/overview.png 1258w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;この記事では、私が大規模なフリマアプリを運営する会社で会計データ基盤の担当者として働いた経験をもとに、以下の三点について書く。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;会社が成長する過程でどのような会計データ基盤が作られたか&lt;/li&gt;
&lt;li&gt;それぞれの方法の pros/cons&lt;/li&gt;
&lt;li&gt;会計データ基盤を作る際の方針をどのように立てるのがよいか&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;なお、以下の点については触れない。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;購買に伴う請求書や立替経費など領収書のデータ化&lt;/li&gt;
&lt;li&gt;給与計算などに伴う人件費のデータ化&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;前提-フリマアプリの話&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%89%8D%E6%8F%90-%E3%83%95%E3%83%AA%E3%83%9E%E3%82%A2%E3%83%97%E3%83%AA%E3%81%AE%E8%A9%B1&quot; aria-label=&quot;前提 フリマアプリの話 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;前提: フリマアプリの話&lt;/h2&gt;
&lt;p&gt;勉強会当日はフリマアプリを題材として取り上げたが、ご存知ない方もいると思われるのでフリマアプリの主な商品とお金の流れについて書く。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/3807a7569a74cd6f5efe61fa2aac6cfe/1628f/flow.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 53.79746835443038%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABw0lEQVQoz12Ti66bMBBE+f+faaVK+Y5GTZvee9s8lEBIILzMwxi8p1qnSZpaWmRgZphZL5G1lvP5TJqmnJKE0+nE8Xhku9mw2e+plkv49pU0KVj/gPe3E6vVkjy/oktE9PKoSB/M8xzK69573DRhxzHU1PfYsqCpDUVhMe3AYIeACYK8rghr4XCA8xnGEZwDBbsJ5hkZx+B89X3FbveboW3A+4ARxTqHKP56hcuFSLwPL7R816H38Cw/TXStIctK8rym7yx+9iD+Jqx8Tdf3wUD0Ylv7gFDVkCQw2GcU5eY5xDEoV6FeXiPrPvRQV9e2/Hp7D/s0FZZLIY4F7wVrJ5qmwZiWafIBk2dCXd+4TVWzeb9xH4JJEvPp85fQ0stFgmhrhL4DYyaqqqRpWsbRazKcE5y7iW+3OxaLxaugjk9ZFKFvKmqMMAwSzmcYPMZ42tYHx8+AEqLXdU9V1mGEIvnv6G/6KiSkJ7ichcPBkWWOOB4xZg64cRS6To3IX859bCYdEwd2QLLLi+jdSRzvWa/XfHz8DCetrlVIW3MbRwnulBc56xkHj+0919Q9vnYHaMSyrMjznCzL6fvhn8gvP0lw+Ac+VVZ6UP2yRQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;flow&quot;
        title=&quot;flow&quot;
        src=&quot;/static/3807a7569a74cd6f5efe61fa2aac6cfe/f058b/flow.png&quot;
        srcset=&quot;/static/3807a7569a74cd6f5efe61fa2aac6cfe/c26ae/flow.png 158w,
/static/3807a7569a74cd6f5efe61fa2aac6cfe/6bdcf/flow.png 315w,
/static/3807a7569a74cd6f5efe61fa2aac6cfe/f058b/flow.png 630w,
/static/3807a7569a74cd6f5efe61fa2aac6cfe/40601/flow.png 945w,
/static/3807a7569a74cd6f5efe61fa2aac6cfe/1628f/flow.png 1232w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;取引は次のような順序で進む。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;出品者の商品が購入される&lt;/li&gt;
&lt;li&gt;購入代金がクレジットカードほか様々な決済手段を通じて支払われる&lt;/li&gt;
&lt;li&gt;決済代行会社を通じて支払われたことが確認される。この資金は決済代行手数料を控除され、予め決められたサイクルで入金される&lt;/li&gt;
&lt;li&gt;フリマアプリが出品者に商品の配送を依頼し、出品者は自身が選択した方法で配送手続を行う&lt;/li&gt;
&lt;li&gt;配送会社によって商品が購入者に届けられる&lt;/li&gt;
&lt;li&gt;購入者が商品を受け取った旨をアプリを介して出品者に通知する。その後、購入者と出品者がお互いを評価して取引が完了し、出品者は売上金を受け取る。このとき一定の販売手数料が控除される。アプリに組み込まれた配送手段で配送依頼した場合は、配送料も控除される&lt;/li&gt;
&lt;li&gt;配送会社に配送代金を支払う&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;実際には決済代行会社や配送会社との取引条件は場合によって異なるので正確に上記の順序通り進む訳ではないが、大まかに説明するとこのような商流となる。&lt;/p&gt;
&lt;p&gt;なお、取引の過程で何らかのイレギュラーな事象が発生する場合もある。例えば、取引が途中でキャンセルされたり、配送途中で商品が破損したり、決済が不正に行われチャージバックされた等の理由から、通常の商流とは異なるお金の流れが発生することがある。一日数十万件の取引が行われていると、必ずどこかしらでイレギュラーが発生している。&lt;/p&gt;
&lt;p&gt;正常な流れ、イレギュラーな流れのそれぞれに対して会計処理が必要となるので、その証拠となる元データを収集し保存しなければならない。&lt;/p&gt;
&lt;p&gt;もし読者が全く異なる事業を営む会社で働いていたとしても、自社のお金の流れを想像しながら適宜読みかえていただけるとありがたい。&lt;/p&gt;
&lt;h3 id=&quot;お金の動きを整理するときのコツ&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%81%8A%E9%87%91%E3%81%AE%E5%8B%95%E3%81%8D%E3%82%92%E6%95%B4%E7%90%86%E3%81%99%E3%82%8B%E3%81%A8%E3%81%8D%E3%81%AE%E3%82%B3%E3%83%84&quot; aria-label=&quot;お金の動きを整理するときのコツ permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;お金の動きを整理するときのコツ&lt;/h3&gt;
&lt;p&gt;上記のような商流を整理するときは、まず取引に直接または間接的に関わる利害関係者を全員書き出すとよい。お金の流れとはすなわち債権債務の発生と消滅なので、利害関係者のそれぞれに対していつ債権債務が発生しいつ消滅するかを考えていくと漏れにくい。&lt;/p&gt;
&lt;p&gt;しかし、実際にお金が流れる点だけに注目すると見落としがちな論点もあるので、社内外の会計専門家にレビューをしてもらうことをお勧めする。例えばポイント引当金（利用者に付与したポイントの将来利用額を見積もって費用/負債として計上する）のような、実際に利害関係者の間で現金の動きはないものの損益として計上する…というような会計処理は見落としやすい。&lt;/p&gt;
&lt;p&gt;ある程度整理できたら、それぞれのお金の流れを証明するデータがどこにどのような形で存在するのか、どうすれば効率的に集計できるのかを一つ一つ調べていく。会計の要件が完全に考慮された上でデータ構造が設計されていれば特に困ることはないのだが、設計時に見落とされている、もしくは優先度が下げられていることもある。データ構造を変更することは難しい場合が多いため、既存のデータ構造を使いながら頑張って複雑な SQL を書いて集計しなければならなくなるかもしれない。&lt;/p&gt;
&lt;p&gt;データが揃ったら、商流を積み重ねて作った財務モデルに実際のデータを回帰的に当てはめてみて、その結果があるべき残高と一致しているか勘定科目ごとに確認する。例えばフリマアプリであれば、利用者の売上金残高を上記のデータから再現し、それを実際の残高と比べてみる。&lt;/p&gt;
&lt;p&gt;ここで不整合があれば、原因を調査し解決したあと同じ手順を再度繰り返す。&lt;/p&gt;
&lt;h2 id=&quot;どのような会計データ基盤が作られたか&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%81%A9%E3%81%AE%E3%82%88%E3%81%86%E3%81%AA%E4%BC%9A%E8%A8%88%E3%83%87%E3%83%BC%E3%82%BF%E5%9F%BA%E7%9B%A4%E3%81%8C%E4%BD%9C%E3%82%89%E3%82%8C%E3%81%9F%E3%81%8B&quot; aria-label=&quot;どのような会計データ基盤が作られたか permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;どのような会計データ基盤が作られたか&lt;/h2&gt;
&lt;p&gt;前述のお金の流れを集計するために作られた会計データ基盤のアーキテクチャと、それが会社やサービスの成長に従って生じた様々な課題にどのように対処したかについて書く。&lt;/p&gt;
&lt;h3 id=&quot;まず何から始めるか&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%81%BE%E3%81%9A%E4%BD%95%E3%81%8B%E3%82%89%E5%A7%8B%E3%82%81%E3%82%8B%E3%81%8B&quot; aria-label=&quot;まず何から始めるか permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;まず何から始めるか？&lt;/h3&gt;
&lt;p&gt;会計に必要なデータの集計には本番に保存されているデータを使うものの、負荷やセキュリティ上の理由から直接本番の DB に集計クエリを投げるわけにはいかない。&lt;/p&gt;
&lt;p&gt;そのため、必要なテーブルを dump しておき、バッチ処理で別の DB や DWH にインポートして集計するという方法が一般的と考えられる。このとき、必要に応じてデータを加工することがある。&lt;/p&gt;
&lt;p&gt;例えば個人情報は会計データの集計には不要であり、漏洩リスクを抑えるためにも dump する前に削除しておくことが望ましい。また、本番のデータ構造が集計に不向きな場合には dump 後に集計用の中間テーブルを作ることが考えられる。&lt;/p&gt;
&lt;p&gt;最初にできた会計データ基盤は以下のようなシンプルな構成だった。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/fa9252aa256df9f262e332e51c415bbc/b8bf8/accounting-2.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 37.9746835443038%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABZElEQVQoz21RXUsCURDdf9aP6If0I/Il6CV7E3qIIAvCoEihfY0eKnpZJM1PxE1dJXTdu9e9XydmcsWkgbl37p0zh5kznnMO5GS7cW5RFGGxWGA4HKLb7cJo/S+e3MuLtgmstXxf3dzh+KQEpRWMMdBKwVkHpRT0mnS31gvDEPP5nB8EStN0Q3h2fo3CUXEDNtZh9j2DNZqx5FmWbWrJvV6vByklfy6XSx5Lb4207oHPTGUoly+QpgLWOkynU0SjCeeEEEiSBF6lUuEE2Xg8hu/73KFcSebxg3scXO4jtQppP8D4dA9y8Mz4m9YTSvVHjtudNprNJrxatYZqtcqfcRyj1WpxTLqRvXdeUKwVIE0GGQ0xuj1EEtY59zr5xEP/jeOPRgNBEMAjDUjkbWF/F+OgjYZYCowGE8bEiUCz/4V5LP4sJdecl7JNQqR5kmIqok5p/Fx0tZJQKuOtW+dg1niqI/8BRLZgkVPJF8wAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;accounting-2&quot;
        title=&quot;accounting-2&quot;
        src=&quot;/static/fa9252aa256df9f262e332e51c415bbc/f058b/accounting-2.png&quot;
        srcset=&quot;/static/fa9252aa256df9f262e332e51c415bbc/c26ae/accounting-2.png 158w,
/static/fa9252aa256df9f262e332e51c415bbc/6bdcf/accounting-2.png 315w,
/static/fa9252aa256df9f262e332e51c415bbc/f058b/accounting-2.png 630w,
/static/fa9252aa256df9f262e332e51c415bbc/40601/accounting-2.png 945w,
/static/fa9252aa256df9f262e332e51c415bbc/78612/accounting-2.png 1260w,
/static/fa9252aa256df9f262e332e51c415bbc/b8bf8/accounting-2.png 1728w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;日次で本番環境の DB が replicate される&lt;/li&gt;
&lt;li&gt;1日の終わりに replication を停止し、個人情報を削除して dump し S3 に upload する&lt;/li&gt;
&lt;li&gt;集計するタイミング（通常は月次）で EC2 上の MySQL にデータを import する&lt;/li&gt;
&lt;li&gt;集計結果を CSV や Google スプレッドシート等で経理に提供する&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ここで会計上の集計ロジックは集計プログラムや SQL 文内に（WHERE や JOIN で）埋め込まれることになり、場合によっては複雑な SQL を書かなければならない。&lt;/p&gt;
&lt;h3 id=&quot;主な課題とその解決策&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%B8%BB%E3%81%AA%E8%AA%B2%E9%A1%8C%E3%81%A8%E3%81%9D%E3%81%AE%E8%A7%A3%E6%B1%BA%E7%AD%96&quot; aria-label=&quot;主な課題とその解決策 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;主な課題とその解決策&lt;/h3&gt;
&lt;p&gt;上記の会計データ基盤は単純かつ安上がりだったが、会社や事業の成長に従って幾つか無視できない課題が生じた。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;集計に時間がかかる&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;元データの UPDATE やスキーマ変更に弱い&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;データの整合性を保つコストが高い&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;まず 1. の集計に時間がかかる問題について。&lt;/p&gt;
&lt;p&gt;事業の成長に従って集計対象のデータ量が増加するだけでなく、中間テーブルの生成や集計時の JOIN が増えて集計が徐々に重くなっていったことで時間がかかるようになってしまった。EC2 のそれなりに良いインスタンスを使っていたかと思うが、集計時間が徐々に伸び月次決算に間に合わないことが増えてきた。&lt;/p&gt;
&lt;p&gt;解決策としては、シンプルにお金で解決することになった。当時インフラに AWS を使っており、 EC2 上の MySQL から Redshift という DWH 製品に移行した。ここで Google の BigQuery を使うという案もあったのだが、クエリの書き換えなど移行コストの低さから Redshift を選択した。BigQuery や Redshift は（様々な機能があるが）一般的なデータベースと比較した際の主たる特徴として、ストレージ内でのデータの配置が一般的なデータベースのような行指向ではなく列指向であり、1行ごとの INSERT や UPDATE が苦手な代わりに特定の列が示す値を全て取得し合算するような集計を高速に処理できる。&lt;/p&gt;
&lt;p&gt;次に 2. の元データ変更に弱い問題について。&lt;/p&gt;
&lt;p&gt;この会計データ基盤では本番のデータ構造をそのまま使い、集計条件を SQL 文内で指定していた。しかし元データの全てが immutable ではないため、集計後に仕様や障害対応で UPDATE されると再集計時に差分が生じてしまうことがあった。また、新たな機能やサービスが追加されたときにスキーマの変更を把握してそれに対応したクエリを書かなければ必要なデータを集計することができない。&lt;/p&gt;
&lt;p&gt;本来はデータ構造を会計の要件に合わせて変えたい（理想をいえば全てのテーブルが履歴形式で immutable だと嬉しい）のだが現実的には困難なため、解決策としては対症療法に終始することになった。具体例としては、社内の issue テンプレートに「会計に影響があるか」という項目を入れておき、会計データ基盤の存在を布教する（知らなければ質問が来て、知っている人は自力で解決できる。まずは存在を認知してもらうことが重要）ということをやっていた。他には社内の Slack において新しいチャンネル作成イベントを全て監視・通知し、新規開発が始まりそうであれば早めに話を聞いて会計への影響を判断し注意点を説明するなど地道な活動をしていた。&lt;/p&gt;
&lt;p&gt;最後に 3. のデータの整合性を保つコストが高い問題について。&lt;/p&gt;
&lt;p&gt;会計データ基盤では、個別の取引と全体の残高という二つの視点でデータ間の整合性を求められる。&lt;/p&gt;
&lt;p&gt;例えば、決済代行会社に対する債権について考えてみる。素朴にお金の流れを整理すると、ある月末時点における債権残高は次の計算式で表現できる。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;前月末残高 + 当月変動額 = 当月末残高&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;当月変動額は以下のように分解できる。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;当月変動額 = 当月決済額 - 決済代行手数料 - 当月入金額&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;まずはこの各項目に対応するデータが正確に保存・集計できているかという「取引レベルの整合性」が求められる。&lt;/p&gt;
&lt;p&gt;次に、各項目を足し引きした計算結果として得られる当月末残高があるべき残高と整合しているかどうかという「残高レベルの整合性」が求められる。因果関係で考えると取引は原因であり残高は結果で、原因を基に生成した仕訳を入力して得られた数字をあるべき残高と突合することで確かめる。つまり「既に認識している債権債務の変動要素」が正しいことを取引レベルで確かめ、その上で「その認識に見落としがないか」を残高レベルの整合性を確認することで保証する。&lt;/p&gt;
&lt;p&gt;残高の整合性が満たされていないケースとしては、「債権債務に変動があるものの、会計データとして捕捉していない」という見落としが考えられる。例えば決済代行会社の管理画面で決済をキャンセルして顧客に返金しているが、（決済代行会社には記録が残っているものの）会社の DB にはデータが残っていないというケースが考えられる。&lt;/p&gt;
&lt;p&gt;何年も運用しているシステムだとそのような見落としがあれば（あるべき残高と会計上の残高が乖離していくため）気づくことができるが、事前に全てを網羅的に把握することは難しい。特に、会社と顧客の関係としては解決されているが会計で必要なデータが残っていない（もしくはどこにあるのか整理されていない）という場合、問題を認識するところから始める必要があるので解決に時間を要する。そもそも問題として認識されておらず、残高差異が異常値を示してから問題となるのが最悪なパターンである。&lt;/p&gt;
&lt;p&gt;これを防ぐためには、より短いサイクルで「取引を集計した結果の残高」と「あるべき残高」を比較して残高差異の要因を究明し潰していく必要がある。なぜならば、差異の原因が増えれば増えるほど原因の確定が難しくなるため。そのためにも、突合作業をできるだけ自動化することが望ましい。&lt;/p&gt;
&lt;p&gt;解決策としては、決済や配送の取引先からの請求額と一致する明細と突合可能な本番のデータを合わせて会計データ基盤のデータベースに import し突合するようにした。結果としてはこのような会計データ基盤ができた。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/11cee5c1b378d9f829f7272076cc4cf2/a429e/accounting-2-red.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 42.405063291139236%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABaklEQVQoz21Sy0rDUBDNf/oF/oAIBZfduHZlVyqIC8GCm1qlBR+taRd2oREsSG21qba5zTv3lSN3aiRUB4bLZWbOOfOwULI8z7Fuy+USvu+DMYbJZII0TaG1Jv+vxhJCIAgCcM4paAqCMMRWpYrL1jUllQGMSSlh6grAsltZlmEwGMC8Sim4rgvPY6ju7uG+94AsTbBYLH7UMkynUyI1uetgBGjU1et1xHFMKhuNBiku2CsnmzjrH9C/e/GO2vYQPMmhtITpVhsglABt20az2USv16MiM6ckScC5IJKjm330X28p9vIU4uo0hOSGTFFXy9kcSRST6jAMVzM0AeOj0Qjj8ZiCxYzIVI4okxBvXYhuFVrG4EKCC45DpwWWRWCeB3fmwipvyKhzHIdaL2YqlYTvM3x8Mcztc0xrG+DRAimX0Ephxz7Gpwjw/PiEu04Hlum72OBwOES73V6JUurXi9PQOYn9s/Xy2XwDXANegRBkRvgAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;accounting-2-redshift&quot;
        title=&quot;accounting-2-redshift&quot;
        src=&quot;/static/11cee5c1b378d9f829f7272076cc4cf2/f058b/accounting-2-red.png&quot;
        srcset=&quot;/static/11cee5c1b378d9f829f7272076cc4cf2/c26ae/accounting-2-red.png 158w,
/static/11cee5c1b378d9f829f7272076cc4cf2/6bdcf/accounting-2-red.png 315w,
/static/11cee5c1b378d9f829f7272076cc4cf2/f058b/accounting-2-red.png 630w,
/static/11cee5c1b378d9f829f7272076cc4cf2/40601/accounting-2-red.png 945w,
/static/11cee5c1b378d9f829f7272076cc4cf2/78612/accounting-2-red.png 1260w,
/static/11cee5c1b378d9f829f7272076cc4cf2/a429e/accounting-2-red.png 1717w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;基本的なデータの収集・集計の手順としては従来と変わらないが、他社から受け取った明細も含めて一旦 S3 にデータをため Digdag と Embulk で Redshift にロードすることになった。&lt;/p&gt;
&lt;p&gt;原則として毎月残高レベルの整合性をチェックし、問題があれば決済や配送の明細を使って全件突合し集計クエリで捕捉できていない理由を調べてフィードバックする、という作業をやっていた。&lt;/p&gt;
&lt;h3 id=&quot;内部統制や監査への対応&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%86%85%E9%83%A8%E7%B5%B1%E5%88%B6%E3%82%84%E7%9B%A3%E6%9F%BB%E3%81%B8%E3%81%AE%E5%AF%BE%E5%BF%9C&quot; aria-label=&quot;内部統制や監査への対応 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;内部統制や監査への対応&lt;/h3&gt;
&lt;p&gt;会計データ基盤が出力するデータは財務諸表の根拠となるので、会計監査や内部統制報告制度への対応を考慮しなければならない。一口に内部統制と言っても様々な目的や枠組みがあるのだが、ここでは金融商品取引法に基づく「財務報告の信頼性を担保する」ための仕組みを指すものとする。&lt;/p&gt;
&lt;p&gt;財務報告の信頼性を担保するために、財務報告の元データを生み出すシステムに関わるシステムや業務プロセスを対象として、開発者は経理や内部監査と協力し監視や統制の仕組みを整備・運用する。&lt;/p&gt;
&lt;p&gt;上記で述べたような会計データ基盤では具体的に、以下のような対応が必要となると考えられる。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;開発、権限付与プロセスを明文化する
&lt;ul&gt;
&lt;li&gt;どのような役割の人間が業務に関係しているか&lt;/li&gt;
&lt;li&gt;業務処理の過程で誰による何の承認が必要か
&lt;ul&gt;
&lt;li&gt;例: システムの変更管理やインフラ環境へのアクセス権限付与は PdM の承認が必要…など&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;いつでも過去の出力結果を再現できるようにデータのバックアップを取っておく&lt;/li&gt;
&lt;li&gt;システムの変更後に過去のデータから過去の出力結果を正確に再現できるかテストする&lt;/li&gt;
&lt;li&gt;BS 上の勘定科目のあるべき残高と、会計データ基盤上の集計結果を突合する&lt;/li&gt;
&lt;li&gt;上記全てが適切に運用されていることを示す証拠を保存する&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;何をもって内部統制が有効とみなされるかというのは状況によって異なるが、上記のような取り組みはこのような会計データ基盤を作る時に必要になると思う。&lt;/p&gt;
&lt;p&gt;基本的な方針としては、一人で勝手に財務諸表につながる数字を改竄できないように、または改竄されても簡単に検出できるような仕組みを整備して運用し、その証拠を保存していくことになる。&lt;/p&gt;
&lt;p&gt;証拠を保存するのは面倒だが、リリースの承認証跡であれば JIRA 等の issue tracker で管理しつつそのステータスや GitHub PR の特定のラベルをチェックしてから自動で merge → deploy するとか、インフラへのアクセス権限管理であれば Terraform のようなソフトウェアで自動化するなど工夫の余地はある。&lt;/p&gt;
&lt;h3 id=&quot;アーキテクチャの移行&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%82%A2%E3%83%BC%E3%82%AD%E3%83%86%E3%82%AF%E3%83%81%E3%83%A3%E3%81%AE%E7%A7%BB%E8%A1%8C&quot; aria-label=&quot;アーキテクチャの移行 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;アーキテクチャの移行&lt;/h3&gt;
&lt;p&gt;主な課題を解決したかに見えた会計データ基盤だったが、&lt;a href=&quot;https://speakerdeck.com/mercari/0924-bold-challenge-at-deeeet&quot;&gt;全社的にマイクロサービスをやっていくぞ&lt;/a&gt;ということで、データベースを dump して集計する方式を続けることが難しくなった。&lt;/p&gt;
&lt;p&gt;難しい理由としては、以下の2点が挙げられる。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;データベースが分散しているため、データ集めてくるのが面倒になる（困難）&lt;/li&gt;
&lt;li&gt;個々のサービスのデータ構造やコンテキストを把握して集計クエリを書かなければならない（無理）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;一つ目の理由は、単純にデータベースが分散するからで、それに加えてアーキテクチャが異なる（各サービスは自分たちで何のデータベースを使うか決めることができる）多数のデータベースの dump を受け取って加工し集計するのが難しいから。&lt;/p&gt;
&lt;p&gt;二つ目の理由は、各サービスは他のサービスに対してインターフェイスを公開してそれを守る限り内部実装はチーム内に閉じて行うため、そのデータ構造をチーム外の人間が集計のために把握しなければならないというのがそもそもマイクロサービス化の方針に逆行しているから。&lt;/p&gt;
&lt;p&gt;チーム内外での議論の結果として、会計データ基盤も一つのマイクロサービスとして捉え、責務を明確にしてそれをインターフェイスとして定義することになった。&lt;/p&gt;
&lt;p&gt;会計データ基盤の関係者は以下の三者に分類することができる。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;経理や財務&lt;/li&gt;
&lt;li&gt;会計データ基盤のサービス&lt;/li&gt;
&lt;li&gt;その他のマイクロサービス（会計サービスのクライアントとなる）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;サービス全体に関する正確な財務情報を適時に報告するという業務において、それぞれの関係者の責任は次のように分担できると考えられる（組織構造によって変わるかもしれない）。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/e47408b5659e5e0f5bf12f10eae8b729/18539/responsibility2.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 44.93670886075949%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA5klEQVQoz41S1wrDMAz0/39gXhKyJwlk76FyAgW3OKECcbZknZYVGeS6rhvP82TUdZ5nGoaB2ralrutoWZY7Rr0R7vtOWZZRHMcURREryMqypDAMybIstm3b9h/hcRyU5zmlacqkSZLQuq5sh6J6KM43obQhRCZ9GsfvG6DSL0/yRG5K9FUhSsc8pCV9NoKwoW3MV1AE7SsYZB7YmOu6ZNs2Y1EU7NMJq6riRTmOw/66rhmDIKBpmkhhY77vswFfQQKwjKZpOJFOiKQgwTv4x3Ekz/N4433fkwIJDkAJfvuXJpERodsPznK/IdhpE6sAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;responsibility2&quot;
        title=&quot;responsibility2&quot;
        src=&quot;/static/e47408b5659e5e0f5bf12f10eae8b729/f058b/responsibility2.png&quot;
        srcset=&quot;/static/e47408b5659e5e0f5bf12f10eae8b729/c26ae/responsibility2.png 158w,
/static/e47408b5659e5e0f5bf12f10eae8b729/6bdcf/responsibility2.png 315w,
/static/e47408b5659e5e0f5bf12f10eae8b729/f058b/responsibility2.png 630w,
/static/e47408b5659e5e0f5bf12f10eae8b729/40601/responsibility2.png 945w,
/static/e47408b5659e5e0f5bf12f10eae8b729/18539/responsibility2.png 1074w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;それぞれの責任を遂行するために、各々の役割は次のように分担できる。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/87131fa7ed69707686472e4c5b76e8d5/b67f3/responsibility1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 44.93670886075949%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA8UlEQVQoz32SV4rEQAxEff8bOuAPR5xzDlqewIPX69kC0UldVWq1IQ+c56kBjuOQfd812LvGK+8Nxp3kHmCaJvE8T3zfF9u2JYoiJX3euQsY35TAPM+SJImkaapkeZ6r67eq/jgchkHatpW+72XbNnXC3h04HsdRlmWRpmlUiPmrQ5yEYahBMsRXeaxxV9e1RlEUOsZxLOu6fi+ZcghUcYNTgNOyLD8VIHBv2CshCVVViWVZYpqmuK6ra0gR4CJziHlPx3HUddd174SMqJN0Bc5wEwSBdptzCBCibM6o5Bfhf38K8EZczLLs04Bnd+9d/gE/Vr7BLhKTXQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;responsibility1&quot;
        title=&quot;responsibility1&quot;
        src=&quot;/static/87131fa7ed69707686472e4c5b76e8d5/f058b/responsibility1.png&quot;
        srcset=&quot;/static/87131fa7ed69707686472e4c5b76e8d5/c26ae/responsibility1.png 158w,
/static/87131fa7ed69707686472e4c5b76e8d5/6bdcf/responsibility1.png 315w,
/static/87131fa7ed69707686472e4c5b76e8d5/f058b/responsibility1.png 630w,
/static/87131fa7ed69707686472e4c5b76e8d5/40601/responsibility1.png 945w,
/static/87131fa7ed69707686472e4c5b76e8d5/78612/responsibility1.png 1260w,
/static/87131fa7ed69707686472e4c5b76e8d5/b67f3/responsibility1.png 1338w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;この役割に沿ってデータの収集と検証、集計をするための会計データ基盤を構築した。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/7ad8e72ee00420c96611474a804184d1/8454b/accounting-golduck.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 43.0379746835443%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABh0lEQVQoz32S227bMBBE9f+f09/oa9sUdYGkTdLYsSmSy13eFPsUpOMAfenDYFcCcTgz0mISKKZkS7jVIyK01v6rrTe2rc/97W2jdqVuypnOsvt+R1wdJRshBFJKmNmHcs7X+b6PeQyV4ypoSuTa2J+eeXjcsT8+s3z7+uUKbBvJCjEEVBXLBVWbjgdIrBJiQiThJRMlzXO1NZw/8evxnj/7Jxb3eiCsDp8aXq4AtcwqlZAyIpGkGRfrhEgazjO1ZNRsRofLu2B5eLgnOEcudd6oVvDRcM5N+MFXXo6CaaIMiBpOGqsXJAZK7bhY5tlaG4t4R4oRy212NdwEMbyPRDEOa+HgEqbX6EPDWRQlqdJ7p/cz27ZxfjuzcLlwvoBa/QAO3fbhqNU8+50JVCc0SkbUqLnhXyL6mqmhs4zsI73lSkqKl8LRK6s7kdRmn+PLnmLhdHKs6/qRYvSpUvm0+8zdj5/sf7+wXC7XMsc/lbNRcp5d3eLddH1f/nkec2udVUclmV46fwFPGrT+Vj86ogAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;accounting-golduck&quot;
        title=&quot;accounting-golduck&quot;
        src=&quot;/static/7ad8e72ee00420c96611474a804184d1/f058b/accounting-golduck.png&quot;
        srcset=&quot;/static/7ad8e72ee00420c96611474a804184d1/c26ae/accounting-golduck.png 158w,
/static/7ad8e72ee00420c96611474a804184d1/6bdcf/accounting-golduck.png 315w,
/static/7ad8e72ee00420c96611474a804184d1/f058b/accounting-golduck.png 630w,
/static/7ad8e72ee00420c96611474a804184d1/40601/accounting-golduck.png 945w,
/static/7ad8e72ee00420c96611474a804184d1/78612/accounting-golduck.png 1260w,
/static/7ad8e72ee00420c96611474a804184d1/8454b/accounting-golduck.png 1798w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;従来は AWS を使っていたが、このときは社内のマイクロサービスで Google Cloud の利用を前提に様々な支援の仕組みが構築されていたので Google Cloud を使って構築することになった。&lt;/p&gt;
&lt;h4 id=&quot;集計までの手順&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E9%9B%86%E8%A8%88%E3%81%BE%E3%81%A7%E3%81%AE%E6%89%8B%E9%A0%86&quot; aria-label=&quot;集計までの手順 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;集計までの手順&lt;/h4&gt;
&lt;p&gt;上記の会計データ基盤では従来の dump して取り込む形式とは異なり、会計処理のためのデータを予め定義したインターフェイスに沿って生成して送ってもらう必要がある。サービス全体の可用性を重視し、データを受け取る際は Pub/Sub モデルを活用して非同期で処理することになった。&lt;/p&gt;
&lt;p&gt;また、会計のデータを集計して支払いやレポートに使う際に際にクライアント側のマイクロサービスとの不整合が起きないよう突合処理（Reconcile と呼ばれていた）用の API を用意し、それをクライアント側から呼んでもらうことで不整合を検知できるようにした。&lt;/p&gt;
&lt;p&gt;まずデータのやり取りをする前に、以下のような事前の準備が必要となる。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;経理チームがクライアントとなる各マイクロサービスに送付してもらうデータの形式と最終的に得たいレポートの形式を定義する&lt;/li&gt;
&lt;li&gt;会計データ基盤側では上記の定義に従ってデータの検証や集計に用いるマスターデータを投入する&lt;/li&gt;
&lt;li&gt;各マイクロサービスはデータの生成、保存や送付、突合処理の開発を行う&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;実際のデータ送付や検証、集計は次の手順で行われる。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;経理による定義に沿って各マイクロサービスが指定の Cloud Pub/Sub へ会計処理に必要なデータを送る&lt;/li&gt;
&lt;li&gt;届いたデータを subscribe し、定義されたインターフェイスに沿って Cloud Functions で検証する&lt;/li&gt;
&lt;li&gt;検証結果が正しければ Cloud Spanner に書き込む&lt;/li&gt;
&lt;li&gt;誤っていれば Pub/Sub のエラー用 topic に書き戻す&lt;/li&gt;
&lt;li&gt;各マイクロサービスは定期的にバッチ処理で突合 API を通じてマイクロサービス側で保存しているデータと会計データ基盤側のデータを突合する&lt;/li&gt;
&lt;li&gt;ここで突合済みのデータは社外への支払いや会計のレポート集計に使われる&lt;/li&gt;
&lt;li&gt;Spanner に保存したデータを Dataflow で BigQuery に運ぶ&lt;/li&gt;
&lt;li&gt;また、社外への支払いで使うデータを Cloud Storage にエクスポートしておく&lt;/li&gt;
&lt;li&gt;月次で BigQuery から会計のレポートを集計する&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;レポート以外のちょっとした数字の可視化については BigQuery を Looker から見られるようにしておき、必要に応じて経理の側で Looker 上にダッシュボードなどを作ってもらうようにした。&lt;/p&gt;
&lt;h4 id=&quot;成果と課題&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%88%90%E6%9E%9C%E3%81%A8%E8%AA%B2%E9%A1%8C&quot; aria-label=&quot;成果と課題 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;成果と課題&lt;/h4&gt;
&lt;p&gt;このようなデータ基盤を構築したことで、以下の成果があった。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;分散したデータベースに適した集計環境が得られた&lt;/li&gt;
&lt;li&gt;（JOIN やサブクエリ、中間テーブルが必要なくなり）集計が高速化した&lt;/li&gt;
&lt;li&gt;データに関する知識の面で個人への依存度が低下した&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;3 についてだが、従来の（本番データの複製から SQL で集計する）方式では、集計ロジックを考えて実装する人間に本番環境のデータ構造と会計知識の両方が要求されていた。これは当然で、例えば「完了した取引に付随して発生した決済代行手数料」を集計しようとすると、完了した取引や決済はデータベース上でどのように表されているか、更にそれぞれの状態遷移の仕様を把握して会計の要件に沿ったクエリを書かなければならない。&lt;/p&gt;
&lt;p&gt;新たな方式では「事業上のイベントと会計処理の関係」と「事業上のイベントと実際のデータとの関係」を把握する責任を組織的に分担することができるので、何か問題が起きたときに原因の分析や対応を組織的なアプローチ（根回し）で解決できるようになり個人の頑張りへの依存度が低下した。&lt;/p&gt;
&lt;p&gt;一方で、作った後に以下のような課題も見えてきた。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;組織的な責任分担の浸透&lt;/li&gt;
&lt;li&gt;クライアント実装のコスト&lt;/li&gt;
&lt;li&gt;運用や障害対応&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;まず 1 について。新たな方式では経理、会計データ基盤、そして各マイクロサービスがそれぞれの役割を果たさなければ正しい会計情報を適時に報告できなくなる。そのように設計したのだから当然といえば当然なのだが、理解度や信頼度が異なるそれぞれのチームの関係者にこういう仕組みがあるのでこのような仕事をお願いしますと言って回るのは面倒だった。&lt;/p&gt;
&lt;p&gt;次に 2 について。新たな方式ではデータベースを dump して集計する方式と異なり、会計で必要なデータを生成・保存・送付するための開発コストが必要になる。1 の問題と関係するのだが、新規サービスの開発中に「実は会計の対応もお願いしたいんですが…」と伝えるのは心苦しかった。やってもらわないと会計で捕捉できないのでやってもらうのだが、クライアント実装を簡単にするような仕組み（SDK のような）があると良かったなと思った。&lt;/p&gt;
&lt;p&gt;最後に 3 について。従来の方式ではデータベースの dump をバッチ処理で加工、ロード、集計していたのでインフラの運用作業は少なかったが、新しい方式ではリアルタイムで各マイクロサービスが送ってくるデータを受け取って検証し保存しなければならないので、監視や障害対応などの運用作業が増える。&lt;/p&gt;
&lt;p&gt;私はこれらの課題が解決される前に退職してしまったのだが、今頃は解消・軽減されているかもしれない。&lt;/p&gt;
&lt;h4 id=&quot;会場で頂いた質問&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BC%9A%E5%A0%B4%E3%81%A7%E9%A0%82%E3%81%84%E3%81%9F%E8%B3%AA%E5%95%8F&quot; aria-label=&quot;会場で頂いた質問 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;会場で頂いた質問&lt;/h4&gt;
&lt;p&gt;このアーキテクチャに際して、当日会場で「（会計データ基盤にとってクライアントとなる）&lt;strong&gt;マイクロサービス達が正しいデータを送ってきていることをどのようにして確認していたのか？&lt;/strong&gt;」という質問を頂いた。&lt;/p&gt;
&lt;p&gt;確かに、従来の本番データのレプリカ及びそれを加工したデータを SQL で集計する方式では、ある程度の整合性を保ったデータをソースとして使うことができる。一方で、新しい方式では正しいデータが会計データ基盤に送られない場合、（顧客との関係においてサービスが適切に運営されていたとしても）それを基にした会計処理は行われないということになる。&lt;/p&gt;
&lt;p&gt;この質問への回答としては、常に2種類の整合性をチェックするということが言える。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;取引レベルの整合性: 送られたデータが全て届いており保存されているか&lt;/li&gt;
&lt;li&gt;残高レベルの整合性: 送られたデータを集計した結果があるべき残高と整合しているか&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;1 については突合用の API を用意して、それをクライアント側から呼んでもらうことで解決する。このとき「クライアント側にあってデータ基盤側にない」と「クライアント側になくてデータ基盤側にある」という2種類の不整合が生じる可能性がある。バグや仕様の認識誤り、障害など様々な原因があるので、不整合が生じる度に原因を調査して潰していく必要がある。&lt;/p&gt;
&lt;p&gt;2 については、社内外に存在する突合先データと会計データ基盤の集計結果を突合することで解決する。例えばフリマアプリであれば顧客の売上金残高は社内で管理されているはずなので、会計データ基盤に送られたデータから集計した売上金残高と本番のデータベースで管理している売上金残高を（顧客の id ごとに）突合し、差異を検出したら原因を調査する。決済代行手数料や配送料の未払残高であれば、取引先からの請求書やその明細と突合する。&lt;/p&gt;
&lt;p&gt;ここは更に工夫の余地があって、例えばあるイベントが送られるときは必ず特定のイベントも送られる、というような場合ではそれを検証時にチェックするなり事後的にバッチ処理で突合するなどで検出することができる。&lt;/p&gt;
&lt;h2 id=&quot;それぞれのアーキテクチャの特徴と-proscons&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%81%9D%E3%82%8C%E3%81%9E%E3%82%8C%E3%81%AE%E3%82%A2%E3%83%BC%E3%82%AD%E3%83%86%E3%82%AF%E3%83%81%E3%83%A3%E3%81%AE%E7%89%B9%E5%BE%B4%E3%81%A8-proscons&quot; aria-label=&quot;それぞれのアーキテクチャの特徴と proscons permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;それぞれのアーキテクチャの特徴と pros/cons&lt;/h2&gt;
&lt;p&gt;最初に紹介したデータベースを dump する方式を &lt;code class=&quot;language-text&quot;&gt;Query-Driven&lt;/code&gt;、次に紹介した予め定義されたインターフェースに沿ってデータを送ってもらう方式を &lt;code class=&quot;language-text&quot;&gt;Event-Driven&lt;/code&gt; と呼ぶことにし、それぞれの pros/cons を整理する。&lt;/p&gt;
&lt;h3 id=&quot;手順の違い&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%89%8B%E9%A0%86%E3%81%AE%E9%81%95%E3%81%84&quot; aria-label=&quot;手順の違い permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;手順の違い&lt;/h3&gt;
&lt;p&gt;Query-Driven な方式では既存のデータを使ったバッチ処理で、Event-Driven な方式は会計用のインターフェイスを定義したストリーミング（リアルタイム）処理ということができる。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/a88e9de1902d617cb9b737ce06f46ffe/46e30/process.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 23.417721518987342%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAuklEQVQY021QyQqFMBDr/3+ZB/HgTRQEcaPuiuIeyfAqFV6gtGSSdGbUfd8gxnGE1hp1XaNpGpznKbyp87a11FVVhbZtPxqFH47jwL7vErRtm6E/QQZGY/Q21DzPiOMYZVnKKYoC0zRhGAYxGFzXJXwQBMiyDEmSwPd9hGEoviiK0Pc9VJ7n8DxPCBYdxxExR1nX9Q1kOI0MoYdNuK4r4cuyvN0q/kqS++u6Tt5pmoqBQntse/x/q+DID0u+f/JQwfS3AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;process&quot;
        title=&quot;process&quot;
        src=&quot;/static/a88e9de1902d617cb9b737ce06f46ffe/f058b/process.png&quot;
        srcset=&quot;/static/a88e9de1902d617cb9b737ce06f46ffe/c26ae/process.png 158w,
/static/a88e9de1902d617cb9b737ce06f46ffe/6bdcf/process.png 315w,
/static/a88e9de1902d617cb9b737ce06f46ffe/f058b/process.png 630w,
/static/a88e9de1902d617cb9b737ce06f46ffe/40601/process.png 945w,
/static/a88e9de1902d617cb9b737ce06f46ffe/78612/process.png 1260w,
/static/a88e9de1902d617cb9b737ce06f46ffe/46e30/process.png 1303w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3 id=&quot;トレードオフ&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%83%88%E3%83%AC%E3%83%BC%E3%83%89%E3%82%AA%E3%83%95&quot; aria-label=&quot;トレードオフ permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;トレードオフ&lt;/h3&gt;
&lt;p&gt;Query-Driven な方式は開発を始めるのが簡単だが事業が成長、複雑化していくにつれて徐々に短所が目立ってくる。特にクエリが複雑になりがちという問題が大きい。&lt;/p&gt;
&lt;p&gt;逆に Event-Driven 方式では予め定義されたインターフェイスに沿ってデータが送付されそれを一括で集計するだけなので単純なクエリで済む一方、事前の準備や開発の手間が多いという問題がある。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/d27e10c54a89d0f8bc7e09c5e9a85303/bb072/tradeoff.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 51.26582278481012%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABS0lEQVQoz32S6Y6CUAyF7/u/Gv8waAQXApFNREVAQKCTr8mdTCbDNGkK3U57es08z/J+vyVNU6mqSj6fj+qyLILUdS1Jkug3vmmaNI6M4yin0+k7H2vO57Ps93vZbDbaFOm6TrIskziOJYoiyfNc+r7X5sT4BqQsS3k8HnK5XPS/aRoxwzAIyqSgYEFiWhLRoigkCAI5HA66DflMhoZhqMAMow3pTBGB3W6n1q77U6wPi9LAdV3Zbrdac7/fFciAejwexfM8HZsAU66J3WQtZuAHvV6vSjJOkNq2VY6ez6euCRAc2pXxQwt5+LF6FIoYHx4g2F6PaR3HUe7gBloAppDDcExiWDakD2JIBv31eok9EA1JgCOawhHTkEOzNeFJGd/3tYiDcDWeCRwxCU+H1WjEP0DovxyyGqvcbjctgiOQ/jqMfdg2/lvh8AuKp/1q902iBwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;tradeoff&quot;
        title=&quot;tradeoff&quot;
        src=&quot;/static/d27e10c54a89d0f8bc7e09c5e9a85303/f058b/tradeoff.png&quot;
        srcset=&quot;/static/d27e10c54a89d0f8bc7e09c5e9a85303/c26ae/tradeoff.png 158w,
/static/d27e10c54a89d0f8bc7e09c5e9a85303/6bdcf/tradeoff.png 315w,
/static/d27e10c54a89d0f8bc7e09c5e9a85303/f058b/tradeoff.png 630w,
/static/d27e10c54a89d0f8bc7e09c5e9a85303/40601/tradeoff.png 945w,
/static/d27e10c54a89d0f8bc7e09c5e9a85303/78612/tradeoff.png 1260w,
/static/d27e10c54a89d0f8bc7e09c5e9a85303/bb072/tradeoff.png 1318w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3 id=&quot;参考事例-uber&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%8F%82%E8%80%83%E4%BA%8B%E4%BE%8B-uber&quot; aria-label=&quot;参考事例 uber permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;参考事例: Uber&lt;/h3&gt;
&lt;p&gt;上記のトレードオフにより、サービスが大規模かつ複雑になるほど Event-Driven な仕組みへの移行動機が強まると考えられる。実際にそのような過程を辿った中で最大の公開されている事例としては Uber を挙げることができる。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://eng.uber.com/ubers-finance-computation-platform/&quot;&gt;Uber Engineering: Uber’s Finance Computation Platform&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;同社ではライドシェアの他に宅配やトラック輸送など複数の需給マッチングプラットフォームを運営しており、それぞれにパートナーや顧客との取引がある。上記のブログによるとライドシェアだけで年間 400 億件の仕訳があるそうだ。&lt;a href=&quot;https://s23.q4cdn.com/407969754/files/doc_presentations/2022/Uber-Investor-Day-2022.pdf&quot;&gt;FY2021 決算の投資家向けプレゼンテーション&lt;/a&gt;を見ると年間の Gross Booking ARR（顧客が払う料金の年額）は 1,000 億ドル近い。&lt;/p&gt;
&lt;p&gt;元々はデータベースに書き込まれたデータを DWH に流し込む ETL パイプラインを作り、そこから SQL で会計処理に必要な数値を集計していた。&lt;/p&gt;
&lt;p&gt;（画像は上記の記事より引用）
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/4a05c9e7c03db66d6c43b484a3cd223e/29007/uber-request-driven.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 41.77215189873418%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAABV0lEQVQY022Ry0rDUBCG8yo+hG+l4Ea8gBuhG5fiVnFTEVEUqVCwpd5AERGpi7S22toqLb1Qk8zJOTmZiyQRiuK/OJuZf843/zjyn4jIpopShWHY6XQ8z8uqiETMIuJkrUSEhCyclY0xQRCAAqWU1iaKIt/3AcBayzz9wyGmp3655ObvPwvagojY2FzUDsu1vav6iQqV0UZrDZAMMsaIyMFp3X0ZJ2ZmHsFHd1Tvey2kOAFh6n213oe1vte21hKiNSYlIxFpvI1nZrc3th5+sFkkMGiJf62dvjEiaD0GNVGhD0pEjgruwlppd7/KnJpNu+HdXSu3SoSIyCKq2/44PxvdXqIO7WjQKxeHNxU7SVAlWRqz4U7Sepzv5Zb8nU2jQAFAjF6l2FyZ6+SWcTyInx9fV+db64vYrCXeNOkstixtRKMpjqfQiKwC1kpYmJBUQCEw0Z+LfgP44b8A2nn5twAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;uber-request-driven&quot;
        title=&quot;uber-request-driven&quot;
        src=&quot;/static/4a05c9e7c03db66d6c43b484a3cd223e/f058b/uber-request-driven.png&quot;
        srcset=&quot;/static/4a05c9e7c03db66d6c43b484a3cd223e/c26ae/uber-request-driven.png 158w,
/static/4a05c9e7c03db66d6c43b484a3cd223e/6bdcf/uber-request-driven.png 315w,
/static/4a05c9e7c03db66d6c43b484a3cd223e/f058b/uber-request-driven.png 630w,
/static/4a05c9e7c03db66d6c43b484a3cd223e/40601/uber-request-driven.png 945w,
/static/4a05c9e7c03db66d6c43b484a3cd223e/78612/uber-request-driven.png 1260w,
/static/4a05c9e7c03db66d6c43b484a3cd223e/29007/uber-request-driven.png 1600w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;しかし、クエリの複雑化などの理由から下記のような Event-Driven なアーキテクチャに移行した。コンポーネントの詳細な説明は上記の記事を参照。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/57f64821c6d083e4460c36dfd1c86622/c45c7/uber-event-driven.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 60.75949367088608%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAACI0lEQVQoz2VSS2/TYBD0P+eIBBc4wCEIwaECCaEiWqEiUBUoJWmhTd3UTey8n3ZsJ3Hs5Mv32m8X2ZYQEqM97uzOzK7FGY/8WGuNQGTIABpjqMCOy/lqu9oJIkJE+g8W27J4Hu/YtjNrutNGsJ6ku2SZhiBFcxQ9PHIOryagdd5rDBpD/wyxau6sctqexVH1/t3bs6f11henf9Xo/ZCcD4P1cWPa9dPV2r8e1TjIXELBLoVYF978xanrL9f19snhz5e2d+kO7rzZLdsxpRQRSSEE6rB1ERxUlsfvUXAq2Dm57vmV03aYpPa4enJzcNv9NZx2BkGLsT0W8/l+b4hg0PMfP/ArT0y2ISKtJABY/TD71gqZVKUNAOz5981RvVybO9WIppBaVBln48aunp1bWisAKPtKJ3HqD0NXKVXau+5/7wa3RNSdOnanxgvZwSIaDMdWliabdXQzOh8snFbfdrqN/tQjon2BbbbtBXeTuEdENe/z8e/XaZas03iZLnLPhKAFm0SDZbqwB+fV5odgM1JSh1GYZRkYg0CFOJBKAoIQ8qpbPXOOALT192iIFG5m7sQejvuBH+x3OwRQjHEhuBSIKKXUSgsuhgu3HTqAxkLEKI7G43G2zfLAlGFSJf3O6Nmj8OTj6NXzbDrmjCFivlwIDaA433/9pCZDixA3SRLHMWL+QUrJ/I+k5NFCphuerFaHb7aNS8jPo8qoQSvp3ZvN+g9vr5ecaf4YigAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;uber-event-driven&quot;
        title=&quot;uber-event-driven&quot;
        src=&quot;/static/57f64821c6d083e4460c36dfd1c86622/f058b/uber-event-driven.png&quot;
        srcset=&quot;/static/57f64821c6d083e4460c36dfd1c86622/c26ae/uber-event-driven.png 158w,
/static/57f64821c6d083e4460c36dfd1c86622/6bdcf/uber-event-driven.png 315w,
/static/57f64821c6d083e4460c36dfd1c86622/f058b/uber-event-driven.png 630w,
/static/57f64821c6d083e4460c36dfd1c86622/40601/uber-event-driven.png 945w,
/static/57f64821c6d083e4460c36dfd1c86622/78612/uber-event-driven.png 1260w,
/static/57f64821c6d083e4460c36dfd1c86622/c45c7/uber-event-driven.png 1346w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Uber 社では記事にもあるように、事業の内容に応じて財務上のライフサイクルを定義してその中から会計に関連するイベントを抽出し、それが発生したタイミングで同期的・非同期的に会計データ基盤（同社では FCP: Financial Compute Platform と呼んでいる）へデータを送る。&lt;/p&gt;
&lt;p&gt;例として、ライドシェアでは次のような会計に関連するイベントが挙げられている。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;顧客が乗車した時の利用料金&lt;/li&gt;
&lt;li&gt;プロモーションコード利用による割引&lt;/li&gt;
&lt;li&gt;Uber の決済システムから顧客への請求&lt;/li&gt;
&lt;li&gt;決済代行事業者からの決済完了通知&lt;/li&gt;
&lt;li&gt;決済代行事業者からの代金支払&lt;/li&gt;
&lt;li&gt;ドライバーへの支払&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Event-Driven の隠れた？恩恵として、リアルタイムな処理がしやすくなり、例えば Uber のようなライドシェアでは乗車・日・都市といった様々な粒度でより短い間隔で収益性やプロモーションの影響を分析できるというメリットがある。&lt;/p&gt;
&lt;p&gt;同社には Financial Engineering と呼ばれているチームがあり、財務データを用いて事業上の重要指標を予測しつつそれを最適化するための予算配分を行なっているらしい。本記事とは関係ないので詳細は触れないが、事業 KPI の関連性をグラフ構造で定義して目標値から入力となる（広告やクレジット等の）予算を最適化するという手法は面白いのでご興味のある方はぜひ。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://eng.uber.com/transforming-financial-forecasting-machine-learning/&quot;&gt;Uber Engineering: Transforming Financial Forecasting with Data Science and Machine Learning at Uber&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;会計特有の課題について&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BC%9A%E8%A8%88%E7%89%B9%E6%9C%89%E3%81%AE%E8%AA%B2%E9%A1%8C%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6&quot; aria-label=&quot;会計特有の課題について permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;会計特有の課題について&lt;/h2&gt;
&lt;p&gt;会計データ基盤にどのようなアーキテクチャや製品を選択するとしても、会計というドメインそのものに由来する本質的な課題は変わらない。会計データ基盤が直面する課題は主に次の三種類に分けることができる。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;履歴形式のデータを用意する&lt;/li&gt;
&lt;li&gt;内外の整合性を保つ&lt;/li&gt;
&lt;li&gt;内部統制に配慮する&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;まず、会計に使うデータは原則的に履歴形式とするのがよい。&lt;/p&gt;
&lt;p&gt;集計対象となるサービスのデータ構造が履歴形式になっていない場合は、スナップショットを使うなど工夫が必要となる。会計に必要な全てのデータが immutable なレコードとして記録されている場合は問題ないが、サービスの仕様によっては immutable なデータのみを使ってサービスを作っていくのが大変なので現実的には難しい。&lt;/p&gt;
&lt;p&gt;次に、内外の整合性を保つことについて。&lt;/p&gt;
&lt;p&gt;会計処理を積み重ねていくと財務諸表になる。この財務諸表内のそれぞれの項目があるべき残高と整合しているかは、その項目が示す債権債務の相手先に依存する。例えば自社プラットフォーム内で管理されている顧客への債権債務残高であれば自社でそれを集計する必要があるし、取引先への債権債務ならば請求書や残高確認状などが突合先になる。仕訳を積み重ねた結果がそれらと整合しているか突合することで会計処理の網羅性を確認することができる。&lt;/p&gt;
&lt;p&gt;最後に内部統制について。&lt;/p&gt;
&lt;p&gt;会社法上の大会社や特定の条件を満たす会社では会計監査人による財務諸表監査を受けなければならない。このとき、財務報告に重要な虚偽表示が存在しないことを監査する過程で、財務報告に係る情報システムの開発・運用プロセスが適切に整備、運用されているかが評価される。J-SOX とか ITAC/ITGC などと呼ばれている。具体的にどのような業務が必要になるかは状況によるが、「一人で好き勝手にシステムや数字を改竄できない、改竄してもすぐに検知できる」ことや「業務の証拠や承認の証跡を必ず残す」ことに気をつけて適時に専門家のレビューを受けていれば特に大きな問題に発展することはない。&lt;/p&gt;
&lt;h2 id=&quot;会計データ基盤を作る際の方針&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BC%9A%E8%A8%88%E3%83%87%E3%83%BC%E3%82%BF%E5%9F%BA%E7%9B%A4%E3%82%92%E4%BD%9C%E3%82%8B%E9%9A%9B%E3%81%AE%E6%96%B9%E9%87%9D&quot; aria-label=&quot;会計データ基盤を作る際の方針 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;会計データ基盤を作る際の方針&lt;/h2&gt;
&lt;p&gt;会計に限らずデータ基盤を作って運用するときに最適な構造は、対象となるドメインの特徴やそのデータの利活用パターンによって異なる。しかし、サービスを開始して間もない等の理由でそれらが見定められていない場合は、とにかく早く安く作るのが重要なので会計データ基盤に時間をかけすぎるのは良くないと考えられる。&lt;/p&gt;
&lt;p&gt;この点、BigQuery や Redshift などの DWH 製品は使いやすく高速に集計でき、最近は値段が安くなったり新しい機能が積極的に追加されてるためおすすめできる。&lt;/p&gt;
&lt;p&gt;そのため、最初は本記事でいう Query-Driven な仕組み（本番のデータを ETL パイプラインで DWH に運び、 SQL で頑張って集計する）からはじめ、事業の規模が拡大したり複雑化したら Event-Driven な仕組みを検討し始めるという方針がおすすめだ。&lt;/p&gt;
&lt;h2 id=&quot;最後に&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%9C%80%E5%BE%8C%E3%81%AB&quot; aria-label=&quot;最後に permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;最後に&lt;/h2&gt;
&lt;p&gt;自分はもともと経理の仕事をしていたのが本記事のような会計データ基盤でプロダクトマネージャーの仕事をするようになり今ではプログラマーをやっているのだが、その理由として以下の2点がある。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;本記事のような「会計データを集計する仕組み」を自分で PdM ではなく一人のプログラマーとして一から作りたい&lt;/li&gt;
&lt;li&gt;もしそれが上手くいかなくても、会計とプログラミング両方の知識や経験があれば当分の間は食いっぱぐれなさそう&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;この記事をご覧になって興味ある方がいたらぜひお話ししたいです。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Go の encoding/csv を読んだ話]]></title><description><![CDATA[ここ1ヶ月くらい空き時間で Go をやっている。 有名なチュートリアル A Tour of Go を二周したので、次の課題として言語標準のパッケージがどのように書かれているのかを調べることにした。理由としては、 Go は Go…]]></description><link>https://lyohe.github.io/2022-06-17-go-encoding-csv/</link><guid isPermaLink="false">https://lyohe.github.io/2022-06-17-go-encoding-csv/</guid><pubDate>Fri, 17 Jun 2022 09:01:31 GMT</pubDate><content:encoded>&lt;p&gt;ここ1ヶ月くらい空き時間で &lt;a href=&quot;https://go.dev/&quot;&gt;Go&lt;/a&gt; をやっている。&lt;/p&gt;
&lt;p&gt;有名なチュートリアル &lt;a href=&quot;https://go-tour-jp.appspot.com/list&quot;&gt;A Tour of Go&lt;/a&gt; を二周したので、次の課題として言語標準のパッケージがどのように書かれているのかを調べることにした。理由としては、 Go は Go で書かれており標準パッケージのコードを読むとより Go らしい書き方を身につけられそうと考えたため。&lt;/p&gt;
&lt;p&gt;その題材として &lt;code class=&quot;language-text&quot;&gt;CSV&lt;/code&gt; 形式の入出力を処理する &lt;a href=&quot;https://pkg.go.dev/encoding/csv&quot;&gt;encoding/csv&lt;/a&gt; のドキュメントとソースコードを読んだので、この記事にまとめておく。これを選んだのは CSV が自分が経理の仕事で慣れ親しんだフォーマットだったからで、それ以上の理由はない。&lt;/p&gt;
&lt;p&gt;ちなみに &lt;a href=&quot;https://twitter.com/tenntenn/status/1528090919597375489&quot;&gt;twitter で質問したら io と error をお薦めされた&lt;/a&gt;。この2つは回答者 tenntenn さんがお薦めされている理由に加えて頻出でもあるので、コードリーディングの題材としてよさそう。実際に encoding/csv の処理をデバッガ等で追っていくと最終的に io や error も現れてくる。&lt;/p&gt;
&lt;h2 id=&quot;コードリーディングの前に&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%82%B3%E3%83%BC%E3%83%89%E3%83%AA%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0%E3%81%AE%E5%89%8D%E3%81%AB&quot; aria-label=&quot;コードリーディングの前に permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;コードリーディングの前に&lt;/h2&gt;
&lt;p&gt;Go のコードを読む際にはこの動画が参考になった。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=X0tzCL5gqr8&quot;&gt;コードリーディングをしよう！ - tenntenn Conference 2022&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=cZJE-pK_uKs&quot;&gt;errorsパッケージを読む - tenntenn.go#1&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Go はコメントが充実していて読みやすい。ソースコードはこちら。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://cs.opensource.google/go/go&quot;&gt;https://cs.opensource.google/go/go&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;csv-について&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#csv-%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6&quot; aria-label=&quot;csv について permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;CSV について&lt;/h2&gt;
&lt;p&gt;コードを読む前に CSV について復習していく。&lt;/p&gt;
&lt;p&gt;一般的には &lt;code class=&quot;language-text&quot;&gt;Comma-Separated Values&lt;/code&gt; で略して &lt;code class=&quot;language-text&quot;&gt;CSV&lt;/code&gt; と呼ばれる。仕様は &lt;a href=&quot;https://datatracker.ietf.org/doc/html/rfc4180&quot;&gt;RFC 4180&lt;/a&gt; で定められているが、分類は Informational となっており、つまりは国際的に標準化されたものではなく単なる参考と言える。&lt;/p&gt;
&lt;p&gt;CSV はデータを受け渡すフォーマットとして幅広く利用されており、例えば Excel や Google Sheets などの表計算ソフトウェアで CSV を取り込んだり出力したりできる。私は長年に亘り経理の仕事をしていたのだが、何かと CSV にはお世話になった。&lt;/p&gt;
&lt;p&gt;例えば…&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;銀行に総合振込（振込先と金額を記載したファイルを送り、一括で振込する処理）を指示するために銀行の指定する形式の CSV を専用の Web サイトからアップロードする&lt;/li&gt;
&lt;li&gt;財務会計ソフトに取り込む仕訳データを CSV で作る&lt;/li&gt;
&lt;li&gt;ERP などの業務システムから CSV 形式でデータを取得し、それを加工して資料を作る&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;rfc-4180-の概要&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#rfc-4180-%E3%81%AE%E6%A6%82%E8%A6%81&quot; aria-label=&quot;rfc 4180 の概要 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;RFC 4180 の概要&lt;/h2&gt;
&lt;p&gt;CSV の仕様はマネックス社の技術ブログで取り上げられているので、詳しく気になる方はそちらもご覧いただくのがよさそう。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://blog.tech-monex.com/entry/2021/03/26/160000&quot;&gt;CSVの国際標準 RFC 4180 と JSONの国際標準 RFC 8259 をいまさら読みなおしてみた 前編&lt;/a&gt; / &lt;a href=&quot;https://blog.tech-monex.com/entry/2021/04/02/160000&quot;&gt;後編&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;以下に特徴的な CSV の仕様についてまとめる。&lt;/p&gt;
&lt;h3 id=&quot;レコード&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%83%AC%E3%82%B3%E3%83%BC%E3%83%89&quot; aria-label=&quot;レコード permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;レコード&lt;/h3&gt;
&lt;p&gt;CSV では、レコードは改行 &lt;code class=&quot;language-text&quot;&gt;CRLF&lt;/code&gt; によって区切られている。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;aaa, bbb, ccc CRLF
aaa, bbb, ccc CRLF&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;このとき、最後の行には改行はなくても構わない。&lt;/p&gt;
&lt;h3 id=&quot;ヘッダー&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%83%98%E3%83%83%E3%83%80%E3%83%BC&quot; aria-label=&quot;ヘッダー permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;ヘッダー&lt;/h3&gt;
&lt;p&gt;最初のレコードをヘッダーとすることができる。ヘッダーレコードは&lt;strong&gt;2つ目以降のレコードと同数のフィールド&lt;/strong&gt;を持ち、それぞれのフィールドに対応する名前を持つ。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;field_a,field_b,field_c CRLF
aaa,bbb,ccc CRLF
aaa,bbb,ccc CRLF&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;このとき、 MIME type でヘッダーの有無を指定すべきである。&lt;/p&gt;
&lt;h3 id=&quot;区切り文字&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%8C%BA%E5%88%87%E3%82%8A%E6%96%87%E5%AD%97&quot; aria-label=&quot;区切り文字 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;区切り文字&lt;/h3&gt;
&lt;p&gt;CSV という名前の通り、レコードとヘッダーはコンマ &lt;code class=&quot;language-text&quot;&gt;,&lt;/code&gt; で区切られる。&lt;/p&gt;
&lt;p&gt;ファイル全体に渡り、全てのレコードおよびヘッダーは同じ数のフィールドを持つべきである。スペースは無視されず、フィールドの一部として扱われる。&lt;/p&gt;
&lt;p&gt;各レコードの最後のフィールドにはコンマ &lt;code class=&quot;language-text&quot;&gt;,&lt;/code&gt; を&lt;strong&gt;つけてはいけない&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;つまり、下記は RFC 通りだが&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;aaa,bbb,ccc&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;以下の書き方は RFC に反している。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;aaa,bbb,ccc,&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;二重引用符&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BA%8C%E9%87%8D%E5%BC%95%E7%94%A8%E7%AC%A6&quot; aria-label=&quot;二重引用符 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;二重引用符&lt;/h3&gt;
&lt;p&gt;各フィールドは二重引用符 &lt;code class=&quot;language-text&quot;&gt;&quot;&lt;/code&gt; で囲んでも良いし、囲まなくても良い。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;&quot;aaa&quot;,&quot;bbb&quot;,&quot;ccc&quot; CRLF
xxx,yyy,zzz&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ただし、フィールド内に改行 &lt;code class=&quot;language-text&quot;&gt;CRLF&lt;/code&gt;、二重引用符 &lt;code class=&quot;language-text&quot;&gt;&quot;&lt;/code&gt;、コンマ &lt;code class=&quot;language-text&quot;&gt;,&lt;/code&gt; を持つ場合は、フィールドを二重引用符 &lt;code class=&quot;language-text&quot;&gt;&quot;&lt;/code&gt; で囲むべきである。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;&quot;aaa&quot;,&quot;b CRLF
bb&quot;,&quot;ccc&quot; CRLF
xxx,yyy,zzz&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;上記の CSV は見た目は3行だが、1行目と2行目がひとつのレコードであり、レコード数は2となる。&lt;/p&gt;
&lt;p&gt;もし &lt;code class=&quot;language-text&quot;&gt;&quot;&lt;/code&gt; でフィールドを囲む場合、その内側では &lt;code class=&quot;language-text&quot;&gt;&quot;&lt;/code&gt; を使うべきではない。もし使う場合は、下記のように別の &lt;code class=&quot;language-text&quot;&gt;&quot;&lt;/code&gt; でエスケープする。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;&quot;aaa&quot;,&quot;b&quot;&quot;bb&quot;,&quot;ccc&quot;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;まとめると、 CSV ファイルで使われる二重引用符 &lt;code class=&quot;language-text&quot;&gt;&quot;&lt;/code&gt; には以下3つの役割がある。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;フィールドの最初と最後につけることでフィールドを囲む&lt;/li&gt;
&lt;li&gt;フィールドの内容を表す（このとき、&lt;strong&gt;エスケープしなければならない&lt;/strong&gt;）&lt;/li&gt;
&lt;li&gt;フィールドの内容を表す二重引用符をエスケープする&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Go の encoding/csv は利用者にこの RFC 4180 に準拠した入力を与えるよう期待している。ただし、 Reader や Writer の構造体に用意されているフィールドを&lt;strong&gt;明示的に書き換えることで RFC 4180 に反するような入出力が可能&lt;/strong&gt;となる。&lt;/p&gt;
&lt;h2 id=&quot;まず簡単に使ってみる&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%81%BE%E3%81%9A%E7%B0%A1%E5%8D%98%E3%81%AB%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B&quot; aria-label=&quot;まず簡単に使ってみる permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;まず簡単に使ってみる&lt;/h2&gt;
&lt;p&gt;ドキュメントやソースコードを読む前にとりあえず &lt;code class=&quot;language-text&quot;&gt;encoding/csv&lt;/code&gt; を使った簡単なプログラムを書いてみることにした。&lt;/p&gt;
&lt;p&gt;このような CSV に test.csv という名前をつけて読んでみる。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;従業員コード,名前,メールアドレス
1,ヤマダ,yamada@example.com
2,サトウ,sato@example.com
3,スズキ,suzuki@example.com
4,タナカ,tanaka@example.com
5,ハシモト,hashimoto@example.com&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;このファイルをゼロから自分で解析する場合は先に挙げた仕様を満たすような実装を自分で書く必要があるが、 encoding/csv を使うと &lt;code class=&quot;language-text&quot;&gt;NewReader&lt;/code&gt; を呼んで返ってくる構造体 Reader を使うだけでよい。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;NewReader&lt;/code&gt; が返す構造体を使って CSV を読むにはファイル全体を読む &lt;code class=&quot;language-text&quot;&gt;ReadAll()&lt;/code&gt; と1レコードずつ読む &lt;code class=&quot;language-text&quot;&gt;Read()&lt;/code&gt; の2種類の方法があるが、以下では Read() を使った。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; main

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
	&lt;span class=&quot;token string&quot;&gt;&quot;encoding/csv&quot;&lt;/span&gt;
	&lt;span class=&quot;token string&quot;&gt;&quot;fmt&quot;&lt;/span&gt;
	&lt;span class=&quot;token string&quot;&gt;&quot;io&quot;&lt;/span&gt;
	&lt;span class=&quot;token string&quot;&gt;&quot;os&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// CSV ファイルを開く&lt;/span&gt;
	file&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; os&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Open&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;test.csv&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;panic&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;err&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;defer&lt;/span&gt; file&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Close&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// CSV ファイルを読む&lt;/span&gt;
	csvReader &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; csv&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;NewReader&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;file&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		line&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; csvReader&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Read&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; io&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;EOF &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;token keyword&quot;&gt;break&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;token function&quot;&gt;panic&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;err&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
		fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;line&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;実行すると次のような出力を得る。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;[従業員コード 名前 メールアドレス]
[1 ヤマダ yamada@example.com]
[2 サトウ sato@example.com]
[3 スズキ suzuki@example.com]
[4 タナカ tanaka@example.com]
[5 ハシモト hashimoto@example.com]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;この各行は Read() が返すスライス &lt;code class=&quot;language-text&quot;&gt;[]string&lt;/code&gt; である。 &lt;code class=&quot;language-text&quot;&gt;Read()&lt;/code&gt; ではなく &lt;code class=&quot;language-text&quot;&gt;ReadAll()&lt;/code&gt; を使うとファイル全体を二次元のスライス &lt;code class=&quot;language-text&quot;&gt;[][]string&lt;/code&gt; で返す。&lt;/p&gt;
&lt;p&gt;次に、より詳細な挙動を把握するためドキュメントを読んでみる。&lt;/p&gt;
&lt;h2 id=&quot;ドキュメントとソースコードを読む&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88%E3%81%A8%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E8%AA%AD%E3%82%80&quot; aria-label=&quot;ドキュメントとソースコードを読む permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;ドキュメントとソースコードを読む&lt;/h2&gt;
&lt;p&gt;encoding/csv には reader.go と writer.go の2つのファイルがある。それぞれ CSV を読み書きするための構造体や関数が書かれている。&lt;/p&gt;
&lt;h3 id=&quot;readergo&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#readergo&quot; aria-label=&quot;readergo permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;reader.go&lt;/h3&gt;
&lt;h4 id=&quot;type-reader&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#type-reader&quot; aria-label=&quot;type reader permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;a href=&quot;https://pkg.go.dev/encoding/csv#Reader&quot;&gt;type Reader&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt;&lt;a href=&quot;https://cs.opensource.google/go/go/+/3474cd4eee82ac442618391f8bc4a70d7b1cb65a:src/encoding/csv/reader.go;l=99-174;bpv=0;bpt=0&quot;&gt;src&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Reader&lt;/code&gt; は &lt;code class=&quot;language-text&quot;&gt;NewReader()&lt;/code&gt; 関数が返す構造体で、これを通じて RFC 4180 に準拠した入力を読み取ることができる。また、この構造体に定義されているフィールドを書き換えることで Reader の挙動をカスタマイズできる。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// ソースコードには大量のコメントがついているが省略した&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 大文字で始まるフィールドの値を書き換えることで、 RFC 4180 に反する入力を読み取ることができる&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; Reader &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	Comma &lt;span class=&quot;token builtin&quot;&gt;rune&lt;/span&gt;
	Comment &lt;span class=&quot;token builtin&quot;&gt;rune&lt;/span&gt;
	FieldsPerRecord &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;
	LazyQuotes &lt;span class=&quot;token builtin&quot;&gt;bool&lt;/span&gt;
	TrimLeadingSpace &lt;span class=&quot;token builtin&quot;&gt;bool&lt;/span&gt;
	ReuseRecord &lt;span class=&quot;token builtin&quot;&gt;bool&lt;/span&gt;
	TrailingComma &lt;span class=&quot;token builtin&quot;&gt;bool&lt;/span&gt;
	r &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;bufio&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Reader
	numLine &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;
	offset &lt;span class=&quot;token builtin&quot;&gt;int64&lt;/span&gt;
	rawBuffer &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;byte&lt;/span&gt;
	recordBuffer &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;byte&lt;/span&gt;
	fieldIndexes &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;
	fieldPositions &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;position
	lastRecord &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;特徴的なフィールドは &lt;code class=&quot;language-text&quot;&gt;Comment&lt;/code&gt; で、 CSV 中にコメントを残しそのレコードを読み取り時に無視することができる。ちなみに RFC 4180 にはコメントについて特に記述はない。&lt;/p&gt;
&lt;p&gt;例えば先述の CSV で、以下のように &lt;code class=&quot;language-text&quot;&gt;#&lt;/code&gt; をつけたレコードをコメントアウトしたい（つまり、そのレコードを無視したい）とする。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;従業員コード,名前,メールアドレス
1,ヤマダ,yamada@example.com
2,サトウ,sato@example.com
3,スズキ,suzuki@example.com
4,タナカ,tanaka@example.com
#メールアドレス変更予定につき一時的にコメントアウト　5,ハシモト,hashimoto@example.com&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;このとき、先程のプログラムで Comment フィールドにコメントを表す記号 &lt;code class=&quot;language-text&quot;&gt;#&lt;/code&gt; を入れておくとそのレコードを無視できる。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;csvReader &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; csv&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;NewReader&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;file&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
csvReader&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Comment &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;#&apos;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;出力は以下のようになる。 &lt;code class=&quot;language-text&quot;&gt;#&lt;/code&gt; でコメントアウトしたレコードが除かれている。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;[従業員コード 名前 メールアドレス]
[1 ヤマダ yamada@example.com]
[2 サトウ sato@example.com]
[3 スズキ suzuki@example.com]
[4 タナカ tanaka@example.com]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;なお、コメントアウトできるのはレコードの先頭に記号をつけたときのみである。&lt;/p&gt;
&lt;p&gt;より詳しくはドキュメントの Example (Options) を参照。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://pkg.go.dev/encoding/csv#example-Reader-Options&quot;&gt;https://pkg.go.dev/encoding/csv#example-Reader-Options&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;他にも様々なフィールドがある。よく使いそうなのだと…&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Comma&lt;/code&gt; rune: 区切り文字を設定する（つまりタブなど他の文字も区切りにできる）&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;FieldsPerRecord&lt;/code&gt; int: 各レコードに期待されるフィールド数を設定する（負の数字を入れるとチェックしないようにできる）&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;TrimLeadingSpace&lt;/code&gt; bool: 先頭の white space を無視する（区切り文字がスペースでも無視する）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;FieldsPerRecord に負の数字を入れると各行のフィールド数チェックをしないためレコードごとにフィールド数が異なる（つまり RFC 4180 に準拠しない） CSV を読み書きできるようになる。一見これは何のためにあるんだ？と思うかもしれないが、世の中には RFC 4180 に準拠しない CSV が平然と使われているので便利と言えるかもしれない。&lt;/p&gt;
&lt;p&gt;例えば「全銀フォーマット CSV」と呼ばれる銀行の総合振込に用いられるデータ形式では、レコードの種類を各レコード最初のフィールドで指定し、その種類ごとにフィールド数が異なるという仕様になっている。&lt;/p&gt;
&lt;p&gt;参考: &lt;a href=&quot;https://www.rakuten-bank.co.jp/business/howto/pdf/h07_06_10.pdf&quot;&gt;楽天銀行 - 依頼ファイル仕様（全銀フォーマット CSV 形式）&lt;/a&gt;&lt;/p&gt;
&lt;h4 id=&quot;newreader&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#newreader&quot; aria-label=&quot;newreader permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;a href=&quot;https://pkg.go.dev/encoding/csv#NewReader&quot;&gt;NewReader()&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt;&lt;a href=&quot;https://cs.opensource.google/go/go/+/3474cd4eee82ac442618391f8bc4a70d7b1cb65a:src/encoding/csv/reader.go;l=176-182;bpv=0;bpt=0&quot;&gt;src&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;io.Reader を満たす引数（ファイルや標準入力）を受け取り、上述の構造体 &lt;code class=&quot;language-text&quot;&gt;Reader&lt;/code&gt; を作ってそのポインタを返すだけの関数。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;NewReader&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;r io&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Reader&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;Reader &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;Reader&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		Comma&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;,&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
		r&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;     bufio&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;NewReader&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;r&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;区切り文字がデフォルトで &lt;code class=&quot;language-text&quot;&gt;,&lt;/code&gt; にされていることが分かる。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;bufio.NewReader()&lt;/code&gt; は io.Reader 用のバッファをデフォルトのサイズ 4096 byte で作って返す関数。&lt;/p&gt;
&lt;h4 id=&quot;readerfieldpos&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#readerfieldpos&quot; aria-label=&quot;readerfieldpos permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;a href=&quot;https://pkg.go.dev/encoding/csv#Reader.FieldPos&quot;&gt;(*Reader).FieldPos()&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt;&lt;a href=&quot;https://cs.opensource.google/go/go/+/3474cd4eee82ac442618391f8bc4a70d7b1cb65a:src/encoding/csv/reader.go;l=202-214;bpv=0;bpt=1&quot;&gt;src&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;CSV 処理中のレコードとカラムのインデックスを返す関数。カラムのインデックスはバイト単位で数える。あまり使う場面は多くないが、ループで Read を呼び出す中で CSV の解析エラーをデバッグするのに便利そう。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;r &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;Reader&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;FieldPos&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;field &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;line&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; column &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; field &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; field &lt;span class=&quot;token operator&quot;&gt;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;r&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;fieldPositions&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token function&quot;&gt;panic&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;out of range index passed to FieldPos&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	p &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;r&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;fieldPositions&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;field&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; p&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;line&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; p&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;col
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;これは Go 1.17 で追加された新しい関数で、その背景や使い方については以下の記事が詳しい。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://future-architect.github.io/articles/20210811a/&quot;&gt;Future Tech Blog - Go1.17のencoding/csv&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;次に示す &lt;code class=&quot;language-text&quot;&gt;Read()&lt;/code&gt; 関数が最後に返した string スライスのうち、引数で指定したバイト単位のインデックスを持つフィールドの先頭に対応する行と列の番号を返す。&lt;/p&gt;
&lt;h4 id=&quot;readerread&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#readerread&quot; aria-label=&quot;readerread permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;a href=&quot;https://pkg.go.dev/encoding/csv#Reader.Read&quot;&gt;(*Reader).Read()&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt;&lt;a href=&quot;https://cs.opensource.google/go/go/+/3474cd4eee82ac442618391f8bc4a70d7b1cb65a:src/encoding/csv/reader.go;l=184-200;bpv=0;bpt=0&quot;&gt;src&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;構造体 &lt;code class=&quot;language-text&quot;&gt;Reader&lt;/code&gt; をポインタレシーバで受け取り csv を一行ずつ読んで結果を string のスライスで返す関数。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;r &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;Reader&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Read&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;record &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err &lt;span class=&quot;token builtin&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; r&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ReuseRecord &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		record&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; r&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;readRecord&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;r&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;lastRecord&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		r&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;lastRecord &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; record
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		record&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; r&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;readRecord&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; record&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;コメントによると、この関数は常に non-nil のレコード（string のスライス）もしくは non-nil エラーのいずれか片方を返すが、もしフィールドの数が異なるレコードが存在する（RFC 4180 に反する）場合は読み取ったレコードと共に &lt;code class=&quot;language-text&quot;&gt;ErrFieldCount&lt;/code&gt; というエラーを返す。このとき、 Reader 構造体の FieldsPerRecord に負の数字（例えば -1）を設定しておくとこのエラーチェックを迂回できる。&lt;/p&gt;
&lt;p&gt;また、最後の行にたどり着くとレコードとしては nil を返し err として &lt;code class=&quot;language-text&quot;&gt;io.EOF&lt;/code&gt; を返すので、これをチェックしておけばファイルの最後まで読んだことを検知できる。&lt;/p&gt;
&lt;p&gt;これら &lt;code class=&quot;language-text&quot;&gt;Reader&lt;/code&gt; 構造体の各フィールドの設定に応じた実際の読み取り処理は &lt;code class=&quot;language-text&quot;&gt;readRecord&lt;/code&gt; という別の関数（とても長い）で行われている。&lt;/p&gt;
&lt;h4 id=&quot;readrecord&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#readrecord&quot; aria-label=&quot;readrecord permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;readRecord&lt;/h4&gt;
&lt;p&gt;&lt;a href=&quot;https://cs.opensource.google/go/go/+/3474cd4eee82ac442618391f8bc4a70d7b1cb65a:src/encoding/csv/reader.go;l=292-462&quot;&gt;src&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;readRecord&lt;/code&gt; は160行以上ある巨大な関数で、実際に csv を読み取る実装がほぼ全て含まれている。小文字で始まっているので、この関数をパッケージ外から呼ぶことはできない。つまり、パッケージ内部でのみ使われている。全部読んでいくのはしんどいが、コメントを追っていけば処理の流れはわかりやすい。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://cs.opensource.google/go/go/+/3474cd4eee82ac442618391f8bc4a70d7b1cb65a:src/encoding/csv/reader.go;l=293-296&quot;&gt;L293-296&lt;/a&gt; 区切り文字とコメントに使う文字は異なる文字でなければならない。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://cs.opensource.google/go/go/+/3474cd4eee82ac442618391f8bc4a70d7b1cb65a:src/encoding/csv/reader.go;l=297-315&quot;&gt;L297-315&lt;/a&gt;: &lt;a href=&quot;https://cs.opensource.google/go/go/+/3474cd4eee82ac442618391f8bc4a70d7b1cb65a:src/encoding/csv/reader.go;l=246-277&quot;&gt;readLine&lt;/a&gt; で bufio の ReadSlice を呼び、区切り文字までのバイト列を読み込む。このとき &lt;a href=&quot;https://cs.opensource.google/go/go/+/3474cd4eee82ac442618391f8bc4a70d7b1cb65a:src/encoding/csv/reader.go;l=278-285&quot;&gt;lengNL&lt;/a&gt; と &lt;a href=&quot;https://cs.opensource.google/go/go/+/3474cd4eee82ac442618391f8bc4a70d7b1cb65a:src/encoding/csv/reader.go;l=286-291&quot;&gt;nextRune&lt;/a&gt; を使って行頭にコメントがあるレコードや空のレコードを読み飛ばしている。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://cs.opensource.google/go/go/+/3474cd4eee82ac442618391f8bc4a70d7b1cb65a:src/encoding/csv/reader.go;l=316-433&quot;&gt;L316-433&lt;/a&gt;: 読み込んだレコードに対して、 Reader 構造体のフィールドに応じた処理をしていく。このときレコードの中身は Reader 構造体の &lt;a href=&quot;https://cs.opensource.google/go/go/+/3474cd4eee82ac442618391f8bc4a70d7b1cb65a:src/encoding/csv/reader.go;l=158-162;bpv=0;bpt=1&quot;&gt;recordBuffer&lt;/a&gt; フィールドにまとめて &lt;code class=&quot;language-text&quot;&gt;[]byte&lt;/code&gt; で書き込まれ、各フィールド終了位置のインデックスは &lt;a href=&quot;https://cs.opensource.google/go/go/+/3474cd4eee82ac442618391f8bc4a70d7b1cb65a:src/encoding/csv/reader.go;l=164-166;bpv=0;bpt=1&quot;&gt;fieldIndexes&lt;/a&gt; に &lt;code class=&quot;language-text&quot;&gt;[]int&lt;/code&gt; で、どのバイトまで読んだかは &lt;a href=&quot;https://cs.opensource.google/go/go/+/3474cd4eee82ac442618391f8bc4a70d7b1cb65a:src/encoding/csv/reader.go;l=168-170&quot;&gt;fieldPositions&lt;/a&gt; に行と列をそれぞれ int で持つ type &lt;a href=&quot;https://cs.opensource.google/go/go/+/3474cd4eee82ac442618391f8bc4a70d7b1cb65a:src/encoding/csv/reader.go;l=223-226&quot;&gt;position&lt;/a&gt; のスライスとして書き込まれる。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://cs.opensource.google/go/go/+/3474cd4eee82ac442618391f8bc4a70d7b1cb65a:src/encoding/csv/reader.go;l=434-447&quot;&gt;L434-447&lt;/a&gt;: recordBuffer への読み込みが一通り終わったら、それを fieldIndexes に記録したインデックス毎に区切って &lt;code class=&quot;language-text&quot;&gt;[]string&lt;/code&gt; に変換する。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://cs.opensource.google/go/go/+/3474cd4eee82ac442618391f8bc4a70d7b1cb65a:src/encoding/csv/reader.go;l=448-460&quot;&gt;L448-460&lt;/a&gt;: 最後に Reader 構造体の FieldsPerRecord が正の数であるときに各レコードのフィールド数が同じかどうかをチェックする。デフォルト値は最初に読み取ったレコードのフィールド数となる。読み取り前に負の値を設定しておけばこのフィールド数チェックを迂回できる。&lt;/p&gt;
&lt;p&gt;この関数で &lt;a href=&quot;https://cs.opensource.google/go/go/+/3474cd4eee82ac442618391f8bc4a70d7b1cb65a:src/encoding/csv/reader.go;l=325;bpv=0;bpt=1&quot;&gt;L325&lt;/a&gt; 以降のような長い for 文を書くときにラベルをつけて break や continue できるのを知った。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;parseField&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 数十行のクソ長い処理&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;break&lt;/span&gt; parseField
    &lt;span class=&quot;token comment&quot;&gt;// 数十行のクソ長い処理&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;continue&lt;/span&gt; parseField
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ループの行数が多くなると &lt;code class=&quot;language-text&quot;&gt;break&lt;/code&gt; や &lt;code class=&quot;language-text&quot;&gt;continue&lt;/code&gt; が指す先が分かりにくくなるので、これは便利そう。&lt;/p&gt;
&lt;h3 id=&quot;writergo&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#writergo&quot; aria-label=&quot;writergo permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;writer.go&lt;/h3&gt;
&lt;p&gt;reader.go に比べると writer.go は行数も半分以下で読みやすい。&lt;/p&gt;
&lt;h4 id=&quot;type-writer&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#type-writer&quot; aria-label=&quot;type writer permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;a href=&quot;https://pkg.go.dev/encoding/csv#Writer&quot;&gt;type Writer&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt;&lt;a href=&quot;https://cs.opensource.google/go/go/+/3474cd4eee82ac442618391f8bc4a70d7b1cb65a:src/encoding/csv/writer.go;l=15-34;bpv=0;bpt=1&quot;&gt;src&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Reader と同様に Comma フィールドで区切り文字を書き換えることができる。UseCRLF が true の場合、Writer は各出力行の最後に &lt;code class=&quot;language-text&quot;&gt;\n&lt;/code&gt; の代わりに &lt;code class=&quot;language-text&quot;&gt;\rn&lt;/code&gt; を出力する。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; Writer &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	Comma   &lt;span class=&quot;token builtin&quot;&gt;rune&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// Field delimiter (set to &apos;,&apos; by NewWriter)&lt;/span&gt;
	UseCRLF &lt;span class=&quot;token builtin&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// True to use \r\n as the line terminator&lt;/span&gt;
	w       &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;bufio&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Writer
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;注意点として、 Writer を使って CSV に書き込んだ後に Flush() 関数を呼ばなければならない。&lt;/p&gt;
&lt;p&gt;詳しくは &lt;a href=&quot;https://pkg.go.dev/encoding/csv#example-Writer&quot;&gt;example&lt;/a&gt; を参照。&lt;/p&gt;
&lt;h4 id=&quot;newwriter&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#newwriter&quot; aria-label=&quot;newwriter permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;a href=&quot;https://pkg.go.dev/encoding/csv#NewWriter&quot;&gt;NewWriter()&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt;&lt;a href=&quot;https://cs.opensource.google/go/go/+/3474cd4eee82ac442618391f8bc4a70d7b1cb65a:src/encoding/csv/writer.go;l=36-42&quot;&gt;src&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;io.Writer インターフェイスを満たす引数を受け取って Writer 構造体を返す関数。この引数が Write する先になるので、 &lt;code class=&quot;language-text&quot;&gt;os.Stdout&lt;/code&gt; を指定すれば標準出力できる。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// NewWriter returns a new Writer that writes to w.&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;NewWriter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;w io&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Writer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;Writer &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;Writer&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		Comma&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;,&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
		w&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;     bufio&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;NewWriter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;w&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4 id=&quot;writerwrite&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#writerwrite&quot; aria-label=&quot;writerwrite permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;a href=&quot;https://pkg.go.dev/encoding/csv#Writer.Write&quot;&gt;(*Writer).Write()&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt;&lt;a href=&quot;https://cs.opensource.google/go/go/+/3474cd4eee82ac442618391f8bc4a70d7b1cb65a:src/encoding/csv/writer.go;l=44-119&quot;&gt;src&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;CSV のレコード1行（つまり各フィールドのスライス）を &lt;code class=&quot;language-text&quot;&gt;[]string&lt;/code&gt; で受け取り、フィールドの数だけループして Writer 構造体が示すバッファに書き込む関数。&lt;/p&gt;
&lt;p&gt;次の順序で処理する。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://cs.opensource.google/go/go/+/3474cd4eee82ac442618391f8bc4a70d7b1cb65a:src/encoding/csv/writer.go;l=60-67&quot;&gt;L60-67&lt;/a&gt;: 引用符で囲む必要があるかどうかをチェックする
&lt;ul&gt;
&lt;li&gt;必要なければそのまま書いて次のフィールドへ continue&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://cs.opensource.google/go/go/+/3474cd4eee82ac442618391f8bc4a70d7b1cb65a:src/encoding/csv/writer.go;l=69-71&quot;&gt;L69-71&lt;/a&gt;: 引用符が必要な場合はまず最初の &lt;code class=&quot;language-text&quot;&gt;&quot;&lt;/code&gt; を書く&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://cs.opensource.google/go/go/+/3474cd4eee82ac442618391f8bc4a70d7b1cb65a:src/encoding/csv/writer.go;l=72-111&quot;&gt;L72-111&lt;/a&gt;: フィールドの長さが 0 でなければ特殊文字（改行 &lt;code class=&quot;language-text&quot;&gt;\r&lt;/code&gt; &lt;code class=&quot;language-text&quot;&gt;\n&lt;/code&gt; と引用符 &lt;code class=&quot;language-text&quot;&gt;&quot;&lt;/code&gt;）を数える
&lt;ul&gt;
&lt;li&gt;特殊文字の中身と Writer 構造体の UseCRLF フィールドの設定に応じて特殊文字を書き込む
&lt;ul&gt;
&lt;li&gt;例えば UseCRLF が true なら、 &lt;code class=&quot;language-text&quot;&gt;\n&lt;/code&gt; に対して &lt;code class=&quot;language-text&quot;&gt;\r\n&lt;/code&gt; を書く&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://cs.opensource.google/go/go/+/3474cd4eee82ac442618391f8bc4a70d7b1cb65a:src/encoding/csv/writer.go;l=113-117&quot;&gt;L113-117&lt;/a&gt;: UseCRLF が true なら各レコードの末尾に &lt;code class=&quot;language-text&quot;&gt;\r\n&lt;/code&gt; を、 false なら &lt;code class=&quot;language-text&quot;&gt;\n&lt;/code&gt; を書く&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;実際に Write を使って CSV に書き込むコードは以下のようになる。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; main

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
	&lt;span class=&quot;token string&quot;&gt;&quot;encoding/csv&quot;&lt;/span&gt;
	&lt;span class=&quot;token string&quot;&gt;&quot;log&quot;&lt;/span&gt;
	&lt;span class=&quot;token string&quot;&gt;&quot;os&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  records &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;first_name&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;last_name&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;username&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Rob&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Pike&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;rob&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Ken&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Thompson&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;ken&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Robert&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Griesemer&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;gri&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  file&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; os&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Create&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;users.csv&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// CSV のファイル名&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  	log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Fatal&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;err&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  csvWriter &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; csv&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;NewWriter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;file&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; record &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;range&lt;/span&gt; records &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// ここで Writer 構造体のバッファにデータを書き込む&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; csvWriter&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Write&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;record&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Fatalln&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;error writing record to csv:&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// バッファのデータを io.Writer （ここでは CSV ファイル）に書き込む関数&lt;/span&gt;
  csvWriter&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Flush&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; csvWriter&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Fatal&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;err&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;注意点として、（デバッガで動かすとすぐに分かるが）Write は内部的には bufio のバッファに入力をコピーしているだけなので、これを呼んだ後に後述の Flush を呼ばないと何も書き込まれない。&lt;/p&gt;
&lt;p&gt;bufio のコードを読む限りではバッファに空きがないときは Flush するようになっているようで、よくできた仕組みだと思った。&lt;/p&gt;
&lt;h4 id=&quot;writerflush&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#writerflush&quot; aria-label=&quot;writerflush permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;a href=&quot;https://pkg.go.dev/encoding/csv#Writer.Flush&quot;&gt;(*Writer).Flush&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt;&lt;a href=&quot;https://cs.opensource.google/go/go/+/3474cd4eee82ac442618391f8bc4a70d7b1cb65a:src/encoding/csv/writer.go;l=121-125&quot;&gt;src&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;encoding/csv の Write 関数は bufio のバッファに書き込む。これを io.Writer に渡すにはこの Flush 関数を呼ばなければならない。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// Flush writes any buffered data to the underlying io.Writer.&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// To check if an error occurred during the Flush, call Error.&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;w &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;Writer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Flush&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	w&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;w&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Flush&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;内部ではこのように &lt;a href=&quot;https://cs.opensource.google/go/go/+/3474cd4eee82ac442618391f8bc4a70d7b1cb65a:src/bufio/bufio.go;l=621-643&quot;&gt;bufio の Flush&lt;/a&gt; を呼んでいるだけ。 bufio の方ではバッファと io.Writer を持つ構造体があって、それを使って io.Writer に書き込んでいる。&lt;/p&gt;
&lt;p&gt;繰り返しになるが Write を呼んだ後に Flush を呼ばないと書き込まれないので注意する。&lt;/p&gt;
&lt;h4 id=&quot;fieldneedsquote&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#fieldneedsquote&quot; aria-label=&quot;fieldneedsquote permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;fieldNeedsQuote&lt;/h4&gt;
&lt;p&gt;&lt;a href=&quot;https://cs.opensource.google/go/go/+/3474cd4eee82ac442618391f8bc4a70d7b1cb65a:src/encoding/csv/writer.go;l=145-181&quot;&gt;src&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;CSV のレコード中のフィールドを1つ受け取り、それが引用符で囲まれなければならないかどうかを bool で返す関数。Write 関数から呼び出される。小文字で始まっていることから分かるように、パッケージ内部でのみ使う。&lt;/p&gt;
&lt;p&gt;フィールドが以下の5通りのいずれかを満たすとき、この関数は &lt;code class=&quot;language-text&quot;&gt;true&lt;/code&gt; を返す。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;引用符 &lt;code class=&quot;language-text&quot;&gt;&quot;&lt;/code&gt; を含む&lt;/li&gt;
&lt;li&gt;改行 &lt;code class=&quot;language-text&quot;&gt;\r&lt;/code&gt; もしくは &lt;code class=&quot;language-text&quot;&gt;\n&lt;/code&gt;を含む&lt;/li&gt;
&lt;li&gt;コンマ &lt;code class=&quot;language-text&quot;&gt;,&lt;/code&gt; 、または Writer 構造体の Comma フィールドで設定された区切り文字を含む&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;\.&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;スペースで始まる&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;なお、空文字列に対しては &lt;code class=&quot;language-text&quot;&gt;false&lt;/code&gt; を返す。つまり、空文字列は引用符で囲まなくてもよい（Go 1.4 以降）。これは Excel や Google Sheets が CSV を作る際の挙動と合わせるため。&lt;/p&gt;
&lt;h2 id=&quot;感想&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%84%9F%E6%83%B3&quot; aria-label=&quot;感想 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;感想&lt;/h2&gt;
&lt;p&gt;読んでみて非常に面白かったので感想を残しておく。&lt;/p&gt;
&lt;p&gt;Go に限らない一般的なプログラミング手法について、および Go の読み書きについて大変参考になった。&lt;/p&gt;
&lt;h3 id=&quot;go-に限らない一般的なプログラミング手法&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#go-%E3%81%AB%E9%99%90%E3%82%89%E3%81%AA%E3%81%84%E4%B8%80%E8%88%AC%E7%9A%84%E3%81%AA%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0%E6%89%8B%E6%B3%95&quot; aria-label=&quot;go に限らない一般的なプログラミング手法 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Go に限らない一般的なプログラミング手法&lt;/h3&gt;
&lt;p&gt;まず有用かつ単純なコメントが多いため、初めて読む人間にとっても関数や構造体の振る舞いが分かりやすい。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://lyohe.github.io/2022-05-21-readable-code/&quot;&gt;最近リーダブルコードを読んだ&lt;/a&gt;のだが、 encoding/csv のコメントを読んでいて「これリーダブルコードじゃん」と思った。むしろリーダブルコードがプログラマーの経験知をまとめた著作なので、順序としては逆かもしれない。皆さんもぜひ読んでみてください。&lt;/p&gt;
&lt;p&gt;また、関数の分割方法についても参考になった。encoding/csv ではパッケージの利用者が呼び出す関数はせいぜい数行で、それらの具体的な処理の大部分は内部でしか使わない関数に切り分けられている。例えば RFC に沿って CSV を読む処理の実装はほぼ &lt;code class=&quot;language-text&quot;&gt;readLine&lt;/code&gt; という巨大な関数に書かれている。&lt;/p&gt;
&lt;p&gt;Go では名前が大文字で始まる関数はパッケージ外部から呼び出すことができ、小文字から始まる関数は外部から呼び出せない。この仕様は Go 独特だが、他の言語にも違う記法で同等のことを実現する仕組みはあると思う。利用者が詳しく知る必要がない内部実装を &lt;code class=&quot;language-text&quot;&gt;readRecord&lt;/code&gt; など内部でのみ使う関数にまとめておいて、大文字で始まるつまり外部から使える関数では&lt;strong&gt;それを呼び出す状況や引数をコントロールする&lt;/strong&gt;というのは、プログラムを読み書きしやすくする上で非常に合理的だと思った。&lt;/p&gt;
&lt;p&gt;例えば Read 関数では Reader 構造体の ReuseRecord フィールドの値によって readRecord を呼び出す引数を変えている（&lt;a href=&quot;https://cs.opensource.google/go/go/+/3474cd4eee82ac442618391f8bc4a70d7b1cb65a:src/encoding/csv/reader.go;l=184-200&quot;&gt;src&lt;/a&gt;）。&lt;/p&gt;
&lt;p&gt;これもリーダブルコードの「コードの再構成」で読んだ話に近い。プロとして長年プログラミングをやっている人にとっては当然のことかもしれないが、こうすると読みやすくなるな〜と実感できて良かった。&lt;/p&gt;
&lt;h3 id=&quot;go-の書き方&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#go-%E3%81%AE%E6%9B%B8%E3%81%8D%E6%96%B9&quot; aria-label=&quot;go の書き方 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Go の書き方&lt;/h3&gt;
&lt;p&gt;Go の特徴？として、エラー処理が挙げられる。&lt;/p&gt;
&lt;p&gt;Go では（例えば Java や JavaScript 等で可能なように）例外を投げて try-catch で捕捉するようなエラー処理をせず、原則的には関数から複数の値（処理結果と error）を返すように実装し、呼び出し側で以下のように if 文で分岐することでエラー処理をすることが多い。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;line&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; csvReader&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Read&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// Read() は正常に処理を行ったとき err が nil になる&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// この条件分岐では err が nil ではない、つまりエラーがあるときの処理を書く&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;これはコードが冗長になる一方で、メリットもある。&lt;a href=&quot;https://go.dev/doc/faq#exceptions&quot;&gt;Go の Frequently Asked Questions (FAQ) によれば&lt;/a&gt;、&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;例外を制御機構に結びつけるとコードが複雑になってしまうので、それを防ぐ&lt;/li&gt;
&lt;li&gt;エラー処理すべきところを例外で処理させないよう促す&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;という意図があるようだ。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;We believe that coupling exceptions to a control structure, as in the try-catch-finally idiom, results in convoluted code. It also tends to encourage programmers to label too many ordinary errors, such as failing to open a file, as exceptional.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;他にも開発者がエラー処理について書いた記事として以下が挙げられる。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://go.dev/blog/error-handling-and-go&quot;&gt;https://go.dev/blog/error-handling-and-go&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;In Go, error handling is important. The language’s design and conventions encourage you to explicitly check for errors where they occur (as distinct from the convention in other languages of throwing exceptions and sometimes catching them).&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;過去には様々な議論があると思うので、Go の特徴的な仕様に触れる度に深掘りしていきたい。&lt;/p&gt;
&lt;p&gt;とにかく、 Go では処理結果と error を返して呼び出し側で責任持ってその処理をする、プロセス自体は止めない、止める場合は panic を使うがあくまで例外的な状況、という方針が推奨されている。&lt;/p&gt;
&lt;h2 id=&quot;次の課題&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%AC%A1%E3%81%AE%E8%AA%B2%E9%A1%8C&quot; aria-label=&quot;次の課題 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;次の課題&lt;/h2&gt;
&lt;p&gt;全銀の総合振込フォーマットを検証するパッケージとそれを使ったコマンドラインツールを作る。&lt;/p&gt;
&lt;p&gt;自分もプログラミングの傍ら？経理をやっていて、普段は過去のデータをコピペして作っているのだが、より頭を使わずに処理したいため。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[リーダブルコードを読んだ話]]></title><description><![CDATA[「リーダブルコード」を読んだので、紹介しつつ感想を書く。 https://www.amazon.co.jp/dp/487311565…]]></description><link>https://lyohe.github.io/2022-05-21-readable-code/</link><guid isPermaLink="false">https://lyohe.github.io/2022-05-21-readable-code/</guid><pubDate>Sat, 21 May 2022 00:01:31 GMT</pubDate><content:encoded>&lt;p&gt;「リーダブルコード」を読んだので、紹介しつつ感想を書く。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.amazon.co.jp/dp/4873115655&quot;&gt;https://www.amazon.co.jp/dp/4873115655&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;背景&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%83%8C%E6%99%AF&quot; aria-label=&quot;背景 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;背景&lt;/h2&gt;
&lt;p&gt;普段の仕事でプログラムを書いていて、コードレビューにおいて「リーダブルコード的に言うと…」という指摘を受けることがあった。&lt;/p&gt;
&lt;p&gt;自分で自分のコードの読みやすさに関して課題を感じていた（数ヶ月前に書いたコードが何してるのかよく分からない）こともあり、書籍を読んでみることにした。&lt;/p&gt;
&lt;h2 id=&quot;概要と感想&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%A6%82%E8%A6%81%E3%81%A8%E6%84%9F%E6%83%B3&quot; aria-label=&quot;概要と感想 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;概要と感想&lt;/h2&gt;
&lt;p&gt;書籍の概要は以下の通り。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;コードは理解しやすくなければならない。本書はこの原則を日々のコーディングの様々な場面に当てはめる方法を紹介する。名前の付け方、コメントの書き方など表面上の改善について。コードを動かすための制御フロー、論理式、変数などループとロジックについて。またコードを再構成するための方法。さらにテストの書き方などについて、楽しいイラストと共に説明する。日本語版ではRubyやgroongaのコミッタとしても著名な須藤功平氏による解説を収録。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;まさにこの通りの内容だった。大まかに以下の3部に分かれている。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;表面上の改善&lt;/li&gt;
&lt;li&gt;ループとロジックの単純化&lt;/li&gt;
&lt;li&gt;コードの再構成&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;簡単に紹介する。ここで紹介しているのはほんの一部の実践なので、気になる方はぜひ買って読んでみてください。&lt;/p&gt;
&lt;h3 id=&quot;1-表面上の改善&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1-%E8%A1%A8%E9%9D%A2%E4%B8%8A%E3%81%AE%E6%94%B9%E5%96%84&quot; aria-label=&quot;1 表面上の改善 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;1. 表面上の改善&lt;/h3&gt;
&lt;p&gt;変数や関数の命名、コードのレイアウトやフォーマット、良いコメントのつけ方について。&lt;/p&gt;
&lt;p&gt;変数や関数の命名は明確で具体的にその振る舞いを示す非汎用的名前をつけるのが良い。&lt;/p&gt;
&lt;p&gt;例えば &lt;code class=&quot;language-text&quot;&gt;GetPage&lt;/code&gt; という名前の関数があったとして「ページを取ってくるのかな？」という挙動は予測できるが、それをどこからどうやって取ってくるのかは見当がつかない。インターネット経由で取ってくるなら &lt;code class=&quot;language-text&quot;&gt;FetchPage&lt;/code&gt; とか &lt;code class=&quot;language-text&quot;&gt;DownloadPage&lt;/code&gt; のような名前をつけるべきだろう。&lt;/p&gt;
&lt;p&gt;また、大きさを表すのに &lt;code class=&quot;language-text&quot;&gt;Size&lt;/code&gt; という汎用的な名前よりは &lt;code class=&quot;language-text&quot;&gt;Height&lt;/code&gt; とか &lt;code class=&quot;language-text&quot;&gt;Bytes&lt;/code&gt; のように中身がより明確に想像できる方が良い。&lt;code class=&quot;language-text&quot;&gt;Get&lt;/code&gt; や &lt;code class=&quot;language-text&quot;&gt;Size&lt;/code&gt; のような汎用的な命名であっても、生存期間が短ければ（= 定義してすぐ使われ他の場所では使われないなど、影響範囲が狭ければ）問題ない。&lt;/p&gt;
&lt;p&gt;命名する際はユーザー（その関数や変数を使う側）の視点に立って期待に沿うような命名をする。誤解を防ぐためには、より明確な語彙を使う。例えば文字列を一部削除して整形するような関数なら &lt;code class=&quot;language-text&quot;&gt;clip&lt;/code&gt; よりは &lt;code class=&quot;language-text&quot;&gt;remove&lt;/code&gt; とか &lt;code class=&quot;language-text&quot;&gt;truncate&lt;/code&gt; のように、より具体的な振る舞いを示す単語を使うのが良い。&lt;/p&gt;
&lt;p&gt;コードのレイアウトについても基本的な思想は同じで、読み手に分かりやすいよう整える。読み手が慣れているパターンに沿って関連するコードをブロックにまとめ、似ているコードを同じ場所に集める。プログラムは書く時間より読む時間が長い。&lt;/p&gt;
&lt;p&gt;例えばテストコードであれば、「状況 A で入力 B から振る舞い X を経て出力 Y を期待する」のような動作をコードとして書き、実際にその状況をセットアップしたり入力値を用意する処理はヘルパーメソッドとして分けておくのが良い。&lt;/p&gt;
&lt;p&gt;コメントは書き手の意図を読み手に知らせるための道具であって、コードからすぐに分かることはコメントすべきではない。なぜなら、その分だけコードを読む時間が減るからだ。
例えば下記のコメントは全く役に立たない。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// address で指定されたメールアドレス宛にメールを送る&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;sendMail&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;address&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; subject&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; body&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;/* */&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;コメントするのであれば、「このコードを読む/使う時にミスしがちなことはなんだろう？」のように読み手使い手の立場に立って役に立つコメントを書く。例えば上記の関数であれば、下記のようなコメントだったら役に立つだろう。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// メールを送信する外部サービス hogehoge を呼び出す（1分でタイムアウト）&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;sendMail&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;address&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; subject&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; body&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;/* */&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;関数や変数の中身や振る舞いについてはコメントではなく良い名前をつけることで読みやすくすべきだが、大きなクラスやファイルなどで先頭にその責任や挙動の全体像をコメントすることは理に適っている（その分コードを読む時間が少なくて済む）。&lt;/p&gt;
&lt;h3 id=&quot;2-ループとロジックの単純化&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#2-%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%AD%E3%82%B8%E3%83%83%E3%82%AF%E3%81%AE%E5%8D%98%E7%B4%94%E5%8C%96&quot; aria-label=&quot;2 ループとロジックの単純化 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;2. ループとロジックの単純化&lt;/h3&gt;
&lt;p&gt;制御フローや式の分割について。&lt;/p&gt;
&lt;p&gt;条件やループはできるだけ自然に記述し、読み手が立ち止まって読み返す必要がないようにする。例えば変数を特定の値と比較した結果に応じて処理を分岐する場合を考える。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// 調査対象 -&gt; 比較対象&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;length &lt;span class=&quot;token operator&quot;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;/* */&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// 比較対象 -&gt; 調査対象&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;=&lt;/span&gt; length&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;/* */&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;結果はどちらも同じだが、英語の自然な文法に沿っている上の方が読みやすいだろう。条件やループを自然にする方法としては、関心を引く条件や目立つ条件を先に書くのが良い。また、ネストは浅くして関数からはできるだけ早く返すと読みやすいコードになる。&lt;/p&gt;
&lt;p&gt;条件やループを処理するコードが長くなってきたら、一部の処理の結果を説明したり要約する変数を用意するのが良い。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; line&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;split&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;:&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;strip&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;root&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;# ...&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;上記のコードより下記のコードの方が読みやすい。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;username &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; line&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;split&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;:&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;strip&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; username &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;root&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;# ...&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;複雑なものをより単純、明確にしていくことでコードが読みやすくなる。&lt;/p&gt;
&lt;h3 id=&quot;3-コードの再構成&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#3-%E3%82%B3%E3%83%BC%E3%83%89%E3%81%AE%E5%86%8D%E6%A7%8B%E6%88%90&quot; aria-label=&quot;3 コードの再構成 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;3. コードの再構成&lt;/h3&gt;
&lt;p&gt;コードを大きく変更したり完全に削除することについて。&lt;/p&gt;
&lt;p&gt;場当たり的にコードを追加していくと、ついつい大きな読みづらい関数やクラスが誕生してしまう。&lt;/p&gt;
&lt;p&gt;関数やコードブロックを見て、「このコードの高レベルの目標は何か」を抽出し、各行に対してその目標に直接的に効果があるのか「無関係の下位問題」を解決しているのかを自問することで、読みやすい単位に分割していくことができる。&lt;/p&gt;
&lt;p&gt;無関係の下位問題は何と「無関係」なのかというと、コードが解決しようとしている課題の前提となる問題を解決することで、例えば以下のような問題が挙げられる。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;高レベルの目標が「与えられた緯度経度に最も近い要素を配列から選ぶ」だとすると、「球面三角法の余弦定理」は無関係の下位問題にあたる&lt;/li&gt;
&lt;li&gt;高レベルの目標が「ファイルの中身をすべて読み込む」だとすると、「ファイルをバッファに読み込む」は無関係の下位問題にあたる&lt;/li&gt;
&lt;li&gt;高レベルの目標が「サーバを Ajax で呼び出してレスポンスを処理する」だとすると、「レスポンスを整形して綺麗な形で出力する」は無関係の下位問題にあたる&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;このように大きな問題を明確な境界線を持つ小さな問題に分離していくことで、一度に考えることを減らすことができ、効率よくコードを読み進められるようになる。&lt;/p&gt;
&lt;p&gt;このような「無関係の下位問題」は誰かがライブラリとして開発していたり言語標準ライブラリに組み込まれていたりするので、それを使うのが良い。&lt;/p&gt;
&lt;p&gt;特に言語標準ライブラリの裏には膨大な設計、デバッグ、修正、文書、最適化の努力、テストがあり、時の試練を生き延びてきているので大きな価値がある。定期的に標準ライブラリのドキュメントやコードを読んでどんなことができそうか考えることで、自分のコードを単純に小さいまま保つことができるようになる。&lt;/p&gt;
&lt;h2 id=&quot;印象的だった箇所&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%8D%B0%E8%B1%A1%E7%9A%84%E3%81%A0%E3%81%A3%E3%81%9F%E7%AE%87%E6%89%80&quot; aria-label=&quot;印象的だった箇所 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;印象的だった箇所&lt;/h2&gt;
&lt;p&gt;第13章「短いコードを書く」の冒頭にこんな言葉がある。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;最も読みやすいコードは、何も書かれていないコードだ。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ここでは例として「店舗検索システム」が挙げられている。任意のユーザーの緯度経度を基に近い店舗を検索するというシステムを作ろうとすると、日付変更線を跨いだときや北極南極近辺の処理、地球の曲率など様々な要素を考慮しなければならない。&lt;/p&gt;
&lt;p&gt;しかし、その対象店舗がアメリカ合衆国のテキサス州に30店舗しか無いとしたらどうだろうか。単純に総当たりでユーザーと30店舗との距離を計算して最も近い距離の店を返せば十分だろう。計算量も大したことはなさそうだ。&lt;/p&gt;
&lt;p&gt;これと似た事象はプログラマに限らず割とどこでもあって、事前に完璧にやろうとすると無限に時間がかかるものの、課題の 80% くらいを解決する単純な方法はすぐ作れたりする。最初からいろいろ考えて準備しても、使われなかったり無駄に複雑にしてしまい説明や理解が難しくなる。&lt;/p&gt;
&lt;p&gt;限られた時間で多くのことをするには、とりあえず小さく単純な形で始めてみて必要になったら追加していく精神が重要そうだ。&lt;/p&gt;
&lt;p&gt;コードを一切書かず人の手も一切動かさずに問題を解決できるなら、それが一番いい。&lt;/p&gt;
&lt;h3 id=&quot;単純さ&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%8D%98%E7%B4%94%E3%81%95&quot; aria-label=&quot;単純さ permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;単純さ&lt;/h3&gt;
&lt;p&gt;本書の感想ではないが、最近読んだ文章で似たような話がありとても面白かった。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://note.com/ruiu/n/n9948f0cc3ed3&quot;&gt;note: 「悪い方が良い」原則と僕の体験談 Rui Ueyama&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;実装の単純さが良いデザインに優先することもある。&lt;/p&gt;
&lt;h2 id=&quot;最後に&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%9C%80%E5%BE%8C%E3%81%AB&quot; aria-label=&quot;最後に permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;最後に&lt;/h2&gt;
&lt;p&gt;10年前に出版された本だが、中身には全く古さを感じなかった。&lt;/p&gt;
&lt;p&gt;あえて言うと「JavaScript では var を使おう（var をつけずに変数を使うとグローバルスコープになるため）」という記述があるが、現代の JavaScript で var を使うことはほぼ無く原則は const 例外的に let を使うだろう。&lt;/p&gt;
&lt;p&gt;これは本書が誤っているのではなく、本書の指針（変数への代入は一度だけ..）に沿った機能が出版後に JavaScript へ取り込まれたからベストプラクティスが変わったのであって、本書の内容自体は読みやすく使いやすいコードを書く上で非常に役立つと思った。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[プログラマー2年目の振り返り]]></title><description><![CDATA[3月末で会計の仕事からプログラマーに転職して2年が経つので、この記事の続きを書く。 プログラミング1年くらいやってつまづいたこと 大きな進歩は無かったものの、今後の長期的な指針を得られた一年だった。 仕事 仕事では Node.js / TypeScript / GraphQL…]]></description><link>https://lyohe.github.io/2022-03-30-2years/</link><guid isPermaLink="false">https://lyohe.github.io/2022-03-30-2years/</guid><pubDate>Wed, 30 Mar 2022 00:01:31 GMT</pubDate><content:encoded>&lt;p&gt;3月末で会計の仕事からプログラマーに転職して2年が経つので、この記事の続きを書く。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://lyohe.github.io/2021-02-04-programming-taihenda/&quot;&gt;プログラミング1年くらいやってつまづいたこと&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;大きな進歩は無かったものの、今後の長期的な指針を得られた一年だった。&lt;/p&gt;
&lt;h2 id=&quot;仕事&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BB%95%E4%BA%8B&quot; aria-label=&quot;仕事 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;仕事&lt;/h2&gt;
&lt;p&gt;仕事では Node.js / TypeScript / GraphQL / React 等を使った Web アプリケーションの開発に関わっていた。GraphQL は使い始めた当初は全く何が起きているか理解できなかったものの、問題にはまって解決することを繰り返していたら朧げながら掴めてきた。&lt;/p&gt;
&lt;p&gt;その中でも &lt;a href=&quot;https://github.com/graphql/dataloader&quot;&gt;graphql/dataloader&lt;/a&gt; のコードを読んだことはとても勉強になった。詳しくはこのブログにメモを書いたのだが、簡潔で短いコードながら GraphQL のパフォーマンス向上にとって重要な問題を解決している。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://lyohe.github.io/2021-12-16-reading-dataloader/&quot;&gt;graphql/dataloader を読んだ話&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;graphql/dataloader は Batch と Cache という2つの単純な機能で構成されているが、自身が何に責任を果たすかが明確なので GraphQL 新人の自分でも理解しやすかった。一定期間内のリクエストの Batch 処理と結果の Cache は graphql/dataloader がやってくれて、 Batch で実行する処理の内容や Cache インスタンスのカスタマイズはユーザーが自由に行える。&lt;/p&gt;
&lt;p&gt;React については最低限の見た目でとりあえず動作する画面なら自分で作れるようになったが、日常的に触るようなよくできたアプリケーションの画面を作るのは難しく非常に困っている。昨年も書いたが CSS が特に難しい…&lt;/p&gt;
&lt;p&gt;TypeScript はクライアント側でもサーバー側でも使っているが、同じチームの方が整備した &lt;code class=&quot;language-text&quot;&gt;compilerOptions&lt;/code&gt; で書くことにより型定義による開発効率の高さを実感できた。&lt;/p&gt;
&lt;h3 id=&quot;サーバーエンジニア&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%82%A8%E3%83%B3%E3%82%B8%E3%83%8B%E3%82%A2&quot; aria-label=&quot;サーバーエンジニア permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;サーバーエンジニア&lt;/h3&gt;
&lt;p&gt;仕事でビールサーバーの分解洗浄をしていたのだが、その任を解かれたので「サーバーエンジニアです」という鉄板の自己紹介ネタが使えなくなった。会社の経理とか労務的な仕事も引き続きやっている。&lt;/p&gt;
&lt;h3 id=&quot;仕事で問題にはまる話&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BB%95%E4%BA%8B%E3%81%A7%E5%95%8F%E9%A1%8C%E3%81%AB%E3%81%AF%E3%81%BE%E3%82%8B%E8%A9%B1&quot; aria-label=&quot;仕事で問題にはまる話 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;仕事で問題にはまる話&lt;/h3&gt;
&lt;p&gt;普段は在宅勤務で一人でプログラムを書いているのだが、問題にはまりこんで詰まることが多かった。印象的だったのがこれ。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://dev.to/e_ntyo/typeorm-date-date-string-map-3el1&quot;&gt;TypeORMにおいて、&lt;code class=&quot;language-text&quot;&gt;date&lt;/code&gt; は &lt;code class=&quot;language-text&quot;&gt;Date&lt;/code&gt; でなく &lt;code class=&quot;language-text&quot;&gt;string&lt;/code&gt; にmapされるので気をつけましょう&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;TypeORM の Entity 定義で、 DBMS 側で日付を扱う &lt;code class=&quot;language-text&quot;&gt;date&lt;/code&gt; 型のカラムに対して &lt;code class=&quot;language-text&quot;&gt;Date&lt;/code&gt; 型を指定したとき、実際には &lt;code class=&quot;language-text&quot;&gt;string&lt;/code&gt; にマッピングされているという仕様がある。自分が書くプログラムでは当然 &lt;code class=&quot;language-text&quot;&gt;Date&lt;/code&gt; 型が入っているとみなしていたので、何故ここでエラーになるんだ…と詰まってしまった。理由や背景が分かれば確かにその仕様で納得できるのだが、自分の偏見（&lt;code class=&quot;language-text&quot;&gt;date&lt;/code&gt; 型は &lt;code class=&quot;language-text&quot;&gt;Date&lt;/code&gt; 型にマッピングされているに違いない…）が邪魔して答えに辿り着くのに時間を要した。&lt;/p&gt;
&lt;p&gt;次に印象的だったのが、ローカル環境（macOS）でテストが成功するのに CI 環境（GitHub Actions）だと失敗するという事件だった。これが起きる原因はいろいろあり得るのだが、自分が出くわしたのはファイル名の大文字小文字の区別によるものだった。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://dev.classmethod.jp/articles/mac-apfs-ignore-case/&quot;&gt;あれMacって大文字と小文字を区別しないのか&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;最近？の macOS のファイルシステムでは大文字小文字を区別しない（Case insensitive）ため、テストコード等で大文字のファイルを小文字でファイル名指定しても読んでくれるが、 CI では Ubuntu を使っていて大文字小文字を区別する（Case sensitive）ので通らなかった。ローカルではテストが成功していたので原因が分からず、解決に時間がかかった。&lt;/p&gt;
&lt;p&gt;これは問題の切り分け方がよくなかったと思っていて、ローカルでテストが成功している =&gt; CI 環境に”問題”があると考えて見当違いの箇所を調べまくっていた。しかし、人間はよく嘘をつくが CI は嘘をつかない。&lt;/p&gt;
&lt;p&gt;これを反省して、「テストが成功している」という事実をもって盲目的にコードを信頼するのではなく「そのテストが具体的にどういった順序で動作し何を証明しようとしているか」を一つ一つ追っていくのが重要だと考えるようになった。そしてローカルの開発環境と CI 環境を揃えるのは大事だ。&lt;/p&gt;
&lt;h3 id=&quot;反省点&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%8F%8D%E7%9C%81%E7%82%B9&quot; aria-label=&quot;反省点 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;反省点&lt;/h3&gt;
&lt;p&gt;一人で悩む時間が多く、生産性は高くなかった。&lt;/p&gt;
&lt;p&gt;何が分からないか分かっている時は「これ分からないんですけど…」と詳しそうな人に聞けるが、そもそも自分が何を理解していないのかを理解していないという状況が多かった。&lt;/p&gt;
&lt;p&gt;基礎を固めて適切な質問ができるようになりたい。&lt;/p&gt;
&lt;h2 id=&quot;個人&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%80%8B%E4%BA%BA&quot; aria-label=&quot;個人 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;個人&lt;/h2&gt;
&lt;p&gt;何かを作っては途中で辞めるのを繰り返しているのだが、&lt;a href=&quot;https://api.slack.com/future/overview&quot;&gt;Slack の新しいプラットフォーム&lt;/a&gt;で使える簡単な用語集を作ってみたら多くの人（…といっても数百人だが）に見ていただいて嬉しかった。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/lyohe/swords&quot;&gt;https://github.com/lyohe/swords&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;これはドキュメントを読みながら2-3日で作ったやつで、傲慢な言い方だが「このレベルのアウトプットでも見てくれる人いるんだ」と元気が出た。&lt;a href=&quot;https://deno.land/&quot;&gt;Deno&lt;/a&gt; の体験も素晴らしかった。Slack 社の方にも見ていただいたようで嬉しい。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://twitter.com/seratch_ja/status/1463322556786614277&quot;&gt;https://twitter.com/seratch_ja/status/1463322556786614277&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;技術的な勉強ではないが、個人的にオープンソースのビジネスモデルに興味があって GitLab や HashiCorp など様々な会社の財務諸表を読んでみた。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://zenn.dev/username/articles/2021-11-29-3fe9ccd53b5395d5ad5b&quot;&gt;ソースコードを公開したソフトウェアで収益を得ている会社&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;どの会社も面白いのだが、何よりソースコードを公開してビジネスをやっている会社がこんなにあって市場にも評価されているんだなという印象が強く残った。この記事には書ききれないくらいたくさんの会社を見つけた。&lt;/p&gt;
&lt;p&gt;OSS の会社以外にも、気になる会社の決算をすぐ読めるので経理の仕事をやっていてよかった。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://lyohe.github.io/2021-07-11-fastly-2/&quot;&gt;Fastly の財務諸表を読んだ話 その2&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://lyohe.github.io/2021-08-22-walmart-financial-statements/&quot;&gt;ウォルマートの財務諸表を読んだ話&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://lyohe.github.io/2021-04-04-uipath-ipo/&quot;&gt;UiPath が上場するので Form S-1 をさらっと読む&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;技術的な勉強&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%8A%80%E8%A1%93%E7%9A%84%E3%81%AA%E5%8B%89%E5%BC%B7&quot; aria-label=&quot;技術的な勉強 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;技術的な勉強&lt;/h3&gt;
&lt;p&gt;ここ一年で読んだ技術書としては Real World HTTP が最も印象的で、このブログにもまとめ記事を書いた。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://lyohe.github.io/2021-05-12-real-world-http2/&quot;&gt;Real World HTTP（第2版）を読んだ話&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;この本は読んだ後もことある度に開いているし、これからも読み返すと思う。HTTP の仕様が歴史を交えて紹介されていて、今の仕組みが何故こうなっているのか背景を学ぶことで関連技術の理解にとても役に立つ。&lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest&quot;&gt;XMLHttpRequest&lt;/a&gt; は何が XML なんだよと思っていたが、この本で理由を知った。&lt;/p&gt;
&lt;p&gt;新しい言語としては、 Ruby にちょっとだけ手を出して Rails チュートリアルをやってみた。Web アプリケーション開発 RTA という印象で、とにかく驚くほど早く動くものができるのでそりゃ流行るだろうなと感じた。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://lyohe.github.io/2021-09-19-rails-tutorial/&quot;&gt;ゼロから Rails チュートリアルをやってみた話&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;あとは Rust の &lt;a href=&quot;https://doc.rust-jp.rs/book-ja/&quot;&gt;TRPL&lt;/a&gt; と呼ばれている入門書や Go のチュートリアル &lt;a href=&quot;https://go-tour-jp.appspot.com/list&quot;&gt;A Tour of Go&lt;/a&gt; 等もやってみた。&lt;/p&gt;
&lt;p&gt;新しいプログラミング言語に手を出した理由としては JavaScript/TypeScript に加えてもう一つくらい言語を身につけたいと考えていたからで、いろいろ試した結果として今のところ最有力候補が Go になっている。文法や基本的な仕組みがとてもシンプルで、学び始めてからちょっとしたツールを作るまで短くてすむのが非常によかった。&lt;/p&gt;
&lt;p&gt;競技プログラミングは1年目に半年で挫折して以来ほぼやっていないのだが、そろそろ重い腰を上げて週末のやつに出ていきたい。これ去年も書いてた気がするのでかなり腰が重い。特に目標は立てず、一種のゲームとして楽しみたいと考えている。&lt;/p&gt;
&lt;h3 id=&quot;反省点-1&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%8F%8D%E7%9C%81%E7%82%B9-1&quot; aria-label=&quot;反省点 1 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;反省点&lt;/h3&gt;
&lt;p&gt;様々な分野に手を出してみたものの、どれも中途半端になってしまった。使える時間は限られているので、3年目は核となる一つの目標に集中していきたい。&lt;/p&gt;
&lt;h2 id=&quot;プログラマーとしての心がけ&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9E%E3%83%BC%E3%81%A8%E3%81%97%E3%81%A6%E3%81%AE%E5%BF%83%E3%81%8C%E3%81%91&quot; aria-label=&quot;プログラマーとしての心がけ permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;プログラマーとしての心がけ&lt;/h2&gt;
&lt;p&gt;2年も働いているので、最近は駆け出しエンジニアですという言い訳もできなくなってきた。仕事については、以下を気をつけるようにしている。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;嘘をつかない&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;動作確認しましたと言ったらちゃんとやっている。何か聞かれたら知っていることだけを答える。知らないことは知らないと言う。自信のないことは自分の認識を述べた上で自信がないと説明する。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;聞く前に調べる&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;誰かに質問する前に、ドキュメントでもコードでも誰かのブログでも調べられることは調べて自分の認識を構築する。用意されているチュートリアルは全てやる。エラーメッセージやログをよく読む。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;層を意識する&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;目の前のプログラムは何に責任を持つのか、その上下にはどのような責任の層が重なっているか、自分はどの層を把握しているか、または把握していないか、外部のパッケージは何に責任を持つか、エラーはどの層で起こっているのか等、手を動かしながら自分の認識と整合性を確認していく。&lt;/p&gt;
&lt;p&gt;全て完璧とは言えないときもあるが、心がけとして忘れないようにしたい。&lt;/p&gt;
&lt;h2 id=&quot;3年目の目標&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#3%E5%B9%B4%E7%9B%AE%E3%81%AE%E7%9B%AE%E6%A8%99&quot; aria-label=&quot;3年目の目標 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;3年目の目標&lt;/h2&gt;
&lt;p&gt;仕事ではやる気を維持しつつ、引き続き様々な技術や知識、メンタルモデルを身につけていきたい。&lt;/p&gt;
&lt;p&gt;個人での活動については複数のことに同時に取り組めないのがはっきり分かったので、目標を一つに絞りたい。3年目の目標は「自作の会計ソフトウェアを作ること」で、そのアルファ版を出すことを目標とする。完成したら OSS として公開したい。&lt;/p&gt;
&lt;p&gt;既存の（勘○奉行や弥○会計のような）財務会計ソフトウェアを再実装するというよりは、自分が過去に会計の仕事をしていたとき困っていた課題である「ソフトウェアが生成するデータと財務諸表との interface」に集中しようと考えている。&lt;/p&gt;
&lt;p&gt;プログラマーに転職した理由がこの「自分で自分の課題を解決する会計ソフトを作りたい」なのだが、そろそろ作り始められそうな気がしてきた。この会計ソフト…というか interface で生きていけるだけの金を稼げるのが理想的だが、まずは作って誰かに使ってもらわないと話にならないので公開することを目標としたい。&lt;/p&gt;
&lt;h2 id=&quot;最後に&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%9C%80%E5%BE%8C%E3%81%AB&quot; aria-label=&quot;最後に permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;最後に&lt;/h2&gt;
&lt;p&gt;最近読んだこの記事が印象的だった。分野は違えど、自分もこのような道を進みたいと考えている。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://engineer-lab.findy-code.io/shougo-vim&quot;&gt;[Findy Engineer Lab] 他人がやっていない事こそ強みになる。テキストエディタに人生を全振りしたエンジニアのキャリア戦略とは&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;3年目もやっていきます。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[メモ: How to Contribute to Open Source (Next.js)]]></title><description><![CDATA[YouTube で How to Contribute to Open Source (Next.js) という動画を見たので内容のメモ。 視聴動機としては、大きな OSS プロジェクトがどのように運用されているか興味を持ったため。Next.js に Contribute…]]></description><link>https://lyohe.github.io/2022-03-06-contribute-oss-guide/</link><guid isPermaLink="false">https://lyohe.github.io/2022-03-06-contribute-oss-guide/</guid><pubDate>Sun, 06 Mar 2022 03:01:31 GMT</pubDate><content:encoded>&lt;p&gt;YouTube で &lt;a href=&quot;https://www.youtube.com/watch?v=7OZErHXgnjo&quot;&gt;How to Contribute to Open Source (Next.js)&lt;/a&gt; という動画を見たので内容のメモ。&lt;/p&gt;
&lt;p&gt;視聴動機としては、大きな OSS プロジェクトがどのように運用されているか興味を持ったため。Next.js に Contribute する予定は（できたら嬉しいけど）今のところ無い。&lt;/p&gt;
&lt;h2 id=&quot;000--introduction&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#000--introduction&quot; aria-label=&quot;000  introduction permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;0:00 — Introduction&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;動画全体で何を話すかを紹介&lt;/li&gt;
&lt;li&gt;Vercel / Next.js の紹介&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;211--code-of-conduct&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#211--code-of-conduct&quot; aria-label=&quot;211  code of conduct permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=cuoNzXFLitc&amp;#x26;t=131s&quot;&gt;2:11 — Code of Conduct&lt;/a&gt;&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Code of Conduct は開発者が従うべき規範や果たすべき責任を表す文書
&lt;ul&gt;
&lt;li&gt;参考: &lt;a href=&quot;https://github.com/vercel/next.js/blob/01268f61ce136386743700fcadfa0236389a939f/CODE_OF_CONDUCT.md&quot;&gt;Next.js の Code of Conduct&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;プロジェクトに参加するときはまず最初に読む&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;311--opening-an-issue&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#311--opening-an-issue&quot; aria-label=&quot;311  opening an issue permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=cuoNzXFLitc&amp;#x26;t=191s&quot;&gt;3:11 — Opening an Issue&lt;/a&gt;&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;人々が OSS プロジェクトを訪れる主な理由は改善提案やバグ報告で、それらは Issue として管理されている&lt;/li&gt;
&lt;li&gt;まずは既存の Issue を検索して自分と同じ提案や報告があるかを確認する
&lt;ul&gt;
&lt;li&gt;例えば &lt;code class=&quot;language-text&quot;&gt;&amp;lt;Image&gt;&lt;/code&gt; コンポーネントに関する報告なら “Image” というキーワードで open の Issue を検索してみる&lt;/li&gt;
&lt;li&gt;参考: &lt;a href=&quot;https://github.com/vercel/next.js/issues&quot;&gt;Next.js の Issue 一覧&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Issue はテンプレートに必要な情報を埋めていくと作れる
&lt;ul&gt;
&lt;li&gt;テンプレートの様式は &lt;a href=&quot;https://github.com/vercel/next.js/tree/01268f61ce136386743700fcadfa0236389a939f/.github/ISSUE_TEMPLATE&quot;&gt;./github/ISSUE_TEMPLATE&lt;/a&gt; 配下の YAML で管理されている&lt;/li&gt;
&lt;li&gt;必要な情報は Node.js の version やバグの再現条件など、その Issue の解決策を探るために役立つもの&lt;/li&gt;
&lt;li&gt;例えば Bug report の場合は &lt;code class=&quot;language-text&quot;&gt;next info&lt;/code&gt; コマンドの出力を入れる（Next.js v12.0.8 以降）など、テンプレートによって必要な情報は異なる&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;実際に Issue を作るときは、以下画像のように目的から必要なテンプレートを選ぶ。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/6faf166686196a71e7776a1437110f78/e515d/issue_1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 53.79746835443038%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABaElEQVQoz42S2UoDUQyG5/0fxwtBEMFSUKyi9KJXLii17ezr2ZdfTs50RNTRgUySIfmyTJK3nGGbtWi7AT0T6AaBnkmyo472wKNmQqFqehRVi6YbkFcNyrZDVtYUkwjO0Dc1pJToB4aBcTAuyA462hxcKPqmtIGxjkQbC3iQ2NFPOGeo6wp100JpDa01nHOYe7z3cD7G3KcbLLaryU/CS0iJ/SFFXpTgXEBKBWMMJf4mx6KL7S1Oni5gnP0Ehs4OaYaqbmCMnbqcBY4d3ezXOH+9gv0CVAq7/QFZXqAoS+RFAcbYNN4c8Hr3gLOXJaxzX4F5XhAwTTM0bUej/we4fL/D6fPl9w7D/uq6IRjjHPqvHXpPgE3xiNVuPe2UgFob6jCcRbDDT+JCwFo7Jf8Etc7DGkDyUJzmicCZA6HE6dj8KKOvjEMrLDppCU4dhhM5jmhsDAoiddAe2nowFe2jL030j5BYIO77AyW3WeVM73WtAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;issue_1&quot;
        title=&quot;issue_1&quot;
        src=&quot;/static/6faf166686196a71e7776a1437110f78/f058b/issue_1.png&quot;
        srcset=&quot;/static/6faf166686196a71e7776a1437110f78/c26ae/issue_1.png 158w,
/static/6faf166686196a71e7776a1437110f78/6bdcf/issue_1.png 315w,
/static/6faf166686196a71e7776a1437110f78/f058b/issue_1.png 630w,
/static/6faf166686196a71e7776a1437110f78/40601/issue_1.png 945w,
/static/6faf166686196a71e7776a1437110f78/78612/issue_1.png 1260w,
/static/6faf166686196a71e7776a1437110f78/e515d/issue_1.png 1430w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;次に、テンプレートに必要な情報を埋めていく。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/3f0d6e69165c0f76b91a2b1932aac838/ccf0c/issue_2.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 67.08860759493672%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAABp0lEQVQ4y31S267jIAzs/3/iPm/bQLiE+z2zwmmqk9NqkUY2BszY49uqA+7CQyiLkAo2G2B9gnHTxg+4kOFCgtws7dXm6K7Ult7damtw1mBlDEpvcD4gl4qYMlIuSDlfMM/62NH6QKkNY+zofbxjNwCQSuHv/YHnsiDEeDxOCSF32LyjDdDa94mdUGuFdZ78n4sSai3hQ6TfQ8zkOyovwof0ssf5ZFXaQE4Bhv9Bb+Xy0e38YdsMMWScQ2kNvW0wxsAYCz33xsGXgZPPZJhSfDHf30zfCWf/nguDEPIoO2WEF7PwgveBehyIbUGM6UiILwwno/v9AcY4Ho8n2RACWmuo9cDhV7TWqc9SaYpNTHEuDDdjsTAOpTSEVFRuzoWYnPZQvaCUijkdMZ49zui9XxOW2pFKR+1T/p1sKo1mM+aCmF7IhWJlJiwJ1gW699FD5+dwTzEMpN7IN87TbNXWP9DHwO91VdlYML5CSI1VKvBVklBzaL+tU4SfuDC01oELiYWteC6cFF+FhJCSmv4tyRm7DPYZMNaBcUFM5/DOIZ7lfnv4v4T/AEIl9ct8mmCHAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;issue_2&quot;
        title=&quot;issue_2&quot;
        src=&quot;/static/3f0d6e69165c0f76b91a2b1932aac838/f058b/issue_2.png&quot;
        srcset=&quot;/static/3f0d6e69165c0f76b91a2b1932aac838/c26ae/issue_2.png 158w,
/static/3f0d6e69165c0f76b91a2b1932aac838/6bdcf/issue_2.png 315w,
/static/3f0d6e69165c0f76b91a2b1932aac838/f058b/issue_2.png 630w,
/static/3f0d6e69165c0f76b91a2b1932aac838/40601/issue_2.png 945w,
/static/3f0d6e69165c0f76b91a2b1932aac838/78612/issue_2.png 1260w,
/static/3f0d6e69165c0f76b91a2b1932aac838/ccf0c/issue_2.png 1428w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 id=&quot;720--contributing-docs&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#720--contributing-docs&quot; aria-label=&quot;720  contributing docs permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=cuoNzXFLitc&amp;#x26;t=440s&quot;&gt;7:20 — Contributing Docs&lt;/a&gt;&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;OSS に Contribute する前に、そのやり方を読む&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/vercel/next.js/blob/01268f61ce136386743700fcadfa0236389a939f/contributing.md&quot;&gt;contributing.md&lt;/a&gt; では開発やビルドのやり方が詳細に記述されている&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;805--releases-canary-stable&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#805--releases-canary-stable&quot; aria-label=&quot;805  releases canary stable permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=cuoNzXFLitc&amp;#x26;t=485s&quot;&gt;8:05 — Releases (canary, stable)&lt;/a&gt;&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Next.js には &lt;code class=&quot;language-text&quot;&gt;canary&lt;/code&gt; と &lt;code class=&quot;language-text&quot;&gt;stable&lt;/code&gt; という2つの release branch がある&lt;/li&gt;
&lt;li&gt;canary は開発用の branch で、全ての Pull Request はここに向けて作られる&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/vercel/next.js/releases&quot;&gt;Next.js の Releases&lt;/a&gt; を見ると、何回か canary が Release された後に semver が振られた stable が Release されていることが分かる&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;917--adding-tests&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#917--adding-tests&quot; aria-label=&quot;917  adding tests permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=cuoNzXFLitc&amp;#x26;t=557s&quot;&gt;9:17 — Adding Tests&lt;/a&gt;&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;たくさんの人が関わるプロジェクトで regression を防ぐためにテストは非常に重要&lt;/li&gt;
&lt;li&gt;参考: &lt;a href=&quot;https://github.com/vercel/next.js/blob/ff6b75027b98ffc379282cb807551d1b5e9e7732/test/readme.md&quot;&gt;testing README&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Next.js では新しい e2e, unit, integration テストを追加するための scaffold script がある&lt;/li&gt;
&lt;li&gt;例えば &lt;a href=&quot;https://github.com/vercel/next.js/blob/ff6b75027b98ffc379282cb807551d1b5e9e7732/test/integration/static-404/test/index.test.js&quot;&gt;static 404 ページのテスト&lt;/a&gt;では&lt;/li&gt;
&lt;li&gt;テストは Next.js で新機能を merge する際は必須となっている&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;1157--testing-against-local-versions&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1157--testing-against-local-versions&quot; aria-label=&quot;1157  testing against local versions permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=cuoNzXFLitc&amp;#x26;t=717s&quot;&gt;11:57 — Testing against Local Versions&lt;/a&gt;&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;自分のローカルにある Next.js を開発していく際は、 package.json で &lt;code class=&quot;language-text&quot;&gt;next&lt;/code&gt; の依存先を自分のローカルに指定する必要がある&lt;/li&gt;
&lt;li&gt;参考: &lt;a href=&quot;https://github.com/vercel/next.js/blob/ff6b75027b98ffc379282cb807551d1b5e9e7732/contributing.md#developing-with-your-local-version-of-nextjs&quot;&gt;contributing.md#developing-with-your-local-version-of-nextjs&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;1237--adding-warning--error-links&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1237--adding-warning--error-links&quot; aria-label=&quot;1237  adding warning  error links permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=cuoNzXFLitc&amp;#x26;t=757s&quot;&gt;12:37 — Adding Warning &amp;#x26; Error Links&lt;/a&gt;&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Next.js では開発者を支援するため Warning や Error にリンクをつける仕組みがある&lt;/li&gt;
&lt;li&gt;ログに全部出すのではなく、ログにはエラーの説明へのリンクを出して、エラーの詳細はリンク先を見るようにする&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;yarn new-error&lt;/code&gt; で新たなエラードキュメントを作り、 &lt;code class=&quot;language-text&quot;&gt;https://nextjs.org/docs/messages/&amp;lt;file-path-without-dotmd&gt;.&lt;/code&gt; のようなリンクでアクセスできる
&lt;ul&gt;
&lt;li&gt;例えば &lt;a href=&quot;https://github.com/vercel/next.js/blob/ff6b75027b98ffc379282cb807551d1b5e9e7732/errors/api-routes-static-export.md&quot;&gt;errors/api-routes-static-export.md&lt;/a&gt; は &lt;a href=&quot;https://nextjs.org/docs/messages/api-routes-static-export&quot;&gt;https://nextjs.org/docs/messages/api-routes-static-export&lt;/a&gt; を指す&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;参考: &lt;a href=&quot;https://github.com/vercel/next.js/blob/ff6b75027b98ffc379282cb807551d1b5e9e7732/contributing.md#adding-warningerror-descriptions&quot;&gt;contributing.md#adding-warningerror-descriptions&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;1429--adding-examples&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1429--adding-examples&quot; aria-label=&quot;1429  adding examples permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=cuoNzXFLitc&amp;#x26;t=869s&quot;&gt;14:29 — Adding Examples&lt;/a&gt;&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/vercel/next.js/tree/ff6b75027b98ffc379282cb807551d1b5e9e7732/examples&quot;&gt;/examples&lt;/a&gt; 以下には Next.js を使ったアプリケーションの例がたくさんある&lt;/li&gt;
&lt;li&gt;examples を新たに追加する際は名前や description を README に記載する&lt;/li&gt;
&lt;li&gt;簡単なチェック用のスクリプトもある &lt;a href=&quot;https://github.com/vercel/next.js/blob/ff6b75027b98ffc379282cb807551d1b5e9e7732/scripts/check-examples.sh&quot;&gt;/scripts/check-examples.sh&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;参考: &lt;a href=&quot;https://github.com/vercel/next.js/blob/ff6b75027b98ffc379282cb807551d1b5e9e7732/contributing.md#adding-examples&quot;&gt;contributing.md#adding-examples&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
&lt;li&gt;この examples は新しくプロジェクトを始めるときの雛形として非常に便利&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;1734--documentation&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1734--documentation&quot; aria-label=&quot;1734  documentation permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=cuoNzXFLitc&amp;#x26;t=1054s&quot;&gt;17:34 — Documentation&lt;/a&gt;&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Next.js のドキュメントは全て Markdown 形式でリポジトリの &lt;a href=&quot;https://github.com/vercel/next.js/tree/ff6b75027b98ffc379282cb807551d1b5e9e7732/docs&quot;&gt;/docs&lt;/a&gt; 以下に書かれている&lt;/li&gt;
&lt;li&gt;ドキュメント全体のパスや構造は &lt;a href=&quot;https://github.com/vercel/next.js/blob/ff6b75027b98ffc379282cb807551d1b5e9e7732/docs/manifest.json&quot;&gt;docs/manifest.json&lt;/a&gt; を参照&lt;/li&gt;
&lt;li&gt;ドキュメントで使われる単語が正しく inclusive であることを保つために alex というツールを使っている&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;2102--pull-requests&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#2102--pull-requests&quot; aria-label=&quot;2102  pull requests permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=cuoNzXFLitc&amp;#x26;t=1262s&quot;&gt;21:02 — Pull Requests&lt;/a&gt;&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Pull Request を作成する際はテンプレートを使う
&lt;ul&gt;
&lt;li&gt;テンプレートは &lt;a href=&quot;https://github.com/vercel/next.js/blob/ff6b75027b98ffc379282cb807551d1b5e9e7732/.github/pull_request_template.md&quot;&gt;.github/pull_request_template.md&lt;/a&gt; を参照&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Next.js では Bug, Feature, Documentation / Examples の3種類の PR を想定している&lt;/li&gt;
&lt;li&gt;Bug と Feature では関連 Issue へのリンクが必要となるなど、 PR の種類によって必要な情報は異なる
&lt;ul&gt;
&lt;li&gt;つまり、いきなり　Issue なしで PR を送ってもただ却下されるだけ&lt;/li&gt;
&lt;li&gt;Issue を作ると Contributor がそれを確認して &lt;a href=&quot;https://github.com/vercel/next.js/discussions&quot;&gt;Discussion&lt;/a&gt; や vote などで Feedback する&lt;/li&gt;
&lt;li&gt;その内容を基に開発して PR を出す&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/vercel/next.js/blob/ff6b75027b98ffc379282cb807551d1b5e9e7732/.github/CODEOWNERS&quot;&gt;.github/CODEOWNERS&lt;/a&gt; が自動的にレビュアーとなる&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;PR を作ろうとすると、テンプレートが使われるため次のように最初から文章が入力されている。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/6e4a3b7b78a592c34b2985ad2b466a53/434c7/pr_1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 62.65822784810127%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB5klEQVQ4y21T266bMBDM/39Lpfa1UvsdR9VR1apJCGDAV/CdqXadkBy1SKNZGzzey3AyxkIZB7cF5kUZGLtilpqZ9pSxLdYW1m3wMcOH9F+c1nXFPC8Q0wwS3/cdtdaGUrHXts4VjH+f/RntO04+RIxixigmSKUxL5LFpVSYjcIoZyxSQUiLUTrOOMSIlAtiyoh3pjU9J6UWDNOCYTboJ41ulFiMh3IRam3Qa4S5M++7iJAKUkoIgVqQnoIxeBi3QdoA7SK2WBELGD7tsFuG8wXWZ5gtwRJ8xrpuuF7OEOMA7/2zZAocvbwNuA0jl07cDwLDOEFbxwMx1nGsjcPmAw/xVydxGTVijCx2CNKH565H14/oeoHLbcClowsEpLZ3OGZyAYlZ5/H28wqxmDbAvQ3nyHAQCxbVLKTtytaIuWIjO8TM/IrVB9yE4sxzzpzdi6DH7/MVfy4dZzVJDbEo7m07HJlDLAiBhtFs9egbxR8Eyay9mO8lNZCx7domSGLWewxGMq5SoLAIDqEPPcyFvJSeiI+4sM8omWnT+Pz+DZ9+fMWX9+8otbx4+2nuJpgzm5V6uXnPMRl+DZVtI80G59NRHv0cNIQQ4tG/+siwlMoiD+wvt9HJfa9s4FLKUeIDVEXm/efeX82c8AouQ3jMAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;pr_1&quot;
        title=&quot;pr_1&quot;
        src=&quot;/static/6e4a3b7b78a592c34b2985ad2b466a53/f058b/pr_1.png&quot;
        srcset=&quot;/static/6e4a3b7b78a592c34b2985ad2b466a53/c26ae/pr_1.png 158w,
/static/6e4a3b7b78a592c34b2985ad2b466a53/6bdcf/pr_1.png 315w,
/static/6e4a3b7b78a592c34b2985ad2b466a53/f058b/pr_1.png 630w,
/static/6e4a3b7b78a592c34b2985ad2b466a53/40601/pr_1.png 945w,
/static/6e4a3b7b78a592c34b2985ad2b466a53/78612/pr_1.png 1260w,
/static/6e4a3b7b78a592c34b2985ad2b466a53/434c7/pr_1.png 1381w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 id=&quot;2647--codesandbox-on-prs&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#2647--codesandbox-on-prs&quot; aria-label=&quot;2647  codesandbox on prs permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=cuoNzXFLitc&amp;#x26;t=1607s&quot;&gt;26:47 — CodeSandbox on PRs&lt;/a&gt;&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;PR を open すると自動的に &lt;a href=&quot;https://codesandbox.io/&quot;&gt;CodeSandbox&lt;/a&gt; が作られ、ブラウザでその PR の挙動を確認できる&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;2747--example-of-contributing&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#2747--example-of-contributing&quot; aria-label=&quot;2747  example of contributing permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=cuoNzXFLitc&amp;#x26;t=1667s&quot;&gt;27:47 — Example of Contributing&lt;/a&gt;&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;ドキュメントの修正を例に Issue を作成し PR を出すまでを説明する&lt;/li&gt;
&lt;li&gt;external contributor はまず Fork して自分の配下の branch から PR を出す&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[2021年に読んだ本 BEST 5]]></title><description><![CDATA[2021年に読んで面白かった本 BEST 5 を紹介したい。昨年以前に出版された本もある。 1位: ルワンダ中央銀行総裁日記 https://www.amazon.co.jp/dp/B00LMB2OLE…]]></description><link>https://lyohe.github.io/2021-12-19-best-reading/</link><guid isPermaLink="false">https://lyohe.github.io/2021-12-19-best-reading/</guid><pubDate>Sun, 19 Dec 2021 03:19:21 GMT</pubDate><content:encoded>&lt;p&gt;2021年に読んで面白かった本 BEST 5 を紹介したい。昨年以前に出版された本もある。&lt;/p&gt;
&lt;h2 id=&quot;1位-ルワンダ中央銀行総裁日記&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1%E4%BD%8D-%E3%83%AB%E3%83%AF%E3%83%B3%E3%83%80%E4%B8%AD%E5%A4%AE%E9%8A%80%E8%A1%8C%E7%B7%8F%E8%A3%81%E6%97%A5%E8%A8%98&quot; aria-label=&quot;1位 ルワンダ中央銀行総裁日記 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;1位: ルワンダ中央銀行総裁日記&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://www.amazon.co.jp/dp/B00LMB2OLE&quot;&gt;https://www.amazon.co.jp/dp/B00LMB2OLE&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;一九六五年、経済的に繁栄する日本からアフリカ中央の一小国ルワンダの中央銀行総裁として着任した著者を待つものは、財政と国際収支の恒常的赤字であった―。本書は物理的条件の不利に屈せず、様々の驚きや発見の連続のなかで、あくまで民情に即した経済改革を遂行した日本人総裁の記録である。今回、九四年のルワンダ動乱をめぐる一文を増補し、著者の業績をその後のアフリカ経済の推移のなかに位置づける。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;今年読んだ本の中で一番おもしろかったのがこの本。あらすじはこんな感じ↓&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/ab126d349d91120961f5b24905e8440c/d8f91/narou.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 73.41772151898735%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIEBf/EABUBAQEAAAAAAAAAAAAAAAAAAAIB/9oADAMBAAIQAxAAAAHp3IrQlT//xAAYEAADAQEAAAAAAAAAAAAAAAABAhIhAP/aAAgBAQABBQIk1XKcZNnlwf/EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABUQAQEAAAAAAAAAAAAAAAAAABAR/9oACAEBAAY/Amv/xAAbEAADAAIDAAAAAAAAAAAAAAAAAREhMUFRYf/aAAgBAQABPyFNul6WuS29GPMKWJgkP//aAAwDAQACAAMAAAAQmB//xAAVEQEBAAAAAAAAAAAAAAAAAAAREP/aAAgBAwEBPxAZ/8QAFREBAQAAAAAAAAAAAAAAAAAAEBH/2gAIAQIBAT8Qp//EABsQAQEBAQEAAwAAAAAAAAAAAAERACExQXHx/9oACAEBAAE/EJwo7A9ZBVH2rks0vXIhI9S+5qdifLfzNcO3g3f/2Q==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;narou&quot;
        title=&quot;narou&quot;
        src=&quot;/static/ab126d349d91120961f5b24905e8440c/828fb/narou.jpg&quot;
        srcset=&quot;/static/ab126d349d91120961f5b24905e8440c/ff44c/narou.jpg 158w,
/static/ab126d349d91120961f5b24905e8440c/a6688/narou.jpg 315w,
/static/ab126d349d91120961f5b24905e8440c/828fb/narou.jpg 630w,
/static/ab126d349d91120961f5b24905e8440c/0ede0/narou.jpg 945w,
/static/ab126d349d91120961f5b24905e8440c/3ac88/narou.jpg 1260w,
/static/ab126d349d91120961f5b24905e8440c/d8f91/narou.jpg 1952w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;IMF の途上国支援の一環として1965 ~ 1971までの6年間、ルワンダ中央銀行総裁として勤務した服部正也氏の回想録。&lt;/p&gt;
&lt;p&gt;当時のルワンダがどのような国だったかというと&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;アフリカの中でも最貧国&lt;/li&gt;
&lt;li&gt;なのに人口増加率、人口密度ともにアフリカ最高&lt;/li&gt;
&lt;li&gt;恒常的な財政赤字&lt;/li&gt;
&lt;li&gt;外国に売れるものはコーヒーと錫だけ（生産量は減少中）だが、輸出のために内陸国でインド洋までは1,200km、大西洋までは2,000kmの移動が必要&lt;/li&gt;
&lt;li&gt;北はウガンダ、南はブルンジ、西はコンゴ、東はタンザニアに囲まれ治安は最悪&lt;/li&gt;
&lt;li&gt;定期的に国境を越えて武装勢力が侵入してくる&lt;/li&gt;
&lt;li&gt;中央銀行に銀行券のストックがほぼなし&lt;/li&gt;
&lt;li&gt;経理がめちゃくちゃなので中央銀行総裁自らが帳簿をつけなければならない&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;こんな絶望的な状況の中で著者は「これ以上悪くなることは不可能であるから、私が何をやっても改善になる」とポジティブな気持ちで様々な改革や政策提言を進めていく。これには（本来は）中央銀行がやるべきではない仕事も含まれている。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;二重為替相場の廃止&lt;/li&gt;
&lt;li&gt;外国人優遇税制の廃止&lt;/li&gt;
&lt;li&gt;財政均衡型予算の成立&lt;/li&gt;
&lt;li&gt;資金援助や流通支援を通じたルワンダ人商人の育成&lt;/li&gt;
&lt;li&gt;農民へのコーヒー集荷資金の融通&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;これらの政策を通じてルワンダは持続的に経済成長し、アフリカの優等生と言われるようになる。&lt;/p&gt;
&lt;p&gt;一方で、1980年以降は度重なる旱魃や飢饉、コーヒー価格の暴落などで所得格差が増大し、武装勢力の侵入や大統領暗殺、94年の大虐殺などでルワンダ経済は壊滅的な打撃を受ける。著者は自分自身の経験から、それらに対する意見を増補している。&lt;/p&gt;
&lt;p&gt;単なる回想録ではなく、その後の経験も踏まえアフリカ諸国とアジア諸国の発展になぜ差が生まれたのか、経済援助など国際関係はどうあるべきなのかという著者の哲学が感じられて非常に面白かった。&lt;/p&gt;
&lt;h2 id=&quot;2位-地球の未来のため僕が決断したこと-気候大災害は防げる&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#2%E4%BD%8D-%E5%9C%B0%E7%90%83%E3%81%AE%E6%9C%AA%E6%9D%A5%E3%81%AE%E3%81%9F%E3%82%81%E5%83%95%E3%81%8C%E6%B1%BA%E6%96%AD%E3%81%97%E3%81%9F%E3%81%93%E3%81%A8-%E6%B0%97%E5%80%99%E5%A4%A7%E7%81%BD%E5%AE%B3%E3%81%AF%E9%98%B2%E3%81%92%E3%82%8B&quot; aria-label=&quot;2位 地球の未来のため僕が決断したこと 気候大災害は防げる permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;2位: 地球の未来のため僕が決断したこと 気候大災害は防げる&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://www.amazon.co.jp/dp/B09CGQVJFH/&quot;&gt;https://www.amazon.co.jp/dp/B09CGQVJFH/&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;温室効果ガスの排出量をゼロにするしか、我々が生き残る道はない。「気候大災害」を回避するために、ビル・ゲイツは政治・経済・科学のあらゆる側面から分析を進めてきた。10年の調査が結実し、パンデミックをも予期した著者の描く未来像が明らかに。20年ぶりの著作。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;マイクロソフトの創業者であり、現在は自身が設立したゲイツ&amp;#x26;メリンダ財団で慈善事業やヘルスケアへの投資、貧困を減らす活動を行なっているビル・ゲイツの著作。&lt;/p&gt;
&lt;p&gt;この本の興味深い点として、エンジニアらしく気候変動の問題を工学的に捉えている点がある。著者は人間の活動によって発生する温室効果ガスを分野別に、著者が財団の活動や投資などを通じて入手した情報を基にして、それぞれの排出を減少させるためにどのようなブレイクスルーが期待できるかを提示していく。&lt;/p&gt;
&lt;p&gt;世界では毎年510億トンの温室効果ガスが発生している。その内訳は大まかに次の通り。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/cac72aeadb1eddc7ae606259b7434c80/e35ec/how-to-avoid-cc.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 39.87341772151899%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABJklEQVQoz31Sa0/DMAzc//9jIKQNJjbQRGGs6Xu0Tbs+08ehM8rU7QOWEjtOcrmzswIAYwzatkHbthjHAX3fS8x80zSo61pyneyP+M9WnJTr4mWzwet2iziK8Ok4eN/v8eU4eF6v8fT4gI/DAW+7HdL0B/M8YzAGw/D3OD0H8ytORaFRlqWwKosC1eUi7KIwQFVVaOpaPPe7rpOL0zSJ9z1PVNCugGEQIPA9FFrDV0ou0yjPDgJYkKUFvi+luAEkENnoPMc5SRCFoUgna2s8Z8GWMcmw/ldAkLZSApBnGdzTN7TOobUWKUkcw/fUDfDSe8pFey85iSNkaSrMTsejMOXaU0pylMUHqeSeIRXxF9wA2hpJt4yRNWM2gN9oXHTzHtDW1gL+AkZgaqI9zf+1AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;how-to-avoid-cc&quot;
        title=&quot;how-to-avoid-cc&quot;
        src=&quot;/static/cac72aeadb1eddc7ae606259b7434c80/f058b/how-to-avoid-cc.png&quot;
        srcset=&quot;/static/cac72aeadb1eddc7ae606259b7434c80/c26ae/how-to-avoid-cc.png 158w,
/static/cac72aeadb1eddc7ae606259b7434c80/6bdcf/how-to-avoid-cc.png 315w,
/static/cac72aeadb1eddc7ae606259b7434c80/f058b/how-to-avoid-cc.png 630w,
/static/cac72aeadb1eddc7ae606259b7434c80/e35ec/how-to-avoid-cc.png 861w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;これらを実質的にゼロに近づけなければ地球の気温上昇とそれに伴う環境の変化や気候の変動を止めることは難しい。ではゼロに近づけなければ何が起きるかというと、例えば次のような現象が頻発するようになる。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;暴風雨や山火事などの災害&lt;/li&gt;
&lt;li&gt;海面上昇による沿岸地域の地盤沈下や水害&lt;/li&gt;
&lt;li&gt;トウモロコシなどの作物栽培可能期間の短縮による農産物の収量低下&lt;/li&gt;
&lt;li&gt;動植物の生息可能地域の減少&lt;/li&gt;
&lt;li&gt;熱中症や昆虫媒介感染症の増加&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;これらを防ぐためには温室効果ガスの排出を減らさなければならないが、道は険しい。というのも、温室効果ガスを発生させない「クリーンな」エネルギー源は、それを発生させる「クリーンでない」エネルギー源と競争しなければならないからだ。&lt;/p&gt;
&lt;p&gt;化石燃料が非常に安く簡単に手に入る。これは環境負荷の観点で本来負担すべきコスト（温室効果ガスを発生させ、気候変動の原因となる）を負担していないからで、著者はそのような燃料と「クリーンな」エネルギーとの価格差を「グリーン・プレミアム」と呼び、それを最小化できるようなブレイクスルー（政策・市場・技術の組み合わせ）を見つけることが問題の解決につながると主張する。実際に著者が投資した会社やなぜそれがブレイクスルーに繋がるのかが工学的な視点から説明されており、自分自身の視野を広げることにつながった。&lt;/p&gt;
&lt;p&gt;個人的にこのような「気候変動を工学的に解決する」という視点が面白く、この本を読んでいて気候変動問題の周辺には巨大なビジネスチャンスが眠っていると実感した。今後20-30年の世界で最も重要なトピックになると思うので、繰り返し読みたい。&lt;/p&gt;
&lt;h2 id=&quot;3位-復讐者マレルバ&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#3%E4%BD%8D-%E5%BE%A9%E8%AE%90%E8%80%85%E3%83%9E%E3%83%AC%E3%83%AB%E3%83%90&quot; aria-label=&quot;3位 復讐者マレルバ permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;3位: 復讐者マレルバ&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://www.amazon.co.jp/dp/B072K1YVWB&quot;&gt;https://www.amazon.co.jp/dp/B072K1YVWB&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;巨大マフィアに家族を殺された21歳の青年。その日より、復讐が彼の生きる目的になった。賭博で金を稼ぎ、銃を仕入れ、敵を撃つ。やがて彼は新興マフィアのボスとなり、家族殺しの首謀者を追い詰める！膨大な死傷者を出した抗争の当事者が獄中で語った真相。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;1990年前後の数年間、シチリアで300名以上の犠牲者を出したマフィア抗争を引き起こした「スティッダ（星）」と呼ばれる組織の創始者の一人アントニオ・ブラッソ（本名ジュゼッペ・グラッソネッリ）の回想録。&lt;/p&gt;
&lt;p&gt;アントニオは多くの親族を突然マフィアに虐殺され、治安当局にも頼れない中で生きるため、残った親族を守るため、親族の復讐のためにマフィアと戦うことを決意する。何年もかけて外国で金や仲間、武器を集め、友や恋人と別れ、シチリアに戻り復讐を完遂する。&lt;/p&gt;
&lt;p&gt;しかし、話はただの復讐劇で終わらない。アントニオは警察に逮捕され、裁判でイタリアの最高刑である終身刑の判決を受ける。収監され厳しい拘禁措置が続く中で、アントニオは過去の自分と向き合う。逮捕当時は小学校しか出ていなかったアントニオは厳しい環境の獄中で過去の自分と訣別するため勉学に励み中学・高校の卒業資格を取り、最終的にはナポリ大学の文学部哲学科を卒業する。&lt;/p&gt;
&lt;p&gt;単なる犯罪ノンフィクションとしても面白い作品だが、それ以上に重大な罪を犯した人間の背景、犯した罪とその経緯、更生の過程を内面から（本人が）語っているという構成が他にはない際立った作品になっている。&lt;/p&gt;
&lt;p&gt;個人的には塀の内と外は紙一重で、自分自身も環境やタイミングによっては「アントニオ」になっていたかもしれないと考えている。だからこそ、なぜ罪を犯すことになったのか、どうすれば合法な社会に留まれるのか、戻れるのかということに興味を持って生きている。この本は自分にとって重要なテーマに示唆を与えてくれる本だった。&lt;/p&gt;
&lt;h2 id=&quot;4位-real-world-http&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#4%E4%BD%8D-real-world-http&quot; aria-label=&quot;4位 real world http permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;4位: Real World HTTP&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://www.amazon.co.jp/dp/4873119030&quot;&gt;https://www.amazon.co.jp/dp/4873119030&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;本書はHTTPに関する技術的な内容を一冊にまとめることを目的とした書籍です。
HTTPが進化する道筋をたどりながら、ブラウザが内部で行っていること、サーバーとのやりとりの内容などについて、プロトコルの実例や実際の使用例などを交えながら紹介しています。
GoやJavaScriptによるコード例によって、単純なHTTPアクセス、フォームの送信、キャッシュやクッキーのコントロール、Keep-Alive、SSL/TLS、プロトコルアップグレード、サーバープッシュ、Server-Sent Events、WebSocketなどの動作を理解します。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;一言で表現すると「HTTP の歴史書」と言えると思う。この本についてはブログでまとめを書いた。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://lyohe.github.io/2021-05-12-real-world-http2/&quot;&gt;https://lyohe.github.io/2021-05-12-real-world-http2/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;インターネットに関する仕事（特に技術的な…）をしていく上で、ある技術が何を目的としてどのような背景で生まれ、どういう技術につながっていったか、もしくは消えていったか…という歴史は知っておいて損をすることは全くない。むしろ知らないと困る。&lt;/p&gt;
&lt;p&gt;例えばクッキーやセッションとはなんなのか、ブラウザの裏側では何が起きているのか…など。本書ではプロトコルとしての HTTP を中心に、そのユースケースと関連する技術を紹介していく。技術とそれが具体的にどのように利用されるかが合わせて読めるので理解しやすい。&lt;/p&gt;
&lt;p&gt;この本の良いところは知識（本書の内容だけでなく、RFC や各種資料への参照を含む）だけでなく自分で手を動かして Go 言語で簡単な HTTP クライアントを実装する章があるところで、これをやると実際にどう動作するかが分かって知識が身につきやすいと感じる。ちなみに事前に Go の経験は一切なくて良い。自分も名前聞いたことあるくらいのレベル感だったが、本書の課題に取り組む上では特に問題はなかった。&lt;/p&gt;
&lt;h2 id=&quot;5位-アカマイ---知られざるインターネットの巨人&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#5%E4%BD%8D-%E3%82%A2%E3%82%AB%E3%83%9E%E3%82%A4---%E7%9F%A5%E3%82%89%E3%82%8C%E3%81%96%E3%82%8B%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%8D%E3%83%83%E3%83%88%E3%81%AE%E5%B7%A8%E4%BA%BA&quot; aria-label=&quot;5位 アカマイ   知られざるインターネットの巨人 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;5位: アカマイ - 知られざるインターネットの巨人&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://www.amazon.co.jp/dp/B00MIFE3BC&quot;&gt;https://www.amazon.co.jp/dp/B00MIFE3BC&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;動画配信、通販などで拡大し続けるネット経由ビジネス。天文学的に増え続ける情報量を陰で支えている会社アカマイ。情報ビッグ３からNHKの災害放送まで、インターネットを陰で支える同社の真実。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;CDN（Contents Delivery Network）として世界最大の企業であるアカマイの創業ストーリーやビジネス、同社を取り巻くお金の流れを紹介する本。インターネットを流れる情報はその最大 1/3 がアカマイの CDN を経由していると言われているが、一般的な知名度は非常に低い。&lt;/p&gt;
&lt;p&gt;その理由はアカマイのビジネスモデルにある。アカマイは「顧客のコンテンツをインターネット上で迅速に配信する」というサービスを運営しているが、顧客はデータを配信する企業であって一般消費者ではない。そのため、普通の人々がアカマイの存在を意識することは少ない。&lt;/p&gt;
&lt;p&gt;一方で、コンテンツの配信において同社は競合他社と比べて非常に大きな売上を得ている。同社の売上は FY2020 で $3,198M で、日本円にして3,500億円くらい。著者はこの成功について、「ISP（Internet Service Provider）の運営コストを減らしつつデータ配信を高速化したい顧客からお金を稼ぐ」というビジネスモデルを競合に先んじて事業化し大規模な資金調達を行って投資を加速したことが大きいと評する。&lt;/p&gt;
&lt;p&gt;世界のインターネットは通信キャリアや ISP が互いに接続することで成立している（Inter-Net）。顧客から近いのは ISP で、基本的にはユーザーから毎月固定料金を徴収するが、彼らはインターネットの基幹部分を支える通信キャリアにトラフィックに応じた利用料を支払っている（通信キャリア同士も同様）。インターネットの維持には回線や通信設備など費用がかかるが、それはトラフィックに応じて発生するためだ。つまり、 ISP（や通信キャリア）はできれば異なる組織との通信を減らしたいというインセンティブがある。&lt;/p&gt;
&lt;p&gt;ここでアカマイが役に立つ。&lt;/p&gt;
&lt;p&gt;アカマイはそれら事業者の施設に自社の機器を配置し、世界中のユーザーが行う DNS の名前解決結果を操作することでユーザーからの通信を特定の方向に誘導し、最も近い場所からコンテンツを取得するように仕向ける。つまり、ある企業（アカマイの顧客）の Web サイトを見ようとしたとき、自分から最も近い場所にあるアカマイのサーバーの IP アドレスがユーザーに渡され、ユーザーとアカマイのサーバーの間で通信が行われる。&lt;sup id=&quot;fnref-1&quot;&gt;&lt;a href=&quot;#fn-1&quot; class=&quot;footnote-ref&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;p&gt;つまり、アカマイのサーバーを通信事業者が自社の施設内に配置することは通信事業者にとって他社のネットワークとの通信を減らす上で大きな役割を果たす。むしろ金を払って置いてもらいたいくらいだ。逆に、一度置いてしまえばアカマイの同業者のサーバーを置くメリットは少ない。一方で、アカマイの顧客であるコンテンツ配信企業としては、自社で同等のネットワークを構築することは難しいが、アカマイにお金を払えばそのサーバーを利用して配信することで高速なコンテンツ配信ができるようになる。&lt;/p&gt;
&lt;p&gt;このように、アカマイの事業は参加者全員にメリットがありつつ他社の参入も難しいという優れたビジネスモデルとなっている。&lt;/p&gt;
&lt;p&gt;アカマイ創業者のトム・レイトンは MIT で応用数学の教授として働いていたが、その隣には World Wide Web（WWW）考案者の一人として有名なティム・バーナーズ=リーのオフィスがあった。リーは WWW におけるアクセスやコンテンツの増加が避けられない問題であることを予見し、より良い配信方法を発明できないか同僚に相談していた。レイトンと研究チームは大量のデータ配信を行うにあたって距離を最短にしつつ経路を調整することで、混雑を避けながらデータを届けられるアルゴリズムとアーキテクチャを考案した。&lt;sup id=&quot;fnref-2&quot;&gt;&lt;a href=&quot;#fn-2&quot; class=&quot;footnote-ref&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;p&gt;この本は単なる「アカマイ」のビジネスの話だけでなくインターネットを取り巻く情報やお金の流れを俯瞰的に見られるという点で面白い本だった。&lt;/p&gt;
&lt;div class=&quot;footnotes&quot;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&quot;fn-1&quot;&gt;具体的には、顧客が管理するドメインの権威 DNS サーバーに CNAME としてアカマイのドメインを登録しておく。アカマイのドメインの権威 DNS サーバーはアカマイが運営しており、ユーザーが利用しているキャッシュ DNS サーバーの IP アドレスを見て、最も近いと判断したアカマイサーバーの IP アドレスを返すことができる。つまり、アカマイはユーザーの IP アドレスを知らずに地理的に最も近いと考えられるサーバーを割り当てることができる。&lt;a href=&quot;#fnref-1&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;li id=&quot;fn-2&quot;&gt;元々は論文を書くための研究だったが、研究者の一人が金に困って学内の賞金付きビジネスプランコンテストに応募し、それをきっかけに事業化した。ちなみにそのビジネスプランコンテストでは敗退したが、1999年2月に事業を始めて急激に成長して11月には NASDAQ へ上場し、年末には時価総額が $35B を超えた（2021年12月20日現在は $18B）。&lt;a href=&quot;#fnref-2&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content:encoded></item><item><title><![CDATA[graphql/dataloader を読んだ話]]></title><description><![CDATA[graphql/dataloader のドキュメント及びソースコードを全て読んだので、その話を書く。 読むことにした第一の理由は仕事で使うからだが、以下の特徴から自分のプログラミング学習教材として適していそうだと考えたからでもある。 広く使われている OSS である GitHub…]]></description><link>https://lyohe.github.io/2021-12-16-reading-dataloader/</link><guid isPermaLink="false">https://lyohe.github.io/2021-12-16-reading-dataloader/</guid><pubDate>Thu, 16 Dec 2021 07:12:21 GMT</pubDate><content:encoded>&lt;p&gt;&lt;a href=&quot;https://github.com/graphql/dataloader&quot;&gt;graphql/dataloader&lt;/a&gt; のドキュメント及びソースコードを全て読んだので、その話を書く。&lt;/p&gt;
&lt;p&gt;読むことにした第一の理由は仕事で使うからだが、以下の特徴から自分のプログラミング学習教材として適していそうだと考えたからでもある。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;広く使われている OSS である&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;GitHub の星が 11k&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.npmtrends.com/&quot;&gt;npm trends&lt;/a&gt; で検索しても多くの人がダウンロードしている&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;コードの量が少ない&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;実装は src/index.js に全て書かれている&lt;/li&gt;
&lt;li&gt;コメント含めて500行にも満たず、しかもその 1/3 くらいはコメント&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;テストカバレッジが高い&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;常に 100%&lt;/li&gt;
&lt;li&gt;初めて読むコードでテストカバレッジが高いと、テストコードを読むことで期待される挙動を確認できるので嬉しい&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;npm trends によると、一週間で200万件近くダウンロードされているようだ。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/1229ea06bd48b738b680293befb15093/b1001/dataloader-npm-trends.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 74.68354430379746%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAABgElEQVQ4y42U3U7DMAyF+/5Px/2Q0K6QWDvW5t92cpCdtnSCDSJZSZT6s3Nid5hdxDzPZsyMZ6O19qcN0zThfD7jcrkADRCpqLXbthYRm/8zhlwKnHNmKSXLcjMiNti2f5aZBrQMb6Hg/erhszqro4APEDIwGXhzfGQG9D5gHCeEEJFzhneqZVmdmwqn6vXpmb6rDaUU5JwsAzMmtDWajkgNN59RhQ366ModBwwb6P41sX8ktaGwXrc+BX1GQaKKgVeNHkber/z7mUKuQcw0+AH4vzqrhyAuCy6eEct3Se3AXdqDw6979McKpeJtKuDa7oreNCxEYGlgqSCpP2a1zBVLEtyiYPSMJQsK97O7TlF6Jrb0fRG4xFgiwes+C7ROl8imVSFBSNTLSR9MO8i66AAM3oP3Kx+r6u/RfvS6th4xQiqm49a3GimmhF6j2dZ6viyLzdqiIQTrJP0XjC6uWmqG1DDOAd4tBlOIAtMKVKdtVsgWpK8Jr6cTXs4fSNKBX+i2nqRwdv0yAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;dataloader-npm-trends&quot;
        title=&quot;dataloader-npm-trends&quot;
        src=&quot;/static/1229ea06bd48b738b680293befb15093/f058b/dataloader-npm-trends.png&quot;
        srcset=&quot;/static/1229ea06bd48b738b680293befb15093/c26ae/dataloader-npm-trends.png 158w,
/static/1229ea06bd48b738b680293befb15093/6bdcf/dataloader-npm-trends.png 315w,
/static/1229ea06bd48b738b680293befb15093/f058b/dataloader-npm-trends.png 630w,
/static/1229ea06bd48b738b680293befb15093/40601/dataloader-npm-trends.png 945w,
/static/1229ea06bd48b738b680293befb15093/78612/dataloader-npm-trends.png 1260w,
/static/1229ea06bd48b738b680293befb15093/b1001/dataloader-npm-trends.png 1380w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 id=&quot;目次&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%9B%AE%E6%AC%A1&quot; aria-label=&quot;目次 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;目次&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#graphqldataloader-%E3%81%A8%E3%81%AF&quot;&gt;graphql/dataloader とは&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#%E4%B8%BB%E8%A6%81%E3%81%AA%E6%A9%9F%E8%83%BD&quot;&gt;主要な機能&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#batch&quot;&gt;Batch&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#cache&quot;&gt;Cache&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#why-Using-with-GraphQL&quot;&gt;Why Using with GraphQL&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#%E8%A9%B3%E7%B4%B0%E3%81%AA%E5%AE%9F%E8%A3%85&quot;&gt;詳細な実装&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#dataLoader-%E3%81%AE%E5%9F%BA%E6%9C%AC%E7%9A%84%E3%81%AA%E4%BD%BF%E3%81%84%E6%96%B9&quot;&gt;DataLoader の基本的な使い方&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#dataLoader-%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E6%9B%B8%E3%81%8B%E3%82%8C%E3%81%9F%E8%A8%98%E4%BA%8B&quot;&gt;DataLoader について書かれた記事&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#%E5%8B%89%E5%BC%B7%E3%81%AB%E3%81%AA%E3%81%A3%E3%81%9F%E7%82%B9&quot;&gt;勉強になった点&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#%E6%9C%AC%E8%A8%98%E4%BA%8B%E3%81%AE%E3%81%BE%E3%81%A8%E3%82%81&quot;&gt;本記事のまとめ&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;graphqldataloader-とは&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#graphqldataloader-%E3%81%A8%E3%81%AF&quot; aria-label=&quot;graphqldataloader とは permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;graphql/dataloader とは&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/graphql/dataloader&quot;&gt;graphql/dataloader&lt;/a&gt; はアプリケーションのデータ取得に使用される汎用的なユーティリティであり、データソースからのデータ取得を Batch 処理したり結果を Cache するための簡単な API を提供する。これにより、データ取得リクエストを大幅に効率化することができる。&lt;/p&gt;
&lt;p&gt;元のアイデアは Facebook （現 Meta）社内で2010年に開発された “Loader” API で、これは当時存在していた様々な KVS の back-end API からデータを取得する方法を統一するために開発された。この “Loader” API を簡略化し Node.js アプリケーション等で使えるよう JavaScript で実装したのが graphql/dataloader で、現在は GraphQL Foundation によって MIT ライセンスで公開されている。&lt;/p&gt;
&lt;p&gt;アイデアとしては Facebook の Production 環境で使われている仕組みと同じだが、このリポジトリのコードはあくまで参考実装であり Facebook で使われているわけではない。当時 Facebook では PHP で同様の機構が実装されていたようだ。&lt;/p&gt;
&lt;p&gt;主に GraphQL サービスの構築に使われているが、特定のアーキテクチャやデータソースに依存するような実装にはなっていない。なお、GraphQL サービスのパフォーマンスを向上させるためには何かしら同じような仕組みが必要になる（詳しくは後述）ので、JavaScript に限らず様々な言語で様々な実装がされている。&lt;sup id=&quot;fnref-1&quot;&gt;&lt;a href=&quot;#fn-1&quot; class=&quot;footnote-ref&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;p&gt;ちなみに graphql/dataloader を最初に書いた Lee Byron と Dan Schafer は Facebook 社で GraphQL を開発したメンバーでもある。&lt;/p&gt;
&lt;h2 id=&quot;主要な機能&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%B8%BB%E8%A6%81%E3%81%AA%E6%A9%9F%E8%83%BD&quot; aria-label=&quot;主要な機能 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;主要な機能&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/graphql/dataloader/blob/master/README.md&quot;&gt;README&lt;/a&gt; を読むと、 graphql/dataloader には &lt;code class=&quot;language-text&quot;&gt;Batch&lt;/code&gt; と &lt;code class=&quot;language-text&quot;&gt;Cache&lt;/code&gt; の2つの機能があることが分かる。&lt;/p&gt;
&lt;h3 id=&quot;batch&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#batch&quot; aria-label=&quot;batch permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;a href=&quot;https://github.com/graphql/dataloader#batching&quot;&gt;Batch&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;データ取得のリクエストを一定時間待ち、その間に行われたリクエストを統合して Batch 処理する。&lt;/p&gt;
&lt;p&gt;使う側は &lt;a href=&quot;https://github.com/graphql/dataloader#batch-function&quot;&gt;Batch Function&lt;/a&gt; と呼ばれる関数を自身で定義して DataLoader のコンストラクタへ渡す。この関数は &lt;strong&gt;Batch 処理対象となる key の配列を受け取り、その key と対応する value（もしくは Error）の配列の Promise を返す&lt;/strong&gt;ようにしておく。つまり…&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ts&quot;&gt;&lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;BatchFunction&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;K&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;V&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;keys&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; $ReadOnlyArray&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;K&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Promise&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;$ReadOnlyArray&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;V&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; Error&lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;実際に Batch Function をどのように定義するかは、リポジトリの &lt;a href=&quot;https://github.com/graphql/dataloader/blob/master/examples/SQL.md&quot;&gt;examples/SQL.md&lt;/a&gt; が分かりやすいかもしれない。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; DataLoader &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;dataloader&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; sqlite3 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;sqlite3&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; db &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;sqlite3&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Database&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;./to/your/db.sql&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Dispatch a WHERE-IN query, ensuring response has rows in correct order.&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; userLoader &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;DataLoader&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;ids&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Promise&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;resolve&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; reject&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  db&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;all&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;SELECT * FROM users WHERE id IN $ids&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;$ids&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ids&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;error&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; rows&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;reject&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;resolve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ids&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        &lt;span class=&quot;token parameter&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; rows&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;find&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;row&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; row&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; id&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;Row not found: &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;id&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Usage&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; promise1 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; userLoader&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;load&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;1234&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; promise2 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; userLoader&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;load&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;5678&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; user1&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; user2 &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; Promise&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;all&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;promise1&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; promise2&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;user1&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; user2&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;上記の &lt;code class=&quot;language-text&quot;&gt;ids =&gt; new Promise((resolve, reject) =&gt; { db.all(...) }&lt;/code&gt; が Batch Function であり、何のことはない key の配列を受け取って value もしくは Error の配列（の Promise）を返すだけの関数である。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;DataLoader.load&lt;/code&gt; に取得対象の key を渡して呼び出すと、 &lt;a href=&quot;https://github.com/graphql/dataloader#batch-scheduling&quot;&gt;Batch Scheduling&lt;/a&gt; 内（デフォルトはイベントループ内の 1 tick。詳しくは後述）に行われたデータ取得リクエストの key を集めた配列を引数に Batch Function を呼び出し、結果として key に対応する value の配列の Promise を返す。&lt;/p&gt;
&lt;p&gt;「Batch Function は key 配列を受け取って value の配列の Promise を返す」が「&lt;code class=&quot;language-text&quot;&gt;DataLoader.load&lt;/code&gt; では単一の key を取りそれと対応する value の Promise を返す」という構造が肝で、ユーザー側としては key を渡して load するだけで裏側で DataLoader が一定時間分の key をまとめて Batch Function に配列として渡し、まとめてデータベースにリクエストを送ってくれる。&lt;/p&gt;
&lt;p&gt;この &lt;code class=&quot;language-text&quot;&gt;DataLoader.load&lt;/code&gt; はアプリケーションの複数の箇所から呼び出される可能性があるが、同一の DataLoader インスタンスからの load であれば Batch 処理（と結果の Cache が）できる。&lt;/p&gt;
&lt;p&gt;GraphQL の Resolver ではこれが非常に重要で、 DataLoader を使うと簡単に非同期 Resolver による N+1 問題を回避することができる。&lt;sup id=&quot;fnref-2&quot;&gt;&lt;a href=&quot;#fn-2&quot; class=&quot;footnote-ref&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;p&gt;DataLoader の Batch 処理を簡単に図解すると、次のようになる。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/e68f13b146e25a746f3994e141d57b40/669eb/dataloader-batchloadfn.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 54.43037974683544%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABkUlEQVQoz3VSi47iMAzs///aVbDQA7E6QAJKSULV0qTpO5mVvc2qi3SW3LESd+yxE3V9j6ZtYZuWcRhHeO8xOcc+ThOj8x7OOb4jm6YJ4zjyGWHf9xxHNs9hlMIry2DyHFoptFUFLSX088lopATnSYm2LJmwer2QZRnyPGcvy5KLRPAe3jkYrXG9XnFPU0YpBPquQ7jnzmanuG1bJpRScnfBIvr4WcIwDOyUTPhu4ywzSOy6jp1yw3nk54rvJoTAfr/H4XBgvN/vXJQbWORrrVluXdffksNlIPbz8G+3G+I/MbbbLVarFdI0/SEMRrmXy4WRCiqlviVTIjkRBV/+9G5LVcfjEU3TMCEthwlJO83NWsszoZiQipAk6oJkbzYbXhgtg85IZlVVjPQPzfWH8PF44HQ6cTI5VTTGoCgKJEmCv7sd4jjGer3G+XzG+uOD57xU+GuGYcthWxSTdFvX2CUJ/n1+QgmBp1L8xAh1VfGTwmIs0f/mFMwNAww9+jRFXxQYjcHUNJhoq9bCCsE5gecLCttQ8DDNd2oAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;dataloader-batchloadfn&quot;
        title=&quot;dataloader-batchloadfn&quot;
        src=&quot;/static/e68f13b146e25a746f3994e141d57b40/f058b/dataloader-batchloadfn.png&quot;
        srcset=&quot;/static/e68f13b146e25a746f3994e141d57b40/c26ae/dataloader-batchloadfn.png 158w,
/static/e68f13b146e25a746f3994e141d57b40/6bdcf/dataloader-batchloadfn.png 315w,
/static/e68f13b146e25a746f3994e141d57b40/f058b/dataloader-batchloadfn.png 630w,
/static/e68f13b146e25a746f3994e141d57b40/40601/dataloader-batchloadfn.png 945w,
/static/e68f13b146e25a746f3994e141d57b40/669eb/dataloader-batchloadfn.png 1244w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h4 id=&quot;batch-の実行範囲&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#batch-%E3%81%AE%E5%AE%9F%E8%A1%8C%E7%AF%84%E5%9B%B2&quot; aria-label=&quot;batch の実行範囲 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Batch の実行範囲&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;DateLoader.load(key)&lt;/code&gt; はデフォルト 1 tick ごとに key を配列にまとめ Batch Function を呼ぶ。&lt;/p&gt;
&lt;p&gt;ここで 1 tick とはどういう意味か。graphql/dataloader は Batch Scheduling に Node.js の &lt;a href=&quot;https://nodejs.org/en/docs/guides/event-loop-timers-and-nexttick/#process-nexttick&quot;&gt;process.nextTick()&lt;/a&gt; を使っており、これに渡したコールバックは呼び出し時点のイベントループ内の phase に関わらず次の phase、つまり C/C++ ハンドラが JavaScript を実行するタイミング、の前に実行される。&lt;/p&gt;
&lt;p&gt;具体的には、下図のそれぞれの箱の中で process.nextTick() にコールバックを渡すと、各箱に固有の処理が行われたあと次の箱に進む前にそれが呼ばれる。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/638e9d046f1a25e64765683d9e58ff99/5b4a1/event-loop.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 69.62025316455697%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAABwUlEQVQ4y32UaVPbMBCG/aFluApMSSjEdnzl8O0cjmUpDtChnWn//w96O7uKiZsYPjyzh8avdqW1jNuBDSdI4AQp3EnGvuVGGI3ncIMU3jSD5Yacs70Ith/D9mKYTsiW1vxZjodRgK+X9zBu7k1YfggrCOFME9iTGKY/x8ifw55EDMWM1xJ2/DnsIMLjeILzbw8wBiMPxVYhFQLFi0S+rZEJgbTqoRRIyopJ9yTrivPRssTV3SOMgekhl5IFc1UjkzWyumM7sOC6OoHy4aLEZVdw8aaw/tsweSORteIdWkGyJxUeC1KrxY6s5ErzTwT7KvxfsNaCy99bFk03nTOjD9p488HZbo4ECyWRNzWKF/VeKbH4qd434QoroXO/tp8LUoV06Nzm3hIs+qp0XugPi2e9Wbf93pZJiCrkGxXiMDobcYjJb89UtPRVqCQyavVVt8w3fIys9Qyu9rSXsmrHZq0Fh6aP5a7h4V69NSj/7LDYKRS1ZPI97Ff9FEKyOA/27dCGF6VwifiAEyZwooTzXpzpeJZgPI1PoLwVRLi4+QHj/HrIP/rYT/hx0Dblh+DJnrHfrhOU+3LxnR+CY86uBvgHugGnmJCSsr4AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;event-loop&quot;
        title=&quot;event-loop&quot;
        src=&quot;/static/638e9d046f1a25e64765683d9e58ff99/f058b/event-loop.png&quot;
        srcset=&quot;/static/638e9d046f1a25e64765683d9e58ff99/c26ae/event-loop.png 158w,
/static/638e9d046f1a25e64765683d9e58ff99/6bdcf/event-loop.png 315w,
/static/638e9d046f1a25e64765683d9e58ff99/f058b/event-loop.png 630w,
/static/638e9d046f1a25e64765683d9e58ff99/5b4a1/event-loop.png 831w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;上図は &lt;a href=&quot;https://nodejs.org/en/docs/guides/event-loop-timers-and-nexttick/#event-loop-explained&quot;&gt;https://nodejs.org/en/docs/guides/event-loop-timers-and-nexttick/#event-loop-explained&lt;/a&gt; から引用。&lt;/p&gt;
&lt;p&gt;Batch が実行されるタイミングを自分で決めたい（例えば 16ms 後に実行する、とか）場合は &lt;code class=&quot;language-text&quot;&gt;batchScheduleFn&lt;/code&gt; を定義して DataLoader のコンストラクタに渡せばよい。詳しくは README の &lt;a href=&quot;https://github.com/graphql/dataloader#batch-scheduling&quot;&gt;Batch Scheduling&lt;/a&gt; を参照。&lt;/p&gt;
&lt;h3 id=&quot;cache&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#cache&quot; aria-label=&quot;cache permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;a href=&quot;https://github.com/graphql/dataloader#caching&quot;&gt;Cache&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Batch と並ぶ graphql/dataloader の主要な機能として Cache がある。&lt;/p&gt;
&lt;p&gt;これは &lt;strong&gt;Batch に登録される key とそれに対応する value の Promise の組をメモ化&lt;/strong&gt;する。&lt;/p&gt;
&lt;p&gt;これにより、同一の DataLoader インスタンスから実行された（≒ 同一のリクエストにおける） Batch 内で同一の key で複数回 value を取得しようとするとき、二回目以降のデータ取得リクエストには Cache から value の Promise を返すことができるようになる。これにより、データ取得のパフォーマンスが大きく向上する。&lt;/p&gt;
&lt;p&gt;Cache はデフォルトで es6 から追加された &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map&quot;&gt;Map&lt;/a&gt; を使う。Cache 内の key と value の組み合わせは load する度に無限に増えていくので、 DataLoader インスタンスの寿命が長い場合はメモリを大量に消費する可能性があり安全ではない。&lt;/p&gt;
&lt;p&gt;ただし、 DataLoader インスタンスは原則的にリクエスト単位で作られるので、クライアントにレスポンスを返した後は DataLoader インスタンスへの参照がなくなり GC によってメモリが解放されるので、問題が起きる可能性は少ない。&lt;/p&gt;
&lt;p&gt;リクエスト毎に DataLoader インスタンスを作る理由は Cache を適切に扱うためで、&lt;strong&gt;仮にリクエスト間でこれを共有すると異なるリクエストのデータ取得結果が Cache としてそれぞれのクライアントから見えてしまい&lt;/strong&gt;適切ではない。これは DataLoader を使うにあたって非常に重要な点で、例えば GraphQL と合わせて使う場合はリクエスト毎の context に attach することになると考えられる。&lt;/p&gt;
&lt;p&gt;以上の背景から、もし Cache の生存期間を長くしたい場合はカスタムの Cache をクライアントごとに生成することを検討すべきだろう。その場合は DataLoader のコンストラクタで &lt;code class=&quot;language-text&quot;&gt;cacheMap&lt;/code&gt; として自分が使いたい Cache のインスタンスを渡せばよい。詳しくは README の &lt;a href=&quot;https://github.com/graphql/dataloader#custom-cache&quot;&gt;Custom Cache&lt;/a&gt; を参照。&lt;/p&gt;
&lt;p&gt;Cache の key は通常 string 等のスカラ値だが、オブジェクトを使うことも許容されている。その場合は Cache の key となるオブジェクトから実際に key と value （の Promise）の組を取り出す関数である &lt;code class=&quot;language-text&quot;&gt;cacheKeyFn&lt;/code&gt; を定義して DataLoader のコンストラクタに渡す必要がある。このとき、DataLoader は &lt;code class=&quot;language-text&quot;&gt;cacheKeyFn&lt;/code&gt; の返り値を Cache とみなす。&lt;/p&gt;
&lt;h2 id=&quot;why-using-with-graphql&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#why-using-with-graphql&quot; aria-label=&quot;why using with graphql permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Why &lt;a href=&quot;https://github.com/graphql/dataloader#using-with-graphql&quot;&gt;Using with GraphQL&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;DataLoader は GraphQL サービスの構築によく使われる。この理由は GraphQL のドキュメントをよく読んでいくと分かる。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://graphql.org/learn/&quot;&gt;https://graphql.org/learn/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;GraphQL のクエリにおける各フィールドの値は、 Resolver と呼ばれる関数によって取得される。フィールドに文字列や数値などスカラ値が生成される場合は実行が完了し、オブジェクトが生成される場合はそのオブジェクトに含まれるフィールドを更に Resolve し、これをスカラ値に達するまで続ける。つまり GraphQL のクエリは必ずスカラ値に到達する。&lt;sup id=&quot;fnref-3&quot;&gt;&lt;a href=&quot;#fn-3&quot; class=&quot;footnote-ref&quot;&gt;3&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;p&gt;Resolver がデータベースを読み書きする場合、これは通常 Promise を返す非同期関数となる。GraphQL はフィールドに値が生成されることを期待しており、非同期 Resolver が完了するのを待ってから「optimal concurrency」で処理を続行する。&lt;sup id=&quot;fnref-4&quot;&gt;&lt;a href=&quot;#fn-4&quot; class=&quot;footnote-ref&quot;&gt;4&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;During execution, GraphQL will wait for Promises, Futures, and Tasks to complete before continuing and will do so with optimal concurrency.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ここで Resolver が Promise の配列を返すとき、 GraphQL は全ての Promise を並行して（concurrently）待つ。&lt;/p&gt;
&lt;p&gt;それに加え、フィールドがオブジェクトの配列である場合、オブジェクトの各フィールドを解決するために処理を続行する。つまり、配列でオブジェクトを返すときはその配列要素ごとに Resolver が実行される。&lt;sup id=&quot;fnref-5&quot;&gt;&lt;a href=&quot;#fn-5&quot; class=&quot;footnote-ref&quot;&gt;5&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;p&gt;つまり、これらの仕様を無視して素朴に GraphQL サービスを構築すると、フィールドが解決される度に新しいデータベースへのリクエストが発生してしまい、いわゆる N+1 問題が起きる。&lt;/p&gt;
&lt;p&gt;文章だけだと分かりにくいので具体例を用意した。例えば、次のような GraphQL スキーマがあると仮定する。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;graphql&quot;&gt;&lt;pre class=&quot;language-graphql&quot;&gt;&lt;code class=&quot;language-graphql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 顧客&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Customer&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token attr-name&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token scalar&quot;&gt;ID&lt;/span&gt;
  &lt;span class=&quot;token attr-name&quot;&gt;orders&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Order&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 顧客による注文&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Order&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token attr-name&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token scalar&quot;&gt;ID&lt;/span&gt;
  &lt;span class=&quot;token attr-name&quot;&gt;items&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Item&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;
  &lt;span class=&quot;token attr-name&quot;&gt;amount&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token scalar&quot;&gt;Int&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 注文される商品&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Item&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token attr-name&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token scalar&quot;&gt;ID&lt;/span&gt;
  &lt;span class=&quot;token attr-name&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token scalar&quot;&gt;String&lt;/span&gt;
  &lt;span class=&quot;token attr-name&quot;&gt;description&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token scalar&quot;&gt;String&lt;/span&gt;
  &lt;span class=&quot;token attr-name&quot;&gt;price&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token scalar&quot;&gt;Int&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Query&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token attr-name&quot;&gt;customer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token attr-name&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token scalar&quot;&gt;ID&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Customer&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;このときある id を持つ顧客の注文一覧とそれぞれで注文された商品を取得するクエリは次のようになるだろう。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;graphql&quot;&gt;&lt;pre class=&quot;language-graphql&quot;&gt;&lt;code class=&quot;language-graphql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;query&lt;/span&gt; &lt;span class=&quot;token definition-query function&quot;&gt;GetOrdersAndItems&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property-query&quot;&gt;customer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token attr-name&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &apos;&lt;span class=&quot;token property&quot;&gt;foobar&lt;/span&gt;&apos;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;id&lt;/span&gt;
    &lt;span class=&quot;token object&quot;&gt;orders&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token object&quot;&gt;items&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;name&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;description&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;price&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;amount&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;GraphQL の各 Resolver が非同期かつ DataLoader を使わず個別に SQL データベースから注文や商品を取得するような実装になっている場合、次のような SQL が発行されると考えられる（あくまで例です）。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 1. 顧客 id を使って注文を探す&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; item_id&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; amount &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; orders &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; customer_id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;foobar&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- 2. 1 の結果として得た item_id から各商品を探す&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; description&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; price &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; items &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;hoge&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; description&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; price &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; items &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;fuga&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; description&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; price &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; items &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;piyo&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 以下、2 が注文された商品数だけ実行される&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;これに対して DataLoader が提供する Batch や Cache の API を介してデータを取得するとデータベースのアクセスを大幅に減らすことができ、計算資源の節約やパフォーマンスの向上に繋がる。例えば上記の 2. であれば、&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 2. 1 の結果として得た item_id から各商品を探す&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt;
  name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; description&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; price
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt;
  items
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt;
  id &lt;span class=&quot;token operator&quot;&gt;IN&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;hoge&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;fuga&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;piyo&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;のようなクエリが一回だけ発行される（上記はあくまで例であり、実際にどのようなクエリが発行されるかは実装によります）。こちらの方がデータベースへのアクセスやクエリ結果の処理が少ないので、データベースへの負荷が低くレスポンスも速い。&lt;/p&gt;
&lt;p&gt;graphql/dataloader の実装は特定のアーキテクチャに依存しないが、 GraphQL の Resolver で非同期処理をすると容易に非効率なクエリが発行されてしまうので、それを防ぐため GraphQL サービスに使われることが多い。&lt;/p&gt;
&lt;p&gt;実は graphql/dataloader や類似のライブラリ以外にも GraphQL でこのような N+1 問題を解決する方法はあるのだが、個人的にはこれが最も単純明快な解決策だと思う。&lt;/p&gt;
&lt;h2 id=&quot;詳細な実装&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%A9%B3%E7%B4%B0%E3%81%AA%E5%AE%9F%E8%A3%85&quot; aria-label=&quot;詳細な実装 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;詳細な実装&lt;/h2&gt;
&lt;p&gt;ここからは &lt;a href=&quot;https://github.com/graphql/dataloader/releases/tag/v2.0.0&quot;&gt;v2.0.0&lt;/a&gt; の &lt;a href=&quot;https://github.com/graphql/dataloader/blob/ef6d32f97cde16aba84d96dc806c4439eaf8efae/src/index.js&quot;&gt;src/index.js&lt;/a&gt; を上から順に読んでいく。&lt;/p&gt;
&lt;p&gt;YouTube の &lt;a href=&quot;https://www.youtube.com/watch?v=OQTnXNCDywA&quot;&gt;DataLoader - Source code walkthrough&lt;/a&gt; の動画が非常に参考になる。この動画は v1 の解説なので最新の v2 とは若干の差があるが、基本的に大きな違いはない。&lt;sup id=&quot;fnref-6&quot;&gt;&lt;a href=&quot;#fn-6&quot; class=&quot;footnote-ref&quot;&gt;6&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;h3 id=&quot;dataloader-flow-type-l10-l33&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#dataloader-flow-type-l10-l33&quot; aria-label=&quot;dataloader flow type l10 l33 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;DataLoader flow type: L10-L33&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/graphql/dataloader/blob/ef6d32f97cde16aba84d96dc806c4439eaf8efae/src/index.js#L10-L33&quot;&gt;10 ~ 33行目&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;graphql/dataloader では JavaScript に静的な型を付けるために &lt;a href=&quot;https://flow.org/&quot;&gt;Flow&lt;/a&gt; を使用している。&lt;/p&gt;
&lt;p&gt;index.js では最初に以下の3つの type が定義されている。まずは &lt;code class=&quot;language-text&quot;&gt;BatchLoadFn&lt;/code&gt; で、これは Batch 処理の対象 keys &lt;code class=&quot;language-text&quot;&gt;K&lt;/code&gt; を受け取って Values &lt;code class=&quot;language-text&quot;&gt;V&lt;/code&gt; の配列の Promise を返す関数。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ts&quot;&gt;&lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// A Function, which when given an Array of keys, returns a Promise of an Array&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// of values or Errors.&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;BatchLoadFn&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;K&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;V&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;keys&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; $ReadOnlyArray&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;K&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Promise&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;$ReadOnlyArray&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;V&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; Error&lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;次に定義されているのは &lt;code class=&quot;language-text&quot;&gt;Options&lt;/code&gt; で、これにより DataLoader クラスのコンストラクタで初期値を設定できる。例えば Batch の最大サイズや Cache を使うかどうか等の設定をすることができる。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ts&quot;&gt;&lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// Optionally turn off batching or caching or provide a cache key function or a&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// custom cache instance.&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Options&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;K&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;V&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;C&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;K&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  batch&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;boolean&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  maxBatchSize&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;number&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  batchScheduleFn&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function-variable function&quot;&gt;callback&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  cache&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;boolean&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  cacheKeyFn&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;K&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;C&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  cacheMap&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; CacheMap&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;C&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Promise&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;V&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;最後に &lt;code class=&quot;language-text&quot;&gt;CacheMap&lt;/code&gt; で、これは通常は使うことはないが、カスタムの Cache を定義したいときはこの型を持つインスタンスを Options として渡す。&lt;sup id=&quot;fnref-7&quot;&gt;&lt;a href=&quot;#fn-7&quot; class=&quot;footnote-ref&quot;&gt;7&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ts&quot;&gt;&lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// If a custom cache is provided, it must be of this type (a subset of ES6 Map).&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;CacheMap&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;K&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;V&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;K&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;V&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;K&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; value&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;V&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;any&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;delete&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;K&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;any&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;clear&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;any&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;type 定義は ES6 で追加された &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map&quot;&gt;Map&lt;/a&gt; の subset になっている。&lt;/p&gt;
&lt;h3 id=&quot;dataloader-コンストラクタ-l34-l70&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#dataloader-%E3%82%B3%E3%83%B3%E3%82%B9%E3%83%88%E3%83%A9%E3%82%AF%E3%82%BF-l34-l70&quot; aria-label=&quot;dataloader コンストラクタ l34 l70 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;DataLoader コンストラクタ: L34-L70&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/graphql/dataloader/blob/ef6d32f97cde16aba84d96dc806c4439eaf8efae/src/index.js#L34-L70&quot;&gt;34 ~ 70行目&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;DataLoader のコンストラクタは BatchLoadFn と Options を受け取る。BatchLoadFn は前述の通り Batch 処理対象となる key の配列を受け取って配列の Promise を返す関数で、ユーザーが定義する。&lt;/p&gt;
&lt;p&gt;コンストラクタから呼ばれる関数（getValidMaxBatchSize など）については後述する。&lt;/p&gt;
&lt;h3 id=&quot;load-l71-l113&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#load-l71-l113&quot; aria-label=&quot;load l71 l113 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;load: L71-L113&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/graphql/dataloader/blob/ef6d32f97cde16aba84d96dc806c4439eaf8efae/src/index.js#L71-L113&quot;&gt;71 ~ 113行目&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;単一の key を受け取り、それを Batch Function に与えて得られる value の Promise を返す。 value そのものは返さない。&lt;/p&gt;
&lt;p&gt;行数はかなり多いが責任は単純で、&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;まず引数の key が null でも undefined でもないことを確かめる&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;getCurrentBatch&lt;/code&gt; で load を実行する Batch 処理を取得する&lt;/li&gt;
&lt;li&gt;引数の key で Cache （key と対応する value の Promise）が存在するかを調べ、hit すればそれを返し hit しなければ Batch 処理に key を push してから key と Promise の組み合わせを Cache する&lt;/li&gt;
&lt;li&gt;3 の Promise を返す&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;という処理を行なっている。&lt;/p&gt;
&lt;p&gt;load や loadMany をまとめて Batch 処理を実行するのは &lt;code class=&quot;language-text&quot;&gt;dispatchBatch&lt;/code&gt; という別の関数で、これは 2. の &lt;code class=&quot;language-text&quot;&gt;getCurrentBatch&lt;/code&gt; から呼ばれる。&lt;/p&gt;
&lt;h3 id=&quot;loadmany-l114-l148&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#loadmany-l114-l148&quot; aria-label=&quot;loadmany l114 l148 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;loadMany: L114-L148&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/graphql/dataloader/blob/ef6d32f97cde16aba84d96dc806c4439eaf8efae/src/index.js#L114-L148&quot;&gt;114 ~ 148行目&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;引数として複数の key を受け取り、それを Batch Function に引数として与えて得る value の配列の Promise を返す。 value の配列そのものは返さない。&lt;/p&gt;
&lt;p&gt;基本的には &lt;code class=&quot;language-text&quot;&gt;DataLoader.load&lt;/code&gt; を &lt;code class=&quot;language-text&quot;&gt;Promise.all&lt;/code&gt; でラップした関数と考えてよい。つまり…&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; b &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; myLoader&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;loadMany&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;a&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;b&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;上記のコードは、下記のコードとほぼ同じ動作をする。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; b &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; Promise&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;all&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
  myLoader&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;load&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;a&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  myLoader&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;load&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;b&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;異なる点としては、 &lt;code class=&quot;language-text&quot;&gt;load&lt;/code&gt; が失敗した際に &lt;code class=&quot;language-text&quot;&gt;Promise.all&lt;/code&gt; ではまとめて reject するが、 &lt;code class=&quot;language-text&quot;&gt;loadMany&lt;/code&gt; では Error インスタンスを resolve する。&lt;/p&gt;
&lt;h3 id=&quot;clear-clearall-l149-l174&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#clear-clearall-l149-l174&quot; aria-label=&quot;clear clearall l149 l174 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;clear, clearAll: L149-L174&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/graphql/dataloader/blob/ef6d32f97cde16aba84d96dc806c4439eaf8efae/src/index.js#L149-L174&quot;&gt;149 ~ 174行目&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;clear&lt;/code&gt; では key を指定して、それと対応する Cache を消去する。この Cache は DataLoader インスタンスごとに作られている。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ts&quot;&gt;&lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;&lt;span class=&quot;token function&quot;&gt;clear&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;K&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; cacheMap &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_cacheMap&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;cacheMap&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; cacheKey &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;_cacheKeyFn&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    cacheMap&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;delete&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;cacheKey&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;積極的に Cache をクリアせずともメモリが枯渇する可能性は非常に低い。なぜなら、基本的には DataLoader インスタンスはリクエスト毎に作られ結果がクライアントに送られた後（参照がなくなるので） GC によってメモリが解放されるからだ。&lt;/p&gt;
&lt;p&gt;実際にこれを使う場面としては、 GraphQL の Mutation 等で key に対応する value が変わって前の Cache を消したいときだろう。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;clearAll&lt;/code&gt; は DataLoader インスタンスの Cache を全て消去する。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ts&quot;&gt;&lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;&lt;span class=&quot;token function&quot;&gt;clearAll&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; cacheMap &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_cacheMap&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;cacheMap&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    cacheMap&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;clear&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;prime-l175-l205&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#prime-l175-l205&quot; aria-label=&quot;prime l175 l205 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;prime: L175-L205&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/graphql/dataloader/blob/ef6d32f97cde16aba84d96dc806c4439eaf8efae/src/index.js#L175-L205&quot;&gt;175 ~ 205行目&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;引数として指定した key と value を Cache に書き込む。つまり load することなく Cache を使うことができる。&lt;/p&gt;
&lt;p&gt;value が Error インスタンスの場合は reject された Promise を Cache する。また、既に指定された key に対して何らかの value が Cache されている場合は何もしないので、上書きしたければ &lt;code class=&quot;language-text&quot;&gt;clear&lt;/code&gt; してから &lt;code class=&quot;language-text&quot;&gt;prime&lt;/code&gt; を呼び出す必要がある。&lt;/p&gt;
&lt;p&gt;これは &lt;code class=&quot;language-text&quot;&gt;load&lt;/code&gt; や &lt;code class=&quot;language-text&quot;&gt;loadMany&lt;/code&gt; によって書き込まれた Cache と挙動を揃えるため。&lt;/p&gt;
&lt;h3 id=&quot;enqueuepostpromisejob-l206-l246&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#enqueuepostpromisejob-l206-l246&quot; aria-label=&quot;enqueuepostpromisejob l206 l246 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;enqueuePostPromiseJob: L206-L246&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/graphql/dataloader/blob/ef6d32f97cde16aba84d96dc806c4439eaf8efae/src/index.js#L206-L246&quot;&gt;206 ~ 246行目&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;デフォルトの Batch Scheduling を定義する。&lt;/p&gt;
&lt;p&gt;DataLoader のコンストラクタで &lt;code class=&quot;language-text&quot;&gt;batchScheduleFn&lt;/code&gt; を渡さない場合、この enqueuePostPromiseJob で Batch 処理のスケジューリングを行う。その場合、この関数は次の手順で呼び出される。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;DataLoader.load&lt;/code&gt; が &lt;code class=&quot;language-text&quot;&gt;getCurrentBatch&lt;/code&gt; を呼ぶ&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;getCurrentBatch&lt;/code&gt; は dispatch 待機中の Batch が無い場合、新しい Batch を作る&lt;/li&gt;
&lt;li&gt;この時、 &lt;code class=&quot;language-text&quot;&gt;DataLoader._batchScheduleFn&lt;/code&gt; のコールバックとして &lt;code class=&quot;language-text&quot;&gt;dispatchBatch&lt;/code&gt; を呼び新しく作った Batch を実行する
&lt;ul&gt;
&lt;li&gt;この時デフォルトで使われる &lt;code class=&quot;language-text&quot;&gt;_batchScheduleFn&lt;/code&gt; がこの &lt;code class=&quot;language-text&quot;&gt;enqueuePostPromiseJob&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;実装としては次のようになっている。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; enqueuePostPromiseJob &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt; process &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;object&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt; process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;nextTick &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;function&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;fn&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;resolvedPromise&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        resolvedPromise &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Promise&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;resolve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      resolvedPromise&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;nextTick&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fn&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
    setImmediate &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; setTimeout&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Private: cached resolved Promise instance&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; resolvedPromise&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Node.js 環境では &lt;a href=&quot;https://nodejs.org/en/docs/guides/event-loop-timers-and-nexttick/&quot;&gt;process.nextTick&lt;/a&gt; が使われる。nextTick に渡したコールバックは Node.js におけるイベントループ内の各 phase の終了時に実行される。各 phase には実行するコールバックの FIFO キューがあり、その phase に固有の operation を実行した後キューがなくなるかコールバックの最大数に達するまでコールバックを実行する。&lt;/p&gt;
&lt;p&gt;ここでは Promise の then コールバックで process.nextTick を呼び出しているが、これは他の Promise より前に nextTick が呼ばれないようにするため。この技法は&lt;a href=&quot;https://youtu.be/OQTnXNCDywA?t=1434&quot;&gt;解説動画の 23:55~&lt;/a&gt; で説明されている。&lt;/p&gt;
&lt;p&gt;process.nextTick の注意点としては、全てのコールバックが nextTick を呼んだ時点の phase 終了後イベントループを継続する前に呼ばれるので、再帰的に呼び続けると I/O が実行できなくなる恐れがある。イベントループについて詳しくは Node.js のドキュメントを参照。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://nodejs.org/en/docs/guides/dont-block-the-event-loop/&quot;&gt;Don’t Block the Event Loop (or the Worker Pool)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://nodejs.org/en/docs/guides/event-loop-timers-and-nexttick/&quot;&gt;The Node.js Event Loop, Timers, and process.nextTick()&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;下記の Synk 社のブログも参考になる。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://snyk.io/blog/nodejs-how-even-quick-async-functions-can-block-the-event-loop-starve-io/&quot;&gt;Node.js Event-Loop: How even quick Node.js async functions can block the Event-Loop, starve I/O&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;なおブラウザ環境には Node.js の process.nextTick が無いので、 setImmediate や setTimeout を介して同様の処理が実行される。この場合、パフォーマンスが少し落ちる可能性がある。&lt;/p&gt;
&lt;h3 id=&quot;batch-flow-type-l247-l257&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#batch-flow-type-l247-l257&quot; aria-label=&quot;batch flow type l247 l257 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Batch flow type: L247-L257&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/graphql/dataloader/blob/ef6d32f97cde16aba84d96dc806c4439eaf8efae/src/index.js#L247-L257&quot;&gt;247 ~ 257行目&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ユーザーが定義する Batch Function の実行状況に責任を持つオブジェクトの型を定義している。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ts&quot;&gt;&lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Batch&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;K&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;V&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  hasDispatched&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;boolean&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// batch が dispatch されたかどうかのステータス&lt;/span&gt;
  keys&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Array&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;K&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// batch function に与える key の配列&lt;/span&gt;
  callbacks&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Array&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// batch promise の完了時に実行される callback&lt;/span&gt;
    &lt;span class=&quot;token function-variable function&quot;&gt;resolve&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;value&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;V&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token function-variable function&quot;&gt;reject&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;error&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Error&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  cacheHits&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Array&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;getcurrentbatch-l258-l287&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#getcurrentbatch-l258-l287&quot; aria-label=&quot;getcurrentbatch l258 l287 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;getCurrentBatch: L258-L287&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/graphql/dataloader/blob/ef6d32f97cde16aba84d96dc806c4439eaf8efae/src/index.js#L258-L287&quot;&gt;258 ~ 287行目&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;DataLoader インスタンスを引数に取り、 Batch （の実行状況）を返す。&lt;/p&gt;
&lt;p&gt;返す Batch はまだ dispatch されていない待機中の Batch があるかどうかによって2種類に分かれる。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;ある&lt;/code&gt;: その Batch を返す&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;なし&lt;/code&gt;: 新しい Batch オブジェクトを作り、それを &lt;code class=&quot;language-text&quot;&gt;dispatchBatch&lt;/code&gt; で実行する&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;なお、待機中の Batch にはコンストラクタで設定できる &lt;code class=&quot;language-text&quot;&gt;maxBatchSize&lt;/code&gt; に到達するまで取得対象の key を追加し続けることができる。 maxBatchSize のデフォルトは Infinity だが、実際には次の tick で Batch が dispatch されるので無限に追加されていくことはない。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;getCurrentBatch&lt;/code&gt; という名前だが、この関数の責任としては Batch を作成したり返すだけでなく（この関数が load から呼ばれることで）Batch を dispatch することも含まれている。&lt;/p&gt;
&lt;h3 id=&quot;dispatchbatch-l288-l352&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#dispatchbatch-l288-l352&quot; aria-label=&quot;dispatchbatch l288 l352 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;dispatchBatch: L288-L352&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/graphql/dataloader/blob/ef6d32f97cde16aba84d96dc806c4439eaf8efae/src/index.js#L288-L352&quot;&gt;288 ~ 352行目&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;これも行数は多いが責任は単純で、&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Batch の発行ステータス（hasDispatched）を true にする&lt;/li&gt;
&lt;li&gt;load 対象の key 配列が空であれば Cache を返す&lt;/li&gt;
&lt;li&gt;load 対象の key があれば、 key を与えて Batch Function を実行する
&lt;ul&gt;
&lt;li&gt;Batch Function が不正、または実行そのものに失敗した場合は failedDispatch を呼ぶ&lt;/li&gt;
&lt;li&gt;成功した場合は結果が配列かつ与えた key と同じ長さであることを確かめ、個々の value の型（Error インスタンスかどうか）に沿って reject または resolve していく&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;この dispatchBatch を呼んでいるのは getCurrentBatch のみで、これを呼んでいるのは load のみなので、 &lt;code class=&quot;language-text&quot;&gt;DataLoader.load&lt;/code&gt; を呼んだ時は次のような手順で dispatch される。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;getCurrentBatch を呼んで dispatch されていない待機中の Batch があるか確認する&lt;/li&gt;
&lt;li&gt;待機中の Batch があれば、そこに取得対象の key を追加する&lt;/li&gt;
&lt;li&gt;なければ新しく作って dispatch し、そこに取得対象の key を追加する&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Batch の実行間隔はデフォルト 1 tick で、コンストラクタから渡せる &lt;code class=&quot;language-text&quot;&gt;batchScheduleFn&lt;/code&gt; でカスタマイズできる。&lt;/p&gt;
&lt;h3 id=&quot;faileddispatch-l353-l367&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#faileddispatch-l353-l367&quot; aria-label=&quot;faileddispatch l353 l367 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;failedDispatch: L353-L367&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/graphql/dataloader/blob/ef6d32f97cde16aba84d96dc806c4439eaf8efae/src/index.js#L353-L367&quot;&gt;353 ~ 367行目&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Batch 実行に失敗したときに key と対応する Cache を消して、 Batch に登録された callback の Promise を reject する。&lt;/p&gt;
&lt;p&gt;これは Batch Function に与える key 毎に行われる。もし Cache に hit した場合は（Batch の実行に失敗しても）Cache を返して resolve する。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ts&quot;&gt;&lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// Private: do not cache individual loads if the entire batch dispatch fails,&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// but still reject each request so they do not hang.&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token generic-function&quot;&gt;&lt;span class=&quot;token function&quot;&gt;failedDispatch&lt;/span&gt;&lt;span class=&quot;token generic class-name&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;K&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;V&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  loader&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; DataLoader&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;K&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;V&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;any&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  batch&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Batch&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;K&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;V&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  error&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Error
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// Cache hits are resolved, even though the batch failed.&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;resolveCacheHits&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;batch&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; batch&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;keys&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    loader&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;clear&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;batch&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;keys&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    batch&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;callbacks&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;reject&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Batch 失敗時に Cache を消す理由は、呼び出し側で reject を捕捉してリトライしたときに Cache hit しないようにするため。&lt;/p&gt;
&lt;h3 id=&quot;resolvecachehits-l368-l376&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#resolvecachehits-l368-l376&quot; aria-label=&quot;resolvecachehits l368 l376 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;resolveCacheHits: L368-L376&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/graphql/dataloader/blob/ef6d32f97cde16aba84d96dc806c4439eaf8efae/src/index.js#L368-L376&quot;&gt;368 ~ 376行目&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Batch を引数に取り、その中で Cache に hit した Promise を resolve するだけの関数。&lt;/p&gt;
&lt;h3 id=&quot;getvalidmaxbatchsize-l377-l394&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#getvalidmaxbatchsize-l377-l394&quot; aria-label=&quot;getvalidmaxbatchsize l377 l394 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;getValidMaxBatchSize: L377-L394&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/graphql/dataloader/blob/ef6d32f97cde16aba84d96dc806c4439eaf8efae/src/index.js#L377-L394&quot;&gt;377 ~ 394行目&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;DataLoader のコンストラクタから呼び出され、 Batch の最大サイズを返す。デフォルトは Infinity。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ts&quot;&gt;&lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// Private: given the DataLoader&apos;s options, produce a valid max batch size.&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getValidMaxBatchSize&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;options&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;Options&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;any&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;any&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;any&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;number&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; shouldBatch &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;options &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; options&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;batch &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;shouldBatch&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; maxBatchSize &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; options &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; options&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;maxBatchSize&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;maxBatchSize &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;undefined&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;Infinity&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt; maxBatchSize &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;number&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; maxBatchSize &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;TypeError&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;maxBatchSize must be a positive number: &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;maxBatchSize&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;any&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; maxBatchSize&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Batch の最大サイズを制限すると、 getCurrentBatch で待機中の Batch をより細かく切り分けて実行することができる。&lt;/p&gt;
&lt;h3 id=&quot;getvalidbatchschedulefn-l395-l410&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#getvalidbatchschedulefn-l395-l410&quot; aria-label=&quot;getvalidbatchschedulefn l395 l410 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;getValidBatchScheduleFn: L395-L410&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/graphql/dataloader/blob/ef6d32f97cde16aba84d96dc806c4439eaf8efae/src/index.js#L395-L410&quot;&gt;395 ~ 410行目&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;DataLoader のコンストラクタから呼び出され、 Batch を Schedule する関数を返す。&lt;/p&gt;
&lt;p&gt;デフォルトでは &lt;code class=&quot;language-text&quot;&gt;enqueuePostPromiseJob&lt;/code&gt; を使う。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ts&quot;&gt;&lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// Private&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getValidBatchScheduleFn&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  options&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;Options&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;any&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;any&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;any&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; batchScheduleFn &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; options &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; options&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;batchScheduleFn&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;batchScheduleFn &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;undefined&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; enqueuePostPromiseJob&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt; batchScheduleFn &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;function&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;TypeError&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;batchScheduleFn must be a function: &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;batchScheduleFn&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;any&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; batchScheduleFn&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;getvalidcachekeyfn-l411-l422&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#getvalidcachekeyfn-l411-l422&quot; aria-label=&quot;getvalidcachekeyfn l411 l422 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;getValidCacheKeyFn: L411-L422&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/graphql/dataloader/blob/ef6d32f97cde16aba84d96dc806c4439eaf8efae/src/index.js#L411-L422&quot;&gt;411 ~ 422行目&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;DataLoader のコンストラクタから呼び出され、 key を通じて Cache から key と value の組み合わせを取得する関数を返す。&lt;/p&gt;
&lt;p&gt;デフォルトは &lt;code class=&quot;language-text&quot;&gt;(key =&gt; key: any);&lt;/code&gt; を返す。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ts&quot;&gt;&lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// Private: given the DataLoader&apos;s options, produce a cache key function.&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token generic-function&quot;&gt;&lt;span class=&quot;token function&quot;&gt;getValidCacheKeyFn&lt;/span&gt;&lt;span class=&quot;token generic class-name&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;K&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;C&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;options&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;Options&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;K&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;any&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;C&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;K&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;C&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; cacheKeyFn &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; options &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; options&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;cacheKeyFn&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;cacheKeyFn &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;undefined&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; key&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;any&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt; cacheKeyFn &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;function&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;TypeError&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;cacheKeyFn must be a function: &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;cacheKeyFn&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;any&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; cacheKeyFn&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;key が string や number であればデフォルトで問題ないが、オブジェクトを key として使いたい場合は CacheKeyFn が必要になってくる。例えば MongoDB など。&lt;/p&gt;
&lt;h3 id=&quot;getvalidcachemap-l423-l447&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#getvalidcachemap-l423-l447&quot; aria-label=&quot;getvalidcachemap l423 l447 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;getValidCacheMap: L423-L447&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/graphql/dataloader/blob/ef6d32f97cde16aba84d96dc806c4439eaf8efae/src/index.js#L423-L447&quot;&gt;423 ~ 447行目&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;DataLoader のコンストラクタから呼び出され、 Cache を書き込むためのインスタンスを返す。コンストラクタに渡すオプションで Cache を無効にすることもでき、その場合はこの関数が null を返す。&lt;/p&gt;
&lt;p&gt;デフォルトでは ES6 で追加された &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map&quot;&gt;Map&lt;/a&gt; オブジェクトを使う。&lt;/p&gt;
&lt;h3 id=&quot;isarraylike-l448-l458&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#isarraylike-l448-l458&quot; aria-label=&quot;isarraylike l448 l458 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;isArrayLike: L448-L458&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/graphql/dataloader/blob/ef6d32f97cde16aba84d96dc806c4439eaf8efae/src/index.js#L448-L458&quot;&gt;448 ~ 458行目&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;引数が配列かどうかを boolean で返す関数で、下記の2箇所で使われている。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;loadMany に key の配列を与えたときそれが配列でなければ例外を投げる&lt;/li&gt;
&lt;li&gt;dispatchBatch において、 Batch Function の Promise を resolve した結果が配列でなければ例外を投げる&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;isArrayLike 関数に次のような引数を与えると、各行にコメントで記した結果を返す。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;undefined&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// false&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// false&lt;/span&gt;
&lt;span class=&quot;token string&quot;&gt;&apos;x&apos;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// false&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// true&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;x&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// true&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;x&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;y&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;z&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// true&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;foo&apos;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;bar&apos;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;200&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;foo&apos;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;300&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;bar&apos;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;400&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// true&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// true&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;最後の条件では配列がその最後の要素を持つかどうかを判定している。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;x&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Object&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;prototype&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;hasOwnProperty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;call&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; x&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ロジックだけ読むと何のためかよく分からないのだが、 Object.prototype が上書きされた場合に安全に配列の要素を参照するためかもしれない。&lt;/p&gt;
&lt;p&gt;参考: &lt;a href=&quot;https://sosukesuzuki.dev/posts/stage-3-object-hasown/&quot;&gt;https://sosukesuzuki.dev/posts/stage-3-object-hasown/&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;dataloader-の基本的な使い方&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#dataloader-%E3%81%AE%E5%9F%BA%E6%9C%AC%E7%9A%84%E3%81%AA%E4%BD%BF%E3%81%84%E6%96%B9&quot; aria-label=&quot;dataloader の基本的な使い方 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;DataLoader の基本的な使い方&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;まずは &lt;strong&gt;Batch Function&lt;/strong&gt; を定義する
&lt;ul&gt;
&lt;li&gt;取得対象のデータを示す key の配列を受け取り、それと対応する value 配列の Promise を返す&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Batch Function&lt;/strong&gt; をコンストラクタに渡して &lt;code class=&quot;language-text&quot;&gt;DataLoader&lt;/code&gt; のインスタンスを作る&lt;/li&gt;
&lt;li&gt;データを取得するときは &lt;code class=&quot;language-text&quot;&gt;DataLoader.load(key)&lt;/code&gt; を使う
&lt;ul&gt;
&lt;li&gt;これにより、同じ Batch Scheduling 内に行われたデータ取得リクエストを DataLoader が一つにまとめてくれる（&lt;a href=&quot;https://github.com/graphql/dataloader#batch-scheduling&quot;&gt;参考&lt;/a&gt;）&lt;/li&gt;
&lt;li&gt;実際の挙動としては &lt;strong&gt;Batch Function&lt;/strong&gt; に key の配列が渡されて実行される&lt;/li&gt;
&lt;li&gt;load は引数として与えた key に対応する value の Promise を返す&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;DataLoader&lt;/code&gt; インスタンスごとに &lt;code class=&quot;language-text&quot;&gt;Cache&lt;/code&gt; の Map が作られる
&lt;ul&gt;
&lt;li&gt;key とそれに対応する value の Promise の組が入っている&lt;/li&gt;
&lt;li&gt;異なるクライアントのリクエストを Cache すると見えてはいけないものが見えてしまうので、必ずリクエスト毎あるいはクライアント毎に DataLoader インスタンスを作ること&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;dataloader-について書かれた記事&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#dataloader-%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E6%9B%B8%E3%81%8B%E3%82%8C%E3%81%9F%E8%A8%98%E4%BA%8B&quot; aria-label=&quot;dataloader について書かれた記事 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;DataLoader について書かれた記事&lt;/h2&gt;
&lt;p&gt;最後に DataLoader について書かれた記事を紹介する。実際に graphql/dataloader を使ってはいなくとも、基本的なアイデアとしては共通している。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://engineering.mercari.com/blog/entry/20210818-mercari-shops-nestjs-graphql-server&quot;&gt;mercari engineering: メルカリ Shops での NestJS を使った GraphQL Server の実装&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://dev.classmethod.jp/articles/graphql-dataloader-sample/&quot;&gt;クラスメソッド: [GraphQL] N+1 問題を解決する DataLoader の仕組みとサンプル実装&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://qiita.com/yuku_t/items/2c1735cbf45e75c0bfb8&quot;&gt;Qiita: GraphQL と N+1 SQL 問題と dataloader&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://zenn.dev/tatta/books/5096cb23126e64/viewer/e1ddb1&quot;&gt;Zenn: TypeScript * GraphQL のバックエンド設計プラクティス&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://zenn.dev/alea12/articles/15d73282c3aacc&quot;&gt;Zenn: GraphQL で N+1 問題を解決する４つのアプローチ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://blog.potproject.net/2021/02/26/dataloader-architecture&quot;&gt;最適化されたデータの取得をしてくれるDataloaderの仕組みを調べてみた&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;勉強になった点&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%8B%89%E5%BC%B7%E3%81%AB%E3%81%AA%E3%81%A3%E3%81%9F%E7%82%B9&quot; aria-label=&quot;勉強になった点 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;勉強になった点&lt;/h2&gt;
&lt;p&gt;graphql/dataloader は自分自身のプログラミングの勉強になったので、感想を書いておく。&lt;/p&gt;
&lt;p&gt;これは簡潔かつ短いコードで限られた機能を提供しているが、非常に多くの人に使われている。多くの人に使われている理由は、 GraphQL の非同期 Resolver で出会う可能性が非常に高い問題を簡単に解決できるからだろう。&lt;/p&gt;
&lt;p&gt;それを簡単に解決できる理由としては、大元のアイデア（一定時間内のデータ取得リクエストを Batch 処理としてまとめ、データソースへのリクエスト回数を減らす）が単純に優れているだけでなく、アイデアを実現するために graphql/dataloader が責任を持つ範囲を明確に限定しているという点を挙げたい。&lt;/p&gt;
&lt;p&gt;graphql/dataloader の責任はデータ取得リクエストの Batch とその Cache であり、その中でも一部に限られている。 Batch 処理を行う関数はユーザー側が定義して DataLoader コンストラクタに渡す。Batch も Cache もインターフェイスは決まっているが、それさえ守ればユーザー側でカスタマイズできる。&lt;/p&gt;
&lt;p&gt;特定のアーキテクチャに依存するのはユーザーが実装する Batch Function やユーザーが与える CacheMap であり、 graphql/dataloader 自体は非同期でサービス内の様々な箇所から同じデータベースに向けて効率的なデータ取得要求をしたいというユースケースを上手に抽象化し、特定のアーキテクチャに依存しない実装となっている。これは簡単で分かりやすく、使いやすい設計といえる。&lt;/p&gt;
&lt;p&gt;機能に関して言えば、このような DataLoader は ORM の機能として実現することもできる（例えば &lt;a href=&quot;https://www.prisma.io/docs/guides/performance-and-optimization/query-optimization-performance#solving-n1-in-graphql-with-findunique-and-prismas-dataloader&quot;&gt;Prisma のように&lt;/a&gt;）。しかし、 graphql/dataloader のように小さく責任範囲が明確で上手に実装されているライブラリは、実装を把握するのが簡単、組み込みやすい、取り替えやすいなど様々なメリットがあると考えられる。&lt;/p&gt;
&lt;p&gt;少人数で大きな価値を生み出すにはこのようにプログラムの責任を明確にしていくことが重要だと感じたので、自分もこれを心がけていきたい。&lt;/p&gt;
&lt;h2 id=&quot;本記事のまとめ&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%9C%AC%E8%A8%98%E4%BA%8B%E3%81%AE%E3%81%BE%E3%81%A8%E3%82%81&quot; aria-label=&quot;本記事のまとめ permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;本記事のまとめ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;graphql/dataloader の本質は Batch と Cache の機能を提供する簡潔な API&lt;/li&gt;
&lt;li&gt;GraphQL におけるデータ取得の問題を簡単に解決してくれるのでよく使われる&lt;/li&gt;
&lt;li&gt;単純かつ率直な実装で素晴らしいアイデアを実装しており、プログラミングの参考になる&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;本記事に誤りがあれば Twitter の DM や GitHub の連絡先へのメール等で教えていただけると助かります。どうぞよろしくお願いいたします。&lt;/p&gt;
&lt;p&gt;最後に、今回 Node.js の非同期処理について調べていて最も自分に刺さった言葉を置いておきます。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;the way that you should be doing things should be easy in the way you shouldn’t be doing things should be difficult&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;— &lt;a href=&quot;https://youtu.be/EeYvFl7li9E?t=1455&quot;&gt;Ryan Dahl: Node JS, JSConf.eu 2009&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;footnotes&quot;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&quot;fn-1&quot;&gt;他言語による実装では Go の &lt;a href=&quot;https://github.com/graph-gophers/dataloader&quot;&gt;graph-gophers/dataloader&lt;/a&gt; や Ruby の &lt;a href=&quot;https://github.com/Shopify/graphql-batch&quot;&gt;exAspArk/batch-loader&lt;/a&gt;、&lt;a href=&quot;https://github.com/Shopify/graphql-batch&quot;&gt;Shopify/graphql-batch&lt;/a&gt; がよく使われているようだ。&lt;a href=&quot;#fnref-1&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;li id=&quot;fn-2&quot;&gt;ただし Batch Function 内部で N+1 問題を引き起こすようなループ処理内でのクエリ発行を行っている場合は、当然ながら N+1 問題が発生してしまう。もっとも、これは GraphQL の Resolver が起こすそれに比べればコード上で明確なぶん与しやすそうだ。&lt;a href=&quot;#fnref-2&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;li id=&quot;fn-3&quot;&gt;&lt;a href=&quot;https://graphql.org/learn/execution/&quot;&gt;https://graphql.org/learn/execution/&lt;/a&gt;&lt;a href=&quot;#fnref-3&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;li id=&quot;fn-4&quot;&gt;&lt;a href=&quot;https://graphql.org/learn/execution/#asynchronous-resolvers&quot;&gt;https://graphql.org/learn/execution/#asynchronous-resolvers&lt;/a&gt;&lt;a href=&quot;#fnref-4&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;li id=&quot;fn-5&quot;&gt;&lt;a href=&quot;https://graphql.org/learn/execution/#list-resolvers&quot;&gt;https://graphql.org/learn/execution/#list-resolvers&lt;/a&gt;&lt;a href=&quot;#fnref-5&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;li id=&quot;fn-6&quot;&gt;load や loadMany には v2.0.0 で breaking change があるので、詳しく知りたい場合は &lt;a href=&quot;https://github.com/graphql/dataloader/releases/tag/v2.0.0&quot;&gt;Releases/v2.0.0&lt;/a&gt; を見ると良い。&lt;a href=&quot;#fnref-6&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;li id=&quot;fn-7&quot;&gt;DataLoader の Cache はデフォルトで無限に成長し、 DataLoader インスタンスへの参照がなくなったときに GC によってメモリが解放される。通常はリクエスト単位でインスタンスを作るので、 Cache は GC されメモリがすぐ解放されるため問題になることはない。開発者 Lee Byron 氏の&lt;a href=&quot;https://youtu.be/OQTnXNCDywA?t=619&quot;&gt;解説動画 10:19 ~&lt;/a&gt;によれば、 Facebook でもそのような実装になっているようだ。&lt;a href=&quot;#fnref-7&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content:encoded></item><item><title><![CDATA[Elastic 社の決算を読んだ話]]></title><description><![CDATA[Elastic 社の決算を読んだので、その話を書く。 数字は主に FY2021/4 の Form 10-K から拾っていく。 会社の概要 Elastic は Elasticsearch や Kibana, Logstash などの検索、ログ関連の OSS…]]></description><link>https://lyohe.github.io/2021-11-25-elastic/</link><guid isPermaLink="false">https://lyohe.github.io/2021-11-25-elastic/</guid><pubDate>Thu, 25 Nov 2021 11:04:44 GMT</pubDate><content:encoded>&lt;p&gt;&lt;a href=&quot;https://www.elastic.co/&quot;&gt;Elastic&lt;/a&gt; 社の決算を読んだので、その話を書く。&lt;/p&gt;
&lt;p&gt;数字は主に &lt;a href=&quot;https://d18rn0p25nwr6d.cloudfront.net/CIK-0001707753/480035b6-2803-4c19-9d74-790dc3090fea.html&quot;&gt;FY2021/4 の Form 10-K&lt;/a&gt; から拾っていく。&lt;/p&gt;
&lt;h2 id=&quot;会社の概要&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BC%9A%E7%A4%BE%E3%81%AE%E6%A6%82%E8%A6%81&quot; aria-label=&quot;会社の概要 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;会社の概要&lt;/h2&gt;
&lt;p&gt;Elastic は &lt;a href=&quot;https://github.com/elastic/elasticsearch&quot;&gt;Elasticsearch&lt;/a&gt; や &lt;a href=&quot;https://github.com/elastic/kibana&quot;&gt;Kibana&lt;/a&gt;, &lt;a href=&quot;https://github.com/elastic/logstash&quot;&gt;Logstash&lt;/a&gt; などの検索、ログ関連の OSS を開発している企業として有名で、それらの追加機能の販売やサポート、マネージドサービスの運用で収益をあげている。&lt;/p&gt;
&lt;p&gt;同社は↑の Elasticsearch, Kibana, Logstash 3つの OSS 開発者によって2012年2月9日にオランダで設立され（当初の社名は SearchWorkings Global B.V.）、2018年10月にアメリカで IPO した。経営陣や多くの従業員はマウンテンビューの事業所で働いており売上の半分以上がアメリカから生じているが、連結親会社である Elastic B.V. は書類上オランダの会社であり本社住所はアムステルダムに存在している。&lt;/p&gt;
&lt;h3 id=&quot;elastic-の-oss-とそのライセンスについて&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#elastic-%E3%81%AE-oss-%E3%81%A8%E3%81%9D%E3%81%AE%E3%83%A9%E3%82%A4%E3%82%BB%E3%83%B3%E3%82%B9%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6&quot; aria-label=&quot;elastic の oss とそのライセンスについて permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Elastic の “OSS” とそのライセンスについて&lt;/h3&gt;
&lt;p&gt;決算とは関係ないが、重要な話なので Elastic 社の “OSS” について書く。&lt;/p&gt;
&lt;p&gt;Elastic が公開している OSS でよく使われるのは Elasticsearch と Kibana で、これらは &lt;a href=&quot;https://www.mongodb.com/licensing/server-side-public-license&quot;&gt;Server Side Public License（SSPL）&lt;/a&gt;と &lt;a href=&quot;https://www.elastic.co/jp/licensing/elastic-license&quot;&gt;Elastic License&lt;/a&gt; のデュアルライセンスという独特な方法で公開されている。&lt;/p&gt;
&lt;p&gt;SSPL は MongoDB 社が作ったライセンスで、このプログラムをサービスとして提供する場合は（商用ライセンスを購入するか）ソースコードを公開しなければならない。公開の範囲が広いので、 MongoDB 社以外がマネージドサービスを提供するのは現実的に不可能というライセンスになっている。背景としては、OSS が人気を集めると “large cloud vendors” がそのマネージドサービスを出して利益を全て持っていってしまうのを防ぎたい、という意図があるようだ。&lt;sup id=&quot;fnref-1&quot;&gt;&lt;a href=&quot;#fn-1&quot; class=&quot;footnote-ref&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;p&gt;Elastic 社も &lt;a href=&quot;https://www.elastic.co/jp/blog/why-license-change-AWS&quot;&gt;AWS に対する防衛策として Apache 2.0 からのライセンス変更&lt;/a&gt;を行った。&lt;/p&gt;
&lt;p&gt;これらのソフトウェアはソースコードは公開されているもののライセンスは &lt;a href=&quot;https://opensource.org/node/1099&quot;&gt;OSI による承認を受けていない&lt;/a&gt;ため「これは “OSS” では無いだろ！」とお怒りになる方もいるかもしれない。確かに厳密には OSS ではないと言える。実際に Elastic 社も（少なくとも SEC Filings 上では） OSI に承認されたライセンスを “open source license”、それを採用しているソフトウェアを “open source software” と呼び、自社のことは “open source model” とか “open code” とか呼んでいる。&lt;/p&gt;
&lt;p&gt;なお、他の独自ライセンスとしては MariaDB が作った &lt;a href=&quot;https://mariadb.com/bsl11/&quot;&gt;Business Source License（BSL）&lt;/a&gt;がある。これも large cloud vendors を意識したライセンスになっている。&lt;/p&gt;
&lt;p&gt;ちなみに AWS はライセンス変更に応じてフォークしたので、2つめの Elasticsearch が生まれた（現在は ”&lt;a href=&quot;https://aws.amazon.com/jp/opensearch-service/the-elk-stack/what-is-opensearch/&quot;&gt;OpenSearch&lt;/a&gt;” という名前になっている）。詳細な経緯については &lt;a href=&quot;https://www.publickey1.jp/blog/19/awselasticsearchossopen_distro_for_elasticsearch.html&quot;&gt;Publickey の記事&lt;/a&gt;が参考になる。&lt;/p&gt;
&lt;p&gt;自分は積極的に OSS 開発をしているわけではないけど、毎日のように OSS のお世話になっている。それらは自分より遥かに優秀な開発者たちが手間暇をかけて作ったものだ。開発に参加した動機はいろいろあるだろうけど、（Elastic の社員や株主を除いては）Elastic 社の利益のために自分の時間と思考をつぎ込む人はいないだろうということは分かる。つまり、一度公開したソフトウェアのライセンスを自社の利益のために後出しで変えるのは外部貢献者に対する裏切りである。&lt;/p&gt;
&lt;p&gt;とはいえ、 Elastic 社の言い分も理解できる。そのソフトウェアが継続的に普及・発展していくためには投資が必要で、（最も投資してきた貢献者は間違いなく Elastic 社であり）更なる投資の元手を稼ぐためにはビジネスでお金を稼ぐ必要があって、美味しいところを持っていってしまう AWS はその邪魔者と見ることもできる。実際にはライセンスに従ってビジネスをしていただけなのだが、他のクラウドベンダーとは良好な関係を築いているので何か行き違いがあったのかもしれない。&lt;/p&gt;
&lt;p&gt;この件に関しては様々な意見があると思うが、オープンソースのエコシステムが中長期的に発展する方向に進んでほしい。あと AWS は非常に影響力が大きいので、自社の顧客以外にも業界全体のことを考えた行動をとってほしい。&lt;/p&gt;
&lt;h3 id=&quot;elastic-の事業概要&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#elastic-%E3%81%AE%E4%BA%8B%E6%A5%AD%E6%A6%82%E8%A6%81&quot; aria-label=&quot;elastic の事業概要 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Elastic の事業概要&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=mVXJHKmFXts&quot;&gt;https://www.youtube.com/watch?v=mVXJHKmFXts&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Elastic 社の事業は Elasticsearch などの “Elastic Stack” と呼ばれる複数のソフトウェアをマネージドサービスまたは顧客による Self-host で提供することで、ソフトウェアのソースコードは前述のライセンスのもとで公開されている。これらのソフトウェアを利用した Solution として &lt;a href=&quot;https://www.elastic.co/jp/enterprise-search&quot;&gt;Enterprise Search&lt;/a&gt;, &lt;a href=&quot;https://www.elastic.co/jp/observability&quot;&gt;Observability&lt;/a&gt;, &lt;a href=&quot;https://www.elastic.co/jp/security&quot;&gt;Security&lt;/a&gt; の3つの事業がある。&lt;/p&gt;
&lt;p&gt;Self-host の場合、無料でダウンロードできるソフトウェアには有償機能が含まれており、これは Elastic 社に利用料を支払うことでアクセスできるようになる。この利用料には無償・有償全ての機能へのサポートが含まれている。&lt;/p&gt;
&lt;p&gt;マネージドサービスの場合は&lt;a href=&quot;https://www.elastic.co/jp/pricing/&quot;&gt;無償版はない（無料トライアル期間はある）&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;Elastic では有償版と無償版が一つのコードベースで提供されており、プロプライエタリなコードを含んでいる。これは AWS がフォークを選択した根拠の一つともなっている（少なくとも建前上は）。これは OSS で事業を運営している会社すべてがそうしているわけではなく、例えば GitLab 社は &lt;a href=&quot;https://www.gitlab.jp/install/ce-or-ee/&quot;&gt;CE（無償版）と EE（有償版）で共通のソースコードを利用している&lt;/a&gt;が、そこからプロプライエタリなコードを取り除いた &lt;a href=&quot;https://gitlab.com/gitlab-org/gitlab-foss&quot;&gt;FOSS 版&lt;/a&gt;を別に提供している。&lt;/p&gt;
&lt;p&gt;Elastic の顧客は2021年4月末の時点で 15,000 社を超えており、売上は $608.5M となっている。2019年は顧客が 8,100 社で売上が $271.7M だったので、ここ2年で2倍以上に急成長している。&lt;/p&gt;
&lt;h3 id=&quot;オランダ法人について&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%82%AA%E3%83%A9%E3%83%B3%E3%83%80%E6%B3%95%E4%BA%BA%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6&quot; aria-label=&quot;オランダ法人について permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;オランダ法人について&lt;/h3&gt;
&lt;p&gt;オランダは&lt;a href=&quot;https://www.jetro.go.jp/world/europe/nl/invest_04.html#block1&quot;&gt;法人税率が低い&lt;/a&gt;。また、所定の手続きを経て政府から認定された知的財産に関する収入については非常に有利な軽減税率（5%）が適用されるという制度、いわゆる patent box がある。&lt;/p&gt;
&lt;p&gt;通常の二国間租税条約では知的財産権の使用料に課される所得税の取り扱いが定められており、基本的には使用料を受け取った国側で課税されることになる。これは国内法の規定より優先される。&lt;/p&gt;
&lt;p&gt;例えば日本からオランダに知的財産権の使用料を払うと日本側では免税となり、オランダ側では patent box 税制に基づいた軽減税率の優遇を受けることができるため、法人税をほとんど支払わなくて良いということになる。2007 ~ 2013年くらいはこれを活用するのがとても流行っていて、スターバックスや Google など様々な企業で”節税”に使われたが、その後 OECD や欧州委員会から怒られが発生して下火になった。&lt;sup id=&quot;fnref-2&quot;&gt;&lt;a href=&quot;#fn-2&quot; class=&quot;footnote-ref&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;p&gt;Form 10-K の 108ページによると税務当局との間でいろいろありそうに見えるので頑張ってほしい。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The Company’s tax filings for fiscal years starting with the year ended April 30, 2016 remain open in various tax jurisdictions.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;主要な経営指標&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%B8%BB%E8%A6%81%E3%81%AA%E7%B5%8C%E5%96%B6%E6%8C%87%E6%A8%99&quot; aria-label=&quot;主要な経営指標 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;主要な経営指標&lt;/h2&gt;
&lt;h3 id=&quot;収益&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%8F%8E%E7%9B%8A&quot; aria-label=&quot;収益 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;収益&lt;/h3&gt;
&lt;p&gt;Elastic 社の四半期ごとの収益は一貫して成長している。 FY2021 の Q1-Q4 の売上は合計 $608.5M だったが前年比で YoY+42% 成長しており、このまま成長すると FY2022 は $800M を超えそうだ。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 470px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/ca7df208184649df4e8bacfe72380093/f96db/elastic-q-revenue.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 91.13924050632912%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAADrUlEQVQ4y42U+1NUZRjH+Xf6B2qarjP9kNVklgxpVMTANCqCOiKghkiNRClekkAgQG4xLDeJkMvI/bKCLCAgLkmssLtclr2evZyzZ8/h05yDIGk2Pr887/ed9/nM933OeZ8o/ic2Nzefy9trLZSwDHIEm83G/ZlZZDlClCzLhEIhRFEkGAzurHcX6iD1qXY5HPidHuasFobNM/RaLfwwNUwwIhPldm0wMDjEiNGIyWTir/l5Hs7NEYlEtmCqugMKh0SQZObsS9xffUzt9EOOd3RT0T7FW9+W4w+FiQqFgqytr2G323WH/xUehwPv+gajj8yML5kp7JggNv8PCipH2fN1BVUNU7wbXYrPLxH1bLGqqkQUBUVV8bncyP4gg3/PM2pd4HrrOMfKu8i7McSegzepaJzkYLJBz+98XoqgAbX+aBB119VWrUt4nU765h8wblsgvaiH5PxOrhWPEJfSQEH1KDFH6yiqGeOTxBpK68Z5de8N/IEnwO1Ys1oR3G4azPMYV2ycLenldFkvZ3K6SDjZxPWKuyRm3OJi0SDvf3WTwuoxPvymkjKDidf2FSEEnlzZ63ShhCSqTOMMLi1yILWes/ndpGa3czijhexrvSSda+VS8RAHjtaRVzLEB3GVOvCj+Krnge0zJh65V9h3wsD54j4OpbeQefEOWVd6SM/tJPVCB3EnG7n82zBfpBjIK9aAFS8GRmc3UthmIvaIgay8blJzOvipcIAT398mKbOVjNxO4k81vRxQ6+FnCb+TX2YkPq2ZnPw+EtKa+e7SHd2ZBtRcxqc2vbzD/YdrKawe1fuTdaWbQ2daOHe5m7QfO0jO+pPTP3eRmNbM1dIRvjxer4M1UFHNPfYmVFNeP8Eb+4u3vrIGfP3TYnILBvRDp3I6iT1Wr7s7ktmqO0s530ZMUh05v/bzcUI1F/L7eTO6hKtlRt6OKdWdvvLeL0//w9qWScamlmlqn6bPuEBT+wyd/WbaeuZo6Zqlo89M4+1pjKbHuh4aW6TccI+7E0tUNIwzOWvTtRSObDkUg15UJYwU8qFERIIBL0pE0rO2jxrWtapIyOGAvpZEgYgsIoWEnVotdKDL5SYkSrjdHkRRwi/4kMIygiDg9Qk4HBvY7SsEBL+utTNer0/PHo+XcDiM0+neAu5+Kfp00YaBT0JRFF0HAn6cGxvYHeu4/MLWe99UXzg/o54dnGFZ4VbnA5atNiwWCxbLIkHBjxOFGY+D1WUry8vLhETxX0N3u/4fvjy1o3VkGlQAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;elastic-q-revenue&quot;
        title=&quot;elastic-q-revenue&quot;
        src=&quot;/static/ca7df208184649df4e8bacfe72380093/f96db/elastic-q-revenue.png&quot;
        srcset=&quot;/static/ca7df208184649df4e8bacfe72380093/c26ae/elastic-q-revenue.png 158w,
/static/ca7df208184649df4e8bacfe72380093/6bdcf/elastic-q-revenue.png 315w,
/static/ca7df208184649df4e8bacfe72380093/f96db/elastic-q-revenue.png 470w&quot;
        sizes=&quot;(max-width: 470px) 100vw, 470px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;上図は&lt;a href=&quot;https://s2.q4cdn.com/265747582/files/doc_presentations/2021/08/Q1-F22-Investor-Presentation.pdf&quot;&gt;直近の FY22/Q1 Investor Presentation&lt;/a&gt; の P48 から引用した。&lt;/p&gt;
&lt;h3 id=&quot;顧客の数と-acv&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E9%A1%A7%E5%AE%A2%E3%81%AE%E6%95%B0%E3%81%A8-acv&quot; aria-label=&quot;顧客の数と acv permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;顧客の数と ACV&lt;/h3&gt;
&lt;p&gt;Elastic 社の顧客数の推移を3年分並べてみた。数字は Form 10-K の 50~51 ページから拾った。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 599px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/f4ae5c67da65fea22d37b80e69408e54/43142/elastic-customers.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 61.39240506329114%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACCklEQVQoz12S307UUBCH+3TiBSrxGTTBd/ABEALBxDui3hqvNUuihjsTLzAQEY24qMtCuywt221P2/P3M+fUFnCSSc6cnvnmNzONnHN05k/j1HA2mVJPYsQkoagq0vSC8/MpqslpqhwjBVl6QVVVXDfPivyhaRryPA8XtTQopTGyQXs3BqlUcLCkheXNrmQ6U+AM1jmKoggMb1FH7rwtpXEqC47OwGZYmQJzjs9y7qymHI5teGqtu5EfXW+5hV+5t6J2jFOLCfkNx3HB0mrM99NWkf0vPyiUUgbZLdwG14Hg+HCgeLglyIUJCUeJY2FFcHCiwztjHUII6rrGWkuktcYYg9I6APKqnZMxLsSDPcXiWslMtAV+JoaFlZKvJybEHuhBfgdZlhGNRiN0gLX2fEfy+HXdx9v7mqWNkrxqWxtObAscm36G3vzGPTRSSuF9XpThw/rbmgdb4t9P1Cq8t14yK/9X2Hbkgb7dsiwDNGqrWKq6CQ82BzWPXoh+loM9GYCXpQnxUay5vVJczdBYOlF+dP2Wu11tDiTLL5sbLd/dqJlL+pZvPan4FnMjr99yB5TKV1Q83RYsP4spdj+BnDPYb7i/OuXPux2YjvmRaBbXcj6+eo88/IxyUAnR76EHernWaGbCMDyOmf0aYmWDkJbhKCXZ30Pnl0jj+J0UnH45QJ4nGNfOsAP+BZHkiqeY/BvwAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;elastic-customers&quot;
        title=&quot;elastic-customers&quot;
        src=&quot;/static/f4ae5c67da65fea22d37b80e69408e54/43142/elastic-customers.png&quot;
        srcset=&quot;/static/f4ae5c67da65fea22d37b80e69408e54/c26ae/elastic-customers.png 158w,
/static/f4ae5c67da65fea22d37b80e69408e54/6bdcf/elastic-customers.png 315w,
/static/f4ae5c67da65fea22d37b80e69408e54/43142/elastic-customers.png 599w&quot;
        sizes=&quot;(max-width: 599px) 100vw, 599px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;これを見ると、顧客数は全体として毎年+30%以上伸びている。Elastic は年間の同一顧客からの収入を ACV（Anual Contract Revenue） と定義しているが、 FY2021 は ACV が10万ドル以上の顧客の伸び率が若干下がっていることが見てとれる。&lt;/p&gt;
&lt;p&gt;売上の伸び率自体は大きく変わっていないので、さらに大口の顧客の利用と $100K より小口の顧客の利用が増えているのかもしれない。 &lt;a href=&quot;https://s2.q4cdn.com/265747582/files/doc_presentations/2021/08/Q1-F22-Investor-Presentation.pdf&quot;&gt;FY2022/Q1 の投資家向けプレゼンテーション&lt;/a&gt;の35ページによると、 ACV &gt; $1M 以上の顧客数は前年比で+50%増えている。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/0a3b21c842a5368eccc664a9887cf70b/2b2c6/elastic-acv.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 56.32911392405063%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACGUlEQVQoz3WSu28TQRDG/WfRgaACGkTDo0pEERqoIkpKajqUAheJQgEi6ZAAIaSEoIgQEJHj2PHZPs6PnF/E9u29b++HdpKYCMGcZk8738y338xuwbablEolHMfh8PCQer1Oo1GnXC5j2zZ2s4FlWeK1U3x/f1/2Bq9WK7O6NE0pmCUII3w/YOopplMl+yiOCcMI5fso5QvmnXoURYL5QYAfhCg/IIpi8jynkGYaP0xod3u0OkcMRyOmKiTNcsYTD9vp0O66OG2XjjvAaXeRmiCmUrX4vlfCajokqQYhTDWeH2NseKzY2D5goiLiJCOMU1QQo4JE2omSVA5P0kz+Yy/AmygCFUquEBpQhQkVq8PS6mcu3FiiN/RERRAlUphqzcraV3Z+tCRuDjNxMthqt9hsOWSpPmnZECaZZm7xNVfnlrk+v8JRfyoqojhjMPJo/Oxx6XaRZ6tfpJMoTjn2Q2puj8c7n3jybRs06D+EGfOLa0J4bW5ZCE17xt58rHJz4QVX7hYpvtyVmFFj/Trm/uZ7Hm594OnerqjV5xXee7Qu6kThwJsRrr8tc/HWcy7fKVJ8dUKoTwkXNt7x4F+EZh61Zp8DyxU3l2LaMrNyh1PKNVe805vIXE3NxI+o9QdYgxHOaCz5OtcUtM6l8LyZAjN88wIyrWfxs1wTMxhZLq4z82ROcgpnyeaGzvxv+x+Wzz44Gnfp911+A9xjKwNa/XWbAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;elastic-acv&quot;
        title=&quot;elastic-acv&quot;
        src=&quot;/static/0a3b21c842a5368eccc664a9887cf70b/f058b/elastic-acv.png&quot;
        srcset=&quot;/static/0a3b21c842a5368eccc664a9887cf70b/c26ae/elastic-acv.png 158w,
/static/0a3b21c842a5368eccc664a9887cf70b/6bdcf/elastic-acv.png 315w,
/static/0a3b21c842a5368eccc664a9887cf70b/f058b/elastic-acv.png 630w,
/static/0a3b21c842a5368eccc664a9887cf70b/2b2c6/elastic-acv.png 869w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;ちなみにプレゼンテーションの次のページを見ると、顧客の特徴として ACV が年間10万ドル以上の顧客はその半分以上が1つの Solution しか使っていない（これは Enterprise Search のことだと思われる）。逆に年間100万ドル以上の顧客は半分近くが3つのソリューション（Enterprise Search, Observability, Security）を使っている。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/bc5f29dfac26b4ecedd685829251f522/eb2af/elastic-expansion.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 55.69620253164557%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACM0lEQVQoz1WSW28TMRBG87t54A8gQLSCJxAt9IGnComKChVKKlE1yQsqAtR70mSz993srr3e+x5kp1SqpbEtz5lvZuQZtG1LmqZkWfbA/r9JKRFCsFqtSJPk3q/fNJMkyT3T9z2Dtm3wfR/XdY0zjiLCIMAPAjzPM/coCnEdB8exDau5MAyJ49jE6bvn+6AFm7aj6aAoG8IoIU4y0kySpIJM5DRtT9djVttDWTfEq9T4/3OqqAxTVg0DvdVNh8xz5gsLa2mzdFxuF0vmloNQFaqsKaraBAiZM71dMJsvWSwdrqdzvGCFVLVhB3XT8vT1MY+fH7K5PeHD3m+G4xnn05hUVCYoE8pU+GpnzMv3Y8anNn6U4XohZdOjygapKvKiXgvuH12w++UvX4+vmJwuOLv2sdyURBSEcWrgru85+HHF/vCCP5ceQSxYpRKRl/di+hxUTcvG1gmb2yM+Dy+YWgmZlMwt27Sqs2tbVzjh2ZtjPn0743wakUnFdLZ4KKgrPDy5YTi64eo2IoglmSxN5ryoDKSFu67n++iGvcNzJr8sLmchXihJxZpd83ctb2yPeLf7E8vNWNourh+hqtaIibvsem1sjXj05IAXb0/Y+XjK0XjK3ElZOr4x3cmgqmtsLyGIpBHQP17VrfnRqm7MWdctbdvhRwLbSwljySpVZLJAqnLNVutJGOjphp4o0oPs3plnBtb3PDPMjuOYgVYqpyoVZaEoVE6e50iRIZTEjm2kEPwDbow11bRWtBcAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;elastic-expansion&quot;
        title=&quot;elastic-expansion&quot;
        src=&quot;/static/bc5f29dfac26b4ecedd685829251f522/f058b/elastic-expansion.png&quot;
        srcset=&quot;/static/bc5f29dfac26b4ecedd685829251f522/c26ae/elastic-expansion.png 158w,
/static/bc5f29dfac26b4ecedd685829251f522/6bdcf/elastic-expansion.png 315w,
/static/bc5f29dfac26b4ecedd685829251f522/f058b/elastic-expansion.png 630w,
/static/bc5f29dfac26b4ecedd685829251f522/40601/elastic-expansion.png 945w,
/static/bc5f29dfac26b4ecedd685829251f522/eb2af/elastic-expansion.png 954w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;これは Elastic 社にとって収益を拡大する機会が大きいことを意味している。&lt;/p&gt;
&lt;h3 id=&quot;売上の内訳&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%A3%B2%E4%B8%8A%E3%81%AE%E5%86%85%E8%A8%B3&quot; aria-label=&quot;売上の内訳 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;売上の内訳&lt;/h3&gt;
&lt;p&gt;Elastic 社の売上の内訳を見ていく。&lt;/p&gt;
&lt;p&gt;まずは地域別の売上だが、 US とそれ以外の内訳が開示されている。数字は Form 10-K の109ページから拾った。これを見ると半分以上が US での売上だが、その比率は徐々に下がっている。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 599px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/c2161a22e1608155591abfd976788452/43142/elastic-geo.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 61.39240506329114%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACTklEQVQoz2WSy0uUURjG59+pFoYa2kWF6LJp0aagtm3KCIJAksq0QgqMso2rNlEh5aJF5B/QwsyEhEHGe4qjkzrzffPdz+37xXdmHKc68JzDec953+d5L7k0TdlfaX030sP1A6JyhbBYxIsSAj9gy4GyG+K6DnEc1343+Wcrl21hGJIkiX00xqBVjEqqqNhFhWWU8Ow9jjxk4qOkQEmJUQqttfXxfR8hBLm/GeoajQTtgw7BhKADUh3YE+UDASCa3FIrJoNVmKmTUjYUmuxMOYDZR2opxeYGUX7OQu6USP9NWdWlp01MaWpqqOtOm+pVevGUhe5WFrqOUvnwztoCz7OicpVKpaHOwugaMgLASIlyHLRXRbmOdd4ZfcZi5yEWTxzBmXhvbUokNjsbMAiCg6BNiizzzBTLF3pYvXiGzb5b1rb1aoR8Vxv57mPsTow36mhT9jyvkUpqDMnKEvHSAnFh3trCmW8UTrYw33GY9dvXre31py2u9ue50p/n89dyjTiIbOlymbJsbIRU6DBg/dJ5VntaWD3XCdvrzC2HXOv7zo17MwyPFaz2kUlJ26CgfUgwPq2ywhAnwvYh1zyciTD0Df/k5t0peu//wKsmzG5A+2NN6yND71tj/72cTOh44HN8wGdiWv4/2Nk4aCWpBpLLYwkdT2LOPk8oOZLZ5YjTQ3v0PNzlzhsXkIx+8Tk1UKZ7sMLHqTBrCWEY15pSC2hs/kppSuWIxbUdir+zRiliofm17VNY22PXFRitcQLF4obDStHDj7S1ZbOcBfwDAqlutmkmZ2gAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;elastic-geo&quot;
        title=&quot;elastic-geo&quot;
        src=&quot;/static/c2161a22e1608155591abfd976788452/43142/elastic-geo.png&quot;
        srcset=&quot;/static/c2161a22e1608155591abfd976788452/c26ae/elastic-geo.png 158w,
/static/c2161a22e1608155591abfd976788452/6bdcf/elastic-geo.png 315w,
/static/c2161a22e1608155591abfd976788452/43142/elastic-geo.png 599w&quot;
        sizes=&quot;(max-width: 599px) 100vw, 599px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://s2.q4cdn.com/265747582/files/doc_presentations/2021/08/Q1-F22-Investor-Presentation.pdf&quot;&gt;FY2022/Q1 の投資家向けプレゼンテーション&lt;/a&gt;の34ページを見ると、西ヨーロッパ、日本、オーストラリアが多そう。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/0053cd2fede4112f56f068e431ea6f23/966a0/elastic-outside-us.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 55.06329113924051%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACVUlEQVQoz1WSO08UURiG9wcYNUFjjIURTUw0lpYmaKOJDYWJ/gGChbGyEAsLW2NBo50NFxGIEC8EiZeIEGFVvIHR3Z1dLuG2C8wuc86emTPnzGNmdl3xK2Ym37zn+c6b90tFUcTOCnTI4nyebOY3OcfBcRwy2Sy5fIFcNsP68hLFpTylRQcwyZl/jIhU/FrwDB0fFeliyMOfgrGFKkFoYyWRtYBNxCWpuTYpufutyq205PLbKrc/q+RfzIzBCbAr43Ok3+NQn8e5Fx4dUx5fNsJkZsx9UtAMzwdceSPZ3SXY2yPZ1S05/VTSOasSnY2Hx8DQRsmEidWQph6P8y8lVycE71aCRDi1Kmh5VmZPt2Bfr+Bwv+TogKCpV3Bnxkdq+5/tlKl/fC0J9vduc+JxkZuTJZZErf/gxyZt4xUuvZYcH6yBDjyKwYLO7xWILFEd2LAclzGatvFtOme24miS3txWyMkhSesryZnnHhdGBS0jguYBycUxiatUHbTjhm6oSXtl3HhSBOl1zY1pRa5i+OUaWl9VOdgnaR4QfCqGFKuGqTXFsONRlKYeSNSwnXJ9xfTaCrlSCSLDhh9xbFAkATmV2lq0jEjOjogk9VpZHLdKd0Yxuqgb0AQovW2WCwXm83nWN91Efv2Don1CNXbz3qxmaF4nSYZ15pxrOTXk0f5+Mxlg6/2U1hq3UsEY0wDcn/PZUDU7NaGu72JsorafgYlYEYbZkofQBmsM1lpS8SOG/r1yXFvK4luL8BXWWKwuo5TE2ghbDfADf4d9KPsBC6sZXLfMH+iZG/N6rjoeAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;elastic-outside-us&quot;
        title=&quot;elastic-outside-us&quot;
        src=&quot;/static/0053cd2fede4112f56f068e431ea6f23/f058b/elastic-outside-us.png&quot;
        srcset=&quot;/static/0053cd2fede4112f56f068e431ea6f23/c26ae/elastic-outside-us.png 158w,
/static/0053cd2fede4112f56f068e431ea6f23/6bdcf/elastic-outside-us.png 315w,
/static/0053cd2fede4112f56f068e431ea6f23/f058b/elastic-outside-us.png 630w,
/static/0053cd2fede4112f56f068e431ea6f23/966a0/elastic-outside-us.png 944w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;売上の製品別の売上は開示されていないが、 License と Subscription の内訳は PL で開示されている。これによると Subscription 売上が全体の8割を超えており、徐々に伸び続けている。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 617px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/2bbba23b30b17a839c1cd498f094db37/bc962/elastic-revenue-breakdown.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 61.39240506329114%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACSUlEQVQoz42SSWsUQRiG55cILiAIMSaaEJkYwaMnb4IHCdGLhzGiEBHNwSV6EbzoIaccVDwJbiEeIy5BESPGkB4Jk8TE2TITe69eqvuRqp7J6M2Ct6v5uurhffv7cmmaolaUSH67NpZlYdkuvlMnckqYloNtWdieh2g08CtlTNvGdjw2mhLHsYnjmPbKqYcQAhEIYimJo0gfiOMQGQsi/d6S+haqeqQVhOpsRJIkOI6jOTnlsO3yf1eYQvhPRTHQHO0wiiKtNlzEIU1hsyUctvRudRR42N4CljmL9OZIZV3DgkAgpcyA7UgKpuwrSS2JTOhIKi+wNVlg9exOVkZ24Lx5kvWgDTRNkzD8K0CatCRbhQDkMoSLIGu6Ur55A6PvIMZAP+b0tK7JVkINdF1XR06UQ9iWcuMvvqV8+RDlqwNsTp7Tlyu3r1Ec7OLH0QOYM891zbWzbudsu9P2NJUk1gKyMYtsfsoOzn3A6O/G6NvP+vkWcGKcYr6L4lAP1uuXWZAkycZG5VbtDuMYKTzWRk9QGs5TOp0nalRwv3zGGOrBONLN+lghizwxjpHvpjjUiznz4l+HGTzR8VLfp3ryOD97dvHrWC+yViWY/8jawB5W+3dTv3hGX67fukLp8F5WBvfhzDzLDLaauj2Haqh9x+XppXs8PDXGo5HrWNVNlr+vMzH8gDvD93l8N4s3NTXPhcIrRgvTvHu/pv+2EEFnDjVQjY5MKLnwtQaGBaFMcSNYasK3qmTD01ao+bBQiVnaBDuERMaIIAP+AUeSZqM9Ia8LAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;elastic-revenue-breakdown&quot;
        title=&quot;elastic-revenue-breakdown&quot;
        src=&quot;/static/2bbba23b30b17a839c1cd498f094db37/bc962/elastic-revenue-breakdown.png&quot;
        srcset=&quot;/static/2bbba23b30b17a839c1cd498f094db37/c26ae/elastic-revenue-breakdown.png 158w,
/static/2bbba23b30b17a839c1cd498f094db37/6bdcf/elastic-revenue-breakdown.png 315w,
/static/2bbba23b30b17a839c1cd498f094db37/bc962/elastic-revenue-breakdown.png 617w&quot;
        sizes=&quot;(max-width: 617px) 100vw, 617px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;ここでいう &lt;code class=&quot;language-text&quot;&gt;Subscription&lt;/code&gt; には顧客による Self-managed、代理店による hosting 及び Elastic Cloud において利用される有償機能の利用権とサポートの料金が計上されている。なお、サポートだけを購入することはできない。代理店による販売に伴う収益に応じてリベートやインセンティブが支払われる場合は、その分がネットされて収益に計上される（Revenue Recognition の箇所を参照）。&lt;/p&gt;
&lt;p&gt;収益認識のタイミングはサービスの提供方法によって異なる。代理店による hosting もしくは Elastic Cloud の場合は契約期間にわたって、もしくは利用ベースで認識される。Self-managed ではサポート及びメンテナンス収益は契約期間にわたって認識されるが、収益認識の要件を満たした部分（おそらく有償機能のライセンス）は契約時点で認識される。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;License&lt;/code&gt; は有償機能の利用権の収益。サポートだけを購入することはできないが、 Self-managed でライセンスだけを購入することはできる。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Professional services&lt;/code&gt; は Elastic 社が提供するソフトウェアに関するコンサルティングやトレーニングの料金が計上されている。&lt;/p&gt;
&lt;p&gt;なお、 Form 10-K の 53 ページによると Elastic Cloud の利用売上の総売上に対する割合は&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;FY2019: 17%&lt;/li&gt;
&lt;li&gt;FY2020: 22%&lt;/li&gt;
&lt;li&gt;FY2021: 27%&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;とのことなので、 Elastic Cloud が成長を牽引していそうだ。&lt;/p&gt;
&lt;h2 id=&quot;財務諸表を読む&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%B2%A1%E5%8B%99%E8%AB%B8%E8%A1%A8%E3%82%92%E8%AA%AD%E3%82%80&quot; aria-label=&quot;財務諸表を読む permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;財務諸表を読む&lt;/h2&gt;
&lt;h3 id=&quot;bs-を読む&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#bs-%E3%82%92%E8%AA%AD%E3%82%80&quot; aria-label=&quot;bs を読む permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;BS を読む&lt;/h3&gt;
&lt;p&gt;Elastic の BS の特徴としては、以下が挙げられる。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;現預金以外の流動資産はほぼ売掛金&lt;/li&gt;
&lt;li&gt;固定資産が薄い（固定資産の6割ほどが他社の買収によって計上された「のれん」）&lt;/li&gt;
&lt;li&gt;流動負債はおよそ7割が前受収益&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/fb3f19be8ce19d2554363f44c0e2d7e5/1f083/elastic-bs.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 55.69620253164557%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAClklEQVQoz0WTz2tUVxTHHwiu/BPsUogLa0EXFjGmRNOCtLrIQkQiorWCXYRgd8X+IEgWFaSIoZRsatC4iBiIgqZB0pgM1TSBtMXUNDEmZuK8eW/ezHsz8+6vNx+5dyK5m3e5557P+55zvtcDqGnDalgiDEtof4ly4JOPApbDPEklQsZL+MUitThBVOpQjskKbxFxhUKk2SiEKClpNBp4FpgKQVKtobXGyJTMfrVBKeX2WtVBZ7wuF+ifH2Vo4SkPVtZ4uJonEQqttGOkaYpnqe+X3ZusQSzrxLJGTWkSpRFau/ij1Vm8n9v5YPBr2sYm6RjPURLCxbJNjlNoldXTujvwaxGH7l3mwHAP56cmOPnHDHNB0AS+nsO7+Tm77lzm2PgkJ57kCNPUKnEKbUWeEAJjDFkjc0nr1RLbB7rwfj3NwbFx9jyeYcoPXez31Vl29B9lz91uWifmaJ+cJxTSAbOsme9FUUS1WkUI+ycIE5+vhto5d7uN7tF+uoYH+HvjlbtcWn/E/LDH7EgLt/ovMPjLJapJyfJc/5zCMAwRrg8NsgZkaR7Gt8Fjj9+u9/LtNzd4tbjkgGrjIYx45O/vpue7MXq+nyBO0mbue4W2f5YspcAeyZLPypf7WTy7j66ry7RcgT9fNhtf/muKlWM7mb54itY+w+GfIIiNHQlCSjcLNxRL10rZipFBwP9HD7PwSSvnf3jB3ispz/9rDqycy7H00S6mO8/waW/EZ30JpcQ4hcpazZgt21hjSmOoFd6y2NnBv8ePcLH3Hz7+scazF7G7E+SmWWz7kMmuc3zRV+TEtQp+lGKUQCq1ZRvnP2Mwm0pVGBCvv2EtH+JXDKnUzgU6TZHFAuHaG9aLVVeu0qaZa4x7Ke8Ar4cBDLYau9sAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;elastic-bs&quot;
        title=&quot;elastic-bs&quot;
        src=&quot;/static/fb3f19be8ce19d2554363f44c0e2d7e5/f058b/elastic-bs.png&quot;
        srcset=&quot;/static/fb3f19be8ce19d2554363f44c0e2d7e5/c26ae/elastic-bs.png 158w,
/static/fb3f19be8ce19d2554363f44c0e2d7e5/6bdcf/elastic-bs.png 315w,
/static/fb3f19be8ce19d2554363f44c0e2d7e5/f058b/elastic-bs.png 630w,
/static/fb3f19be8ce19d2554363f44c0e2d7e5/1f083/elastic-bs.png 660w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;それぞれ FY2021 の詳細な内訳を見てみることにする。&lt;/p&gt;
&lt;h4 id=&quot;流動資産&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%B5%81%E5%8B%95%E8%B3%87%E7%94%A3&quot; aria-label=&quot;流動資産 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;流動資産&lt;/h4&gt;
&lt;p&gt;現金以外の流動資産はほぼ売掛金で、 FY2021 の期末残高は $160M となっている。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 599px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/3670815e3b512d5a1fc7083e287feab8/43142/ca-break.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 61.39240506329114%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACUUlEQVQoz2WTzUtUURjGL/0LQX9Ai0SSQlPT0TTHmVrVNohWuWkRuahFkKnlzB2lcJHQwk1gZCQWOVQLhUpEkWxVoUIFA5KK48zc8Zz5uJ+/uHdmrqO+8HIOh8OP93nOc5RcLkcqlULTNHRdx3EcLMvABoziHvbmW5Z+vObFUoHvfy0s28Gtyured7tSSjqdJpFIsL29jbvXiwUKOojENJnZkxBXGJtooKY/Q8egpGc8x68N6wjUB5qmSbFYxLIsLFP3JrN2J5Fxhex7BT4pvJtqpknVuKzmaBnYI6RKH2r70DKwQnYc21vNXY3kaC1iRkHMHcP5oPB56gznohqhiCQcE7QMCG6O5w7JPgSsnGjxadYa6kjcqGdn7DjWrMLKTA1t0TTdkRzBqPAmDAwKlv+YB6R7QCklyWSSTCqFMEy2RlXWA6dZD15grbMdrecEq89rCY/scHEo7wHDqqSxTzC5qPvAio+K658QAt31Edh6EmG9tY6N0FkSwXo+Xr3Fnbtf6IpJghHhA5v6BC8XDgLd3pdslzzMvJngd/Mp4td7uX1vns7hAoFh24cFo9KTfL5fML9Wfph9xSgVslMGFjY36b2/QEA1aRspgbojWbqikq5Iyb/2R4JrzyTpvQJZLU0mo3mxy+fzpQk9YFUEJlag8UGW4FCWsFqCuB2OSToeC1oHBF9XXbkWRd3AjZ77QQzDKEt2DS0/fclcm6llnUsxSfND4fnltru/8lQy99M8kL3qqsrh0a/0L23zalFHnSkwHC8y/c0gJWw/0L5dVf0fX9gzFqVTltkAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;ca-break&quot;
        title=&quot;ca-break&quot;
        src=&quot;/static/3670815e3b512d5a1fc7083e287feab8/43142/ca-break.png&quot;
        srcset=&quot;/static/3670815e3b512d5a1fc7083e287feab8/c26ae/ca-break.png 158w,
/static/3670815e3b512d5a1fc7083e287feab8/6bdcf/ca-break.png 315w,
/static/3670815e3b512d5a1fc7083e287feab8/43142/ca-break.png 599w&quot;
        sizes=&quot;(max-width: 599px) 100vw, 599px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;FY2021 の通期売上が $608M なので、およそ 1/4 が売掛金として計上されていることになる。基本的には前払いが多いと思われるが、ライセンスは提供された時点で収益認識するようなのでその分と Elastic Cloud の使用ベースでの支払いがここに含まれていそうだ。&lt;/p&gt;
&lt;h4 id=&quot;固定資産&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%9B%BA%E5%AE%9A%E8%B3%87%E7%94%A3&quot; aria-label=&quot;固定資産 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;固定資産&lt;/h4&gt;
&lt;p&gt;固定資産は半分以上が「のれん」で、 FY2021 の期末残高は $199M となっている。これは大部分が2019年6月に Endgame というエンドポイントセキュリティ製品を開発する企業を $234M で買収した際に計上されたもの（&lt;a href=&quot;https://www.elastic.co/jp/blog/endgame-joins-forces-with-elastic&quot;&gt;Elastic CEO による買収のアナウンス&lt;/a&gt;）。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 597px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/ccc6fcbdecdedc212b7336911f1e812d/17602/fa-break.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 62.0253164556962%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACcUlEQVQoz2WTTUgUYRzGB7p07ybRqZMEWvhtiq66Jdih0xZdLKMgCukQhLir5bZmHpI8JJVmoUViRaQV1CWLQgMhyK90M9yV1N0ld2dnd3a+fjGzH7r5wsv7DsP8eJ7n/4wgiiKhUAjzNAwDTdPQNAVrRTdYmvYy9fAPTz/JTHk1dN2wXmmp0/zG3OklBINBfD4fgUCAzc1NYvE4JAz65j7T1VvK++bTdBXOUtHyl9J2kaZ7EjN+bQc0C+j3+y1gIBQEA57PvUO46yCn7wgTrnLuHJ+mvi1Czc0oJS6Rus4osymonoGmgKqqkkgkUJUEqg7EfrM8vocLQ4cQBpo433OYkZMjVDsVqj0R7J1J6Nn7MXRjp20hHA5bCkPBDaIySAvdyC8EeCMwMLqf3IFaOpp7qHcqVHki2NwitZ4o5e0i37xqxnoaKui6jrktr4D83YE4JhB+uwvGBaZf76b1diNHXXGqPKIFNC0XtIo8+5rIytJSmJGsJzMJDV5k5UwOK+dyWWzMI+zYx/Clq5R1atS4I9hubAGffEm2QdWS7TCFCRm0pRICD/qZyz/Agq0Sb0UBk/ZjNLjWqfTEsaWApuXStggfZ2ImDikWZ3V1FUmSEMyqrK2tEQxsEJFlpKV5FuzF/KwrxleTx5XLY5R0Qa07TLU7mszvmsiJXolYIhmVbmxTqCiKNWXTtq4mQw487mc5fy/Dp1qovKVj90QskGm14rpIWbvIxHx6IGQtIevJzDJ1XR8axOFc5GBbgqLWMIVOkSKnSEN3lA8/1EwH09PNTHmrQ9tan+rUryA8mpDpeCnjeRVndFIhKOpZsP//lH+fayv2AopB8AAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;fa-break&quot;
        title=&quot;fa-break&quot;
        src=&quot;/static/ccc6fcbdecdedc212b7336911f1e812d/17602/fa-break.png&quot;
        srcset=&quot;/static/ccc6fcbdecdedc212b7336911f1e812d/c26ae/fa-break.png 158w,
/static/ccc6fcbdecdedc212b7336911f1e812d/6bdcf/fa-break.png 315w,
/static/ccc6fcbdecdedc212b7336911f1e812d/17602/fa-break.png 597w&quot;
        sizes=&quot;(max-width: 597px) 100vw, 597px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;また Deferred contract revenue は契約獲得に要した費用を契約期間にわたって繰延ている。FY2020 では $24M だったのが $50M と倍増しているので、長期の契約をたくさん獲得したのかもしれない。&lt;/p&gt;
&lt;p&gt;Elastic Cloud は AWS, GCP, Azure の上に構築されており、 Elastic 社自身ではデータセンターを持っていないようだ。BS にもそれらしいものは載っていない。&lt;/p&gt;
&lt;h4 id=&quot;流動負債&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%B5%81%E5%8B%95%E8%B2%A0%E5%82%B5&quot; aria-label=&quot;流動負債 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;流動負債&lt;/h4&gt;
&lt;p&gt;流動負債はほぼ Deferred Revenue で、これは Elastic が収益認識前に顧客から支払いを受けたいわゆる前受収益を意味する。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 598px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/dcd14a3a18269552b66608f9b96162e3/0c69d/cl-break.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 61.39240506329114%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACOklEQVQoz32TXUsUURjHFz9A90GfQax8xbRVV7MXKoNug/ALdBFFZeqmu4MGYRCBF930QkUQuYWlRIKl4V0vVBYVJRobu+vuzjk7sztvvzjjzqolHXiYw5nhd/7///NMSEpJOp0mm82i6zqO4+DYNi5ASef78jPmZu8wMZtj/quH43rqTeXpeZ5fwQop0MrKig9dXV2laBoUXUgvJCg+3cHcwyrORsMcOfeDuqhJ77jk3ZLzD7QCVAozmQy5XI58Nov6ND8zzefmGjIj20i9CKGNddMT/UWbZtI0oNMek7z9+Te0DDRN04dJKTAtGyv1m289HSy21LJ4sIXC/Squ32jlQH+SvXGDLk3QNCA4OV7YWmFlVz5MPpnkQ1M1S107WWqsJntiO5O3auiOJgnHDNqHBZG49KGvv9ibVPrAINTgcCyhc/j0J86fSnCt9wpTR3uZPnOMzpEkbUMG7TFBpyap7RPcflWqAAOVoUCyWwZqjy12DZZoHoWGEQjHC+wfTNER02kblmvAuKSuT3Dz5X+AgcK78yXq+/Lsi+eJDOV8gMougKmGKMsN/YKZj2uWbcerjE8lQ7d8w3LGpUuThIcFHXHpZ+ZXTPhQBdsTlRy/WkAW17Pb1JRA7kaVuy8IH6rsRcqlsmu9JGjs13n+Xtn1ENJACIEaP8uyAuD6xAfwe/MlH1B/Ufh5qVL7Q5clU29MZRTLtn2Q+sNSqRSGYaxbDkAbocq+6mTskYk2UeTBgkVad8sRseX6AymnM3qSvDIcAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;cl-break&quot;
        title=&quot;cl-break&quot;
        src=&quot;/static/dcd14a3a18269552b66608f9b96162e3/0c69d/cl-break.png&quot;
        srcset=&quot;/static/dcd14a3a18269552b66608f9b96162e3/c26ae/cl-break.png 158w,
/static/dcd14a3a18269552b66608f9b96162e3/6bdcf/cl-break.png 315w,
/static/dcd14a3a18269552b66608f9b96162e3/0c69d/cl-break.png 598w&quot;
        sizes=&quot;(max-width: 598px) 100vw, 598px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Deferred Revenue は FY2020 で $260M、 FY2021 で $398M あり、それぞれ負債総額の 67%、76% を占めている。また、そのほぼ全てが流動負債として計上されている。&lt;/p&gt;
&lt;p&gt;Elastic Cloud は契約期間が 1~3 年で、毎年前払いで請求される（いちおう月単位で購入することもできる）ので、その前払い分が計上されていると考えられる。&lt;/p&gt;
&lt;p&gt;Form 10-K の 99 ページで増減内訳が開示されているが、これを見るに毎年売上の半分以上に相当する Deferred revenue の増加があるようだ（FY2021 の売上は $608M で Deferred revenue の増加額が $364M のため）。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/d75ba641da17f8b3ab06b26e4672ca1e/264eb/elastic-deferred-revenue.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 27.21518987341772%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAABEUlEQVQY042OXU+CYACF+f//pbUu22zlaoVhhiICvsqHIEoIykegYjwtuuqusz17zsW5OBL/SNu2HT9pmoY8z6nrmiAIEEKQZRlFUVBVFZIIIgwvxI0zNuWZdVYTZDVhfuz67tiSnPn1CaLy3O0nC4/lNmGgmcyDCBHGqJaNpFgut7JKT9HoqybDhY8ifIbC53W+QnU2ONmJoAb/syWowCu/WKQ16yO4eYNXXPCrFpFUSPe6w/XzmKvHETeyRk/3Ou50D9ndIXsp0/2FWQ561nY2ChjHx87a/sIkbTBLMAuQBsaSh3cDRayw4gIzyjG2B6yPgmVa4+XNn3f24cTI2fBi2My2B56mgjc7ZLpO6KsG3zwRcvIiu31OAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;elastic-deferred-revenue&quot;
        title=&quot;elastic-deferred-revenue&quot;
        src=&quot;/static/d75ba641da17f8b3ab06b26e4672ca1e/f058b/elastic-deferred-revenue.png&quot;
        srcset=&quot;/static/d75ba641da17f8b3ab06b26e4672ca1e/c26ae/elastic-deferred-revenue.png 158w,
/static/d75ba641da17f8b3ab06b26e4672ca1e/6bdcf/elastic-deferred-revenue.png 315w,
/static/d75ba641da17f8b3ab06b26e4672ca1e/f058b/elastic-deferred-revenue.png 630w,
/static/d75ba641da17f8b3ab06b26e4672ca1e/264eb/elastic-deferred-revenue.png 867w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;つまり、単純に計算すると売上の半分以上に相当する顧客が2年分を契約して前払いしているということになる。&lt;/p&gt;
&lt;h3 id=&quot;pl-を読む&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#pl-%E3%82%92%E8%AA%AD%E3%82%80&quot; aria-label=&quot;pl を読む permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;PL を読む&lt;/h3&gt;
&lt;p&gt;Elastic は上場以来ずっと赤字決算企業だが、売上は伸び続けている。FY2020 は前年比+57%、 FY2021 は+42%成長している。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/5705a1dc13fb68c703fde6ca48cb4f1e/6db71/elastic-pl.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 56.32911392405063%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB2ElEQVQoz2VSTWsUQRCd/+B/8Z94FPQayCk3D15EMCcRVlAPkngRJEbZICFqIqIRPAiSIGRBCDJhE3d3dmG+uruqu59UdWY3iwM1/bq6+vWrjwwAYoxqCeuCSRUwLQ3o/AzFpEBTjWDLPxiNCxjTQsJCF3zly+RHRHDOIYQA772aIzEGO6tnRA5MHWYAXo0v48XkfrZQFtXxny35EwYCfuWMwZAVe5/OhUMVWmvnCpkXL3YWg7yeMLFXkvUdg957o1iymSvsiDqFEqCvCrlP+Nm+xeGA0mUWX8SDvkFvzyomvqJwOp2iqmowkar7euKQjwkIBOtI67TyvMGrb6KGYGzyrfdb9PZa9UkcMyeFRSFdM+hafPtpi4+DtHWsTqxutHj9Iyz57r81ePRBN6CwmJRMOixFlZWcw92tGl8+nQIX39GWp6rm3psa7w6GwOwErsnV92S/xUb/HBgdw1W/Ya3TOmbd/IhkIWwCMHm5hYsXN1Dmm/AMSGLDh4+Rr11DeXQT0hfJabS9i7M71zH7eQvMcUEoZF0Nonaadb50LjmlVR8dY3a4CTP5jBAlRQ+uKphxDtf8RbgcnSXC1OmIuq61rl3nY4hoiGBSGXWE5Ky1Fm0q6rzL/wA5/UjGitjrOQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;elastic-pl&quot;
        title=&quot;elastic-pl&quot;
        src=&quot;/static/5705a1dc13fb68c703fde6ca48cb4f1e/f058b/elastic-pl.png&quot;
        srcset=&quot;/static/5705a1dc13fb68c703fde6ca48cb4f1e/c26ae/elastic-pl.png 158w,
/static/5705a1dc13fb68c703fde6ca48cb4f1e/6bdcf/elastic-pl.png 315w,
/static/5705a1dc13fb68c703fde6ca48cb4f1e/f058b/elastic-pl.png 630w,
/static/5705a1dc13fb68c703fde6ca48cb4f1e/6db71/elastic-pl.png 659w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;何にお金を使っているか、 PL の費用内訳をグラフにしてみる。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/fb9270425c895dd5c4e8d27eafba112b/612f7/elastic-operating-loss.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 45.56962025316456%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABkElEQVQoz42Sv24UMRCH7y14A6QU1DwBBV0K6KnpERWRKEJLCw0UoEiIKESipQDpQhS47rgoEIIQQXt3EN/+8W7WXo/9IXuTQBGhjDSesTTzefyzB3Vdo5SiLEvms4z5bEpRlkQL0b3vPYQL+SAuIoJIoG4DbRcIncVVJd4YQuDCsAT0Ps7h+DIVbj7UPBqCGb7h6/I1itcb/aSxOEYRvLj/A23nAGFy6Lhyt+L+KwtaoUc7iK5QL9c4uHGd+uM2p3YmxXlApRYQLLs/HVdXNA8229TkT5r18C3T1XuY79/QO+9RL57h8jxBvXN47888ARd5kc78dCgs3alYWW/TXpykKf61H7dvMbl8CXOwz3mWgM5FTTy5tmx/btnPDOI6rO3oug5rDPb4mM579NY78vU12t+/mD1/wvzpY2ql+DAaMR6PiaxBJMfGXhmfYhw/vvzpVVIu0msXq0Kg2dul2Zsg1pIXBVVV/f027kSLsqqJj2StTQXGGLTWZFmW8kZryjxP+aJpONJ1r3c8LP4v4A91hqrv5zn0wAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;elastic-operating-loss&quot;
        title=&quot;elastic-operating-loss&quot;
        src=&quot;/static/fb9270425c895dd5c4e8d27eafba112b/f058b/elastic-operating-loss.png&quot;
        srcset=&quot;/static/fb9270425c895dd5c4e8d27eafba112b/c26ae/elastic-operating-loss.png 158w,
/static/fb9270425c895dd5c4e8d27eafba112b/6bdcf/elastic-operating-loss.png 315w,
/static/fb9270425c895dd5c4e8d27eafba112b/f058b/elastic-operating-loss.png 630w,
/static/fb9270425c895dd5c4e8d27eafba112b/612f7/elastic-operating-loss.png 773w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;それぞれの定義は Form 10-K の 55~56 ページに記載されている。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Cost of revenue&lt;/code&gt; は Subscription 及び Professional services の提供に関わるカスタマーサポート及びサービス担当者の人件費（給与、福利厚生、株式報酬など）やクラウドインフラ費用が含まれている。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Research and development&lt;/code&gt; には新製品や既存製品の開発者の人件費が含まれている。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Sales and marketing&lt;/code&gt; には、販売や広報活動を行う人員の人件費や顧客契約の獲得に関連して営業担当者に支払う販売手数料、マーケティングプログラムに関する費用、広告宣伝費が含まれている。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;General and administrative&lt;/code&gt; には経営陣、財務、法務、人事、そのほか管理部門の従業員の人件費や会計、税務、弁護士など専門家への報酬が含まれている。&lt;/p&gt;
&lt;p&gt;過去の決算を見ても費用の割合は大きく変わっていないので、 Elastic 社は営業活動や社債等で調達した資金を使って Sales and Marketing に投資するという王道の方法でこれからもビジネスを拡大していけそうだ。&lt;/p&gt;
&lt;h3 id=&quot;cf-を読む&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#cf-%E3%82%92%E8%AA%AD%E3%82%80&quot; aria-label=&quot;cf を読む permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;CF を読む&lt;/h3&gt;
&lt;p&gt;Elastic 社は継続的な赤字決算企業だが、実はキャッシュフロー計算書を読むと現預金は増え続けている。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/938c12d92d05ba3c700f5f14996900b0/a1253/elastic-cf.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 56.32911392405063%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB4ElEQVQoz22TP4sTQRjG81nsbP0Utn6Cq2y1s7W4xsLCwkOtxML+BCsRkVNBODEih3CihxJjEi67t8lmZmfmnZmfzLtJNODCy86+fx6e531mBwApRjLgJ2Oq84rkaqT5ybK1nF2MqZoFqf6FqaZU9QVNs6Q1ntlshrW2QJBz1hiUD+89IQRi8OSYmLZzjmen2tgFRxDRmoS+T0QQidtzSokYo74VsG8QJEUFOZr/YO/eVfj4jKQK+qH/RozEdX3LcAsYRQHfNBNu7F+Gl3cJBVC8Mij1FHs228jouspZAZ1zKnkH8OI3N+9cgaMDBYzeQUpa20hTRiXhDHbyjZTpJdd1Tdd12ugl6NCresT125eUoaN/xp3l8Pt7pVN2mjtLFRO3nuzRPLjWs5TAYD6fK0MfPNZY4smQ0+knnj7fJ5+8wBTTjt/ydfiQR58PCxo2BJbDD1SzEQev77N69xgnGQmBgbqrMrIuOJzPcLY3J6/ZudEZ1F/WkoWce/llZtOXNjssiQJaYrOXLkSqpWdlhdaK7rGLYJwQU6TzkVUnLEx5B1IMu9dmA6hOFnP0LDgfsU5oTeC8cVSLwMKIgpW87co9/Du3cw83tpdo25biPv8It2ZFZ806tc5ZgzFm50/5A/bMSzWYue9EAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;elastic-cf&quot;
        title=&quot;elastic-cf&quot;
        src=&quot;/static/938c12d92d05ba3c700f5f14996900b0/f058b/elastic-cf.png&quot;
        srcset=&quot;/static/938c12d92d05ba3c700f5f14996900b0/c26ae/elastic-cf.png 158w,
/static/938c12d92d05ba3c700f5f14996900b0/6bdcf/elastic-cf.png 315w,
/static/938c12d92d05ba3c700f5f14996900b0/f058b/elastic-cf.png 630w,
/static/938c12d92d05ba3c700f5f14996900b0/a1253/elastic-cf.png 657w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;原因としては、 BS の箇所で取り上げた Deferred Revenue の増加がある。前期末から当期末にかけて増加した Deferred Revenue と同じだけ現預金も増えており、それが営業キャッシュフローを押し上げている。四半期ごとの Deferred Revenue の増加は &lt;a href=&quot;https://s2.q4cdn.com/265747582/files/doc_presentations/2021/08/Q1-F22-Investor-Presentation.pdf&quot;&gt;FY2022/Q1 の投資家向けプレゼンテーション&lt;/a&gt;の 48 ページを見ると分かりやすい。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 454px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/ccf0248616c077883cf91cdf5cedfcea/b3c1d/deferred-revenue-growth.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 86.0759493670886%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAADOUlEQVQ4y52U7W9TdRTH+/cYg1ES8AF5ZZAIgrKNF2oIEQ1shjh9QYgg0cxMjbzAwTb2QGSLbi5pxx7wiS7VdivZ2NbuidG1tbfrw13LutvbW9rdh7Yfc+/iWIaK+ktOTs4v935yzvl9z7HxmFOpVP42luUswcA8a5IElKhUytgUJUcqlSKbzXI/nSaZTFqxaYqibEL+NPMUCnnUgsS9kMjpC4PM3Y1gH3ARi6ewhUNBbjmdeL1jzC8ssByNIkSjRCIRMpnMNuBGZoFgjB6HG+9UlKf2tzDuT7CnuhPv1DI2TVWRZRkpm8UolR4puVwub4IEQUBMRBh2LrLz1XY8EwJ7qjsY98XYdegqo5NRbH8FMI0tvQouBZAyIl32aU6edXDLE2JvTSfucYHnj7Qz7o/z7GttjE0uY9van60N1zSdSDiAWpTp6Jmg6Zsxrtv9HHrnO5yjYV6o6ngI9MXZffgqY2aG24GlUolcTkZVi9x0+rkXTHLuqxGOfeCgd2iOqlM9/wzcKPNhyYZh4PPPkVeyvFnfT2Ozhy9bPbx7doCewVmOnHwMUMnJiAkBaW2V38MB8nmFN97vx/HTIrXnBmlsdvNFi4cTZ278O2B6VaGzd4KEKNE3NEU0vsb+Y11ct/uoOz9E45X/CFxYSvPES5eZnE2y+3A7P/4apKa2ly6Hn9r/A1wM3ee519uYnk+y92gnv7hD1NR9T7fDz3sfD/N5s3uzh+ajVJ/qtYAvmrIxdVjVYcnGZFiyMTN8ct9l7swmeOZAKz+4ljj49rdc65vmxJkBPrnkoqHpN96qt9PdP8Mrx7v52R1i58FWXLcjPH2ghdvTMXa8fAX3RBRbNCFx+sIQwcgqHzbcZHI2TsPXI4yMhrjY5qbb4aNveIZL17y4vGE+a3JxZyZG3flBZhZFaj+6wd1givpPh5kPrGDTdQ1NLWB6df0BhqFTLOTRddXyZqyuF6hUSqjrRUqGZnlNK5pTznrR/FZH18w7FVulXCEWi1mXoiiiqhrpdJoHhSKSJCHLuY1NtJqhWCwgrqygaRqJpGhpNh5PYBglazvpuvHopGwfQ/Nnc6UJQoRUKm1N0vaVttX+AAq6dTo1veF8AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;deferred-revenue-growth&quot;
        title=&quot;deferred-revenue-growth&quot;
        src=&quot;/static/ccf0248616c077883cf91cdf5cedfcea/b3c1d/deferred-revenue-growth.png&quot;
        srcset=&quot;/static/ccf0248616c077883cf91cdf5cedfcea/c26ae/deferred-revenue-growth.png 158w,
/static/ccf0248616c077883cf91cdf5cedfcea/6bdcf/deferred-revenue-growth.png 315w,
/static/ccf0248616c077883cf91cdf5cedfcea/b3c1d/deferred-revenue-growth.png 454w&quot;
        sizes=&quot;(max-width: 454px) 100vw, 454px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;営業キャッシュフローを押し上げている要因は他にも株式報酬 Stock-based compensation がある。Elastic 社は役員や従業員に RSA/RSU を配っているが、この費用は実際に現金支出を伴わないので、PL 上は損失として計上されているが営業キャッシュフローへの影響は±ゼロとなる。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 623px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/d91769fdbc6ccf7a48a5a2963afeb160/6114d/stock-based-comps.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 41.139240506329116%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABqUlEQVQoz3WO2Y7aQBBF/f9fFJREE41mMplhEYwB463dxm0DXtjcNgQwJ7LJQ15S0tGt5VapjDzPUUoRSIkQAVJKfCEoioK6rqmqCq01WlddXZYl1T/9Vluu1yttGNttQRLHhFLiuW6ntr3AsW22RcFhv2e33bLf7TgeD51WWpPnGXn2oPXdm+Zx8HJruN6hLVvuf2n+w77UJJuUTV5gzi0sx+3yZbziqCuMsYjpuxFDXzH0Y16mLi+my8BTTFXGOEgYBys+lynycMEtan5aAZ9RxizZ8ToXOJlmIFZMA4XxY2jy7eOT3tuIp9GMvrPEzkrcvELVd+KaB6eHrn/DL0tgrfdE+sbzZEFyAjPKGTsBhikTRr6ib0vab+X+RHaDzYXOqPStW1weL6iqISqvvFs+9nqH2Na8zbxuNgk3WGGMMXAjeh8m30dzvrxP6PVNvg5nPE0cnqc+/WDNIEx591cs8hpxuPAyDxgvM6y05NWSeLtz57OiFCPJCpwgxJURXqiwhcQRYdeL1innBk4NnO+gLw0qLZg6Hv4yJohXmLaH2uQsRIhUCX8AejNPmCZkZA8AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;stock-based-comps&quot;
        title=&quot;stock-based-comps&quot;
        src=&quot;/static/d91769fdbc6ccf7a48a5a2963afeb160/6114d/stock-based-comps.png&quot;
        srcset=&quot;/static/d91769fdbc6ccf7a48a5a2963afeb160/c26ae/stock-based-comps.png 158w,
/static/d91769fdbc6ccf7a48a5a2963afeb160/6bdcf/stock-based-comps.png 315w,
/static/d91769fdbc6ccf7a48a5a2963afeb160/6114d/stock-based-comps.png 623w&quot;
        sizes=&quot;(max-width: 623px) 100vw, 623px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;投資キャッシュフローが FY2019 に大きく増加しているのは IPO で $270M を調達したため。Elastic は FY2020 に Endgame を $234M（acquisition price）で買収しているが、この時は現金支出は $27M しかなく、ほとんどが Elastic 社が新規発行した普通株式で支払われている。内訳は Form 10-K の 93 ページに記載されている。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 497px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/88bcb19ef28e14873c94fdb6a2fad7b0/15d25/endgame-acquisition.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 25.316455696202528%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA/klEQVQY03WKy26CUBRF+f+/6bAdmKbpoIbGRkWUp1C4Fy4gRQUsWl0NaBonPcnK3nvlaIe24dDURGGAtTRZLYwhPcfGNOaszAWB7+Ha1rB777v2kL1XUiDjiLLI6U+L0hwrFNhRwmde4YqMdbphrTY4scIRGUFWDs6T+ZCBKnGEwk8KvroLRdORVjX5/oBmi4zRx5J3T2IVLbID8X2l7/J412+Im+971IJfdbwuPCa+RDPWgocXncfxlCd9ztsqQHdjxlaImW4JWwjqy7+EDbjbE88zh9HERKt2e6TKSFROJBLKascPcDxfOJ3h9Jfc7Sv9zxmIZcJkOsNyPX4Bg3pz2EgKUGkAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;endgame-acquisition&quot;
        title=&quot;endgame-acquisition&quot;
        src=&quot;/static/88bcb19ef28e14873c94fdb6a2fad7b0/15d25/endgame-acquisition.png&quot;
        srcset=&quot;/static/88bcb19ef28e14873c94fdb6a2fad7b0/c26ae/endgame-acquisition.png 158w,
/static/88bcb19ef28e14873c94fdb6a2fad7b0/6bdcf/endgame-acquisition.png 315w,
/static/88bcb19ef28e14873c94fdb6a2fad7b0/15d25/endgame-acquisition.png 497w&quot;
        sizes=&quot;(max-width: 497px) 100vw, 497px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 id=&quot;その後&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%81%9D%E3%81%AE%E5%BE%8C&quot; aria-label=&quot;その後 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;その後&lt;/h2&gt;
&lt;p&gt;Elastic は2021年6月に &lt;a href=&quot;https://ir.elastic.co/news-events/press-releases/press-releases-details/2021/Elastic-Announces-Proposed-Private-Offering-of-500-Million-of-Senior-Unsecured-Notes/default.aspx&quot;&gt;$500M の社債を private で募集&lt;/a&gt;した（その後、 &lt;a href=&quot;https://ir.elastic.co/news-events/press-releases/press-releases-details/2021/Elastic-Announces-Upsizing-and-Pricing-of-575-Million-of-Senior-Unsecured-Notes-Due-2029/default.aspx&quot;&gt;$575M に増額&lt;/a&gt;した）。その後、相次いで3社を買収している。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.elastic.co/jp/blog/elastic-and-cmd-join-forces-to-help-you-take-command-of-your-cloud-workloads&quot;&gt;Cmd&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.elastic.co/jp/blog/elastic-and-build-security-shifting-left-together-to-secure-the-cloud&quot;&gt;build.security&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.elastic.co/jp/blog/elastic-and-optimyze-join-forces-to-deliver-always-on-continuous-profiling-of-infrastructure-applications-and-services&quot;&gt;Optimyze&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;いずれも Elastic Security 及び Observability の機能を拡充するための買収で、これからもそういった方向の買収の動きが増えてくるかもしれない。&lt;/p&gt;
&lt;div class=&quot;footnotes&quot;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&quot;fn-1&quot;&gt;&lt;a href=&quot;https://www.mongodb.com/licensing/server-side-public-license/faq&quot;&gt;Why are we changing the license for MongoDB&lt;/a&gt;&lt;a href=&quot;#fnref-1&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;li id=&quot;fn-2&quot;&gt;オランダはヨーロッパで最初に patent box 税制を導入した国だが、すぐにベルギーとかスイスとか UK でも同じようなことができるようになったのでオランダだけが租税回避に使われていたわけではない。しかし、Apple が開発した &lt;a href=&quot;https://www.cao.go.jp/zei-cho/content/20131023_25dis11kai3.pdf&quot;&gt;Double Irish with a Dutch Sandwich&lt;/a&gt; という租税回避スキームが多国籍企業でよく使われていた。&lt;a href=&quot;#fnref-2&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content:encoded></item><item><title><![CDATA[HashiCorp が上場するので Form S-1 を読んだ話]]></title><description><![CDATA[HashiCorp が NYSE に上場するので、その Form S-1 を読んだ話を書く。 https://www.reuters.com/technology/software-company-hashicorp-files-us-ipo-2021-11-04/ 2020年…]]></description><link>https://lyohe.github.io/2021-11-06-hashicorp-ipo/</link><guid isPermaLink="false">https://lyohe.github.io/2021-11-06-hashicorp-ipo/</guid><pubDate>Sat, 06 Nov 2021 00:18:38 GMT</pubDate><content:encoded>&lt;p&gt;HashiCorp が NYSE に上場するので、その &lt;a href=&quot;https://www.sec.gov/Archives/edgar/data/1720671/000119312521319849/d205906ds1.htm&quot;&gt;Form S-1&lt;/a&gt; を読んだ話を書く。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.reuters.com/technology/software-company-hashicorp-files-us-ipo-2021-11-04/&quot;&gt;https://www.reuters.com/technology/software-company-hashicorp-files-us-ipo-2021-11-04/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;2020年3月に行われた直近の資金調達である Series E では $5.1B の評価額で $175M を調達しており、上場時の時価総額は $10B （約1.1兆円）に達すると見込まれている。&lt;/p&gt;
&lt;h2 id=&quot;hashicorp-について&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#hashicorp-%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6&quot; aria-label=&quot;hashicorp について permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;HashiCorp について&lt;/h2&gt;
&lt;p&gt;HashiCorp はソフトウェアのインフラ構成を自動化するためのツールを開発しているサンフランシスコの企業で、2012年に Mitchell Hashimoto 氏によって創業された。当初は氏が大学時代に自分の課題を解決するためのソフトウェアとして作った &lt;a href=&quot;https://github.com/hashicorp/vagrant&quot;&gt;Vagrant&lt;/a&gt; を事業化するための会社だった。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.hashicorp.com/blog/announcing-hashicorp&quot;&gt;https://www.hashicorp.com/blog/announcing-hashicorp&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ちなみに創業者である Hashimoto 氏はたまに日本に来ているらしい。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.publickey1.jp/blog/17/hashicorp_interview01.html&quot;&gt;https://www.publickey1.jp/blog/17/hashicorp_interview01.html&lt;/a&gt;
&lt;a href=&quot;https://www.publickey1.jp/blog/17/hashicorp_interview02.html&quot;&gt;https://www.publickey1.jp/blog/17/hashicorp_interview02.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;なお、 Hashimoto 氏は創業から2016年まで CEO、それから今年の7月まで CTO を務め、現在は役員を退任して同社で従業員として働いているそうだ。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.hashicorp.com/blog/mitchell-s-new-role-at-hashicorp&quot;&gt;https://www.hashicorp.com/blog/mitchell-s-new-role-at-hashicorp&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;hashicorp-の事業&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#hashicorp-%E3%81%AE%E4%BA%8B%E6%A5%AD&quot; aria-label=&quot;hashicorp の事業 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;HashiCorp の事業&lt;/h2&gt;
&lt;p&gt;HashiCorp の製品は全て OSS として MPL-2.0 ライセンスで公開されている。&lt;sup id=&quot;fnref-1&quot;&gt;&lt;a href=&quot;#fn-1&quot; class=&quot;footnote-ref&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/09c822a946f12c5ed421ca0e1efac66c/715a3/hashicorp-oss.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 46.835443037974684%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABMklEQVQoz2VSi26DMAzk//9x2qhEpZKGNO+EPG6yIRVbkcxZzvlyNkwA0HsnQAwB61PCeQcqtd4ZnffYpISxBt5ZHE9DcA5SKbTWUJnbMfUzoWfxFX6vuIkMmxrslpBzQ3lqlJBQ1hXYM263b7SS8BU3+JIxx4TQGtCBiR2ed96VQUoJq7RQ2sK8LLbtBScV140Q0C+NVQiUUvGzrUg54U7ujWENdlhrZdu9Vc4JWz1yikIjnVhOLvPLcd5KOfpo5JwzpJTQWsNax0TvPRNCiCcGRu/cgd6/eYTOOYzVTVRQSnHwrecBBY1JNcLhgCLGyPWB157JWot5nrEsy7tpkPZ955zwKkhTjYs+BGmRtNDH48FN199oNJDAELzWB/ePIL1oB0KID4dDaOD4GMPh/yDBX7GRwMsDjvGkAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;hashicorp-oss&quot;
        title=&quot;hashicorp-oss&quot;
        src=&quot;/static/09c822a946f12c5ed421ca0e1efac66c/f058b/hashicorp-oss.png&quot;
        srcset=&quot;/static/09c822a946f12c5ed421ca0e1efac66c/c26ae/hashicorp-oss.png 158w,
/static/09c822a946f12c5ed421ca0e1efac66c/6bdcf/hashicorp-oss.png 315w,
/static/09c822a946f12c5ed421ca0e1efac66c/f058b/hashicorp-oss.png 630w,
/static/09c822a946f12c5ed421ca0e1efac66c/715a3/hashicorp-oss.png 830w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;HashiCorp 社では &lt;a href=&quot;https://www.terraform.io/&quot;&gt;Terraform&lt;/a&gt;, &lt;a href=&quot;https://www.vaultproject.io/&quot;&gt;Vault&lt;/a&gt;, &lt;a href=&quot;https://www.consul.io/&quot;&gt;Consul&lt;/a&gt;, &lt;a href=&quot;https://www.nomadproject.io/&quot;&gt;Nomad&lt;/a&gt; の4つを主要な商用製品と定義している。それぞれ次の領域で使われている。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Terraform … &lt;strong&gt;Provisioning&lt;/strong&gt; - サービスを支えるインフラの構築プロセスや設定をコード化する&lt;/li&gt;
&lt;li&gt;Vault … &lt;strong&gt;Security&lt;/strong&gt; - サービスやユーザーのアイデンティティに応じてポリシーを適用し、認証情報や機密データを保護する&lt;/li&gt;
&lt;li&gt;Consul … &lt;strong&gt;Networking&lt;/strong&gt; - サービス間の相互の通信に必要な情報を共有するレジストリを提供する&lt;/li&gt;
&lt;li&gt;Nomad … &lt;strong&gt;Application Delivery&lt;/strong&gt; - シンプルで柔軟な Kubernetes&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;これらを使うことで、企業は AWS/GCP/Azure などを組み合わせて（マルチクラウドで）構築されたインフラを自動的・効率的に管理することができる。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/5447696414fe39c34109242e8a62610a/79e48/layer.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAAByUlEQVQoz3WSTWsTURSG8yPcuXIlUgqiK4sbd11VxI3+CFcusuhC8A8oiEo3Vty4iUK7ULDJ4ELqWItINRQzI0msJpmZ3PnozMRkvh65k8zUaHvgwLnn3vOe973nVJhZlmX8aynTXBxF1Go1TMNgc+MlQtgn1lT+voiiCN/3CYIg93Q0JgpChsMhja0tlHqDnV0V23FLwDRN57wikwWgBIvjeEYvY8frse+LsrthmpykSJ6TJJkyLGwUhnkXCeoGPi8cjbrdITg8ZDKJ5ooLlySkMmk5oExKeb7n0XEsxmnMOE0w99r0V1/x8/47BgcDYlK++0P6vV4JIGur1Srqe7X8spyh67oMDINB54AkTcjqX/CvPaa1dI/P5x+xf32TUHOxDANd03MmkoSu6yiKQrPZxPO8I8mT8QQhBO2Wnnd69mCN1cVl2lcf8vryXW6eXWZ3+yO/Oj/odrvTyccxYRiWUiW7fCgysCwLYQuE6ecP3qxpnDu1wtLCBRZOX+TSmdt8+yRwhY/W0nAc59jhlH9YmNJ4S6/fgxi+Ph9x68oT7tzYQN/+TZbOr0kRSxDpRVwC2rbN+vpTVPXDUUePHHzGhWP2+L/F/gN2qebqQ9LdqgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;layer&quot;
        title=&quot;layer&quot;
        src=&quot;/static/5447696414fe39c34109242e8a62610a/f058b/layer.png&quot;
        srcset=&quot;/static/5447696414fe39c34109242e8a62610a/c26ae/layer.png 158w,
/static/5447696414fe39c34109242e8a62610a/6bdcf/layer.png 315w,
/static/5447696414fe39c34109242e8a62610a/f058b/layer.png 630w,
/static/5447696414fe39c34109242e8a62610a/79e48/layer.png 865w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Terraform はほんの少しだけ触れたことがあるが、社内のマイクロサービス基盤チームが作った便利な Terraform モジュールを使った上で YAML をちょちょっと書くとマイクロサービスの立ち上げに必要なリソース、例えば GCP のプロジェクトやユーザー・サービスアカウントの権限、 DataDog や PagerDuty、それから Kubernetes のあれこれ必要なやつらがいい感じに揃うので、とても便利という印象があった。&lt;/p&gt;
&lt;p&gt;商用製品が OSS として公開されておりそのサポートを主な収益源としている点では、先日上場した &lt;a href=&quot;https://about.gitlab.com/&quot;&gt;GitLab&lt;/a&gt; と似ている。&lt;sup id=&quot;fnref-2&quot;&gt;&lt;a href=&quot;#fn-2&quot; class=&quot;footnote-ref&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;p&gt;HashiCorp では GitLab と同様に、 OSS で主力製品を公開しつつ、エンタープライズのユースケースを実現する独自機能を備えたプロプライエタリ版を開発し、そのソフトウェアと技術サポートを売ることで収益を得ている。HashiCorp のビジネスモデルは Form S-1 の79ページ以降に記載されているので気になる方はそちらを読んでください。&lt;/p&gt;
&lt;h2 id=&quot;主要な経営指標&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%B8%BB%E8%A6%81%E3%81%AA%E7%B5%8C%E5%96%B6%E6%8C%87%E6%A8%99&quot; aria-label=&quot;主要な経営指標 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;主要な経営指標&lt;/h2&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/0024dbfefa6dd6cfe66347c9795653c4/d4c13/kpi.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 109.49367088607596%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAAAsTAAALEwEAmpwYAAADMUlEQVQ4y11VaU8UQRCdT4rIAgq7AosLqOCBB0GNB2gUr4iJMRI00cQo97HAshxyi4KCKF5giH7wF0739OwfKPOqp2aPD0Uz3dVVr1696nVqJxTBKkYUlQ64oSVSmppmNV1Y9OjUW03HpjSdW/B4jeb4lg0qKh9SVD5o95yjKRsQa/W4oophRUU9Lt3fMvT6b4Ze7Pn04IuhZ7s+9f/L0Ks/GXr83af4hKJICECxIbgTHc0GFDuSVFQ5YrPiYsOUZpTN8xZp3aRmP5xVFqB1kAUXq5LWIT5uE2AtLK1UfMdsYgGCe4eHLWJHHCP9LiOrT1sEiUlFtal8fg8NWfSxUYtMgkqVSORI1oN9LjXPe9T1y6fnv33mCcHhmEjZ89Nzmrp3fLqzaahjw7Bv145PT3/61DijGWmIENnB0ZVVj84varq86tHJWU014xZJ2aBLsaTioK3Lmq598Oj6mkdt6x6dXcj6hQGxIgsuHJ+2TUBpOMOKhCX9LtuJac0GH1RwoNdl/qAQJ5dwrLhYHpjQAd6wHzZmSFH1mOWtskC/eQiRvbjPZR0ia3QkKyURLgIgATcnqbhUGLrMAQUFgmESbm8YbkjndpZodFsCQYe3Phnq3Db0ci/DXEq3uctAVjagGNnV9x7d2zI8GQ+/GuaoKhA5UDSkNTcAU4TEdz8balvz6MycDitxoD+QiQ5feuexoXutK5q7Da6AXgICIfZQIkoGKlQRdhmb+AeOImpRPhJJM6Qx0CNAyPxGBuTb5Tv8OGDMRBo43PfGNkaaIx0s6nWpuNdKB4HxjXPZZ9mATKBrX7O8NM3YJ+vmR0Oty/bpEpSYEOy3rxvW6sWVrF/Lkm2OA5ggHqPUveuzE0h/8sOnR9986tg0jB6loVn4RjPgh3OMHzp+Y93wiDqACWJBNIa8OtAV9tBd3huzQt/f47JBn/VpxdNSl7Y+8AfPDqLWBA+rEFwSkBwLXhEYtIqycRn+8Yns85Un7NqcNxBIwBeQ5T66MmIiDbF4ACRv9FAi9AYD0ZBOIpWfHZfiBQmiBTMsY+ngD4JByC1Lmhpng8e14BLQJ4KfB5QeyXlUUJUI+z9e4ENjv9hi/QAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;kpi&quot;
        title=&quot;kpi&quot;
        src=&quot;/static/0024dbfefa6dd6cfe66347c9795653c4/f058b/kpi.png&quot;
        srcset=&quot;/static/0024dbfefa6dd6cfe66347c9795653c4/c26ae/kpi.png 158w,
/static/0024dbfefa6dd6cfe66347c9795653c4/6bdcf/kpi.png 315w,
/static/0024dbfefa6dd6cfe66347c9795653c4/f058b/kpi.png 630w,
/static/0024dbfefa6dd6cfe66347c9795653c4/d4c13/kpi.png 825w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;2020年8月 ~ 2021年7月の12ヶ月の売上は $259M だった。平均の NRR: Net Dollar Retention Rate が 124% なので、同じ顧客からの売上が前年比で1.2倍になっている。&lt;/p&gt;
&lt;p&gt;印象に残った HashiCorp の特徴として、顧客全体に占める $100K （10万ドル）以上の ARR: Annual Recurring Revenue を支払う顧客の割合が高いことが挙げられる。2021年7月末時点で顧客数は2,101社&lt;sup id=&quot;fnref-3&quot;&gt;&lt;a href=&quot;#fn-3&quot; class=&quot;footnote-ref&quot;&gt;3&lt;/a&gt;&lt;/sup&gt;でその内 $100K 以上の ARR の顧客は 558 社なので、全体のおよそ27%が年間 $100K 以上を支払っている。&lt;/p&gt;
&lt;p&gt;顧客に大きな企業が多いと考えられる GitLab でも Base Customers&lt;sup id=&quot;fnref-4&quot;&gt;&lt;a href=&quot;#fn-4&quot; class=&quot;footnote-ref&quot;&gt;4&lt;/a&gt;&lt;/sup&gt;が3,632社で ARR $100K 以上はその内383社（約11%）なので、 HashiCorp の顧客にはそれだけのお金を支払ってもよいと考える大きな企業が多いと言えそうだ。&lt;/p&gt;
&lt;p&gt;ちなみに134ページの記述によれば、2021年7月末時点で ARR $1M 以上の顧客が58社いるらしい。&lt;/p&gt;
&lt;h3 id=&quot;年間-100k-以上を支払う顧客の数&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%B9%B4%E9%96%93-100k-%E4%BB%A5%E4%B8%8A%E3%82%92%E6%94%AF%E6%89%95%E3%81%86%E9%A1%A7%E5%AE%A2%E3%81%AE%E6%95%B0&quot; aria-label=&quot;年間 100k 以上を支払う顧客の数 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;年間 $100K 以上を支払う顧客の数&lt;/h3&gt;
&lt;p&gt;85 ~ 86 ページより図を引用した。&lt;/p&gt;
&lt;p&gt;有料顧客数の伸びと ARR $100K 以上の顧客数の伸びを比較すると前者の方が大きい。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/30674141839a4efc26b6b637312e1a3a/d52e5/customers.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 59.49367088607595%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACDElEQVQoz62Ty0tWURTFv78paNagQRQUjRIEw6CiQSBYNDIMhaIse5BaWSqZqJSZPUzpIWgJNZCiQQ8iAiH0hp/3fR73/Yt7PiVCgoo2LPbesFisvfc5Fdu2WVxcxLIs0jT9Z2QlsoxKFEV4nofv+yb/LVy3lqu2SxgKKvynaOgVTL1LqBRFwZ8gz2uAWr8ePc8Vs59itpx0uflSb3S4TjYia8jynwLpWt03p5l5H7P9nM+ZScXuiz635vWvDo2LoiDJig0jWW6Op3I6pxUDLzR7ugJaxgSNvQHnpxU7L/gMzuvf77Aa5HyzM2Y+xDx4E9N+X3J0RHB4MKR5WHCwP6R9QtJwNaBzSrFrXbB0lGYFgcr58j3j41LKo7cx/XPakEuhuu6A43elETkyLDg2KtjfF9I2Idl7LTCuS0Ez8teVzDT3FiK2nva4MavZ3OZx+WmNVO6nsTekZUxyoD+kaUgY0X3XQ1rHJfVXAs4+Vuzo9GtH+WylbDrhMLEQsa3D4/ZrTV2XbxyW+7n0RJoxTz2UNA+HtNwRtI4LmoZCOiYlhwYCup8p6nt8Rl9pKmmaseqGKB1TtQOkilixfYSMsN0QoWIcX+CHymQ3kHiBxPEEoYxwfIlQEVUnQOq4duUk1iRJjOc6LC8tEUeaKNKkSUyeZaZP4ojV6opByY20IsvKL5dgWcu4zqp5oz8Av8djhrCkjBIAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;customers&quot;
        title=&quot;customers&quot;
        src=&quot;/static/30674141839a4efc26b6b637312e1a3a/f058b/customers.png&quot;
        srcset=&quot;/static/30674141839a4efc26b6b637312e1a3a/c26ae/customers.png 158w,
/static/30674141839a4efc26b6b637312e1a3a/6bdcf/customers.png 315w,
/static/30674141839a4efc26b6b637312e1a3a/f058b/customers.png 630w,
/static/30674141839a4efc26b6b637312e1a3a/d52e5/customers.png 848w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/355ea5fcc7305810f398f412809dd9e1/c3fd4/100k_customers.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 48.10126582278481%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB8ElEQVQoz3WSz04TURTG50U0LowhUTEQw17BJ/EFiDESIKArpb6ALtwRUNQg0bgz3VH+KLqySdukpqWhtJ25987AdO78/Zk7UzFoOMnJN+f7znz33JtjNZtN2u02rVaLRqORfxuu0+mQpilJkvyXcZwQRgVGccFlqckUS0qJUupcSmnQxWhCSISU2I7Ma5OeK0kCxYmnCH2FIySHXYcg0FhcEBkXh/Dhy8+Y6lHKi7KmXI2ZLnmoYYaVpBlplhEnGVmWjawKuzDO+DVIaNsJq9sBlXrE/Vcem98044uCtUrAtUeCN7uaS7MO9kl6fkJjfCRTDp2E55+HlKsRd54qXu9orj4UrG5rbszLvJ5YkmzsaSaXJO/3C90xhrVukpu8LAdUGhF3nyne7WvG5swEmluLMp9g6rFkY1dze7nAyZHhxL+GNxdkbnDlQTHB2Jw8M1rf0YwvSNYrGtO3NkLD/5n0+rzk7Z7m8qwormxO/PQj5F7JZetAM7Oi2DooavNWMyWXDyPc/PpXn14p+s2NPn7XTD2RiNMUqzcQ+MOA475DGMUc9wW+H9DtOegwwujDQNPt2fnOGf7UL/oDHdJ3VP5ft+/k+2iFOiAMQ048l3q9hm0PiOMIHQzzxTZ6FIV4Rq/V8FyV10Y326CkOONN/AZn/sFCL1qLKAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;100k customers&quot;
        title=&quot;100k customers&quot;
        src=&quot;/static/355ea5fcc7305810f398f412809dd9e1/f058b/100k_customers.png&quot;
        srcset=&quot;/static/355ea5fcc7305810f398f412809dd9e1/c26ae/100k_customers.png 158w,
/static/355ea5fcc7305810f398f412809dd9e1/6bdcf/100k_customers.png 315w,
/static/355ea5fcc7305810f398f412809dd9e1/f058b/100k_customers.png 630w,
/static/355ea5fcc7305810f398f412809dd9e1/c3fd4/100k_customers.png 854w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;後者を伸ばす、つまり顧客に年間 $100K 以上を使ってもらうためには&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;HashiCorp の製品を導入している会社のビジネスが成長する&lt;/li&gt;
&lt;li&gt;成長に HashiCorp の製品が必要という信頼を顧客から受ける&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;必要があるので簡単ではないが、顧客数自体は伸びていて NRR もそこそこ高いので今後に期待したい。&lt;/p&gt;
&lt;p&gt;あと、この ARR $100K 以上顧客数の伸び鈍化はマイナスというよりは2020年6月に始まった HashiCorp Cloud Platform というマネージドサービスの影響もあるかもしれない。自社で運用できない中小企業はマネージド・サービスを使いそうで、それらの顧客が使う金額はそれほど大きくないと考えられるためだ。&lt;/p&gt;
&lt;h3 id=&quot;収益コホート&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%8F%8E%E7%9B%8A%E3%82%B3%E3%83%9B%E3%83%BC%E3%83%88&quot; aria-label=&quot;収益コホート permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;収益コホート&lt;/h3&gt;
&lt;p&gt;83 ページより引用。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/b6c3303494994b660165cecaf75e2b60/71c8e/cohort.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAAByElEQVQoz21SvW7UQBh0SUeRV0C8BnUeJV2kVEhBCkghDUh018MjgIQoqAinFCAQDRI6zobznX/vbK93vWt7vYO+79groow02i1mRzPffkFd1wjDEKvVCnEcoygKjOOIYRiYpu/hACilEEURa9brNdI0PWg8nXMIyrLEcrlEnudomgZCCH5MFFJhVB3gHNq2xWKxOOiIpJFSous65jRNCCgNOd+G/X9eixrfpQKmidPehb7vQcHIK2B3rdnUs7cTC7/WCkcffuNjYQA3omnlQeNBRn5MXNn3J0zOYbB78Tcx4OjdFsGbCvPMAm5gQwI9pHpJknBtDzbUWsMYw2YenzcO92cKwbnEvVOB6wUNYEAjKOFeU+1K9EbDWsumPnVA/Ue7n1glLV683eLBWYiHJz/w6HSO47P3+BluKT+EaFmXpCmWqwxpKfizyONgSNHzosSn+Q1ezl7j5HyGx89e4fnVFS4vn+Li4gmiKGRxKwSiJMOXX3+RVh2UHjghmfkzoEtRlsjyHFmygWxKbBLaswx/4g3i9QZVLbhFbwzyXc0VOyWhNa2L5pXxtYO71mBnJwzGoJ0A2WkeRdVInnVH+ykEsiznj7mNfzXO7+CbEOcOAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;cohort&quot;
        title=&quot;cohort&quot;
        src=&quot;/static/b6c3303494994b660165cecaf75e2b60/f058b/cohort.png&quot;
        srcset=&quot;/static/b6c3303494994b660165cecaf75e2b60/c26ae/cohort.png 158w,
/static/b6c3303494994b660165cecaf75e2b60/6bdcf/cohort.png 315w,
/static/b6c3303494994b660165cecaf75e2b60/f058b/cohort.png 630w,
/static/b6c3303494994b660165cecaf75e2b60/71c8e/cohort.png 875w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;FY2018 ~ FY2020 は傾向が似ており、1年目を100として4年目に200、つまり2倍になるような成長を続けている。このコホートからは、顧客との関係が中長期的に拡大していく傾向がよく分かる。&lt;/p&gt;
&lt;p&gt;NRR を高める（= 同じ顧客から継続的に収益を得る）ためには売上の機会、つまり既存のユースケースを拡張したり新たなユースケースを実現していく必要がある。&lt;/p&gt;
&lt;p&gt;83 ページの記述によれば2021年7月末時点で ARR 100K 以上の顧客のうち44%は複数の製品を使っているとのことなので、 HashiCorp が新製品を次々に作っているのは NRR を高めるのに効果があると言えるかもしれない。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/de25b9c47d91c8feef8f399eac6017c1/47ff6/history.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 67.08860759493672%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB4klEQVQ4y5WT627aQBCFef8n4UfzEv3dBiSIKEQ2wRAbX8AXfN3LfBWGuFYiqnak0e5oV2fnnDM74R9Crily24sM+2ucLpbva4Wfmr6e8B8xBioay+pdU9SWqhE6LX8H/NzRR1130mfRCG4EYSk4paF6BPiI2kcEqcGJYO9HRMGBrNF4paX8DPgIqGiFVgkXLeRKyDtL3EFWlGw2r5zTfFDaWmEyBhgD5VdtOiGIWt4Tw1thOVSGY2VwSqEqSqI06+8aK70pSsu4w9uatYbaCGFmiC+QHWNCP+D+JNrYG/VjxJuzIa2E+U73bveUjTForbF3xF3ekjSGsIVEwfocsg19rL11os3tXqss20T46dZUjR4YThaLBdPpdKDq5Aq3FIJTTq2F8JjivwfDeathf7b8cBsOJ4XF0omls/cOl4sF356e+ulti5p9HJM1Dd5uR55GpKcC19kSZh1ubJm5Df7pxgosuTbMLyWvdd2z7DW8anYpLuzfPLy9h3fwOBcd7rHh16Fm5lYsvZoo0xSqI1ItamzkyMxew9VqxfLlhefnZ+azGS/rLXMn5pAavHNLZcwf941hXdWclBq+5Xj0+rFJkoQgCCjLchgdv+sIVEtuNZuqJr9SlK9/3Frb0zf3R38DVcTwzSpsNDwAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;history&quot;
        title=&quot;history&quot;
        src=&quot;/static/de25b9c47d91c8feef8f399eac6017c1/f058b/history.png&quot;
        srcset=&quot;/static/de25b9c47d91c8feef8f399eac6017c1/c26ae/history.png 158w,
/static/de25b9c47d91c8feef8f399eac6017c1/6bdcf/history.png 315w,
/static/de25b9c47d91c8feef8f399eac6017c1/f058b/history.png 630w,
/static/de25b9c47d91c8feef8f399eac6017c1/47ff6/history.png 852w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;128 ページによれば Terraform と Vault（↓ の階段の一番右）がよく売れているようだ。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/52501425579b659b639a5f9d508fe34a/cc8d6/stepup.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 45.56962025316456%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABt0lEQVQoz22SPW/TUBSG+z9gY2BkY+uPYIAF+AMglQWxIMTCwoYEErAgISGxsCCxUVSxVCpS47Sp48TxF/lo09hOYjt2/JHrBzmOoxTlSFe695zzvvc9HztsWJ7nbLPK//pHxN23Pvff+zz6HBAm+TpenZ3KsRBlsGZl3Hnj8fCjz713Po8LYFzGHnzwubbncuPpmNsvJ0xDUaARYoOwumQrwl9yyvUnY249n3Dz2ZjdVxO8qATa/gLLFpi2YOiJrZWsFYplWTlRIvjrZHQdQc/NsYP/USmB5xL6EyzLROto9Lo9PM8jSZJS4TZL4xnO6JxBz0JpKeiahmGa2I7LaGSj6TqSJCMrMo2zEwzDLAmjKEI3DDqahtpuo3Z0ZKWFbTucX1xQO65xdixx2m4i1esrJTGzcM7UldFPO1z2fMIoIE3TsuSp4yA3GshqC615wrBrUemezmccXhq4R02SaH6lijjY5+j7IQM1WbWDknAoctRBH7uhsa9GKL5YJ/hkfOpLuF8OIBPLj8pBXh1KLjbW5s885mddov/tNy8OFnztxsuk5aA2WpwXj4KMav8EQoj1nhaE/wAfy5+y08/WegAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;stepup&quot;
        title=&quot;stepup&quot;
        src=&quot;/static/52501425579b659b639a5f9d508fe34a/f058b/stepup.png&quot;
        srcset=&quot;/static/52501425579b659b639a5f9d508fe34a/c26ae/stepup.png 158w,
/static/52501425579b659b639a5f9d508fe34a/6bdcf/stepup.png 315w,
/static/52501425579b659b639a5f9d508fe34a/f058b/stepup.png 630w,
/static/52501425579b659b639a5f9d508fe34a/cc8d6/stepup.png 791w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 id=&quot;財務諸表を読む&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%B2%A1%E5%8B%99%E8%AB%B8%E8%A1%A8%E3%82%92%E8%AA%AD%E3%82%80&quot; aria-label=&quot;財務諸表を読む permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;財務諸表を読む&lt;/h2&gt;
&lt;p&gt;決算期は1月期。&lt;/p&gt;
&lt;h3 id=&quot;bs-を読む&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#bs-%E3%82%92%E8%AA%AD%E3%82%80&quot; aria-label=&quot;bs を読む permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;BS を読む&lt;/h3&gt;
&lt;p&gt;HashiCorp の BS はシンプルで、固定資産や固定負債はほぼない。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/565c5fd2a0d46f26d86a1f631a7fd0b5/1f083/hashicorp-bs.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 55.69620253164557%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACZklEQVQoz22STUgUcRjGp1vQpVunIKiDlw5FhyS6KERQEUlBl4iiKA8RUQeDoNCoSAINgi0qEPKQnTxoJSptQuZHoWWBLau2rq7rOLMf6u78P2Z+8f+v9gG98OedmWeeZ97nnccBWFWKlOfjeT5qMUlhySWTW2Lay7BSyCOKSVzXJZ/PM7+YpbC4QH4ujet7ZHKKhayHFIIoinCMYCAE5SBAKUUoA5SUSCUJpECbZypASAlhxO8KQyAi1BFSKssRQlQErVAY2i8YjunmsNa1JcM3L8WJt/e4EI/R+GWCm+OTJIvLFlNaWx0rKKW0N+tkqZU99iWt7bWp3tkxnNZaNj8/xf7XPeztjjPsLllMKmV1HDNmEARore2U/6sw1La/n5tg4+NjbG+vpyY+xL74OCNe4V/BXC7H6uoq2pAiWFjx6Ui8o3NqkHgmQ+9chsVSyZL6019xYnVsaztH87MGWmNXmZmdrFhWFZeO7/sUi0WEkhZ4k/qC8/AwG56epbpvkKqeUT4u+RYbSI+z5clBdredob6pl4sNA3xPeBYTQlqnjhnT2NVrtn5khrnSvpPrr2q40fmISy9bSWRnLLac7SfZ6fCtaweHHnjsaoKRKcMLUTr8ExuzRyUD45jI7YFuB9m1idjdFhqvtfAzWRGU832IFw5ex1aO309RfavEpymxtkNdmXA9IiIIMKYLEx+YOl/F2OUD1DX77LkNI4myJfmfh5g8sovx00c5eSdF7Z1lRhMliMyP/SvYNi5KVyJTChDzHrnpedIZH68gCIQijEJUuYzIuuRSadLZIm5RUzaYWdlaSn4BBBMREptZj1MAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;hashicorp-bs&quot;
        title=&quot;hashicorp-bs&quot;
        src=&quot;/static/565c5fd2a0d46f26d86a1f631a7fd0b5/f058b/hashicorp-bs.png&quot;
        srcset=&quot;/static/565c5fd2a0d46f26d86a1f631a7fd0b5/c26ae/hashicorp-bs.png 158w,
/static/565c5fd2a0d46f26d86a1f631a7fd0b5/6bdcf/hashicorp-bs.png 315w,
/static/565c5fd2a0d46f26d86a1f631a7fd0b5/f058b/hashicorp-bs.png 630w,
/static/565c5fd2a0d46f26d86a1f631a7fd0b5/1f083/hashicorp-bs.png 660w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;140 ページの記述によれば、 HashiCorp は全ての製品を AWS/GCP/Azure 上で運用しており、自社でデータセンターは持っていない。固定資産は主に2種類で、リース資産（PC など）と繰延契約獲得費用（営業人員の契約獲得に応じて支払う手数料）で構成されている。この契約獲得費用はその顧客から利益を獲得する期間（110ページによると通常は5年間）にわたって繰り延べられる。&lt;/p&gt;
&lt;p&gt;現預金以外の流動資産の大部分は売掛金で、 FY2020 では $52M（年間売上の43%）、 FY2021 では $93M （年間売上の44%）の売掛金がある。それぞれ HashiCorp の年間売上の 43%, 44% なので、だいたい5ヶ月分くらいの売上が売掛金となっている計算になる。&lt;/p&gt;
&lt;p&gt;また、流動負債の大部分は前受収益 Deferred Revenue であり、これが FY2020 では $89M、 FY2021 では $136M ある。&lt;/p&gt;
&lt;p&gt;資産側の売掛金と負債側の前受収益を比べると前受収益の方が大きいので、 HashiCorp 社はその差額だけ現金が増えている計算になる。 SaaS の会社が前受収益を活用して急成長中のキャッシュフローを補うという構造はよく見かけるが、売掛金が売上の5ヶ月分というのはちょっと大きい気がする。&lt;/p&gt;
&lt;p&gt;HashiCorp の収益は基本的に年1回で1年分を前払いするそうだが、複数年分（上限は3年）の前払いもできるらしい（87ページより）。これが前受収益として計上され、収益認識基準を満たした時点で売上に振り替えられる。&lt;/p&gt;
&lt;p&gt;なお、104ページによると新規顧客との契約は 4Q に行われることが多い&lt;sup id=&quot;fnref-5&quot;&gt;&lt;a href=&quot;#fn-5&quot; class=&quot;footnote-ref&quot;&gt;5&lt;/a&gt;&lt;/sup&gt; 。契約締結から売掛金の回収までは 1 ~ 2 四半期を要するとのことなので、急成長する局面では売掛金が大きくなりそうだ。売掛金が大きくなっている原因はこれかもしれない。&lt;/p&gt;
&lt;h3 id=&quot;pl-を読む&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#pl-%E3%82%92%E8%AA%AD%E3%82%80&quot; aria-label=&quot;pl を読む permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;PL を読む&lt;/h3&gt;
&lt;p&gt;FY2020 の売上は $121M で FY2021 の売上は $212M なので、 +75% の急成長をしている。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/6a6b303eaa05188994da8eab54b9813d/1f083/hashicorp-pl.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 56.32911392405063%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABx0lEQVQoz3WSvYoUQRSF5xVMzHwEYwMDH8EnMNgNFk0EIxFEMDUUFCZZBEUDYcFMNxJTBTFwRJF1dVBwdtr56enu+rlVn9zb3Wvvgg0Huu6pOnXq3DsCSCkZcs6knIHMfJ0oVjX+15T5UUG1nuFWh8xmc+q61mO2/zRGSnjvCSG0gp14iApBOk6iwuF8sHq/bwgTzOaIE2It2SINbk+pda/4r2Dv0DlnRRExB1HdyT/oGoT7Lxse7Df2P+QVen6kQrpQdZFETklTNei6vz1KW7vysGJ7XB3zctrhYrFgs9kQQrRN61q48bjm1QcHRKJmJ/FY8NpuxfVHlXESo3Fp6LAoCpqmoUuSP5vE+Zsl49dildil1uYHW+OanV1n//1bTnRZO6jK3msXPcXKsTUu2dv/Cd8+4WdvCeUXnBfInjvPN9x9OkcOv+J/T4jlBO+d9UFdWlPMSYw2HsE59P7ZsyccXL7Eeu8czcerhATB1cYt37/j88ULHN07Q/3mLKFe25jp80e9mKIPV7+wWlJPvxPLKeLm9uQk0Tj344Dp7VssX2zjJjukoBOCjZkJ9m0fZhEkUeoo9ZOX2y7mlJEMlY5Y97phhn8Bj85IlhnaJw8AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;hashicorp-pl&quot;
        title=&quot;hashicorp-pl&quot;
        src=&quot;/static/6a6b303eaa05188994da8eab54b9813d/f058b/hashicorp-pl.png&quot;
        srcset=&quot;/static/6a6b303eaa05188994da8eab54b9813d/c26ae/hashicorp-pl.png 158w,
/static/6a6b303eaa05188994da8eab54b9813d/6bdcf/hashicorp-pl.png 315w,
/static/6a6b303eaa05188994da8eab54b9813d/f058b/hashicorp-pl.png 630w,
/static/6a6b303eaa05188994da8eab54b9813d/1f083/hashicorp-pl.png 660w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;FY2020 は $53M、 FY2021 は $84M の損失を出しているが、現金支出のない株式報酬が多いこと、 BS の箇所で述べたように売掛金増加より前受金増加の方が大きいことから、キャッシュフローはそれほど悪くない。&lt;/p&gt;
&lt;h4 id=&quot;収益構造&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%8F%8E%E7%9B%8A%E6%A7%8B%E9%80%A0&quot; aria-label=&quot;収益構造 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;収益構造&lt;/h4&gt;
&lt;p&gt;HashiCorp の主な売上は自社製品のサポートであり、 FY2022 の 2Q では売上の 77% を占めている。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/39bd08fc37fcc610aa56e42c3a9eb9a8/e619b/quarter-revenue.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 46.835443037974684%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAACCklEQVQoz12S60sUURiH92/rP+hLBH1ZtsJPqSRaSuS2Ql7KMsRLeSnQEFwUBBMUArOSykuoayVq0+y60+y4lxlnZmfntk/M7BrWD57zcg6c57y8nEi1WsV1XXzfJ0jOLKGeaRiGQbls4poSuq6jGwZWuYylyOimhVKqYJVNfM+l6lfDu8EaCYSO44TCUO57eF4N3w9w/+4918VzHVzHpu4I4+FyvD+NXdGIhAeeF8oCqNdzwofqXIyhy6hFEWH1BfKnecTrl7CzApFAdrHDoIZ4Lv+nmBM4FffZXX2N+LKP4+4mTu42oowOIEavYadFIpqmYZpmrTPP+0dgWwZ6/oTM2iLptUW+t8XIPu8n3XgDpb8HubMDKdFOfnKEX7Er2BmRiKqq4bDPY1Y0DFXhaH4CaWGGw7YGpL4EUnecbGszyuggmY7byAO9ZBPtZOPtnE6MIMSu1oSObeMApb0vSMuzZAcfIo8PkLsVRR1+TKEpSulpgmL/AwotMbThPvKtNyk+6eI03kLhfjPq2DOk6GWctECE+rDzyRmExgYy9+5w8qibzXgvqVdJljuH2ByeZnNoijddk3yYWmGuZ5bk9DbjY1skB5dZmdsi3vWRnKzXvk0VH/Hnb3Y2DtnZFkilMrz7qrBxoLK0W2b9hx6ymHJZP7JZ2rN5f2Dx9luFlX2Lz8cW81sWhTOHP/MPeiVe8ioLAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;quarter-revenue&quot;
        title=&quot;quarter-revenue&quot;
        src=&quot;/static/39bd08fc37fcc610aa56e42c3a9eb9a8/f058b/quarter-revenue.png&quot;
        srcset=&quot;/static/39bd08fc37fcc610aa56e42c3a9eb9a8/c26ae/quarter-revenue.png 158w,
/static/39bd08fc37fcc610aa56e42c3a9eb9a8/6bdcf/quarter-revenue.png 315w,
/static/39bd08fc37fcc610aa56e42c3a9eb9a8/f058b/quarter-revenue.png 630w,
/static/39bd08fc37fcc610aa56e42c3a9eb9a8/e619b/quarter-revenue.png 787w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;一方で2020年6月にリリースされた Cloud-hosted services つまり HashiCorp Cloud Platform(HCP) の売上が急激に成長しており、 FY2022 の 2Q では売上のおよそ 5% を占めている。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/db0b0e8faaa0004f55033bcdc4a5e11e/3f3b9/hcp.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 51.89873417721519%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABuklEQVQoz52SP2sVQRTFt8oH0C6FKCKKhYjmC1jaimAREMQqCDEqUYmaRlAsbBSxUYRgChEsbIIIaqFoowQlUVH8n4ckuzPjZnd2Z3ZmfrL7XswmSBAHLjNz5t7DuXNuxH+u0DrPdjwzc10kCiHwr+Hr8GEFnTae3eOSHWMCU4VlwjXVrHqXuefylGbiaYk2gS2jgg0jgsoFor8VLxHUiuqkWlWNlbaLf40dfYdiBsZlQ7jtlGDT8RZhCMtF9W5dwPmVqt51HDvPSsbu5ojMs34oYc8FRWECW08KNh7rEa7V7rfYceNJwZvvFW/nHNHgAoPXU5TuEV5UjcLtpwWbT7QU/lSeV18chQ28+Gg5fDPj+QfLg9eGaO88R29nfJp3RPsW2H81bf4wOhiz65wiLz39w4J1Qy3CRzMFo5OS9x3Ly8+GA1diHs8afojAkVsJU9MasegZmRBMPssaZ8/cUVx7uIgLcOl+yvl7Cuc8UdOwN1gtsabA2QKMRGeSX0rgS0lVZhhT4gpJqHTXPJtitUIkCSYXBJN253DJzdqD2hDvfTNlWZYjlWrhtVE099DLN7YiSRJKY//gvwHU0N+J9y032QAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;hcp&quot;
        title=&quot;hcp&quot;
        src=&quot;/static/db0b0e8faaa0004f55033bcdc4a5e11e/f058b/hcp.png&quot;
        srcset=&quot;/static/db0b0e8faaa0004f55033bcdc4a5e11e/c26ae/hcp.png 158w,
/static/db0b0e8faaa0004f55033bcdc4a5e11e/6bdcf/hcp.png 315w,
/static/db0b0e8faaa0004f55033bcdc4a5e11e/f058b/hcp.png 630w,
/static/db0b0e8faaa0004f55033bcdc4a5e11e/3f3b9/hcp.png 870w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;直近2期分の費用内訳を見ると、 Sales &amp;#x26; Marketing に多額の費用（売上のおよそ7割）をつぎ込んでいることが分かる。この中には営業やマーケティングを行う人員の給与、賞与、株式報酬、広告費用、出張費などが含まれている。&lt;/p&gt;
&lt;p&gt;98ページの記載によると、FY2021の1年間で営業やマーケティング組織の人員が38%増加したとのことで、これが費用増加の主たる要因となっているようだ。&lt;/p&gt;
&lt;p&gt;各費用の内訳は下記の通り。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/aea24856d3bdb5641508cb8dbd2e851f/44fd6/fy2020-breakdown.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 46.835443037974684%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABj0lEQVQoz4WRvW7UQBDH/TYUvAM1UioiJGjyFEjUSCjQpYCOhhdAIhVVqChOOikVkBB04dARH8g++3xrnz92dvxDu8bhJCIx0uzsx+xv/zMblWVJmqbkeU589YM4vqLYGLz13p0bvFf6vv+vR8452rbBWqGsO+pWkG2FzVa4pmE0D1cnqIfrv3D9sxepz0SYJ46HLypeT4CzU5bPn1B//ki7+E45+YCU5i/cQ/RmxZGIAo4vsXD7seHweFAlTkNMXr1kfnCPZvYV+zOmnc8GlTvKRg/AdbEJCs9jx61Hhqdvm1CgB4aksVxrmR/sc3n/Lq5thj1Vdi0A83xNr8Jq0/FmsuX0sqFXS9dZrPWxw4rQ1TXfHuwx27tDt63onMP3P8syptMpy+UyQKO2bcOFQcfQfr3pB1Vpzj/RXJxhs5RfR88o3x2zKgren5ywWCwGoB+8CueUzgoiw8siEuJuj3yBoeMiSJbijMGpXueGkv0wLqqqCof+AWPMdUySJMyr0mA2RZiv1gWmqhgFjb/8G6h9raLqZanZAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;fy2020-breakdown&quot;
        title=&quot;fy2020-breakdown&quot;
        src=&quot;/static/aea24856d3bdb5641508cb8dbd2e851f/f058b/fy2020-breakdown.png&quot;
        srcset=&quot;/static/aea24856d3bdb5641508cb8dbd2e851f/c26ae/fy2020-breakdown.png 158w,
/static/aea24856d3bdb5641508cb8dbd2e851f/6bdcf/fy2020-breakdown.png 315w,
/static/aea24856d3bdb5641508cb8dbd2e851f/f058b/fy2020-breakdown.png 630w,
/static/aea24856d3bdb5641508cb8dbd2e851f/44fd6/fy2020-breakdown.png 789w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/172c9f0a7a915a85eed9343f00ce3717/2e237/fy2021-breakdown.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 46.835443037974684%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABgklEQVQoz5WRP28TQRTE/W3oqOioETVfgI6CiiIFFGlSICGlQnwHGlAkkKBBQgYlkmloKAg4KRKf77Lk7Lvbdby3f39o98CkAARPGr0p3oxG80ZKKeq6pmlaTk5nzIqCtmkgBGJCjP+FkfcerXtC8ICDYEksTQSCcxn/aj7KwujRJvJ5HqgkhPMzVpMDrDjj8kTviN7/3dC6lMdyOPdcvd/x8FWAo09Uj3fR00Pk+7eIJ7sYUf0yTuI/JB6l7oiGaeW5tq149FJnUfghbl48Y77zgH52gtof0715PdQQQq5p2AOyYb1YZvmX0nNlS7Kzp3N7zvqcYpPKOY5v3WB68zrBGn432dAYk8qh7gx7H9Z8PNbEYDHGYq3F9Bpjesz6gtm9O5zevU3fdaijr/RVyWK5ZDKZUJZlNs1Psdb9/GnePgTS98OlnhI3zRK7UthvgmJ7i/b5UxZS8m48piiKwTAdD+KIVCuMdaTUUsrNFkJkfqE1ar3O/FwIurZlCGQ3T/kOIo2sQwbvqfcAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;fy2021-breakdown&quot;
        title=&quot;fy2021-breakdown&quot;
        src=&quot;/static/172c9f0a7a915a85eed9343f00ce3717/f058b/fy2021-breakdown.png&quot;
        srcset=&quot;/static/172c9f0a7a915a85eed9343f00ce3717/c26ae/fy2021-breakdown.png 158w,
/static/172c9f0a7a915a85eed9343f00ce3717/6bdcf/fy2021-breakdown.png 315w,
/static/172c9f0a7a915a85eed9343f00ce3717/f058b/fy2021-breakdown.png 630w,
/static/172c9f0a7a915a85eed9343f00ce3717/2e237/fy2021-breakdown.png 790w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h4 id=&quot;地域別の売上&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%9C%B0%E5%9F%9F%E5%88%A5%E3%81%AE%E5%A3%B2%E4%B8%8A&quot; aria-label=&quot;地域別の売上 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;地域別の売上&lt;/h4&gt;
&lt;p&gt;F-13 ページより。&lt;/p&gt;
&lt;p&gt;HashiCorp の売上の7割超が米国から生じているが、その比率は徐々に下がっている。つまり、米国内の売上成長より米国外の成長の方がわずかに速いということになる。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/ef40ca6d64e3ca731b6f22bc4b1a0ece/bcb8c/geography.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 26.58227848101266%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAABFklEQVQY0x2N126DQAAE+f8fsxTHJXESWgwc3IEpDkc1zUxkHkbanYddA+DxeCCl5Op5BEFAGIYIIZBKoZQiTVOquqaqKoqioNR661pXaK03Xm6cJozX4HNZ6PuOrm3pu26jrituSYJlmoggIIlj7kXBOAwMw0AoBFEYEsevU0nbNqzrirEsT5quZ5gXFmBaYQXyUvNtOexPZzwRYTrulp2rhy8i9sczb4cTX6bF5cfk/fTBMI4YRVmxu9i4t5JihmyEvydbv/gK1UzYKudo+6hmxEnuHCyPUPeYMmf3aWHHBW6qKZsWY5oXuvnJvelJy4pMN2S6RsQpbhDiyQQvivkVEl8mG1ch8WS8+SjJyHVDWtaM88w/gfh1NAZyGZwAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;geography&quot;
        title=&quot;geography&quot;
        src=&quot;/static/ef40ca6d64e3ca731b6f22bc4b1a0ece/f058b/geography.png&quot;
        srcset=&quot;/static/ef40ca6d64e3ca731b6f22bc4b1a0ece/c26ae/geography.png 158w,
/static/ef40ca6d64e3ca731b6f22bc4b1a0ece/6bdcf/geography.png 315w,
/static/ef40ca6d64e3ca731b6f22bc4b1a0ece/f058b/geography.png 630w,
/static/ef40ca6d64e3ca731b6f22bc4b1a0ece/bcb8c/geography.png 879w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;リモート前提ではあるが日本でも採用しているようなので、興味ある方はぜひ。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.hashicorp.com/job/3431357&quot;&gt;https://www.hashicorp.com/job/3431357&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;cf-を読む&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#cf-%E3%82%92%E8%AA%AD%E3%82%80&quot; aria-label=&quot;cf を読む permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;CF を読む&lt;/h3&gt;
&lt;p&gt;PL では損失を出しているが、現金支出の無い株式報酬や顧客からの前受収益が大きいため営業キャッシュフローはそれほど凹んでいない。また、 FY2021 に $175M の大型資金調達をしているのでお金には困ってなさそうだ。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/3d626fa1196054b17d629cc263a11bde/889a4/hashicorp-cf.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 55.69620253164557%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB1UlEQVQoz2WSP28TQRDF/T2gBomSJhKiCOIb8B3oaegiJARSCkBCIERaCsqkQ6KEKB2gUFAg4qRKMP5z9vnOd7d/ZveHZle27OSkubuZ3X373rzpAQQRIuCGA6ajCbabsJj2WSwMp7MLinKOTM9piwHFrGRWzmlaTzEa09SVQhBjTNHTxFqLc47gHd55RDziLSKC1Zr3aU28w+m/BGrTMGprghKKkRBCBtTX8lnekiPnRDZyHyTt/dA/4sHHh/D1LcF1CXjFUJlo6C2rEEcIl2ohJMb6vDs55O7ubdi5hjQlek0MgZ7KNcZkWeuHkxQysPgrgO9PDrn38g48v4W0a4BFUaT+rSSTVCKzb0QzyvW0FpJsF3yq7Z19Z/vFFjy7Seiq1Z4EuGSYzfHIoqT6fJ36Yh/TP8YdH2CjmtdhlcrwE2++PGL71X14egNbF1gfkpm9pVRl6WPETMYMdp/Qnh5hQ4Mb9pG/vxDJbTjfecx8/zXj9g/9f2fI4DfOmkxEJJuycllDBD8tUuIEWo0IjRFUbPPzB2Yw3jxzeQ6VXZrDNUOUfmccrdGvp7NC3XrqCHMLdWPwalZSmKfkytisz6H2s6oqtW6dh9qeXK+rKvV9c3Yj/wFDAUcaXJx8gQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;hashicorp-cf&quot;
        title=&quot;hashicorp-cf&quot;
        src=&quot;/static/3d626fa1196054b17d629cc263a11bde/f058b/hashicorp-cf.png&quot;
        srcset=&quot;/static/3d626fa1196054b17d629cc263a11bde/c26ae/hashicorp-cf.png 158w,
/static/3d626fa1196054b17d629cc263a11bde/6bdcf/hashicorp-cf.png 315w,
/static/3d626fa1196054b17d629cc263a11bde/f058b/hashicorp-cf.png 630w,
/static/3d626fa1196054b17d629cc263a11bde/889a4/hashicorp-cf.png 658w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;上場でも大金を調達すると考えられるが、本業で稼げており（開示を読む限りは）運転資金の借り入れ枠もたくさんあるようなので、 &lt;a href=&quot;https://lyohe.github.io/post/2021-07-11-fastly-2/&quot;&gt;Fastly が上場後に Signal Sciences を買収したように&lt;/a&gt;何かしら買収等の大きな動きがあるのかもしれない。&lt;/p&gt;
&lt;p&gt;Fastly の場合は Edge の計算資源を活用して顧客の新たなユースケースを実現するという方向性の買収だったが、 HashiCorp の場合はマルチクラウドの運用課題を解決するような製品やサービスを増やすという方向性になりそうな気がする。&lt;/p&gt;
&lt;h3 id=&quot;おまけ-ストックオプション&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%81%8A%E3%81%BE%E3%81%91-%E3%82%B9%E3%83%88%E3%83%83%E3%82%AF%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3&quot; aria-label=&quot;おまけ ストックオプション permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;おまけ: ストックオプション&lt;/h3&gt;
&lt;p&gt;SO の未行使残高や直近2期の行使数は F-28 ページを見ると分かる。HashiCorp は2014年から SO を発行しておりそれらが 4-year vesting 1-year cliff とすると、最初の方はまるまる開示されていないので注意（つまり、既に普通株式に転換されている）。&lt;/p&gt;
&lt;p&gt;発行済普通株式と上場時に普通株式に転換される優先株式の数は F-27 ページに記載されている。&lt;/p&gt;
&lt;h2 id=&quot;感想&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%84%9F%E6%83%B3&quot; aria-label=&quot;感想 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;感想&lt;/h2&gt;
&lt;p&gt;HashiCorp の製品は Vagrant 以外全て Go で書かれているようだ。Go を書いた経験ほぼ無いけど、興味が出てきたので来年は Go の年にしようかな。&lt;/p&gt;
&lt;div class=&quot;footnotes&quot;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&quot;fn-1&quot;&gt;&lt;a href=&quot;https://www.vagrantup.com/&quot;&gt;Vagrant&lt;/a&gt; のみ MIT&lt;a href=&quot;#fnref-1&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;li id=&quot;fn-2&quot;&gt;GitLab については&lt;a href=&quot;https://lyohe.github.io/post/2021-09-26-gitlab-ipo/&quot;&gt;以前に記事を書いた&lt;/a&gt;ので興味があればぜひ。&lt;a href=&quot;#fnref-2&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;li id=&quot;fn-3&quot;&gt;無料顧客を除く（85ページ参照）&lt;a href=&quot;#fnref-3&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;li id=&quot;fn-4&quot;&gt;GitLab は ARR $5K 以上の顧客を Base Customers と定義している（&lt;a href=&quot;https://lyohe.github.io/post/2021-09-26-gitlab-ipo/#%E4%B8%BB%E8%A6%81%E3%81%AA%E7%B5%8C%E5%96%B6%E6%8C%87%E6%A8%99&quot;&gt;以前書いた記事&lt;/a&gt;）&lt;a href=&quot;#fnref-4&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;li id=&quot;fn-5&quot;&gt;HashiCorp は1月決算なので、 11/1 ~ 1/31&lt;a href=&quot;#fnref-5&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content:encoded></item><item><title><![CDATA[Firestore を使いたいので調べたことを記録する自分用の記事]]></title><description><![CDATA[せっかくプログラミングの仕事をしているので、自分でほしいアプリを自分で作ることにした。そのバックエンドとして Firebase を使うことを考えている。理由は3つある。 面倒な認証の実装を Firebase Authentication…]]></description><link>https://lyohe.github.io/2021-10-27-firestore-getting-started/</link><guid isPermaLink="false">https://lyohe.github.io/2021-10-27-firestore-getting-started/</guid><pubDate>Wed, 27 Oct 2021 13:26:42 GMT</pubDate><content:encoded>&lt;p&gt;せっかくプログラミングの仕事をしているので、自分でほしいアプリを自分で作ることにした。そのバックエンドとして Firebase を使うことを考えている。理由は3つある。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;面倒な認証の実装を Firebase Authentication で省略できるから&lt;/li&gt;
&lt;li&gt;データの保存先として Cloud Firestore が便利そうだから（&lt;a href=&quot;https://www.youtube.com/watch?v=QcsAb2RR52c&quot;&gt;動画&lt;/a&gt;）&lt;/li&gt;
&lt;li&gt;仕事で AWS を使うことがありそうなので、個人では Google Cloud を使ってみたかったから&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;アプリの開発には &lt;a href=&quot;https://expo.dev/&quot;&gt;React Native（Expo）&lt;/a&gt; を使うことにする。Expo の公式ドキュメントはとても充実しており、 &lt;a href=&quot;https://docs.expo.dev/guides/using-firebase/&quot;&gt;Expo アプリから Firebase を使うための初期設定ガイド&lt;/a&gt;も親切に用意されている。Expo の話はまた別に書きたい。 React Native ってどう使われてるの？という人は最近開催された &lt;a href=&quot;https://www.youtube.com/watch?v=OGsR3O4qu6s&quot;&gt;React Native Matsuri 2021 のアーカイブ動画&lt;/a&gt;を見るといいと思う。&lt;/p&gt;
&lt;p&gt;React Native の話は置いといて、 Firebase の中心（？）となるデータストアである Firestore について一通り調べてみたので、自分が気になったことを書き留めておいた。&lt;/p&gt;
&lt;h2 id=&quot;初期設定の手順&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%88%9D%E6%9C%9F%E8%A8%AD%E5%AE%9A%E3%81%AE%E6%89%8B%E9%A0%86&quot; aria-label=&quot;初期設定の手順 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;初期設定の手順&lt;/h2&gt;
&lt;p&gt;とりあえず動かしてみる。&lt;/p&gt;
&lt;p&gt;まずは Firebase のプロジェクトを作り、 Expo アプリ上で Firebase を使うための初期設定をしてみた。下記の手順で公式ドキュメントを見ながらやれば簡単にできそう。&lt;/p&gt;
&lt;h3 id=&quot;1-ドキュメントを読む&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1-%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88%E3%82%92%E8%AA%AD%E3%82%80&quot; aria-label=&quot;1 ドキュメントを読む permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;1. ドキュメントを読む&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://firebase.google.com/docs/firestore/quickstart?hl=ja&quot;&gt;公式の quick start&lt;/a&gt; を読む&lt;/li&gt;
&lt;li&gt;先に気になるところをざっと読んで概要を掴んでから試していくとよさそう&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;2-firebase-でプロジェクトを作成する&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#2-firebase-%E3%81%A7%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B&quot; aria-label=&quot;2 firebase でプロジェクトを作成する permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;2. Firebase でプロジェクトを作成する&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://firebase.google.com/docs/web/setup?hl=ja#create-project&quot;&gt;参考になりそうな公式のドキュメント&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Firebase コンソールからでも GCP コンソールからでも作れる&lt;/li&gt;
&lt;li&gt;どっちで作っても中身は同じ（&lt;a href=&quot;https://firebase.google.com/docs/projects/learn-more?hl=ja&quot;&gt;参考&lt;/a&gt;）&lt;/li&gt;
&lt;li&gt;GCP の管理コンソールで API Key を取得できるようになる
&lt;ul&gt;
&lt;li&gt;対象のプロジェクトを選んで「API &amp;#x26; Services &gt; Credentials」を見ると、自動生成された Key を取得できる&lt;/li&gt;
&lt;li&gt;auto created by Firebase とか書いてあるはず&lt;/li&gt;
&lt;li&gt;ここから新しく API Key を作ることもできる&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;3-開発用のマシンに-firebase-sdk-をインストールする&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#3-%E9%96%8B%E7%99%BA%E7%94%A8%E3%81%AE%E3%83%9E%E3%82%B7%E3%83%B3%E3%81%AB-firebase-sdk-%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B&quot; aria-label=&quot;3 開発用のマシンに firebase sdk をインストールする permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;3. 開発用のマシンに Firebase SDK をインストールする&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;普通は &lt;code class=&quot;language-text&quot;&gt;npm install&lt;/code&gt; や &lt;code class=&quot;language-text&quot;&gt;yarn add&lt;/code&gt; でインストールするが、 expo は &lt;code class=&quot;language-text&quot;&gt;expo install&lt;/code&gt; コマンドを使うのがよい&lt;/li&gt;
&lt;li&gt;こうすると、 expo SDK と互換性のあるバージョンをインストールしてくれるので助かる&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;4-firebase-にアプリを追加する&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#4-firebase-%E3%81%AB%E3%82%A2%E3%83%97%E3%83%AA%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B&quot; aria-label=&quot;4 firebase にアプリを追加する permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;4. Firebase にアプリを追加する&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://firebase.google.com/docs/web/setup?hl=ja#register-app&quot;&gt;参考になりそうな公式のドキュメント&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;このとき初期化用のコードが生成されるので後でコピペする&lt;/li&gt;
&lt;li&gt;Firebase SDK を使うためのクラスを定義しておくとよさそう（後述）&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;5-アプリ側で-firebase-を-initialize-する&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#5-%E3%82%A2%E3%83%97%E3%83%AA%E5%81%B4%E3%81%A7-firebase-%E3%82%92-initialize-%E3%81%99%E3%82%8B&quot; aria-label=&quot;5 アプリ側で firebase を initialize する permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;5. アプリ側で Firebase を initialize する&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;↑ でアプリ作成時に自動生成したコードを使う
&lt;ul&gt;
&lt;li&gt;API Key は公開しても良い（&lt;a href=&quot;https://firebase.google.com/docs/projects/api-keys&quot;&gt;参考&lt;/a&gt;）ので、コードに書いてリポジトリにコミットできる&lt;/li&gt;
&lt;li&gt;ただし、&lt;a href=&quot;https://firebase.google.com/docs/firestore/security/get-started?hl=ja&quot;&gt;セキュリティルール&lt;/a&gt;で適切なアクセス制御をしていない場合、 Firestore に対して意図しない不正なアクセスをされる恐れがある&lt;/li&gt;
&lt;li&gt;開発中は特に問題なさそう&lt;/li&gt;
&lt;li&gt;Firebase を initialize するための config、 Auth や Firestore のインスタンスを取得するコードをクラスにまとめておくと便利そう&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Cloud Functions やサーバーから Firestore を触る場合は Admin SDK が必要になる
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://firebase.google.com/docs/firestore/quickstart?hl=ja#node.js&quot;&gt;公式の Cloud Firestore スタートガイドの Node.js&lt;/a&gt; の箇所を見るのがよさそう&lt;/li&gt;
&lt;li&gt;Admin SDK はセキュリティルールの対象外となる（何でもできる）ので、取り扱いに注意する&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;今まで Firestore を使った経験はなかったのだが、ドキュメントや記事を読む限りでは普通のデータベースとだいぶ勝手が違っており（例えばスキーマが無い）、将来的に他に移行するのが大変そうという印象がある。&lt;/p&gt;
&lt;h2 id=&quot;firebase-sdk-を扱うクライアントのクラス&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#firebase-sdk-%E3%82%92%E6%89%B1%E3%81%86%E3%82%AF%E3%83%A9%E3%82%A4%E3%82%A2%E3%83%B3%E3%83%88%E3%81%AE%E3%82%AF%E3%83%A9%E3%82%B9&quot; aria-label=&quot;firebase sdk を扱うクライアントのクラス permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Firebase SDK を扱うクライアントのクラス&lt;/h2&gt;
&lt;p&gt;初期設定の 4. で書いたが、 Firebase SDK を扱うクライアント用のクラスを作成しておき、これのインスタンスを使い回すようにするとよさそう（実際は auth とかの実装も必要なはずだが最低限はこれで動く）。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ts&quot;&gt;&lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; firebase &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;firebase/app&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;firebase/firestore&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; firebaseConfig &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;../../config/dev&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// Firebase の apiKey 等の設定を別ファイルに分けておいて import するとよさそう&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Firebase&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; _instance&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Firebase&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; _store&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; firebase&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;firestore&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Firestore&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;constructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    firebase&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;initializeApp&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;firebaseConfig&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_store &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; firebase&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;firestore&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;get&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;instance&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Firebase &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_instance&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_instance &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Firebase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_instance&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;get&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;store&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; firebase&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;firestore&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Firestore &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_store &lt;span class=&quot;token operator&quot;&gt;??&lt;/span&gt; firebase&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;firestore&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;これを static メソッドとして、データを Firestore に投稿する際には&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ts&quot;&gt;&lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; Firebase&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;instance&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;store&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;collection&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;コレクション名&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;doc&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;ドキュメント名&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;フィールド&apos;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;値&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;フィールド&apos;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;値&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;みたいに呼び出して使うイメージ。これで singleton 的に？インスタンスを使い回すことができる。&lt;/p&gt;
&lt;p&gt;これを使って&lt;a href=&quot;https://firebase.google.com/docs/firestore/quickstart?hl=ja&quot;&gt;スタートガイド&lt;/a&gt;を参考にアプリから適当なデータを Firestore に投稿し、それを別の画面で読み取れるようになった。いろいろメモしたのだが、正直このガイドを見れば十分なので特に書くべきことはなかった。&lt;/p&gt;
&lt;h2 id=&quot;firestore-のデータモデル&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#firestore-%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E3%83%A2%E3%83%87%E3%83%AB&quot; aria-label=&quot;firestore のデータモデル permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Firestore のデータモデル&lt;/h2&gt;
&lt;p&gt;データモデルは通常の RDB とだいぶ違うので注意が必要。&lt;/p&gt;
&lt;p&gt;Firestore は &lt;code class=&quot;language-text&quot;&gt;ドキュメント&lt;/code&gt; と &lt;code class=&quot;language-text&quot;&gt;コレクション&lt;/code&gt; それから &lt;code class=&quot;language-text&quot;&gt;リファレンス&lt;/code&gt; という3つの概念でデータを管理する。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;ドキュメント&lt;/code&gt;は普通の RDB における「レコード」のようなもので、key と value の組み合わせを格納する
&lt;ul&gt;
&lt;li&gt;JSON のように内部でネストして複雑な構造を作ることもできる&lt;/li&gt;
&lt;li&gt;ドキュメント内にコレクションを持つこともでき、これは &lt;code class=&quot;language-text&quot;&gt;サブコレクション&lt;/code&gt; と呼ばれる&lt;/li&gt;
&lt;li&gt;ドキュメントはその key および value としてドキュメントを持つことはできない&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;コレクション&lt;/code&gt; はドキュメントをまとめた「テーブル」のようなもので、多数のドキュメントを特定の名前（例: users というコレクションでアプリのユーザーに関する user ドキュメントを…）でまとめておくことができる
&lt;ul&gt;
&lt;li&gt;完全にスキーマレスで、各ドキュメントは異なるフィールドを持つことができる&lt;/li&gt;
&lt;li&gt;ドキュメントと組み合わせて階層的なデータ構造を作ることができる（&lt;a href=&quot;https://firebase.google.com/docs/firestore/data-model?hl=ja&quot;&gt;参考&lt;/a&gt;）&lt;/li&gt;
&lt;li&gt;コレクションが持てるのはドキュメントのみ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Reference&lt;/code&gt; はドキュメントやコレクションを参照するだけの軽量なオブジェクト
&lt;ul&gt;
&lt;li&gt;これを通じてデータの追加や更新、削除を行う&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;データを初めて追加したときに「暗黙的に」ドキュメントやコレクションが追加されるため、管理コンソール等を通じて明示的に作成する必要はない。&lt;/p&gt;
&lt;h2 id=&quot;firestore-のセキュリティルール&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#firestore-%E3%81%AE%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%83%AB%E3%83%BC%E3%83%AB&quot; aria-label=&quot;firestore のセキュリティルール permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Firestore のセキュリティルール&lt;/h2&gt;
&lt;p&gt;実は上記の「暗黙的な追加」はテスト用のデータベースを「セキュリティルール」無しで作ったときの挙動である。&lt;/p&gt;
&lt;p&gt;Firestore の「セキュリティルール」を「ロックモード」にしてデータを追加しようとすると、無効な操作として次のようなエラーを吐く。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;[Unhandled promise rejection: FirebaseError: Missing or insufficient permissions.]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Firestore ではプロジェクトの追加時にセキュリティルールの開始モードを「テストモード」と「ロックモード」の2種類から選択でき、ロックモードのときは全ての読み書きを拒否する。テストモードでは全ての読み書きを通す。&lt;/p&gt;
&lt;p&gt;ロックモードでプロジェクトを開始し管理コンソールで Firestore のセキュリティルールを見ると、次のようなルールが書かれている。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;rules_version = &apos;2&apos;;
service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
      allow read, write: if false;
    }
  }
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;基本的には &lt;code class=&quot;language-text&quot;&gt;match&lt;/code&gt; 式で記述したドキュメントorコレクションへの path に &lt;code class=&quot;language-text&quot;&gt;allow&lt;/code&gt; していく。より詳しい書き方は&lt;a href=&quot;(https://cloud.google.com/firestore/docs/security/get-started)&quot;&gt;公式ドキュメント&lt;/a&gt;を参照。&lt;/p&gt;
&lt;p&gt;5行目の &lt;code class=&quot;language-text&quot;&gt;if false;&lt;/code&gt; を &lt;code class=&quot;language-text&quot;&gt;if true;&lt;/code&gt; にするとテストモードと同じルールになり、全ての読み書きが承認される。これは本番環境では絶対にやってはいけない。また、 &lt;code class=&quot;language-text&quot;&gt;if false;&lt;/code&gt; を &lt;code class=&quot;language-text&quot;&gt;if request.auth != null;&lt;/code&gt; にすると認証を必須にできる。&lt;/p&gt;
&lt;p&gt;なお、アクセス制御だけでなくデータの検証（例えばこのフィールドには 1 以上 5 未満の数字が入る…など）も定義できる。&lt;/p&gt;
&lt;h3 id=&quot;なぜセキュリティルールがあるのか&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%81%AA%E3%81%9C%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%83%AB%E3%83%BC%E3%83%AB%E3%81%8C%E3%81%82%E3%82%8B%E3%81%AE%E3%81%8B&quot; aria-label=&quot;なぜセキュリティルールがあるのか permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;なぜセキュリティルールがあるのか？&lt;/h3&gt;
&lt;p&gt;このセキュリティルールとは、要するにデータの保護ポリシーである。クライアントから送られるデータは信頼できないので、セキュリティルールでデータの機密性と完全性を担保する。&lt;/p&gt;
&lt;p&gt;しかし何故このような仕組みになっているのか。&lt;/p&gt;
&lt;p&gt;Firestore ではサーバーレスで、直接クライアント（SDK）とデータのやり取りをする。通常の Web アプリケーションではクライアントとデータベースの間に Web サーバー的なプロキシがあって、不正なリクエストはそこで弾くような実装をする。つまり、データベースはサーバーの裏に隠されておりユーザーが直接データベースに書き込むことは無い。&lt;/p&gt;
&lt;p&gt;しかし Firestore にはそのレイヤーがなく、 SDK を通じて API を呼び出すために必要な情報は全てアプリにバンドルされている。つまり、セキュリティルールが存在しない場合（アプリから Firestore の操作をする導線が一切なくても）アプリから入手した API Key 等を使って好き勝手に Firestore のデータを読み出したり書き換えることができる。これは非常に危険なので、セキュリティルールを通じてデータのアクセス制御を行う。&lt;/p&gt;
&lt;p&gt;セキュリティルールで実現できることは以下の動画が大変わかりやすい。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=eW5MdE3ZcAw&quot;&gt;Security Rules! 🔑 | Get to know Cloud Firestore #6&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;実装の方針&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%AE%9F%E8%A3%85%E3%81%AE%E6%96%B9%E9%87%9D&quot; aria-label=&quot;実装の方針 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;実装の方針&lt;/h3&gt;
&lt;p&gt;ドキュメントや動画を見ることでセキュリティルールが何のために存在するのか、どういう書式で何を書くべきか、どうやってデプロイするかは理解できた。しかし、詳細なルールの設定をする前にアプリ全体でどういうデータを持ち、それらをどのような画面からどのように処理するかを固める必要がありそうなので、実際に適用するセキュリティルールは後で考えることにした。この辺の話は別で書きたい。&lt;/p&gt;
&lt;p&gt;ちなみにサーバーや Cloud Functions から Firestore の操作をするときは普通に IAM を使って権限を制御する（&lt;a href=&quot;https://cloud.google.com/firestore/docs/security/iam&quot;&gt;参考&lt;/a&gt;）。&lt;/p&gt;
&lt;p&gt;Firebase のセキュリティに関しては以下のブログが参考になりそう。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://flattsecurity.hatenablog.com/entry/2020/04/10/122834&quot;&gt;Firebaseにおけるセキュリティの概要と実践 - Flatt Security Blog&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://flattsecurity.hatenablog.com/entry/firestore_security_rules&quot;&gt;Firestoreセキュリティルールの基礎と実践 - セキュアな Firebase活用に向けたアプローチを理解する - Flatt Security Blog&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;firestore-のデータ構造を設計する上での注意点&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#firestore-%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E6%A7%8B%E9%80%A0%E3%82%92%E8%A8%AD%E8%A8%88%E3%81%99%E3%82%8B%E4%B8%8A%E3%81%A7%E3%81%AE%E6%B3%A8%E6%84%8F%E7%82%B9&quot; aria-label=&quot;firestore のデータ構造を設計する上での注意点 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Firestore のデータ構造を設計する上での注意点&lt;/h2&gt;
&lt;p&gt;通常の RDBMS を用いた Web アプリケーションであれば、データベースに保存するデータは正規化して重複を排除するようなデータ構造にしておき、必要に応じて結合して使う。しかし Firestore でそれを実践しようとすると難しい。&lt;/p&gt;
&lt;p&gt;Firestore には JOIN が無い（！）ので、結合をやろうとすると必要なデータを取得した上でクライアント側で結合する必要がある。不可能ではないが、特定のビューを組み立てるために複数の異なるコレクションからデータを取得するクエリを発行するのは効率が悪い。さらに、クライアント側で複雑なビジネスロジックを記述しなければならないので、作るのも後から修正するのも大変になる。&lt;/p&gt;
&lt;p&gt;そこで、 Firestore（や一般的な NoSQL データベース）では基本的に使う形でそのままデータを保存する。よって、同じデータが複数のドキュメントに重複して存在するような構造になる可能性がある。なお、 Firebase のクエリはデフォルトで shallow な挙動をするので、あるドキュメントにサブコレクションが保持されていても明示的にそれを指定しない限り取得はされない。これは Firebase Realtime Database と Firestore の最大の違いでもある。&lt;/p&gt;
&lt;p&gt;Firestore のデータ構造については以下の動画が参考になる。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=v_hR4K4auoQ&quot;&gt;NoSQLデータベースとCloud Firestoreの構造を知ろう| Get to know Cloud Firestore #1&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Firestore のクエリには制約がいろいろある。JOIN 以外に驚いたのが &lt;code class=&quot;language-text&quot;&gt;OR&lt;/code&gt; が無いこと。他にもいろいろあるので注意。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://firebase.google.com/docs/firestore/query-data/queries#query_limitations&quot;&gt;https://firebase.google.com/docs/firestore/query-data/queries#query_limitations&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;インデックス&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%82%A4%E3%83%B3%E3%83%87%E3%83%83%E3%82%AF%E3%82%B9&quot; aria-label=&quot;インデックス permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;インデックス&lt;/h3&gt;
&lt;p&gt;Firestore はドキュメントをコレクションに追加したとき、デフォルトで全てのフィールドに対してインデックスを作成する。これにより、ドキュメントやコレクションを横断して特定の条件を満たすフィールドを検索するのが速くなる。&lt;/p&gt;
&lt;p&gt;複数の条件を OR 指定するクエリはない。これを高速に処理するには、 OR 条件を満たすフィールドを追加する。&lt;/p&gt;
&lt;p&gt;複数の条件を AND 指定した場合は「ジグザグマージ結合」が行われる（&lt;a href=&quot;https://developers-jp.googleblog.com/2019/10/why-is-my-cloud-firestore-query-slow.html&quot;&gt;この記事&lt;/a&gt;の理由3を参照）。しかし、この記事にもある通り、これはソートされた複数のインデックスの間を行き来して結果を結合するので、クエリ対象のデータ間に共通点が少なすぎる場合は効率が悪くなってしまう。&lt;/p&gt;
&lt;p&gt;それを改善する手段として「&lt;a href=&quot;https://firebase.google.com/docs/firestore/query-data/index-overview?hl=ja#composite_indexes&quot;&gt;複合インデックス&lt;/a&gt;」がある。通常のインデックスと違い、 Firestore は自動では複合インデックスを作らないので自分で作る必要がある。なぜデフォルトではないかというと、複合インデックスは全ての場合でクエリのパフォーマンス向上につながるとは限らないかららしい。&lt;/p&gt;
&lt;p&gt;効率的なクエリやインデックスの詳しい話は以下の動画が参考になる。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=Ofux_4c94FI&quot;&gt;How do queries work in Cloud Firestore? | Get to know Cloud Firestore #2&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;課金---pricing&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%AA%B2%E9%87%91---pricing&quot; aria-label=&quot;課金   pricing permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;課金 - Pricing&lt;/h3&gt;
&lt;p&gt;Firestore は &lt;a href=&quot;https://cloud.google.com/firestore/pricing&quot;&gt;Read/Write/Delete クエリの実行回数に応じて課金される&lt;/a&gt;ので、効率の良いクエリは節約につながる。料金の計算にはいろいろ注意が必要…&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Read&lt;/code&gt;: 検索対象のボリュームによらず、クライアントに返すドキュメントが1つであれば1回、ドキュメントが20個であれば20回分の料金になる
&lt;ul&gt;
&lt;li&gt;つまり、ページネーションを実装する等して「必要ないデータを取得しないこと」が非常に重要&lt;/li&gt;
&lt;li&gt;クエリの結果をクライアントでリッスンする場合、結果セット内のドキュメントが追加または更新されるたびに Read として課金される&lt;/li&gt;
&lt;li&gt;セキュリティルールでドキュメントの読み取りが発生する場合、それも Read として課金される&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Write&lt;/code&gt;: あるドキュメントのある1箇所のフィールドを更新するのも同じドキュメント内で30箇所のフィールドを更新するのも同じ料金になる&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Delete&lt;/code&gt;: 削除したドキュメント数に比例する&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;このようなルールは、作るアプリによっては実装に大きな影響を与える可能性がある。&lt;/p&gt;
&lt;p&gt;例えば LINE のようなチャットアプリで5秒に1度ルームにメッセージを送ることを考えると、参加者が2人なら1分あたり &lt;code class=&quot;language-text&quot;&gt;2 * 60/5 = 24&lt;/code&gt; 回の書き込みと &lt;code class=&quot;language-text&quot;&gt;2 * 24 = 48&lt;/code&gt; 回の読み込みが発生する。しかし、これが n 人なら &lt;code class=&quot;language-text&quot;&gt;n * 60/5 = 12n&lt;/code&gt; 回の書き込みと &lt;code class=&quot;language-text&quot;&gt;n * 12n = 12 * n^2&lt;/code&gt; 回の読み込みが発生する。つまり、指数関数的に課金額が増加していく。&lt;/p&gt;
&lt;p&gt;このようなケースでは書き込みの度に読み込ませるのではなく、 Cloud Functions で一定間隔ごとにメッセージを一括更新しまとめて読み込ませるのがよさそうだ。&lt;/p&gt;
&lt;p&gt;課金額を抑える方法については以下の動画が参考になる。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=6NegFl9p_sE&quot;&gt;Cloud Firestore Pricing | Get to know Cloud Firestore #3&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;これは結構注意していても課金で爆死する匂いがするので Budget や Alert 的な閾値を設定しておいた方がよさそう。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://firebase.google.com/docs/firestore/monitor-usage&quot;&gt;https://firebase.google.com/docs/firestore/monitor-usage&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;ドキュメントの制約&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88%E3%81%AE%E5%88%B6%E7%B4%84&quot; aria-label=&quot;ドキュメントの制約 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;ドキュメントの制約&lt;/h2&gt;
&lt;p&gt;Firestore のドキュメントには様々な制約がある。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;1つのドキュメントには 1MB までしか入れられず、インデックスの数は 40,000 まで
&lt;ul&gt;
&lt;li&gt;このような制限が設けられている理由は、 Firestore がデータの追加時に全てのフィールドに対してインデックスを作るから&lt;/li&gt;
&lt;li&gt;ドキュメントの更新時にはインデックスを再構築するため、多すぎるフィールドは Write のパフォーマンスに悪影響をもたらす&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;同じドキュメントに対して Write できるのは1秒に1回のみ&lt;/li&gt;
&lt;li&gt;ドキュメントの取得時にはそのドキュメントの全てのフィールドを取得し、一部分だけを取得することはできない
&lt;ul&gt;
&lt;li&gt;Firestore のクエリのパフォーマンスは対象となるデータセットのサイズではなく結果セットのサイズに比例する&lt;/li&gt;
&lt;li&gt;つまり、この点でも一つのドキュメントに必要以上のデータを詰め込むことは得策ではない&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Firestore のクエリは shallow で、明示的に指定したドキュメントのみを取得しそのサブコレクションは取得しない
&lt;ul&gt;
&lt;li&gt;つまり、一緒に使うデータはサブコレクションに分けるのではなく同じドキュメントに詰めるのがよい&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Array の特定の位置に要素を挿入、更新、削除することはできない
&lt;ul&gt;
&lt;li&gt;Array 内の要素を追加するには arrayUnion()、削除するには arrayRemove() を使う&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ドキュメントの構造や制約については以下の動画が参考になる。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=o7d5Zeic63s&quot;&gt;Maps, Arrays and Subcollections, Oh My! | Get to know Cloud Firestore #4&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;ドキュメント設計の工夫&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88%E8%A8%AD%E8%A8%88%E3%81%AE%E5%B7%A5%E5%A4%AB&quot; aria-label=&quot;ドキュメント設計の工夫 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;ドキュメント設計の工夫&lt;/h3&gt;
&lt;p&gt;これらの制約や Firestore の特性から、 Firestore のドキュメント - コレクションのデータ構造設計は多少の工夫が必要になる。&lt;/p&gt;
&lt;p&gt;例えば特定の画面を構成するのに必要で読み込みの頻度が多く書き込みの頻度が少ないデータは非正規化して持ち、 Cloud Functions 等でまとめて更新して整合性を保つ。&lt;/p&gt;
&lt;p&gt;階層的な関係にあるデータであっても、それが異なるドキュメント間で N:N の関係にあるのであれば、それぞれとそのマッピング（例: Users, Restaurants, FavoriteRestaurants）をトップレベルのコレクションとして持つのがよい。&lt;/p&gt;
&lt;p&gt;データ構造の工夫については以下の動画が参考になる。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=haMOUb3KVSo&quot;&gt;How to Structure Your Data | Get to know Cloud Firestore #5&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;非正規化したデータの更新には Cloud Functions を使う。使い方については以下の動画が参考になる。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=rERRuBjxJ80&quot;&gt;How do Cloud Functions work? | Get to know Cloud Firestore #11&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;ページネーション&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%83%9A%E3%83%BC%E3%82%B8%E3%83%8D%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3&quot; aria-label=&quot;ページネーション permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;ページネーション&lt;/h3&gt;
&lt;p&gt;Firestore ではドキュメントの取得回数に応じて課金されるので、ページネーションが重要になる。また、ユーザー体験的にも必要な分だけ取得できたほうがよい。最後のドキュメントを previousDoc として次のクエリで &lt;code class=&quot;language-text&quot;&gt;.start(after: previousDoc)&lt;/code&gt; 的な使い方が多そう。&lt;/p&gt;
&lt;p&gt;以下の動画にだいたい説明されている。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=poqTHxtDXwU&quot;&gt;How Do I Paginate My Data? | Get to know Cloud Firestore #7&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;トランザクション&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%83%88%E3%83%A9%E3%83%B3%E3%82%B6%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3&quot; aria-label=&quot;トランザクション permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;トランザクション&lt;/h2&gt;
&lt;p&gt;Firestore では、「全ての操作が成功する」か「いずれも適用されない」という操作を行うための atomic な処理が2種類用意されている。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Transaction&lt;/code&gt;: 1つまたは複数のドキュメントに対する読み取りと書き込みの操作&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Batch Write&lt;/code&gt;: 1つまたは複数のドキュメントに対する一連の書き込み操作&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Batch Write の利点は、読み取りができない代わりに読み取り起因の失敗がないこと、全てのクライアントがオフラインでも実行できることがある。&lt;/p&gt;
&lt;p&gt;両者には幾つかの注意点がある。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Reads Before Write&lt;/strong&gt;: 書く前に読む&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;No Side Effects&lt;/strong&gt;: retry の可能性があるので、副作用をトランザクション内で実行しない&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Don’t Go Overboard&lt;/strong&gt;: 関係ないドキュメントをトランザクション内に入れない（ロックによるパフォーマンス低下など、デメリットしかない）&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;No Offline Support&lt;/strong&gt;: トランザクションはクライアントがオフライン状態のとき必ず失敗する&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;500 Documents&lt;/strong&gt;: 1トランザクションで処理できるドキュメントの上限数は 500&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;5 の制限により、 500 を超える数のドキュメントを一つの Transaction/Batch Write で更新することはできず、複数回に分けて実行することになる。トランザクションについては以下の動画が参考になる。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=dOVSr0OsAoU&quot;&gt;How do Transactions Work? | Get to know Cloud Firestore #8&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;オフラインサポート&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%82%AA%E3%83%95%E3%83%A9%E3%82%A4%E3%83%B3%E3%82%B5%E3%83%9D%E3%83%BC%E3%83%88&quot; aria-label=&quot;オフラインサポート permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;オフラインサポート&lt;/h2&gt;
&lt;p&gt;Firestore にはオフラインサポートという機能がある。端末がインターネットから切断しても、オフラインでキャッシュを保持してそれをいい感じに Firestore に反映してくれる。オフラインキャッシュは無制限ではなく（とはいえ通常の使用では気にしなくてもいいサイズらしい）、最も使われていないデータから消されていく。&lt;/p&gt;
&lt;p&gt;ちなみに、 Firestore にはインデックスがあるがキャッシュにはそれが無いので、巨大なデータをクライアント側のキャッシュで扱うのは得策ではない。小さなデータで変更の頻度が少なければオフラインに持っておくことで節約になるかもしれないが、ほとんどのケースではそのような使い方はユーザー体験の悪化を招きそうだ。&lt;/p&gt;
&lt;p&gt;なお、オフラインサポートは iOS/Android ではデフォルトで有効だが、 Web では少しだけコードを書く必要がある。オフラインサポートについては以下の動画が参考になる。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=oDvdAFP6OhQ&quot;&gt;How do I Enable Offline Support? | Get to know Cloud Firestore #9&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;リアルタイムリスナー&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%83%AA%E3%82%A2%E3%83%AB%E3%82%BF%E3%82%A4%E3%83%A0%E3%83%AA%E3%82%B9%E3%83%8A%E3%83%BC&quot; aria-label=&quot;リアルタイムリスナー permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;リアルタイムリスナー&lt;/h2&gt;
&lt;p&gt;Firestore には「リアルタイムリスナー」と呼ばれる仕組みがあり、ドキュメントに対する変更を検知することができる。&lt;/p&gt;
&lt;p&gt;これによって明示的に fetch しなくても新しいデータを取得できユーザー体験が格段によくなるため、特に理由がなければこれを使うべきだろう。しかし、以下の点に注意する必要がある。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;必要以上のデータをダウンロードしない（その分課金されるので）
&lt;ul&gt;
&lt;li&gt;ドキュメントを適切に設計する
&lt;ul&gt;
&lt;li&gt;サブコレクションに入れておくなど&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;必要ないときはリスナーを deactivate する
&lt;ul&gt;
&lt;li&gt;例えば、コンポーネントを生成時に listen するならコンポーネントがなくなるときに切る&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;リアルタイムリスナーはバックグラウンドで動作しない
&lt;ul&gt;
&lt;li&gt;つまり、ユーザーが戻ってきたときは多少のロードが必要になる&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;リアルタイムリスナーについては以下の動画が参考になる。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=3aoxOtMM2rc&quot;&gt;リアルタイムを使うかどうか | Cloud Firestore を知ろう＃10&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;firestore-のデータ設計まとめ&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#firestore-%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E8%A8%AD%E8%A8%88%E3%81%BE%E3%81%A8%E3%82%81&quot; aria-label=&quot;firestore のデータ設計まとめ permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Firestore のデータ設計まとめ&lt;/h2&gt;
&lt;p&gt;まとめると、 Firestore は以下の点に注意して使う必要がありそうだ。&lt;/p&gt;
&lt;h3 id=&quot;画面にそのまま使えるような構造にデータをモデリングする&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%94%BB%E9%9D%A2%E3%81%AB%E3%81%9D%E3%81%AE%E3%81%BE%E3%81%BE%E4%BD%BF%E3%81%88%E3%82%8B%E3%82%88%E3%81%86%E3%81%AA%E6%A7%8B%E9%80%A0%E3%81%AB%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E3%83%A2%E3%83%87%E3%83%AA%E3%83%B3%E3%82%B0%E3%81%99%E3%82%8B&quot; aria-label=&quot;画面にそのまま使えるような構造にデータをモデリングする permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;画面にそのまま使えるような構造にデータをモデリングする&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Firestore にはクライアントから直接アクセスする、かつ JOIN が無い
&lt;ul&gt;
&lt;li&gt;つまり、画面を組み立てるのにデータの加工が必要な場合はクライアント側でしなければならない&lt;/li&gt;
&lt;li&gt;さらに、データが複数のドキュメントに分かれていると複数回のクエリが必要になる&lt;/li&gt;
&lt;li&gt;データの重複を許容して非正規化し画面ごとにドキュメントを用意することで、パフォーマンスが上がり課金額は下がる&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;全てのケースで非正規化が有効というわけではない
&lt;ul&gt;
&lt;li&gt;時間の経過やアプリの利用とともにデータが増えていく場合、後述の Cloud Functions による更新が難しくなっていく&lt;/li&gt;
&lt;li&gt;このような場合では、
&lt;ul&gt;
&lt;li&gt;ドキュメント間の関係性を表現する「リファレンス型」をドキュメントのフィールドとして持つことで JOIN っぽいドキュメント取得を行う
&lt;ul&gt;
&lt;li&gt;Read が増えるので万能ではない&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;更新の頻度を抑えるような仕様をアプリに追加する&lt;/li&gt;
&lt;li&gt;一定期間を過ぎたデータをクライアントから取得できないようにする&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;1:1 の関係性を表現する場合は、同一の id をドキュメントに割り当てる&lt;/li&gt;
&lt;li&gt;1:n の場合は…以下のいずれかを行う
&lt;ul&gt;
&lt;li&gt;ドキュメントのサブコレクション、もしくは&lt;a href=&quot;https://firebase.google.com/docs/firestore/query-data/queries?hl=ja#collection-group-query&quot;&gt;コレクショングループ（同じ id を持つコレクション）&lt;/a&gt;として持つ&lt;/li&gt;
&lt;li&gt;リファレンス型を持つフィールドを用意する&lt;/li&gt;
&lt;li&gt;ドキュメント内のフィールドで非正規化して持つ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;ドキュメントは大きくしすぎない&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88%E3%81%AF%E5%A4%A7%E3%81%8D%E3%81%8F%E3%81%97%E3%81%99%E3%81%8E%E3%81%AA%E3%81%84&quot; aria-label=&quot;ドキュメントは大きくしすぎない permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;ドキュメントは大きくしすぎない&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Firestore ではデータをドキュメント単位で取得し、ドキュメント内の一部のフィールドのみを取得するような操作ができないため&lt;/li&gt;
&lt;li&gt;フィールド数が増えるとその分だけスキーマやデータの検証も複雑になる&lt;/li&gt;
&lt;li&gt;ドキュメントには保持できるサイズ（1MB）、フィールドの数（40,000）に制約がある
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://firebase.google.com/docs/firestore/quotas?hl=ja&quot;&gt;他にも様々な制約がある&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;増え続けるデータはサブコレクションに隔離する&lt;/li&gt;
&lt;li&gt;「画面にそのまま使えるような設計」とは対立する可能性がある
&lt;ul&gt;
&lt;li&gt;CQRS 的に（？）読み取り用のドキュメントと書き込み用のドキュメントを分離するのもいいかもしれない
&lt;ul&gt;
&lt;li&gt;この場合、副次的なメリットもある
&lt;ul&gt;
&lt;li&gt;セキュリティルールの記述が簡潔になる&lt;/li&gt;
&lt;li&gt;書き込みの履歴を残すことができる&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;読み取りと書き込みを分離するデメリットとして、書き込み用ドキュメントの更新をトリガーにして Cloud Functions で読み取り用のドキュメントを更新することで整合性を保つ必要がある&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;非正規化されたデータを一斉に更新する際は-cloud-functions-を使う&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E9%9D%9E%E6%AD%A3%E8%A6%8F%E5%8C%96%E3%81%95%E3%82%8C%E3%81%9F%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E4%B8%80%E6%96%89%E3%81%AB%E6%9B%B4%E6%96%B0%E3%81%99%E3%82%8B%E9%9A%9B%E3%81%AF-cloud-functions-%E3%82%92%E4%BD%BF%E3%81%86&quot; aria-label=&quot;非正規化されたデータを一斉に更新する際は cloud functions を使う permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;非正規化されたデータを一斉に更新する際は Cloud Functions を使う&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;以下の点に注意する
&lt;ul&gt;
&lt;li&gt;セキュリティルールの対象外となるので、 Firestore のセキュリティルールで設定したスキーマやデータの検証をすり抜ける可能性がある&lt;/li&gt;
&lt;li&gt;1トランザクションで更新できるドキュメント数には 500 までという制限がある&lt;/li&gt;
&lt;li&gt;更新中はドキュメントをロックするのでパフォーマンスが落ちる&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;ドキュメント内で-access-level-が異なる情報を保持してはならない&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88%E5%86%85%E3%81%A7-access-level-%E3%81%8C%E7%95%B0%E3%81%AA%E3%82%8B%E6%83%85%E5%A0%B1%E3%82%92%E4%BF%9D%E6%8C%81%E3%81%97%E3%81%A6%E3%81%AF%E3%81%AA%E3%82%89%E3%81%AA%E3%81%84&quot; aria-label=&quot;ドキュメント内で access level が異なる情報を保持してはならない permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;ドキュメント内で access level が異なる情報を保持してはならない&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;住所や支払情報など&lt;/li&gt;
&lt;li&gt;Firestore ではデータの検証やアクセスレベルの管理には必ずセキュリティルールを使う&lt;/li&gt;
&lt;li&gt;セキュリティルールはドキュメント単位で設定される&lt;/li&gt;
&lt;li&gt;また、ドキュメントの一部取得を担保することは不可能（表示上は一部しか使わなくとも、クエリとしては完全なドキュメントを取得している&lt;/li&gt;
&lt;li&gt;ドキュメントを分け、必要ならリファレンスとして持つ
&lt;ul&gt;
&lt;li&gt;リファレンスはセキュリティルールで保護できるので access level が異なってもよい&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[GitLab が上場するので Form S-1 を読んだ話]]></title><description><![CDATA[8年ほど前だったか、お金のない会社で働いていたとき、社内で GitLab という OSS を使っている人たちがいた。  当時の私は経理の仕事をしておりプログラムは書いていなかったが、 GitHub…]]></description><link>https://lyohe.github.io/2021-09-26-gitlab-ipo/</link><guid isPermaLink="false">https://lyohe.github.io/2021-09-26-gitlab-ipo/</guid><pubDate>Sun, 26 Sep 2021 04:17:09 GMT</pubDate><content:encoded>&lt;p&gt;8年ほど前だったか、お金のない会社で働いていたとき、社内で GitLab という OSS を使っている人たちがいた。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/2028e9619927ff904c2ebf06796c1525/9f82e/gitlab-logo.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 36.075949367088604%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABNElEQVQoz5WRvUoDURCF8xoWYmElKPgI2vsANmJr4QuIhQ8giDYW2lmJnXYprOxi/MtGs5vsT1ZDyN9m4ybB6O69n9zNxqgEwQOHO+ceZpjDpACklCCFKpAiQkaR+kWOvG8YafX+pkJq2Azd9AWDQi6uP17KBOenyQRBr9cniqKvJiEEk6D8lExMb2udzv42kd8mODmgsbES/5u2i+080/Y7FE0npu+/EoYhjaZHySpTqdbGA+Ni4CEOF+ivTeMszxOsziD2Zol8A013MS2HB03n+lZDeypSb7RotjzSl1dk7/JksjmCbi+JHOcH6ZwR7i5SW5rifWcOoR+pcFSqdW7u8zhuJaZpuRQMC71ok3s0MEp2rNXGPwbGm7Z13o43EZXMUPM/jCMn1/1hKj3hkn9RbfgJg9kMJB+E6hQAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;gitlab-logo&quot;
        title=&quot;gitlab-logo&quot;
        src=&quot;/static/2028e9619927ff904c2ebf06796c1525/f058b/gitlab-logo.png&quot;
        srcset=&quot;/static/2028e9619927ff904c2ebf06796c1525/c26ae/gitlab-logo.png 158w,
/static/2028e9619927ff904c2ebf06796c1525/6bdcf/gitlab-logo.png 315w,
/static/2028e9619927ff904c2ebf06796c1525/f058b/gitlab-logo.png 630w,
/static/2028e9619927ff904c2ebf06796c1525/9f82e/gitlab-logo.png 820w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;当時の私は経理の仕事をしておりプログラムは書いていなかったが、 GitHub は辛うじて知っていた。プログラムを共有するための場所で、基本無料だがプライベートリポジトリ（権限を持っている人しか見られない場所）を作ろうとするとお金がかかった。&lt;sup id=&quot;fnref-1&quot;&gt;&lt;a href=&quot;#fn-1&quot; class=&quot;footnote-ref&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;p&gt;自分でサーバーに GitLab をインストールすると「無料」で Git を中心にした開発フローが作れるので、とにかくお金がない会社にとってはありがたい存在だったと思う。それから8年ほどが経ち、 GitLab が Nasdaq に上場することになった。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://techcrunch.com/2021/09/17/inside-gitlabs-ipo-filing/&quot;&gt;https://techcrunch.com/2021/09/17/inside-gitlabs-ipo-filing/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;この記事によれば GitLab の時価総額はおよそ $6B で、これは2018年に Microsoft が GitHub を買収したときの時価総額 $7.5B に近い。金額は不明だが GitHub の買収には Control Premium が乗っているはずなので、この時価総額はいかに GitLab が高く評価されているかを表していると思う。&lt;/p&gt;
&lt;p&gt;自分の中では未だに「お金のない会社が使う GitHub」という印象があり、なぜ高く評価されているのかが不思議だったので &lt;a href=&quot;https://www.sec.gov/Archives/edgar/data/0001653482/000162828021018818/gitlab-sx1.htm&quot;&gt;Form S-1&lt;/a&gt; を読むことにした。&lt;/p&gt;
&lt;h2 id=&quot;本記事内における金額や決算期の表記&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%9C%AC%E8%A8%98%E4%BA%8B%E5%86%85%E3%81%AB%E3%81%8A%E3%81%91%E3%82%8B%E9%87%91%E9%A1%8D%E3%82%84%E6%B1%BA%E7%AE%97%E6%9C%9F%E3%81%AE%E8%A1%A8%E8%A8%98&quot; aria-label=&quot;本記事内における金額や決算期の表記 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;本記事内における金額や決算期の表記&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;$1K = $1,000&lt;/li&gt;
&lt;li&gt;$1M = $1,000,000&lt;/li&gt;
&lt;li&gt;$1B = $1,000,000,000&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;とする。&lt;/p&gt;
&lt;p&gt;FY2020 は Fiscal Year 2020 のことで、 GitLab は1月決算なので西暦2019年2月1日から2020年1月31日を意味する。Fiscal Year（FY）に対して通常の1月から12月までの1年を Calendar Year （CY）と呼ぶ。&lt;/p&gt;
&lt;h2 id=&quot;主要な経営指標&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%B8%BB%E8%A6%81%E3%81%AA%E7%B5%8C%E5%96%B6%E6%8C%87%E6%A8%99&quot; aria-label=&quot;主要な経営指標 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;主要な経営指標&lt;/h2&gt;
&lt;p&gt;直近四半期（2021-05-01 ~ 2021-07-31）の売上を単純に4倍する（Run Rate Revenue）と $233M となる。ARR $5K 以上の顧客（Base Customers）数が 3,632 で、ARR $100K 以上の顧客数が 383。&lt;/p&gt;
&lt;p&gt;ARR は期末から数えて直近12ヶ月間の売上のうち、顧客からのライセンス/サブスクリプション収益の合計額を意味する。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/d87d8f2030a72b53fcbed2d26dd5fc3f/c946b/gitlab-kpi.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 98.10126582278481%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEJElEQVQ4y22R71dTdRzH76OKHxvsbgzRlDQtzdRNGLBfdwNCQRBFS8tUMlCYjF8qbpPtbhBsCCWEihwlSlNJs6OezI52rI4nn/SkJz3vT3l1vt9tzNPpwft+fr0+P+69Sq1lhJflUxM0rk6y9+0pGsrG2FWe4sC2aXa9keKgbZqm8iTNayfYsWoMvznBf/uVbLKuZIR66ygeY4zuhmssjD9jeugR+id3uBJ/wpz+hPnEU2ZCP3G+7wHRI9+hFcdln+jPzlHEQzPFcRfG5DBhBei3JNixcoz60lG5qHltSsZNa5LL1zgLoniL9OVYDFVEc+uGSY555nh/8xd8aJ/hoC2tA1svsPP1cblALBWfQ9h9mz7n48pZ2l2Xads4hU+N5y50FUTp0K5w5/ILZsOPWUg+Y3HiVx4s/slfL/7hI/sMbkNMXikaxYU3p5/z28O/Wbr4B/MjTwk2fSUZ8fqKZtJpWZfiVNs3BJsW6G64yon6eTp8V+jQ5mgoG8Wvxqm1JNIyJ2h3XZLs3o2THK6alT9LK9ZlXfGb43iLY/hUnZY3U7S+NSFty/oUbmMUsVAwPnNcWk3VZW7X2iRt70zSuGYMV+EwfkuaUTQ1A1tysLSqLn+MTw7JScS+DOs1Zbk4WoZTxGU+s56+0qxnwNiyRE4ymSWSNeVYLcNpajqneM0xhOpXjuAVyRJd+kK1KxIyp2UYzRLDaTxHXVkCjxqVrN8ax18al75gFa1EpyIvxET/ffrbFpmNPmYm8oiLsZ85134bR0EYzarjVqPUrUoQPbbEhdCPBJqucnX8F27OPufG9O+Ej9yiqjCMolmiOA1hendfY+T4HcZ77jG4b5GxwPcEW65RUxjCZ4niMQ1TtyJOR+1lho/eIhX8gWj7LT7ruov+6RKddXNyjuIxR/CoEXzWYfZvO0/zhs/YuzlF47oR3GqEbF1YETvyz0j2QMUUrZvGaVgdx5E/hNMYkoziModwqSHc5hAeSxivNYJmjeAtCcucK6uXGLcl7WsZ1m3JsYrTNITTdAZhXWpay7457Wfr/8dKXs3llZriU2RVkd8v5TAMYHu1l+15fVQX5epSptNUGwexv9Yn65UF/VQZB5frSnXxABWFfdSXRxg6tEC04zrho18zdeYewT1zuK2ncRj7EVyNaRBbXpDDnklGe24TP/EtoSOLsreysE8yiqOoF3v+SerLzzI1dJdE9w2+jN1n4IM5kgNLtG6JY8sLUFXcK7XllS4OuVPMJx9xaeQhetd1dq6PLDPK9qIAtoIuGjaE2O9I0LI1yj5HgvfWn6VxYxh/+Wnshm4EJ6yztI89dl1yze8Os3trFN+aU1QUBdhuDKDYDcexFXZSbQlQYz2Js/Qk1SUBXCt6cJcFZd5m6CTLVZq6JCckas7SHtkj64ZO/gXF4wwiYDXiXgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;gitlab-kpi&quot;
        title=&quot;gitlab-kpi&quot;
        src=&quot;/static/d87d8f2030a72b53fcbed2d26dd5fc3f/f058b/gitlab-kpi.png&quot;
        srcset=&quot;/static/d87d8f2030a72b53fcbed2d26dd5fc3f/c26ae/gitlab-kpi.png 158w,
/static/d87d8f2030a72b53fcbed2d26dd5fc3f/6bdcf/gitlab-kpi.png 315w,
/static/d87d8f2030a72b53fcbed2d26dd5fc3f/f058b/gitlab-kpi.png 630w,
/static/d87d8f2030a72b53fcbed2d26dd5fc3f/c946b/gitlab-kpi.png 805w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Dollar-Based Net RR が 152% （FY2021 では 148%）なので、既存顧客からの収益が1年で1.5倍に増加しているということになる。&lt;sup id=&quot;fnref-2&quot;&gt;&lt;a href=&quot;#fn-2&quot; class=&quot;footnote-ref&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/9f12f560ba4369b0e660efa75eaf28ca/fdaf8/gitlab-nrr.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 13.29113924050633%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAApklEQVQI13WGTw+BcABA+/6fxc2Jk06YUcwqpfzqtwpLJZX8qefAzMXb3t5T+Ev30472caPIM/ZRiPQFgfA4Zym0T+qyYLd1CMQOZWZ5zG3BfCPQthLdlfh5Q9xAVHdf3aREXVr0R2OmpsfMkQwmGupijRmnjHST3lBF0S2H1cZFM2wM1ye51OS3luIBxb37+P6qBXlMOVUNDXA4V9h+SPmEK2AHES8tU+BLiLe9fAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;gitlab-nrr&quot;
        title=&quot;gitlab-nrr&quot;
        src=&quot;/static/9f12f560ba4369b0e660efa75eaf28ca/f058b/gitlab-nrr.png&quot;
        srcset=&quot;/static/9f12f560ba4369b0e660efa75eaf28ca/c26ae/gitlab-nrr.png 158w,
/static/9f12f560ba4369b0e660efa75eaf28ca/6bdcf/gitlab-nrr.png 315w,
/static/9f12f560ba4369b0e660efa75eaf28ca/f058b/gitlab-nrr.png 630w,
/static/9f12f560ba4369b0e660efa75eaf28ca/fdaf8/gitlab-nrr.png 674w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;なお、75ページによると Dollar-Based Gross RR は FY2020 と FY2021 の2年続けて 97% なので、既存顧客の解約はかなり少ないことが分かる。&lt;sup id=&quot;fnref-3&quot;&gt;&lt;a href=&quot;#fn-3&quot; class=&quot;footnote-ref&quot;&gt;3&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;p&gt;これを見る限りでは、とても順調に成長しているようだ。&lt;/p&gt;
&lt;h2 id=&quot;bs-を読む&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#bs-%E3%82%92%E8%AA%AD%E3%82%80&quot; aria-label=&quot;bs を読む permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;BS を読む&lt;/h2&gt;
&lt;p&gt;GitLab の Balance Sheets は面白い。なにが面白いかというと、とにかく何も無いところだ。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/7429aa4db8d5a4a1ec7d708881f5469c/1f083/gitlab-bs.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 56.32911392405063%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACiElEQVQoz0WSS0hUURzGB6GSVi7CRS4KCtoE5aKHLRSMIoMekqsCq1WKEAUtJMpMaJH2WFSIljM9XBhEUUGRiilIRL5IB3pg42seemfGce7Mnfs6d35xzxW9cLiH+3G+87vf9/cBaLZgYXmZRGIZErOgamhaDiWtgJZBZP6hxOOk02mUeIJsXEGNRkimlllM2cSWkliWST6fx+ca6oaBpuvgwFwqwr2xNzye/ERPaJbu6QUWsyoIgW3bcjm2jbAsubdsB8t9WxaGYeBzXd3HwXsPRKbwPamiyF9LVf8Xyj73MpZMSm08HqLifSM1vW1cGx3nysgkf9WM1LzTrBPqpiE/DIYnKXxaw87ARZ49bMR/u4H50G+p9c9P4Ht0lC2BCxzoG6a0b5TviZTUDNNC13V8LqYQApF3PMNIkE2dpynx13O8VeHQdY2xkLl6WZCNHdXs6L5E3Qc/de8C/FIi3h/mHS/DVCqFqqqYtiWFr+EpabjVX8+x+woHb+UYCXn0AwuTFHRUs+v5eYZvVDJ1dR8rf35IzTINjzCZTMow86spDEWCFHaeosRfR5Vr2KQxOrNOuKHjBNtf1HPkboyKZpfelppw8h6h25RpmmuEA+EgBR1nKO5qkIZlTdoaYd98EF97DcWByxxuVShv0RkJWbISyxayaVmKm6EtvJu+RX+yLXCYPS9rpeH+mznGVwmjS8P0vN3M64+lnGyLUNasrxMKR46RHBt3uRnYeUiHh5h+VcRE917OPZijvEVlfDorD+VmBzHaC1G6dnO2bYbKOxlGp3NugrLltcF2N8IdVsdBGDlIxcjG5liIrRBPC3TTli1aOYNcNEliNkp4USWurmrulAiB4zj8B+9b8DQ4NcroAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;gitlab-bs&quot;
        title=&quot;gitlab-bs&quot;
        src=&quot;/static/7429aa4db8d5a4a1ec7d708881f5469c/f058b/gitlab-bs.png&quot;
        srcset=&quot;/static/7429aa4db8d5a4a1ec7d708881f5469c/c26ae/gitlab-bs.png 158w,
/static/7429aa4db8d5a4a1ec7d708881f5469c/6bdcf/gitlab-bs.png 315w,
/static/7429aa4db8d5a4a1ec7d708881f5469c/f058b/gitlab-bs.png 630w,
/static/7429aa4db8d5a4a1ec7d708881f5469c/1f083/gitlab-bs.png 660w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;資産はほぼ全てが現預金で、固定資産はほぼ繰延費用（契約獲得に関するボーナスや手数料を繰り延べたもの）が占めている。負債は大部分が License/Subscription 収益の前受（Deferred revenue）で、契約期間にわたって分配される。&lt;/p&gt;
&lt;p&gt;非常に単純な BS なので、自分が経理として働くならこういう会社で働きたい。&lt;/p&gt;
&lt;h3 id=&quot;gitlab-のオフィス&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#gitlab-%E3%81%AE%E3%82%AA%E3%83%95%E3%82%A3%E3%82%B9&quot; aria-label=&quot;gitlab のオフィス permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;GitLab の「オフィス」&lt;/h3&gt;
&lt;p&gt;BS を見ると、 Property や Equipment といった固定資産が一切ない。先述の繰延費用を除けば、 FY2021 の BS には Intangible assets が $0.8M と Other long-term assets が $1.5M 載っているだけだ。&lt;/p&gt;
&lt;p&gt;実は GitLab は2014年の設立以来 100% リモートワークで、役員や従業員が仕事をするためのオフィスは無く各自が自宅等で仕事をしている。実は日本にも社員がいる（公開されている範囲では東京に6人、横浜に2人、大阪に2人、鹿児島に1人）。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/5e0a5d29a33b52d1c8bdb1246be162ae/898f6/gitlab-full-remote.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 112.0253164556962%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEn0lEQVQ4y3WQa1NTVxSGz5cq19xRsYqOKEESqZDEEHKDKJgGuVjAggiCCAYSICEgt5yQWBW8oKJCQa2ObUWno2NVWh1rP3SmdqbTH/V0zglga+mHZ9Za+33X2mtvwZ4h0ue7z0L8LbMjPxHv/IFuzyLXhpa5EnrJVPA5c+IbTlhu4lCIeLISlGnjlOsS6yK4VJM0GGc4c+gOjfuuyXmzaZZ2+5w85JRznoD3Hkd2TeNWT/6jOb4ugi0tylD9t9yaeM3l0AtGmh5x3v+MS/0/MhN5JW9+fXiZhcRbOhzzSC9Kbrk+glsTx7djitq8yzJS7ttxUc7rDTPy1tW5lziaf4WK7K/WnivF9RCkNV3qGE6lKONWx2RWa6dCxKVK1mWayf996tqT3dpJyiR0H7Niyop/ONP+F/dHCC7NJK6PDl0aEadaxKGawK6cwK2NrSBpMVmTosxaTxLBLQtiEnUUlybKwc3nOLx9ito9cxzNn8euSVCq+Qq7SpQHHMqeojwrkVxA7o0izZEQXFoRly5GjX6REyXPOelYpr74KR3WGzQX36W1+Ab+vAAR03nO2B5w2vWC/s/f4fe8psv9imbTY7y7buHURHFpYwgOjYhNG0c0tvPQe5ZLNY+Ie27TZJilRDWOQzvGw9JanlWc5FzV90SqfmGg5j39Ve8JVf/BGftd6naMUip9hU5EqMiWChH/zlPMVk4zVzbIY2sFlVnDlChFaneLjPju01p0h+Ch+/grfuWc7wnj1W/o9v5J+75pTuX6saml/5xA8G4foixrFIsyysHcRRrzpjiW049VNY5NGaHecIfBur/or/qNwSPLNOz/jhGjH7/5JlOVF6neNoZZMYFTO4ZDM45gU0sbjuDQncWiiFCfKxKrWqJm7yI29QierQm+MMwTrHzLqPcpnmwRs3SZdoIv9XG8OQlcm8Zx6kaxa89KA4dIMkyJKoJzU5TOsncM1f5OXf55TBkhbKoQvRUv6XEtyRdL/lKpRxvDt+cqNcYFLOooB1TDCCWqQVaxqSOY0vtps9xmuOoBDm0YmyqCWREhUHKDFuMUVvUoNtUgVkUY15YJRg/e4/rBCwQKOvFlBxEOqEKsYlWHMWUEqSu4gm93gqL0IFZ1CIsyhFMToFQdwKwYwCr5lQNYNRG8WwK057TSsDNIeVYfgkURxKIMYlYEMGVK9GLK7MeUOUBxeg/mFd2k6MOs6JNzi7JPpjith8LUAIUZIfZnDFCc2YdQrOihKNOPRRPAquvjgDaIc1sYe/YApVsGMCl7KFL4kXwySmlIN4Vp3Tg/DcuYlJKe9AhFii6MKR14doUZbv2aSv0QD66/5urYE5YW3nFk3xiGje1IPgkpby2/wPTwEt/M/CxH2+ZeCtM7ZV0ozGjHkNqKLdvPeNci3TWXCR+/SadvmvHTizhzAhSktCL5kt42KvRhWsoSDLXNyT6LrgtjapusCwVpLRSkHifvkyZMug4OG0M4d/bgyQuyN6UZ/YZmDLLnA/oNTZRs7cKd28tnyja5XvUIeSkNGBRN7Ne1yHHPxnry0xpXOIY+tQF9yr/JT21c8+hTV1jR/gYPcUa9OMK93wAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;gitlab-full-remote&quot;
        title=&quot;gitlab-full-remote&quot;
        src=&quot;/static/5e0a5d29a33b52d1c8bdb1246be162ae/f058b/gitlab-full-remote.png&quot;
        srcset=&quot;/static/5e0a5d29a33b52d1c8bdb1246be162ae/c26ae/gitlab-full-remote.png 158w,
/static/5e0a5d29a33b52d1c8bdb1246be162ae/6bdcf/gitlab-full-remote.png 315w,
/static/5e0a5d29a33b52d1c8bdb1246be162ae/f058b/gitlab-full-remote.png 630w,
/static/5e0a5d29a33b52d1c8bdb1246be162ae/898f6/gitlab-full-remote.png 798w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;オフィスの代わりに、同社はリモートワークをするための仕組みにいろいろな投資をしてきている。それがドキュメントで、 GitLab 社にどのような組織やワークフローがあり、各チームがどのような方針に基づきどのようなプロセスで仕事をするかが細かく記述されている。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://about.gitlab.com/company/culture/all-remote/&quot;&gt;https://about.gitlab.com/company/culture/all-remote/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://about.gitlab.com/company/&quot;&gt;https://about.gitlab.com/company/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;中には GitLab の役員・従業員しかアクセスできないものもある（例えば従業員が受け取れる株式報酬の計算ツールや給与の支給カレンダー等）が、ほとんどは公開されている。&lt;/p&gt;
&lt;p&gt;例えば、このページでは地域や職種別に GitLab の従業員一覧を見ることができる。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://about.gitlab.com/company/team/&quot;&gt;https://about.gitlab.com/company/team/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;このページでは飼っているペットの一覧を閲覧できる。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://about.gitlab.com/company/team-pets/&quot;&gt;https://about.gitlab.com/company/team-pets/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;このページでは経費精算のやり方が解説されている。リモートワークにあたってどういうものを買うべきかも書かれている。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://about.gitlab.com/handbook/finance/expenses/&quot;&gt;https://about.gitlab.com/handbook/finance/expenses/&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;bs-上のソフトウェア&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#bs-%E4%B8%8A%E3%81%AE%E3%82%BD%E3%83%95%E3%83%88%E3%82%A6%E3%82%A7%E3%82%A2&quot; aria-label=&quot;bs 上のソフトウェア permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;BS 上の「ソフトウェア」&lt;/h3&gt;
&lt;p&gt;BS を見ると有形の固定資産が無いことはすぐ分かるが、いわゆる無形資産もほとんど載っていないことが分かる。FY2021 で無形資産が $0.8M （中身はのれんっぽい）で総資産が $362.6M なので、ほぼ無いといっていいだろう。&lt;/p&gt;
&lt;p&gt;ちなみに DTA の内訳を見てもソフトウェアは無いので、会計だけではなく税務上もソフトウェアを無形資産としてほとんど計上していない（もしくは、償却済み or 即時償却している）と考えられる。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/44bc881768ca0ee334d82ad36d89b79c/ace37/gitlab-dta.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 60.12658227848101%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACR0lEQVQoz22SCW/aUBCE/f9/Sw9VbdUqVEnIQSE2xhgMBkzM4QNfhMuAub7KD9ImUi2NZsf7NN59Hmm322EYBv1+H9u26Xa7LJdLjscj+/1e4HA4kJ97Rf4uyzLB2+32L3It5QaaplHTNBRFwex0kGUZVVUpVyqilhVFQKvXKZVKgmVZoWkYYgDLstB1ndF4jBSFAdMkFoiCSx3HxFFIEkW89pM44mWaEE580Q98H99zxbnVcsE+27LLtkjTdEuSZiTplll2ZHXiHdK3+ggpsDxA3wtR2z30nk3NtKiZfaL5Cknu2Hy+LvHl9jcFuYE6iqlYHmacMt7AcHVklJ4Yrs7I6+fZDnuxRx0EaKMQL4PqIMB0I6S2G/H9/omfjwqFisZ11UCzfTqTF8arA+4G3PUJd/2PnfTEZAdNJ6ZYaxEdoekmVM0+0lP7ma/FsjD7VizzoHewoiVtf3o2zA3WJ5wLe1vov2yo2T43aotfsi6M7xo9lLaFZHoJVxWNm2qTu7qJ0nfRxzHtYH6Z6PTfCcfLAw0npj4KcdIjupPQyVeu25740q3aQrYc1MGE4WLPcLm/TPYG6UlcwfMsQx+F3De6XKstWt6UO717njA3/Pjrnh+PivgxJcMSazkbLmu+R96zpmsUy+FTociHq1uxcu5ReCgjtQYej7qJ0rGptCyM0QQ3v7tXpGd2Ltpbn7Cna3rhnOYopKSbjBcZhhPRHjhISRzjex5BMBHhFYGOI4JJrmMR7DzwE98TAc/7eR2FodCL+Yy3zx/ernLcVt2cQgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;gitlab-dta&quot;
        title=&quot;gitlab-dta&quot;
        src=&quot;/static/44bc881768ca0ee334d82ad36d89b79c/f058b/gitlab-dta.png&quot;
        srcset=&quot;/static/44bc881768ca0ee334d82ad36d89b79c/c26ae/gitlab-dta.png 158w,
/static/44bc881768ca0ee334d82ad36d89b79c/6bdcf/gitlab-dta.png 315w,
/static/44bc881768ca0ee334d82ad36d89b79c/f058b/gitlab-dta.png 630w,
/static/44bc881768ca0ee334d82ad36d89b79c/ace37/gitlab-dta.png 666w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;ソフトウェアの会社の BS に会計上のソフトウェアが載っていないこと自体は（少なくとも上場企業の開示を読む限りは）よくあることだが、税務上もソフトウェアの痕跡すら無いのは日本だとあまり見ないかもしれない。事業にもよるし実務上不可能ではないけど、ここまで極端なのは難しそう。&lt;/p&gt;
&lt;h2 id=&quot;pl-を読む&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#pl-%E3%82%92%E8%AA%AD%E3%82%80&quot; aria-label=&quot;pl を読む permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;PL を読む&lt;/h2&gt;
&lt;p&gt;FY2020 の売上は $81M で FY2021 の売上は $152M で、前年比 +87.3% の成長をしている。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/045b8d1bf72cc143a59ce5e3c0f4e178/6db71/gitlab-pl.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 56.32911392405063%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABy0lEQVQoz2VSPYsUQRBdcyOjAxF/goGBiaAXmJtcpP4aTQ5OhANRMBMRPwJBuEDMVDBcdRXvVu4QxfVuZ3fYmbnp6amu6ifV3buztzY8Zph+9arqzesBgIgEeO8h4gF4ZCVjWhi0o9+YZFMcl2M0xU8cjScwptaywF9FTy+ICEQuCQocC8jpkyFEcM6B2UG4Te+84HaDSCeohDkJinAEEr4pBJI+b+1Y3N2xWhXvhf+fULsq9NTWY/N1g48HUYCDAdEWPTfu17j1sEktI+IcSdBaG9dUQe+Ql4SN7Qov34yAX3ugaR9cH4CcyjrcflXjzrMJeH8IOhyAqwFcskV1enmeQ0V15eCltaH79PEjDK9cwOzJKTT9Dage2TpMW3/rY+/qZWRbazDvz4JMGTxXn4NgVVWd0Wn1/MVT7F9fR/H8NOyXm3Ft14Y7832AH9fWkd07B/PhPIRiI/W6p1PNxRZQ744r0OEIXA4hzZ9YwBwFv37C7qWLGG+egXm3dlJQCW3bhnVPRCH9az83X9Jf15gd/UX2YBvm81uw2YVopGQlh2rqcp60WM0WUTKHAvFds2XIag6XwzqHNimKYkFchnLL2QzU2pTTLof/APkzQtiNHtnvAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;gitlab-pl&quot;
        title=&quot;gitlab-pl&quot;
        src=&quot;/static/045b8d1bf72cc143a59ce5e3c0f4e178/f058b/gitlab-pl.png&quot;
        srcset=&quot;/static/045b8d1bf72cc143a59ce5e3c0f4e178/c26ae/gitlab-pl.png 158w,
/static/045b8d1bf72cc143a59ce5e3c0f4e178/6bdcf/gitlab-pl.png 315w,
/static/045b8d1bf72cc143a59ce5e3c0f4e178/f058b/gitlab-pl.png 630w,
/static/045b8d1bf72cc143a59ce5e3c0f4e178/6db71/gitlab-pl.png 659w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;気になった箇所を順番に見ていく。&lt;/p&gt;
&lt;h3 id=&quot;営業損失&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%96%B6%E6%A5%AD%E6%90%8D%E5%A4%B1&quot; aria-label=&quot;営業損失 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;営業損失&lt;/h3&gt;
&lt;p&gt;GitLab の営業損失を分解すると、次のような図で表すことができる。&lt;/p&gt;
&lt;p&gt;FY2020 は売上 $81M に対して Cost of Revenue が $9M、 Research &amp;#x26; Development が $59M、 Sales &amp;#x26; Marketing が $99M、 General &amp;#x26; Administrative が $42M だった。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/fdcda6a54d2b844fc7d7d414259fa01a/6db71/gitlab-op-loss-2020.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 55.69620253164557%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB0klEQVQoz42SzYoTQRDHc/YRFF9A9Gm8e9CzFxE9LuJBxLMiuJcV3AfwkETRxY1HT6IkIRiDkt1kMpmvnWR6+mPmJ9Wzm10/saCY6p7qX1f9u1rr9ZowDEmShPk8YDKZ+PUyikmzDLHaWeqq4n+sVVUVeZ4jYK0VqlhRKkWRJKgspT5OlG9VOST/b17XNS18ok9n573h1gtNmBj0xw+o0ZDyYEq4/Zii/7mBGvNvYF2DsQ5w3N5VXLmbM40qvxbL99/y6fw5op1nm7YELIfFz9qmwmbf8uT1mutPj5jHRkrBAmr6ncXzbdZfRmS9PeaP7lOGC3+dtRatNVmWURSFr7Il+hljsM7hrKFyFmsNxtpmv679Yan58MEW/csXPVwuq7QmiiI6nQ6DwaB5lNVqRVmWOOc2bfzkoo/WPnn+8B79SxcoJ+NNm2ma0u12GY1GDZDj0sXlcf4ouIyNHO685GDrDnoRkO69YvXuDXEc0263GQ6Hp0CpTvysuL/ZL3vfrl3l8OYN0jhmv9fj63h8ChStBCgCyzwKUESWtfwT0SXWZUmepj73aLEgXy59fPIOG+DJDMmmUsrH0oroK+DZbOZj8SAIPHwZJyyTxAMbuZo5/AGUI0L2yQJZhQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;gitlab-op-loss-2020&quot;
        title=&quot;gitlab-op-loss-2020&quot;
        src=&quot;/static/fdcda6a54d2b844fc7d7d414259fa01a/f058b/gitlab-op-loss-2020.png&quot;
        srcset=&quot;/static/fdcda6a54d2b844fc7d7d414259fa01a/c26ae/gitlab-op-loss-2020.png 158w,
/static/fdcda6a54d2b844fc7d7d414259fa01a/6bdcf/gitlab-op-loss-2020.png 315w,
/static/fdcda6a54d2b844fc7d7d414259fa01a/f058b/gitlab-op-loss-2020.png 630w,
/static/fdcda6a54d2b844fc7d7d414259fa01a/6db71/gitlab-op-loss-2020.png 659w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;FY2020 は売上 $152M に対して Cost of Revenue が $18M、 Research &amp;#x26; Development が $107M、 Sales &amp;#x26; Marketing が $154M、 General &amp;#x26; Administrative が $87M だった。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/250c3f8b7be59ebe59f43f4df97b0c1a/0012b/gitlab-op-loss-2021.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 55.69620253164557%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB0klEQVQoz42Tv24TQRCH/QI09BQUvA0SlAgK3oEaiQ5EkxIqGgqEECXIMUUKCoQEmARFsmUSDApR7m4vtu9859u/96HZixFBwmKl1e7eznzz25m53mq1Is9zFosFSZJxcDhFKUWuFGVRIKP1nrYN/M/ohRAoy5KqqiFo8BXWaBrnMAI6M5RVbDfNtm3pibH3Ej2wved4+MqiFhYzfE/95TOuLCh23qB/TDuotWeA9t9AY5xguftCc+VOyUHiwTcRUA8/sH/pAurR1rmnibPMv7/1nHO4qNDzZKfm9uOSI2XjWcLoLEE9f0r1dUz57i0nD+7RHP/EtS3OGIwxFEWB1EJU9ubzOVprvPc4ZwnexdVah7UWFwI+JgROtu6zf/kiy71hPIu+09mM7X6f0XjcFUWAy+UyAtfPODclP9ZE49nLZ0xvXEVPDzFZijs+it0xGAyYTCYdsKqqKFeeLpL9hip6Y/CrOqr7dus6329eY5alvO73GY9GHbCrso/AP5O7achts/sJvfsRozUqzxFhv4ExV9J3xlDXdQSKasmt3EnS496Y2LMiYBUCte9aRXzXKYrAdQ+Jc9M0MdI6t3JOkiTuJUiapjGw/EkqyyJM/NY1+AUpUUbaDFAz1gAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;gitlab-op-loss-2021&quot;
        title=&quot;gitlab-op-loss-2021&quot;
        src=&quot;/static/250c3f8b7be59ebe59f43f4df97b0c1a/f058b/gitlab-op-loss-2021.png&quot;
        srcset=&quot;/static/250c3f8b7be59ebe59f43f4df97b0c1a/c26ae/gitlab-op-loss-2021.png 158w,
/static/250c3f8b7be59ebe59f43f4df97b0c1a/6bdcf/gitlab-op-loss-2021.png 315w,
/static/250c3f8b7be59ebe59f43f4df97b0c1a/f058b/gitlab-op-loss-2021.png 630w,
/static/250c3f8b7be59ebe59f43f4df97b0c1a/0012b/gitlab-op-loss-2021.png 661w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;それぞれの費用の主な内容は以下の通り。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Cost of Revenue: SaaS のホスティングとカスタマーサポートの人件費&lt;/li&gt;
&lt;li&gt;Sales &amp;#x26; Marketing: 営業やマーケティング部門の人件費、広告費、旅費や交際費&lt;/li&gt;
&lt;li&gt;Research &amp;#x26; Development: 新機能の開発や既存機能の強化、研究開発に関する人件費&lt;/li&gt;
&lt;li&gt;General &amp;#x26; Administrative: 役員、財務、法務、人事のための人件費（法律事務所や会計事務所への支払いを含む）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;人員の規模や事業の内容的に、費用の半分以上は人件費と考えられる。ちなみに FY2021 は Operating expense の総額 $366M のうち後述の株式報酬が $112M で 30.6% を占めている。&lt;/p&gt;
&lt;h3 id=&quot;収益コホート&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%8F%8E%E7%9B%8A%E3%82%B3%E3%83%9B%E3%83%BC%E3%83%88&quot; aria-label=&quot;収益コホート permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;収益コホート&lt;/h3&gt;
&lt;p&gt;収益のコホートを見ると、ここ3年くらいで売上が急激に伸びていることが分かる。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 449px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/2ece0f630e29d0a31e4a703778ebaf45/93dc1/gitlab-cohort.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 68.9873417721519%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAIDBAX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAHeFrk4gf/EABoQAAIDAQEAAAAAAAAAAAAAAAACAQMSETH/2gAIAQEAAQUCg8EbcdLFZypcL//EABURAQEAAAAAAAAAAAAAAAAAAAAB/9oACAEDAQE/AVf/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAZEAACAwEAAAAAAAAAAAAAAAABEQAQEmH/2gAIAQEABj8ContLSEU//8QAGRAAAwEBAQAAAAAAAAAAAAAAAAEhETFR/9oACAEBAAE/IaJQtByCIhPHwSO327zD/9oADAMBAAIAAwAAABD0H//EABcRAQEBAQAAAAAAAAAAAAAAABEAIQH/2gAIAQMBAT8Q4Owcv//EABgRAQADAQAAAAAAAAAAAAAAABEAASEx/9oACAECAQE/EB5Ay7Z//8QAHBABAAICAwEAAAAAAAAAAAAAAQARIUExUWFx/9oACAEBAAE/EEhvtlApo5VY4IhCvJkQ3uWFsW5+ty3ZzWNnk//Z&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;gitlab-cohort&quot;
        title=&quot;gitlab-cohort&quot;
        src=&quot;/static/2ece0f630e29d0a31e4a703778ebaf45/93dc1/gitlab-cohort.jpg&quot;
        srcset=&quot;/static/2ece0f630e29d0a31e4a703778ebaf45/ff44c/gitlab-cohort.jpg 158w,
/static/2ece0f630e29d0a31e4a703778ebaf45/a6688/gitlab-cohort.jpg 315w,
/static/2ece0f630e29d0a31e4a703778ebaf45/93dc1/gitlab-cohort.jpg 449w&quot;
        sizes=&quot;(max-width: 449px) 100vw, 449px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;契約開始年度別の FY2021 における前年比成長率は次の通り。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;FY2016: 90%&lt;/li&gt;
&lt;li&gt;FY2017: 71%&lt;/li&gt;
&lt;li&gt;FY2018: 73%&lt;/li&gt;
&lt;li&gt;FY2019: 79%&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;これを見ても分かる通り、既存顧客からの売上の伸びがとても大きい。これは GitLab が DevOps プラットフォームとして長期的に信頼されていることを表していると考えることができる。&lt;/p&gt;
&lt;p&gt;図と数字は75 ~ 76ページから引用した。&lt;/p&gt;
&lt;h3 id=&quot;stock-based-compensation---株式報酬&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#stock-based-compensation---%E6%A0%AA%E5%BC%8F%E5%A0%B1%E9%85%AC&quot; aria-label=&quot;stock based compensation   株式報酬 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Stock-based Compensation - 株式報酬&lt;/h3&gt;
&lt;p&gt;PL を読んでいて気づいたのだが、 GitLab の operation expenses のうち、それなりの部分を Stock-based Compensation（株式報酬）が占めている。14 - 15ページに金額が記述されている。&lt;/p&gt;
&lt;p&gt;FY2021 は売上 $152M に対して株式報酬が $112M（Operating expense の総額 $366M の 30.6%）で、 FY2020 は売上 $81M に対して株式報酬 $41M（Operating expense の総額 $210M の 19.5%）だった。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/eaf8807d10847ce77fb5f3eaabfa1fcd/227ba/gitlab-stock-based-compensation.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 20.88607594936709%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA6ElEQVQY0z2J206DQAAF+f9f0photFGr9kKBZmlBrmHZQrWlS1suY9yHPkzOZI7VNA2qlFQ7RaVKdv+uyhv7ukJJSZHnlLIw/9B1nLUmiSPTijyj3imGvscaxpFDe+W3vdIOcOqh6cYbcn9k5Qe4m5B1GONsQhaeYOasmbsC8Z2Yzwsifo4nLH2+8PBhc/e+4Gkp8CtN1kKqR9LTaLy4wFTEZqNjx8TZmp5pWMYlFeDJA34qsa79wDzMeLEFr+4WJ1V4eUVQa/IW3LzmK8i4f5tjJyVTEfE4c41/blImK8EqUTzbPl4Y8wdB5CftqA4lCQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;gitlab-stock-based-compensation&quot;
        title=&quot;gitlab-stock-based-compensation&quot;
        src=&quot;/static/eaf8807d10847ce77fb5f3eaabfa1fcd/f058b/gitlab-stock-based-compensation.png&quot;
        srcset=&quot;/static/eaf8807d10847ce77fb5f3eaabfa1fcd/c26ae/gitlab-stock-based-compensation.png 158w,
/static/eaf8807d10847ce77fb5f3eaabfa1fcd/6bdcf/gitlab-stock-based-compensation.png 315w,
/static/eaf8807d10847ce77fb5f3eaabfa1fcd/f058b/gitlab-stock-based-compensation.png 630w,
/static/eaf8807d10847ce77fb5f3eaabfa1fcd/227ba/gitlab-stock-based-compensation.png 769w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;この中身は大部分が secondary stock sales で、注記として Note 16 （F-35 ページ）により詳しい説明がある。これによると、現在および過去に在籍していたチームメンバーや創業者が普通株式と vested option を既存投資家に売却し、その売却価額と fair value（公正価値）との間に差額が生じている…とある。&lt;/p&gt;
&lt;p&gt;この差額は借方が PL の費用、貸方が BS の純資産として計上され、 CF 上は営業 CF の加算項目となる。&lt;/p&gt;
&lt;h4 id=&quot;stock-option&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#stock-option&quot; aria-label=&quot;stock option permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Stock Option&lt;/h4&gt;
&lt;p&gt;役員・従業員に対するインセンティブとしては、上場前の会社らしく Stock option を配っている。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/eed4da3cf396d548d0734c0334800873/0fcea/gitlab-so.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 56.32911392405063%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACP0lEQVQoz32SbXOaUBCF+f+/pR86k5mmTapJTDTGl2hU5EVFEBAxioqAGISnw03b6afemTtn787O7jlnr3Q4HJhNpziOw/F4pHyH5Q1DEcdxTJqmRFEkcnme878jFUCW55w/MqI45hhFRHEi4lN6ZjozqFSrjGQZ23EZyWOC3Y6V76PpOtsgwFut0CcTNtst0vNA5edLj1pPRrbXzHcJqzN4JwTO9ykvmsX9q4y2PtAzVzQVA9UPaekLan2FsbejPXNRHR+pO7G4rnepdIYsjhluAk5c4CSfdxFdMPcpT0OdWZBgRxfauoUVfoh6dbUXucXxgp9ckMrJ3+odbloD2rMlih+yTMEWTcEMM8bentvWG4p/YLKNqY+mzHYntPeIZ9Vkuk1ErK8CpI425+r+mdtmj2VS4KXgJoVg+omFYPj4pgl0fjN0BKsM1dvhxrlQsj7lSE/9MT+aPSrtgfBj5GxYnv8wLLCjnMkmotZXBZqHMy+qiRVmGLsTnYmNGX4IloYfILUUg693Da4emny5eeBxoP8jucA9IaY35JmQX+aayvyvv/IyEDV2Au9nkO67IyrtodhitTPkrqcgL3eiqFxOaXhp/NNAR1+HGEFCZ+oIpiXDvuUL1NYhiu0jfa+3BcPrRldIL81/NVzRqGRaNi4XUe3KQla5qKGzFQoWUU7fXGEdM+aHDM19L/+hwn1nSP1NoTHUKD2tvY5Qllusfcr6jMCWamAGMV5SINs+3qnAjS4M5kvcKGMRnpl5G34BupcpE18jYEoAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;gitlab-so&quot;
        title=&quot;gitlab-so&quot;
        src=&quot;/static/eed4da3cf396d548d0734c0334800873/f058b/gitlab-so.png&quot;
        srcset=&quot;/static/eed4da3cf396d548d0734c0334800873/c26ae/gitlab-so.png 158w,
/static/eed4da3cf396d548d0734c0334800873/6bdcf/gitlab-so.png 315w,
/static/eed4da3cf396d548d0734c0334800873/f058b/gitlab-so.png 630w,
/static/eed4da3cf396d548d0734c0334800873/0fcea/gitlab-so.png 851w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;2021年7月末時点で未行使の SO が 20,427,047 株あり、加重平均行使価額が $10.26 となっている。2020年12月 ~ 2021年1月に行われた直近の買付が1株あたり $40.00 で上場時はこれより価格が上昇すると考えられるので、 SO だけで日本円にして600億円を超えるキャピタルゲインが生まれることになる。&lt;/p&gt;
&lt;p&gt;ちなみに上場申請時点の発行済株式は Class A common stock が 1,150,784 株で、Class B common stock は 133,444,037 株ある。&lt;sup id=&quot;fnref-4&quot;&gt;&lt;a href=&quot;#fn-4&quot; class=&quot;footnote-ref&quot;&gt;4&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;p&gt;SO が全て行使されると、持分の割合は 13.2% 程度になる。既に行使されたもしくは失効した option を加えるとだいたい 19.3% ある。20% 近い株式を SO として配るというのはあまり見ないので、役員と従業員に大盤振る舞いしている会社と言えそうだ。&lt;/p&gt;
&lt;h3 id=&quot;収益構造&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%8F%8E%E7%9B%8A%E6%A7%8B%E9%80%A0&quot; aria-label=&quot;収益構造 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;収益構造&lt;/h3&gt;
&lt;p&gt;GitLab の収益は主に3種類の売上で構成されている。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Subscription&lt;/code&gt;: self-managed もしくは SaaS として提供されているプラットフォームのサポート、メンテナンス、アップデートの契約による定期収入&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;License&lt;/code&gt;: self-managed の GitLab において、有料の機能を利用するためのライセンス供与による収入&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Other&lt;/code&gt;: GitLab 導入の支援を行うサービスによる収入&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;収益を支えているのは self-managed つまり顧客が自分でパブリッククラウド等に GitLab をインストールして管理する方式で、売上の約8割を占めている。その一方で GitLab は SaaS も運営しており、これが直近1年で急激に伸びている。FY2020 では SaaS が売上に占める割合は 6.1% だったが、 FY2021 ではそれが 11.7% にまで伸びた。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/a84c1ccb371c8e60f2d4905c74934bac/3dde1/gitlab-self-vs-saas.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 36.075949367088604%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABi0lEQVQozz2Qz2tTQRSF8x9ZlbotFN25EGI31UWhG1dCoaCxBixZGBVps2iR7kqRp7RZuBEXUrtokVh0IxZEaAUbFEuTl5k378e8N/OVmSTvwIWB+82599yKEIIwDFGRID7rIk9P6PZyxrLWlSUcDBBiQKhiev0QdXZMt6fHlGecKq5JkXLch+crX/lUvcFU4y/1bU2SGQ8ZY+mdn5MZQ/bvlP/3Zjm8P8H15gm1NwVxakbDLZWRMYtByvSTPr8PDml3FFeWIlofUt/LC4Mxw0/NzT8E1QWSvR3a3zKuPpKsvB9yhbFU3CNUlqmG5PWBLqMutxOqq2oEGh8rVIbpZylr+yXG03cJMy2FLqxnvGGiLTdfRNS3ExfQN+ZeKeY3RoaFAWvIcrj1UlILVMnNb8Ql52/o1nR6+1lzqSa4u66orkZcq0v2f+ZlZFdOOx3N5Zrgzpridksx+Viyd+Q4TaZzd0Nbun/8nrOwFfMwUHz5lbndEEIipfQHH6O7P4bcgyCh4zlDpBRxHHMBdbby5uXbdpYAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;gitlab-self-vs-saas&quot;
        title=&quot;gitlab-self-vs-saas&quot;
        src=&quot;/static/a84c1ccb371c8e60f2d4905c74934bac/f058b/gitlab-self-vs-saas.png&quot;
        srcset=&quot;/static/a84c1ccb371c8e60f2d4905c74934bac/c26ae/gitlab-self-vs-saas.png 158w,
/static/a84c1ccb371c8e60f2d4905c74934bac/6bdcf/gitlab-self-vs-saas.png 315w,
/static/a84c1ccb371c8e60f2d4905c74934bac/f058b/gitlab-self-vs-saas.png 630w,
/static/a84c1ccb371c8e60f2d4905c74934bac/40601/gitlab-self-vs-saas.png 945w,
/static/a84c1ccb371c8e60f2d4905c74934bac/3dde1/gitlab-self-vs-saas.png 1018w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;また、 FY2022 の前半6ヶ月（2021/2 ~ 2021/7）では売上の 17.8% が SaaS からの売上になっている。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/c6f140955acc268b95d5dd8213ab61c2/d0fa6/gitlab-sales-last-six-months.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 22.151898734177216%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA1UlEQVQI1y3G2XKDIBQAUP//d/oF3ZJJ2saNiCGIV4xE1EgJbtB27EM7cx6OdxUCABopB2OctdYu/5bFWev+rrRrlW36r5teh3k103qf1nH2FueUvmszmGnWw8iAkyzDhNZtR3MgGaMsF3tEPmL8FlD/eCXAEYGUts+hd67VKyLbJCuNk3Y9XjpcdaAmUBPiDRZ9fhuBiFj2zNi0H06fY3CRZPmGd+ohLncnCEEW2lbjzz7ND7SMuURls8OZz6qoqJPHcPsSRAEN/TNO+ObpEOEiedj8AqC01obk878vAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;gitlab-sales-last-six-months&quot;
        title=&quot;gitlab-sales-last-six-months&quot;
        src=&quot;/static/c6f140955acc268b95d5dd8213ab61c2/f058b/gitlab-sales-last-six-months.png&quot;
        srcset=&quot;/static/c6f140955acc268b95d5dd8213ab61c2/c26ae/gitlab-sales-last-six-months.png 158w,
/static/c6f140955acc268b95d5dd8213ab61c2/6bdcf/gitlab-sales-last-six-months.png 315w,
/static/c6f140955acc268b95d5dd8213ab61c2/f058b/gitlab-sales-last-six-months.png 630w,
/static/c6f140955acc268b95d5dd8213ab61c2/40601/gitlab-sales-last-six-months.png 945w,
/static/c6f140955acc268b95d5dd8213ab61c2/78612/gitlab-sales-last-six-months.png 1260w,
/static/c6f140955acc268b95d5dd8213ab61c2/d0fa6/gitlab-sales-last-six-months.png 1263w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;数字は F-21 ページより引用した。&lt;/p&gt;
&lt;h3 id=&quot;地域別の売上&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%9C%B0%E5%9F%9F%E5%88%A5%E3%81%AE%E5%A3%B2%E4%B8%8A&quot; aria-label=&quot;地域別の売上 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;地域別の売上&lt;/h3&gt;
&lt;p&gt;地域別の売上を見ると、 FY2020 も FY2021 も売上の 80% 以上がアメリカから生じている。アジア太平洋地域の売上は全体の3%にも満たない。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 596px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/34a1399eca6304e4ccab1601009b80be/699b7/gitlab-revenue-by-geo.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 62.0253164556962%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACLUlEQVQoz3WSzWsTURTF8/8IgguxlKIttdW6cCu0iAs17gTpQhFMW2rTuuhCSHHR4l+hoLhqF25URFCo0IY0bUzjNJl8zLzMvI/5yXuTpMaPB2e4b86755377s0kSUJ/9WMT7NNp1mgGgvjkJ53KIW3RpewpWq0mvt9ESjmU018Z+wnDkDiOHWmMwaguWkm0NmgZo+MYpTVRrN1e2X9KYiy0SnOMcfmZ/g0DMYsk3ScuTgZxkhjs6T8xJGjFrDtbwpDof6AqH5GlHeTBDrK0jap+dgaM0aeCWmuH00T9D6Rui3eus3v1LMW5CXanzlC6P5u61D3Ber2OUuo3sQRt+AumV3J2vcq1R2Vu5Q+ZeVjmwcaxK9y+txP0PA8hhCvZvZdRQBuMD/okjRPhLrKCN17EjCxHjK/FnF+KuP0ytv5OBWu1Wtr6XnPC4x98WMnxKf+EL+vLvH88z8Hb12njjGauEDC22GY632F0oU12M0wdmrR5mSiKXFO6UXrT94pkIucznmsy87TFufkGz1+FjlNKM7cRMLbUYWrVCnbIbllOO27QFDfMPYd7NcP0M8GlFcHkmuDCYkjhXX+IYbYgGF0MuLwaMrIQcHdL9PJTPtMflcg6NDG7R11m1nwmlxtcyTcYzTUovOnY4XJnbhZaXFzyHTe24HNvs+XybIX2HZ1DKyiVQmuFiCSVumLvqM3XfY+yJ6m3pePsNFQbkmJV8K3oUap1OfYlWqnBpPwChnRuCqxUH2IAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;gitlab-revenue-by-geo&quot;
        title=&quot;gitlab-revenue-by-geo&quot;
        src=&quot;/static/34a1399eca6304e4ccab1601009b80be/699b7/gitlab-revenue-by-geo.png&quot;
        srcset=&quot;/static/34a1399eca6304e4ccab1601009b80be/c26ae/gitlab-revenue-by-geo.png 158w,
/static/34a1399eca6304e4ccab1601009b80be/6bdcf/gitlab-revenue-by-geo.png 315w,
/static/34a1399eca6304e4ccab1601009b80be/699b7/gitlab-revenue-by-geo.png 596w&quot;
        sizes=&quot;(max-width: 596px) 100vw, 596px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;数字は F-21 ページより引用した。&lt;/p&gt;
&lt;p&gt;日本では殆ど GitLab が使われていないか、もしくはお金の無い会社しか使っていないのかもしれない。なお、 GitLab は2021年2月に中国に GitLab Information Technology 社（JiHu）を設立したので、これから中国に投資していくのかもしれない。F-31 に単体の PL が載っているが、数字としてはまだまだ小さい。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/2817029fd86afbf58bbe7b8002a49d31/91e7e/jihu.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 68.9873417721519%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACGUlEQVQ4y5WSiU7bQBCG/f5PU1VVSwulEgLaEOUCJ03Jndje+EpCYu/G8fFVazcqICiqpU8z3vl3dmZnDdd1cYRALJdoX1vP8wiCANfzSoSoYloXhmEZX2qd7yOEQCrF8TOKPCNLDyV5lpKnaWWPpCnZ4VDZoyarfL1XxhH1mxqtZoMk2WOsZYIsIMpgl1b2f9iolFqny1WjQ6QSjPNml/rQZhblWIrSLuLiTeZxUeoHQYxpr/ja7DG2lxgfLmqcN0zqQ4v5LsVNwZIFtuQNCmxdwC5ltFbUB3MsL8Q4+d7krH7Lx8s6Zzcd2jOvFOqkT+EZ1doiznEUNEY2YvWA8flHi9ObDp+uG2j/buEjEh4l5RWqCsdrRc8JeXd+xXBuY5xcN9Cc1loM/F154ngtmW6SR60XL7esK4wyRivFlTlg4QYY35pdzLlLX6zoOyH3yw0/bZ+B94DYv5asWtetjlaSOyvgS63N2FpitKeCruVjLjzu3Q09O6BnBeX/dC3xEnBVgbvnKarAT2ASRkxXEa2RxUIPJUkSlFLsoog4jpFSIaUklpI0yyiAvCjIC55RlLHkcGA4HGGaZpnHuGj3qfUn9Cyf25kon44eirP/O5iXWj4OZbLZ0xg7vL+oIVZbjMvbX7THTnkfVpz/ubPHvD4UvWe+PeDIgtbYxtvGGJ2JQ3fulsm04Gmifz9srZ89JOWkB96WMFL8BjPxIDrBj7X/AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;jihu&quot;
        title=&quot;jihu&quot;
        src=&quot;/static/2817029fd86afbf58bbe7b8002a49d31/f058b/jihu.png&quot;
        srcset=&quot;/static/2817029fd86afbf58bbe7b8002a49d31/c26ae/jihu.png 158w,
/static/2817029fd86afbf58bbe7b8002a49d31/6bdcf/jihu.png 315w,
/static/2817029fd86afbf58bbe7b8002a49d31/f058b/jihu.png 630w,
/static/2817029fd86afbf58bbe7b8002a49d31/91e7e/jihu.png 692w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3 id=&quot;主要な顧客&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%B8%BB%E8%A6%81%E3%81%AA%E9%A1%A7%E5%AE%A2&quot; aria-label=&quot;主要な顧客 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;主要な顧客&lt;/h3&gt;
&lt;p&gt;116 ~ 117ページに GitLab の主要な顧客リストが載っている。これを見ると、大企業や公的機関で使われているようだ。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/5f3b50814894a794d0d04b00dc57c024/eb390/gitlab-customers.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 65.18987341772153%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAABZklEQVQ4y61T2YrCQBCc//8kX0QfRNEoUTyJqEkUiXgfiUdSSzV0yLqzx8M2FDNMT3dXX2a/36PX62EymWAwGGCz2eByueB6vSJJEsRxLPirmPl8juVyidVqhTAMsdvtxJHneeh2uxiNRvB9Hwz8fD7xer2wWCwwnU7Fbrvdyv/7/S5602q1RHG73YQJHyl8r9frOJ1OYkDQGaXRaKBarWI8HmO9XotT2qVpCkMjpqxpZVkmZ7PZRKVSQRRFX9JiEDK2pszIj8cjd6YOgyAQ5qylvhf1xf9FmKLSdrfJu+NPDG1RCNaD4J0ZvGfxHQwL/RtYcO3wT5Cm4J/FsGPE4XCQBmiq5/M5H3CdANXxP+eOosxyhhyNfr8vA308HqVWrEW73UatVoPrutJxbpB23HEc2SqS0PoSMtj8WFwt7R4NSqUSyuWyOCQj1XU6HQyHQ3vKtpmikDEdcbB55yapMNhsNrN2/QPiOu1keokmcwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;gitlab-customers&quot;
        title=&quot;gitlab-customers&quot;
        src=&quot;/static/5f3b50814894a794d0d04b00dc57c024/f058b/gitlab-customers.png&quot;
        srcset=&quot;/static/5f3b50814894a794d0d04b00dc57c024/c26ae/gitlab-customers.png 158w,
/static/5f3b50814894a794d0d04b00dc57c024/6bdcf/gitlab-customers.png 315w,
/static/5f3b50814894a794d0d04b00dc57c024/f058b/gitlab-customers.png 630w,
/static/5f3b50814894a794d0d04b00dc57c024/eb390/gitlab-customers.png 935w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;どうやら米軍でも使われているらしい。&lt;/p&gt;
&lt;p&gt;例えば陸軍のサイバー作戦の教育訓練を行う Cyber School では、コードを個人のラップトップに保存して Zip ファイルで送り合ったりホワイトボードを使って管理していたが、非効率で手間がかかっていたので Git ベースのソリューションを探しており、いろいろ試した結果 GitLab を選んだとのこと。現在は Cyber School で使われる資料や教材、試験の問題などが GitLab で管理されており、 CI パイプラインで採点して結果をウェブサイトに公開してくれるらしい。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://about.gitlab.com/customers/us_army_cyber_school/&quot;&gt;How the U.S. Army Cyber School created “Courseware as Code” with GitLab&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;GitLab では他にも国防総省のソフトウェア開発を支援する仕事をしているらしい。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://about.gitlab.com/press/releases/2020-07-01-gitlab-announces-hardened-container-image-in-support-of-the-us-department-of-defense-enterprise-devsecops-initiative.html&quot;&gt;GitLab Announces a Hardened Container Image in Support of the U.S. Department of Defense Enterprise DevSecOps Initiative&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&quot;github-vs-gitlab&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#github-vs-gitlab&quot; aria-label=&quot;github vs gitlab permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;GitHub vs GitLab&lt;/h4&gt;
&lt;p&gt;軍や役所、大学などの Public sector にとって情報の管理がしやすい self-managed の GitLab が魅力的に見えるのは理解できる。&lt;/p&gt;
&lt;p&gt;現在の GitLab と GitHub の間には&lt;strong&gt;普通のソフトウェア開発者にとっての&lt;/strong&gt;主要な機能にはあまり差が無い。下記のページが分かりやすいかもしれない。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.gitlab.jp/devops-tools/github-vs-gitlab.html&quot;&gt;https://www.gitlab.jp/devops-tools/github-vs-gitlab.html&lt;/a&gt;
&lt;sup id=&quot;fnref-5&quot;&gt;&lt;a href=&quot;#fn-5&quot; class=&quot;footnote-ref&quot;&gt;5&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;p&gt;いろいろ書いてあるのだが、 GitHub ではなく GitLab を選ぶ理由としては次のようなものがありそうだ。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;情報管理のポリシーが厳しく、ソースコードやそれをビルドした成果物、テスト、プロジェクトの進捗やドキュメントを社内で管理するサーバーに置かなければならない&lt;/li&gt;
&lt;li&gt;GitHub の可用性のレベルを許容できない&lt;/li&gt;
&lt;li&gt;2,000人を超える多人数の開発者がおり、 GitHub Enterprise の限界に達している&lt;/li&gt;
&lt;li&gt;GitHub リポジトリに対するアクセス制御や GitHub Actions の機能に満足できない&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;自分の印象としては「金が無い会社が使う GitHub」という印象があったが、実態としては逆に「&lt;strong&gt;金がある会社が使う GitHub&lt;/strong&gt;」という見方もできることが分かった。&lt;/p&gt;
&lt;h2 id=&quot;cf-を読む&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#cf-%E3%82%92%E8%AA%AD%E3%82%80&quot; aria-label=&quot;cf を読む permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;CF を読む&lt;/h2&gt;
&lt;p&gt;BS も PL も単純なので、特に見どころはない。Equity で調達した資金を開発や営業、マーケティング等の営業活動に使っている。&lt;/p&gt;
&lt;p&gt;前述の通り株式報酬が多いのと License/Subscription の deferred revenue（前受収益）があるので、 PL 上の損失ほど CF は悪くない。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/821aee3a51de7b36ac568a77f73fe8ab/6db71/gitlab-cf.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 56.32911392405063%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABpElEQVQoz32SzW7TQBSF/bIsWMIj8ATdwY4VEkWInwUbNoBEJVS1sGs3VdQkTqKG2Bn/JeOZO/OhGduJUSlXutZoPHP83XOcAGitadsW7z3OudhWBHEutnuovQejqSfXZKqI95MgGBZDh1rvFM8uXjNU3B+dGZ8V2TObX7LZbMPJTnAgDDShpuWaR19O+LHOOf+dxz0r9wkjYNtwO7kkyxQiciQ8jADMqg1Pz15wervg/WzZkTxAaJ0nzQsW6ZyqqkjCo2karLUdoYdpsebJ9+d8mC35lK7iRWMtvp/gL2897FuhriuMMSRZlsWRQzknHeEu5/HXE95MF1E0ThFE8dw124O3rvd2XIlSKiobrTFA/u6U9fkZV+WKlVKkqiBwbV69RF39JLM1n+dLvi3vwFqMCONgky4pQayNL+pfF5h0NuQLvhtz+/Et+8lNXF/nipuiOlIOf0IgjMYG/0QOHoXaG6HWDm37RIcxR2fcKJx7gqFj2iLRS21COxrtKHeOsrFUO6E1EkVDKD7+Ov8j7L8YEi3Lsg/paPxub1BFeRDy/yD8AxsFU/jOKJhDAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;gitlab-cf&quot;
        title=&quot;gitlab-cf&quot;
        src=&quot;/static/821aee3a51de7b36ac568a77f73fe8ab/f058b/gitlab-cf.png&quot;
        srcset=&quot;/static/821aee3a51de7b36ac568a77f73fe8ab/c26ae/gitlab-cf.png 158w,
/static/821aee3a51de7b36ac568a77f73fe8ab/6bdcf/gitlab-cf.png 315w,
/static/821aee3a51de7b36ac568a77f73fe8ab/f058b/gitlab-cf.png 630w,
/static/821aee3a51de7b36ac568a77f73fe8ab/6db71/gitlab-cf.png 659w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;今後は国外の事業や買収に投資していくと考えられるので、継続的に見ていきたい。&lt;/p&gt;
&lt;h2 id=&quot;最後に&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%9C%80%E5%BE%8C%E3%81%AB&quot; aria-label=&quot;最後に permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;最後に&lt;/h2&gt;
&lt;p&gt;本記事の冒頭に貼った GitLab のロゴ、ずっとキツネだと思っていたが実はタヌキらしい。 &lt;code class=&quot;language-text&quot;&gt;GitLab Tanuki&lt;/code&gt; と呼ばれている（そこ日本語なんだ…）。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://about.gitlab.com/blog/2015/07/03/our-new-logo/&quot;&gt;https://about.gitlab.com/blog/2015/07/03/our-new-logo/&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;footnotes&quot;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&quot;fn-1&quot;&gt;ちなみにこの記事を書いている現在は、機能に制約があるものの無料でいくらでも作れる。&lt;a href=&quot;#fnref-1&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;li id=&quot;fn-2&quot;&gt;前期末時点の ARR に対する当期末時点の ARR の割合&lt;a href=&quot;#fnref-2&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;li id=&quot;fn-3&quot;&gt;前期 ARR から当期末時点で解約済みの顧客の ARR を除いた割合&lt;a href=&quot;#fnref-3&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;li id=&quot;fn-4&quot;&gt;上場時に自動的に普通株式に転換される優先株を含む&lt;a href=&quot;#fnref-4&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;li id=&quot;fn-5&quot;&gt;これは GitLab が作ってるページなので当然 GitLab の機能が豊富に見える&lt;a href=&quot;#fnref-5&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content:encoded></item><item><title><![CDATA[ゼロから Rails チュートリアルをやってみた話]]></title><description><![CDATA[三行で要約 「Ruby on Rails チュートリアル - プロダクト開発の０→１を学ぼう」をやってみた Rails 便利そう Ruby をある程度やってから Rails チュートリアルを始めましょう Rails チュートリアルについて Ruby on Rails…]]></description><link>https://lyohe.github.io/2021-09-19-rails-tutorial/</link><guid isPermaLink="false">https://lyohe.github.io/2021-09-19-rails-tutorial/</guid><pubDate>Sun, 19 Sep 2021 03:58:12 GMT</pubDate><content:encoded>&lt;h2 id=&quot;三行で要約&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%B8%89%E8%A1%8C%E3%81%A7%E8%A6%81%E7%B4%84&quot; aria-label=&quot;三行で要約 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;三行で要約&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;「&lt;a href=&quot;https://railstutorial.jp/chapters/beginning?version=6.0&quot;&gt;Ruby on Rails チュートリアル - プロダクト開発の０→１を学ぼう&lt;/a&gt;」をやってみた&lt;/li&gt;
&lt;li&gt;Rails 便利そう&lt;/li&gt;
&lt;li&gt;Ruby をある程度やってから Rails チュートリアルを始めましょう&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;rails-チュートリアルについて&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#rails-%E3%83%81%E3%83%A5%E3%83%BC%E3%83%88%E3%83%AA%E3%82%A2%E3%83%AB%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6&quot; aria-label=&quot;rails チュートリアルについて permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Rails チュートリアルについて&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://rubyonrails.org/&quot;&gt;Ruby on Rails&lt;/a&gt; はプログラミング言語 Ruby を使って Web アプリケーションを作るためのフレームワーク。&lt;/p&gt;
&lt;p&gt;Rails チュートリアルは Ruby on Rails の初心者向けに Twitter ライクな Web アプリケーションを一から作るという基本無料（最新版は4章から有料: 980円+消費税）の教材で、毎日1&lt;del&gt;2時間 + 休日を丸々使って2週間&lt;/del&gt;1ヶ月かかる程度の分量がある&lt;sup id=&quot;fnref-1&quot;&gt;&lt;a href=&quot;#fn-1&quot; class=&quot;footnote-ref&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;。&lt;/p&gt;
&lt;p&gt;最後までやるとこんな感じの Web アプリケーションができる。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/0c3a458e5dca1be5f9b066ab9a283e9d/e9140/rails-example.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 65.18987341772153%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAABo0lEQVQ4y52TzU8bMRDF998FNkpyLseK3nqrOPAP9MilrSrSJCBVAg4ciqo0QUVBkDbNftnrxevNfvwqG4RQBaTKSO/g8eh53vOM529tsr39ip2dN7RaLYd2u43v+/hbPpsbGw7u/Ai2rtPpONj6brfrct7FZMyP0XduZjMmkwnj8Zjp1RU0DTfX14Sx4Fbn/G94ZlkhMkMQRkgpMcawLEuSJOHjpw/M5gGLwCJEpBlN01BVFXVdPwnP5DlKCnSmoKkfXiqk4HJwyO8gJopihLCdandnSZ+Dp4uSUC2JsiVBaghkTqAKgjDm9GjIPBIkQqK1fpHogfDs54LX7495u3/G3sGI3c8j3h1c8PV8yvGgx58oIUkEMlUUZe28fZGwripynWFyTVOV0FROVpmmTIdWcuT8VUqtlOsI//0lm7RhCfpHQ+dhnFjZAp2b1R4+lbShheBbz0q+81BISW6K1YTPdZinkvN+n3mYuA6VSinLcn3JqVL0Bl9YhFbyHamdw7U7NEJw2R/w69Ec6vuNWYvQDvrJ4ZBQKFR26zbIbsgqyX8BO77OGb4LeJoAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;rails-example&quot;
        title=&quot;rails-example&quot;
        src=&quot;/static/0c3a458e5dca1be5f9b066ab9a283e9d/f058b/rails-example.png&quot;
        srcset=&quot;/static/0c3a458e5dca1be5f9b066ab9a283e9d/c26ae/rails-example.png 158w,
/static/0c3a458e5dca1be5f9b066ab9a283e9d/6bdcf/rails-example.png 315w,
/static/0c3a458e5dca1be5f9b066ab9a283e9d/f058b/rails-example.png 630w,
/static/0c3a458e5dca1be5f9b066ab9a283e9d/40601/rails-example.png 945w,
/static/0c3a458e5dca1be5f9b066ab9a283e9d/e9140/rails-example.png 1226w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 id=&quot;背景&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%83%8C%E6%99%AF&quot; aria-label=&quot;背景 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;背景&lt;/h2&gt;
&lt;p&gt;プログラミングを始めた当初から TypeScript + Node.js を使っているのだが、 Web アプリケーションの開発に携わる身として全く Ruby on Rails に触れたことが無いのもどうなんだ？？と感じていた。そんなときとある筋から勧められたこともあって、 Rails チュートリアルを一通りやることにした。&lt;/p&gt;
&lt;p&gt;事前に Ruby を書いた経験は完全にゼロ。結果としては、 Ruby 経験なしで取り組むのは無謀だった。仕事でアプリケーションを作るレベルには全く達してはいないが、Rails がどういうものか雰囲気はつかめたと思う。&lt;/p&gt;
&lt;h2 id=&quot;結論から-自分の-ruby-on-rails-に対する印象&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%B5%90%E8%AB%96%E3%81%8B%E3%82%89-%E8%87%AA%E5%88%86%E3%81%AE-ruby-on-rails-%E3%81%AB%E5%AF%BE%E3%81%99%E3%82%8B%E5%8D%B0%E8%B1%A1&quot; aria-label=&quot;結論から 自分の ruby on rails に対する印象 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;結論から: 自分の Ruby on Rails に対する印象&lt;/h2&gt;
&lt;p&gt;まず明らかに優れている点として、機能を作って一通り動くまでが異常に早い。早いというより速い。雑な表現をすると「Web アプリケーション開発 RTA」のような存在だと思った。&lt;/p&gt;
&lt;p&gt;自分なりに考えた理由としては、&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;そもそも Ruby 自体が記述量を減らす工夫をいろいろしていそう&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;作者の思想？&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Rails がコマンドで自動生成するコードや組み込みの関数、特殊な記法でコードを書く量が大幅に減る&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;第2章を除いて &lt;code class=&quot;language-text&quot;&gt;scaffold&lt;/code&gt; を使わないが、それでも早い&lt;/li&gt;
&lt;li&gt;Web アプリケーションフレームワークって何なんだ？と不思議に思っていたが、以下の要素を集めたものということが分かってきた
&lt;ul&gt;
&lt;li&gt;ORM&lt;/li&gt;
&lt;li&gt;ファイルをいい感じに連結してまとめるためのモジュールバンドラー&lt;/li&gt;
&lt;li&gt;便利なヘルパー関数やクラスを集めたライブラリ&lt;/li&gt;
&lt;li&gt;ビューのテンプレート&lt;/li&gt;
&lt;li&gt;フレームワークの思想に沿った雛形のコードを自動生成したり定型的な作業（例えば migration 実行や seed 投入）を自動化するコマンド&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Rails ではアプリケーションを構成する概念が明確に定義され互いに密結合しているので、どこに何を書くべきかが明確&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ビジネスロジックやデータの操作を行う関数は全てモデルに書く&lt;/li&gt;
&lt;li&gt;ルーティングでどのコントローラーを呼ぶかを決める&lt;/li&gt;
&lt;li&gt;コントローラーが権限の制御をしつつモデルを呼んでビジネスロジックやデータベースの操作を実行する&lt;/li&gt;
&lt;li&gt;ビューは erb で組み立て、コントローラーからパラメータを渡して描画する&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;というところがある。&lt;/p&gt;
&lt;p&gt;しかしながら、この早さは Ruby と Rails に慣れている人が使ってこその早さであって、初心者は Rails のやり方を理解して自分の手で実践するまでに苦労すると思う。よくいえば「魔法」みたいな存在。慣れていない人は恩恵を受けるのが難しいし、逆に Rails に慣れている人を何人か集めたら物凄い早さで Web アプリ作れそう。&lt;/p&gt;
&lt;p&gt;また、自分が気になった点として、モデルが DB のテーブル定義と 1:1 で対応（n:1も可能？）していて、データの操作とビジネスロジックをふんだんに含みそうなところがある。これは欠点というか状況に応じて評価が変わる点で、コントローラーとモデル、ビューの関係がシンプルであれば特に困ることは無いと思う。&lt;/p&gt;
&lt;p&gt;チュートリアルで作る単純な Web アプリケーションのモデルでも結構いろいろ書かれている状態になる。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/da5d9201138c294778845dd31864c545/f43e4/rails-model-code.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 59.49367088607595%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABoUlEQVQoz5WS7XISMRhGI98FFoEiQu3gJQibzX5lN9kPoVJaq/3hjPd/IaddQB2ZOsUfZ5LMJGee980rpvGacbJhkD1QK34gzCPCfEOkFQ8HqvO5vJE5k+wLH3TJVBnmgeVSRozdkJpfUAtKxNIgPqXnUZcZfb3FCT/T9xIGvmXmxyyUTy9Z08puEW6OWFrE6gwaMmeQ3jKMSoaVUFlmKtoL56FmFBgcqem6yYnUvIBFtFTBu2LLVbnmYxCwUAETL2bsRXvRWxnTdTX16kFV+jI9rvYFDKLp5YyL78w3j8wiy7Xvcx0EzLyYqRczlNleVlGTBcJb79eWm9JYGZqrlGa1l78TlozsHVf5jvdRRl9qeipmIDVDqXGkpS8THE/TUPnrwrZf4iQbuuYex94zze6Y5F/pxJvDhb/KO6PkKqGjDSMTcWkt83KHo7f0kxu6YXlo9tL+afprn1IlvIgKWsGGi3BNxy+PKY5Jfl1emhPRP8amrUq6cU4nuqGlctpuQttNqUtzks6cN4dVwpHdstj9ZF7smMiQnkpoq+T/Zc88AcRqY1JYiXzbAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;rails-model-code&quot;
        title=&quot;rails-model-code&quot;
        src=&quot;/static/da5d9201138c294778845dd31864c545/f058b/rails-model-code.png&quot;
        srcset=&quot;/static/da5d9201138c294778845dd31864c545/c26ae/rails-model-code.png 158w,
/static/da5d9201138c294778845dd31864c545/6bdcf/rails-model-code.png 315w,
/static/da5d9201138c294778845dd31864c545/f058b/rails-model-code.png 630w,
/static/da5d9201138c294778845dd31864c545/40601/rails-model-code.png 945w,
/static/da5d9201138c294778845dd31864c545/f43e4/rails-model-code.png 1120w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;あとフロントエンド周りは気になった。クライアントサイドで仮想的な DOM を使って必要に応じてサーバーから取得したデータを使って更新があった箇所だけ再レンダリングする、というやり方はあまり Rails には合わなさそうな気がする。 もちろん、やってる会社はたくさんあるだろうし不可能ということは無いだろうけど…&lt;/p&gt;
&lt;p&gt;結局のところは長所と短所は表裏一体でそれぞれをどう評価するかというだけの話かもしれない。経験者を数人集めてそれなりの機能を備えた Web アプリケーションを素早く作るのにはとても向いてそう。10年以上にわたって多くの成功したスタートアップで使われてきた理由が分かった。&lt;sup id=&quot;fnref-2&quot;&gt;&lt;a href=&quot;#fn-2&quot; class=&quot;footnote-ref&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;h2 id=&quot;要約&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%A6%81%E7%B4%84&quot; aria-label=&quot;要約 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;要約&lt;/h2&gt;
&lt;p&gt;第1章から第14章までの内容を一通り要約してみた。ちょっとだけ自分の感想が入っている。&lt;/p&gt;
&lt;h3 id=&quot;第1章-ゼロからデプロイまで&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%AC%AC1%E7%AB%A0-%E3%82%BC%E3%83%AD%E3%81%8B%E3%82%89%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E3%81%BE%E3%81%A7&quot; aria-label=&quot;第1章 ゼロからデプロイまで permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;第1章 ゼロからデプロイまで&lt;/h3&gt;
&lt;p&gt;Ruby on Rails の簡単な説明、環境設定、 Cloud9 や Git/GitHub など基本的なツールの使い方、サンプルのアプリケーションを Heroku にデプロイする方法などを教えてくれる。&lt;/p&gt;
&lt;p&gt;Rails Tutorial では Cloud9 という AWS のクラウド IDE を使っている。これは環境設定の手間を省いてミスを防ぐためらしい。私は自分が使い慣れている Visual Studio Code とターミナルで進めることにしたが、特に問題はなかった。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;rails new&lt;/code&gt; で指定ディレクトリに簡単に Rails アプリケーションのスケルトンを作れるのは（create-react-app みたいで）とても便利だ。Rails 使ってる人からすると当たり前のことなのだろうが、 Web アプリケーションのディレクトリ構造を考えるのは面倒だし、これに沿ってやれ！！というのを強制された方が他人や他社のコードを読む上で楽そう。少なくとも Rails が向いているアプリケーションでは。&lt;/p&gt;
&lt;p&gt;なお、 rails new すると大量のディレクトリとファイルが生成されて初見では意味不明なのだが、デフォルトでどのディレクトリに何が格納されているかは本章内で説明されている。&lt;/p&gt;
&lt;p&gt;最後に何も機能がないシンプルな Web アプリを Heroku にデプロイしインターネットからアクセスできるようにする。 Heroku へのデプロイはアカウントを作って CLI からログインし Heroku にリポジトリを push するだけでよくて楽。&lt;sup id=&quot;fnref-3&quot;&gt;&lt;a href=&quot;#fn-3&quot; class=&quot;footnote-ref&quot;&gt;3&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;h3 id=&quot;第2章-toyアプリケーション&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%AC%AC2%E7%AB%A0-toy%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3&quot; aria-label=&quot;第2章 toyアプリケーション permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;第2章 Toyアプリケーション&lt;/h3&gt;
&lt;p&gt;ユーザーや投稿を作成したり削除したりするおもちゃ（Toy）のようなアプリケーションを作成しながら Rails の便利な機能を学ぶ。&lt;/p&gt;
&lt;p&gt;まずはデータモデルを考え、 &lt;code class=&quot;language-text&quot;&gt;scaffold&lt;/code&gt; を使ってデータを取得・操作するコードを自動生成する。これは短時間でアプリケーションを作るために非常に強力なツールだが、 Rails アプリケーションの初心者がこれを使うとアプリがどうやって動いているのか全く分からなくなってしまうそうなので第3章以降では一切使用しない。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;scaffold&lt;/code&gt; では定義したデータモデルに沿って実際のデータを作成 / 更新 / 削除をするためのルーティング、 Model / View / Controller を自動生成する。例えばチュートリアル内で定義された User モデルについては、&lt;code class=&quot;language-text&quot;&gt;config/routes.rb&lt;/code&gt; で &lt;code class=&quot;language-text&quot;&gt;/users&lt;/code&gt; のルートが Users Controller の index に割り当てられており、 Controller はアクションを実行して View の .erb を呼びだし結果として生成された HTML をルーターに返す。&lt;/p&gt;
&lt;p&gt;また、 ActiveRecord を使った簡単なデータモデル同士の関連付けを学ぶ。&lt;/p&gt;
&lt;p&gt;このように、ブラウザから操作をしたときに Rails のそれぞれの部品が何をしているのかを簡単に解説してくれる。第3章以降はこの &lt;code class=&quot;language-text&quot;&gt;scaffold&lt;/code&gt; を使って自動生成されるコードを手動で実装したり穴を埋めていくことで Rails の使い方を理解していく。&lt;/p&gt;
&lt;h3 id=&quot;第3章-ほぼ静的なページの作成&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%AC%AC3%E7%AB%A0-%E3%81%BB%E3%81%BC%E9%9D%99%E7%9A%84%E3%81%AA%E3%83%9A%E3%83%BC%E3%82%B8%E3%81%AE%E4%BD%9C%E6%88%90&quot; aria-label=&quot;第3章 ほぼ静的なページの作成 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;第3章 ほぼ静的なページの作成&lt;/h3&gt;
&lt;p&gt;静的なページの生成やそれに対する自動テストを実装する。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;rails generate HogeController fuga piyo&lt;/code&gt; のように generate コマンド（逆は destroy コマンド）でルーティングや Controller, View を生成し、それを編集していく。&lt;/p&gt;
&lt;p&gt;さらに、アプリケーションが期待通り動作しているか確かめるために自動テストを追加する。まずは Controller のテストを書き、Model のテストや統合テストは別の章で行う。&lt;/p&gt;
&lt;p&gt;テストは「実行可能なドキュメント」ということができ、バグを発見しやすくなるため一度上達すれば確実に開発速度が上がる。&lt;sup id=&quot;fnref-4&quot;&gt;&lt;a href=&quot;#fn-4&quot; class=&quot;footnote-ref&quot;&gt;4&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;p&gt;Controller のテスト自体は rails generate コマンドの実行時に &lt;code class=&quot;language-text&quot;&gt;/test/&lt;/code&gt; 以下に自動生成されるので、これを変更していく。未実装のアクションをテストして故意に失敗させ、そのメッセージを読みながらテストや実装を修正していく。&lt;/p&gt;
&lt;p&gt;個人的にこの方法は仕様を理解するのに良いなと思っていて、アプリケーションが何がどうなってるのか分からない内は特にテストを失敗させて仕様を学んでいくことで効率よく学習できそうだと感じた。ドキュメントがあるならそっち読んだ方が早いけど。&lt;/p&gt;
&lt;h3 id=&quot;第4章-rails風味のruby&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%AC%AC4%E7%AB%A0-rails%E9%A2%A8%E5%91%B3%E3%81%AEruby&quot; aria-label=&quot;第4章 rails風味のruby permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;第4章 Rails風味のRuby&lt;/h3&gt;
&lt;p&gt;最新のチュートリアルは4章から有料だったので、少し古い ver 5.1 を読むことにした。とりあえずやってみて良さそうだったら有料版を買おうかなと考えていたが、気づいたら最終章までやってしまった。Rails 6 で古いチュートリアルを進めるとたまにテストが落ちるので注意。&lt;/p&gt;
&lt;p&gt;4章では Rails で Web アプリケーションを開発する際によく登場する Ruby の機能、概念などを紹介している。コメント、文字列、オブジェクト、メソッドの定義、配列、ハッシュ（連想配列）とシンボル、クラスと継承など。&lt;/p&gt;
&lt;p&gt;印象的だったのはブロックを使ったイテレーションで、これを使うことで特定のデータの塊に対してコードを繰り返し実行することができる。同じような機能はほとんどのプログラミング言語に備わっていると思うけど、 Ruby のブロックはかなり簡潔に書ける気がする。
&lt;a href=&quot;https://docs.ruby-lang.org/ja/2.7.0/doc/spec=2fcall.html#block&quot;&gt;https://docs.ruby-lang.org/ja/2.7.0/doc/spec=2fcall.html#block&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Ruby 書いたことなかったので役に立ったけど、本来は Ruby 書けるようになってから読むべきコンテンツなので今からやる人は別のところで Ruby を勉強してください。&lt;/p&gt;
&lt;h3 id=&quot;第5章-レイアウトを作成する&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%AC%AC5%E7%AB%A0-%E3%83%AC%E3%82%A4%E3%82%A2%E3%82%A6%E3%83%88%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B&quot; aria-label=&quot;第5章 レイアウトを作成する permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;第5章 レイアウトを作成する&lt;/h3&gt;
&lt;p&gt;アプリケーションに簡単なレイアウトや Bootstrap による CSS を追加していく。また、 &lt;code class=&quot;language-text&quot;&gt;.html.erb&lt;/code&gt; 内で使う Rails のヘルパー関数を紹介してくれる。&lt;/p&gt;
&lt;p&gt;本章では Rails のモジュールバンドラーである Asset Pipeline や、静的なページへのルーティングを追加してページから遷移するためのビューの書き方などが説明されている。&lt;/p&gt;
&lt;p&gt;新しい Rails 6 を使って古いチュートリアルを勧めている場合は途中の &lt;code class=&quot;language-text&quot;&gt;javascript_include_tag&lt;/code&gt; で &lt;code class=&quot;language-text&quot;&gt;application.js&lt;/code&gt; が無いよというエラーが出てくるが、 &lt;code class=&quot;language-text&quot;&gt;javascript_pack_tag&lt;/code&gt; に変えれば動く。
&lt;a href=&quot;https://qiita.com/yaaasuuu/items/1d29954fda1f5fb8fc27&quot;&gt;https://qiita.com/yaaasuuu/items/1d29954fda1f5fb8fc27&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;第6章-ユーザーのモデルを作成する&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%AC%AC6%E7%AB%A0-%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%81%AE%E3%83%A2%E3%83%87%E3%83%AB%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B&quot; aria-label=&quot;第6章 ユーザーのモデルを作成する permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;第6章 ユーザーのモデルを作成する&lt;/h3&gt;
&lt;p&gt;第6章から第11章までは、第5章までに作ってきたアプリケーションにユーザー登録やログイン、パスワードを用いた認証システムを実装し、データを保存したり取得したりする実戦的なやり方を学ぶ。&lt;/p&gt;
&lt;p&gt;本章では、第2章で scaffold を使って生成したようなデータモデルの生成とデータを保存する手段を用意する。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;rails generate model&lt;/code&gt; コマンドでモデル、テスト、マイグレーション（データベースの構造をインクリメンタルに変更する手段を提供する）を自動生成し、変更を加えていく。なお、生成したマイグレーションは &lt;code class=&quot;language-text&quot;&gt;db:migrate&lt;/code&gt; コマンドで適用できる。&lt;/p&gt;
&lt;p&gt;自動生成されたモデルのクラスは &lt;code class=&quot;language-text&quot;&gt;ApplicationRecord&lt;/code&gt; を継承しており、 &lt;code class=&quot;language-text&quot;&gt;ApplicationRecord&lt;/code&gt; は &lt;code class=&quot;language-text&quot;&gt;ActiveRecord::Base&lt;/code&gt; を継承している。この &lt;code class=&quot;language-text&quot;&gt;ActiveRecord::Base&lt;/code&gt; が提供するメソッドを使ってデータの取得や操作、検証を行う。&lt;/p&gt;
&lt;p&gt;ActiveRecord はデータベースのテーブルの行をラップしたクラス（要はインスタンスと DB のレコードをマッピングしていろいろな処理ができる ORM）で、様々な便利メソッドが用意されている。&lt;/p&gt;
&lt;h3 id=&quot;第7章-ユーザー登録&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%AC%AC7%E7%AB%A0-%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E7%99%BB%E9%8C%B2&quot; aria-label=&quot;第7章 ユーザー登録 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;第7章 ユーザー登録&lt;/h3&gt;
&lt;p&gt;6章で作ったユーザーのモデルクラスをもとに、ユーザー登録するためのページを作成する。&lt;/p&gt;
&lt;p&gt;一口に「ユーザー登録するためのページ」と言っても必要な画面はいろいろある。「すでに登録されたユーザーを表示する」「ユーザーを登録する（フォーム）」「ユーザー登録成功 / 失敗したときの画面」などを作る。&lt;/p&gt;
&lt;p&gt;本章ではルーティングの定義やエラーページ追加、登録成功時のリダイレクトなどを実装し、よくあるフォーム付きのページとそのテストを完成させる。&lt;/p&gt;
&lt;h3 id=&quot;第8章-基本的なログイン機構&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%AC%AC8%E7%AB%A0-%E5%9F%BA%E6%9C%AC%E7%9A%84%E3%81%AA%E3%83%AD%E3%82%B0%E3%82%A4%E3%83%B3%E6%A9%9F%E6%A7%8B&quot; aria-label=&quot;第8章 基本的なログイン機構 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;第8章 基本的なログイン機構&lt;/h3&gt;
&lt;p&gt;第7章で追加したユーザー登録の仕組みを使って、ログインやログアウトの基本的な仕組みを実装する。&lt;/p&gt;
&lt;p&gt;HTTP はステートレスなプロトコルなので、本来リクエスト一つ一つは独立しておりそれより前のリクエストの情報を利用することはできない。したがって、ユーザーのログインが必要な Web アプリケーションでは「セッション」と呼ばれる半永続的な接続の識別情報をクライアントとサーバーで持つ。&lt;/p&gt;
&lt;p&gt;Rails でセッションを実装する方法として一般的なのは cookie を利用すること。セッションはサーバー上に保存されるが Active Record オブジェクトではないのでユーザー登録や削除とは少し実装のやり方が異なる。&lt;/p&gt;
&lt;p&gt;ログイン/ログアウトを実装したらログイン状態を判定するヘルパー関数を実装して、「ログインしているユーザーのみがこのページを見られる」等のテストを簡単に追加できるようにする。&lt;/p&gt;
&lt;h3 id=&quot;第9章-発展的なログイン機構&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%AC%AC9%E7%AB%A0-%E7%99%BA%E5%B1%95%E7%9A%84%E3%81%AA%E3%83%AD%E3%82%B0%E3%82%A4%E3%83%B3%E6%A9%9F%E6%A7%8B&quot; aria-label=&quot;第9章 発展的なログイン機構 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;第9章 発展的なログイン機構&lt;/h3&gt;
&lt;p&gt;第8章で追加した基本的なログイン機構では、ログアウト時にセッションが破棄され再度ログインが必要になるようなシンプルな実装をしていた。実際の一般的な Web アプリケーションでは cookie を使ってログイン情報を記憶することが多いので、本章ではそれを実装していく。&lt;/p&gt;
&lt;p&gt;また、Cookie を盗む方法は幾つかあるので、盗まれてもセッションハイジャックされないように cookie に保存するセッショントークンを暗号化する。&lt;/p&gt;
&lt;p&gt;Rails には、このような発展的なログイン機構を簡単に作るための便利な機能がいろいろ用意されている。&lt;/p&gt;
&lt;h3 id=&quot;第10章-ユーザーの更新表示削除&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%AC%AC10%E7%AB%A0-%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%81%AE%E6%9B%B4%E6%96%B0%E8%A1%A8%E7%A4%BA%E5%89%8A%E9%99%A4&quot; aria-label=&quot;第10章 ユーザーの更新表示削除 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;第10章 ユーザーの更新・表示・削除&lt;/h3&gt;
&lt;p&gt;第7章で作ったユーザー登録の機能を拡張子、ユーザーの編集や削除、ページネーションを含む一覧表示を行えるようにする。また、それらの機能を使う管理者として新たなロールのユーザーを追加し、一般のユーザーにはユーザーの編集や削除などの操作ができないようにセキュリティ上の制御機構を追加する。&lt;/p&gt;
&lt;p&gt;新しい Rails で 5 以前の rails チュートリアルを進めている場合は test で &lt;code class=&quot;language-text&quot;&gt;update_attributes&lt;/code&gt; メソッドを使っている箇所があるが、 rails 6.1 以降では非推奨になっているため動かない。該当箇所を &lt;code class=&quot;language-text&quot;&gt;update&lt;/code&gt; に書き換えると動くようになる。&lt;/p&gt;
&lt;h3 id=&quot;第11章-アカウントの有効化&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%AC%AC11%E7%AB%A0-%E3%82%A2%E3%82%AB%E3%82%A6%E3%83%B3%E3%83%88%E3%81%AE%E6%9C%89%E5%8A%B9%E5%8C%96&quot; aria-label=&quot;第11章 アカウントの有効化 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;第11章 アカウントの有効化&lt;/h3&gt;
&lt;p&gt;第10章までのアプリケーションでは、登録したユーザーはログインすれば直ちに全ての機能を使えるようになっていた。しかし、一般的な Web アプリケーションではメールアドレスを使ってアカウントを作成した際に本当にそのメールアドレスの所有者であるかを確認する必要がある。&lt;/p&gt;
&lt;p&gt;第11章ではメールを使ってアカウントを有効化するためのトークンを生成しそれをメールで送付、メールに記載されたリンクをクリックすることでアカウントを有効化する機能を実装する。&lt;/p&gt;
&lt;p&gt;Rails でアプリケーションを作るときの流れ（↓）がよく分かるいい章だった。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;rails generate&lt;/li&gt;
&lt;li&gt;テスト書く（失敗)&lt;/li&gt;
&lt;li&gt;実装&lt;/li&gt;
&lt;li&gt;テスト（成功）- 必要に応じて migrate &amp;#x26; seed 投入&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&quot;第12章-パスワードの再設定&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%AC%AC12%E7%AB%A0-%E3%83%91%E3%82%B9%E3%83%AF%E3%83%BC%E3%83%89%E3%81%AE%E5%86%8D%E8%A8%AD%E5%AE%9A&quot; aria-label=&quot;第12章 パスワードの再設定 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;第12章 パスワードの再設定&lt;/h3&gt;
&lt;p&gt;第11章で追加したアカウントの有効化メールを使って、パスワードの再設定を実装する。&lt;/p&gt;
&lt;p&gt;基本的な手順は以下の通り。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ユーザーがパスワードの再設定をリクエストすると、メールアドレスをキーにしてユーザーを見つける&lt;/li&gt;
&lt;li&gt;該当ユーザーがいれば再設定用トークンとそれに対応する再設定用ダイジェストを生成する&lt;/li&gt;
&lt;li&gt;再設定用ダイジェストはデータベースに保存しておき、再設定用トークンはユーザーに送信する&lt;/li&gt;
&lt;li&gt;ユーザーがメールのリンクをクリックすると、データベースに保存しておいた再設定用ダイジェストと比較して認証する&lt;/li&gt;
&lt;li&gt;認証に成功したらパスワード変更用のフォームをユーザーに表示する&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;再設定機能を使ってアカウントを乗っ取られないように、再設定用のリンクには短い期限を設定することと、再設定用のダイジェストを使うことが重要。&lt;/p&gt;
&lt;h3 id=&quot;第13章-ユーザーのマイクロポスト&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%AC%AC13%E7%AB%A0-%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%81%AE%E3%83%9E%E3%82%A4%E3%82%AF%E3%83%AD%E3%83%9D%E3%82%B9%E3%83%88&quot; aria-label=&quot;第13章 ユーザーのマイクロポスト permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;第13章 ユーザーのマイクロポスト&lt;/h3&gt;
&lt;p&gt;Twitter のかんたんなクローンを作るためにユーザーが投稿するためのモデルやコントローラー、基本的なビューを作成する。さらに、そのビューにユーザーを関連付け、結果を処理し表示するために必要なフォームを作成する。&lt;/p&gt;
&lt;p&gt;個人的には第11章とこの章が Rails の威力、というか開発の早さを実感できると思う。ユーザーが投稿する画面や投稿一覧のフィードを一瞬で作れて、一気に Web アプリケーションっぽさが増す。初期の Twitter は Ruby on Rails を使って作られたらしいけど、それも納得できる便利さだった。&lt;/p&gt;
&lt;p&gt;新しい Rails で古いチュートリアルを進めている場合はこの章の途中で謎に NameError というエラーでテストが落ちるのでこれをやる必要がある（spring を再起動したら治った）。
&lt;a href=&quot;https://qiita.com/yokoyan/items/0f82fc3eede75cd6db55&quot;&gt;https://qiita.com/yokoyan/items/0f82fc3eede75cd6db55&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;第14章-ユーザーをフォローする&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%AC%AC14%E7%AB%A0-%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%82%92%E3%83%95%E3%82%A9%E3%83%AD%E3%83%BC%E3%81%99%E3%82%8B&quot; aria-label=&quot;第14章 ユーザーをフォローする permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;第14章 ユーザーをフォローする&lt;/h3&gt;
&lt;p&gt;最終章。&lt;/p&gt;
&lt;p&gt;13章までで作った Twitter ライクな Web アプリケーションに他のユーザーをフォロー・フォロー解除できる仕組みと、フォローしたユーザーの投稿を表示する機能を追加する。ある機能を実現するためのデータをどうモデリングするか、 SQL を利用したデータの取得の工夫などを取り扱う。また、ちょっとした jQuery を通じてフォロー・フォロー解除の Web インターフェースを追加する。&lt;/p&gt;
&lt;p&gt;最後にサンプルとして作ったアプリケーションの機能を拡張するためのアイデアや今後役に立つであろう読み物を紹介して終了。&lt;/p&gt;
&lt;p&gt;分からないことがあったら &lt;a href=&quot;https://railsguides.jp/&quot;&gt;Ruby on Rails ガイド&lt;/a&gt;という Web サイトを見ればいいらしい。&lt;/p&gt;
&lt;h2 id=&quot;最後に&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%9C%80%E5%BE%8C%E3%81%AB&quot; aria-label=&quot;最後に permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;最後に&lt;/h2&gt;
&lt;p&gt;Rails チュートリアル、とても長いけど「フレームワークってこんなことしてるんだ」というのを掴むのには良い教材なので、興味ある人はやってみてはどうでしょうか。&lt;/p&gt;
&lt;p&gt;これを1周やっただけでは自力でアプリケーションを開発できるようにはならないけど、 Ruby にしても他の言語で Web アプリケーションを作るにしてもこれをやった経験は役に立つと思う。&lt;/p&gt;
&lt;div class=&quot;footnotes&quot;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&quot;fn-1&quot;&gt;最初に推薦文を書いてる人が「3日で終わらせました」って書いてあったけど絶対嘘だろって思う分量だった。&lt;a href=&quot;#fnref-1&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;li id=&quot;fn-2&quot;&gt;日本だと &lt;a href=&quot;https://www.ruby.or.jp/ja/showcase/case22.html&quot;&gt;freee&lt;/a&gt; や&lt;a href=&quot;https://codezine.jp/article/detail/10988&quot;&gt;クックパッド&lt;/a&gt;、アメリカだと &lt;a href=&quot;https://github.blog/2019-09-09-running-github-on-rails-6-0/&quot;&gt;GitHub&lt;/a&gt; や &lt;a href=&quot;https://www.youtube.com/watch?v=ohHdZXnsNi8&amp;#x26;t=716s&quot;&gt;初期の Twitter&lt;/a&gt; が有名？AirBnB も創業から最近まで？ずっと Rails 使ってたらしい（&lt;a href=&quot;https://medium.com/airbnb-engineering/rearchitecting-airbnbs-frontend-5e213efc24d2&quot;&gt;Rearchitecting Airbnb’s Frontend&lt;/a&gt;）。&lt;a href=&quot;#fnref-2&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;li id=&quot;fn-3&quot;&gt;ちなみに Heroku では利用開始時にイタリアに住んでるか聞かれるのだが、これはイタリア民法1341条で明示的に同意が必要な内容が利用規約内に存在するらしい。イタリア以外はいいのか？？&lt;a href=&quot;#fnref-3&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;li id=&quot;fn-4&quot;&gt;テストをいつ何に対して書くかは流派が分かれるが、アプリケーションのコードより明らかにテストコードが短くシンプルであれば先にテストを書くほうがよいと思う。&lt;a href=&quot;#fnref-4&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content:encoded></item><item><title><![CDATA[ウォルマートの財務諸表を読んだ話]]></title><description><![CDATA[最近、アマゾンの商品取扱高がウォルマートを抜いたという記事を見かけた。 https://www.nytimes.com/2021/08/17/technology/amazon-walmart.html…]]></description><link>https://lyohe.github.io/2021-08-22-walmart-financial-statements/</link><guid isPermaLink="false">https://lyohe.github.io/2021-08-22-walmart-financial-statements/</guid><pubDate>Mon, 23 Aug 2021 03:15:34 GMT</pubDate><content:encoded>&lt;p&gt;最近、アマゾンの商品取扱高がウォルマートを抜いたという記事を見かけた。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.nytimes.com/2021/08/17/technology/amazon-walmart.html&quot;&gt;https://www.nytimes.com/2021/08/17/technology/amazon-walmart.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;中国を除く小売最大の企業といえばウォルマートというイメージがあったので、この記事は強く印象に残った。「コロナの影響やオンライン対応の遅れ等が重なってアマゾンに抜かれたんだろうな」とありきたりな感想を抱いたが、冒頭の記事の最後の方を読むと気になることが書いてある。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;During the pandemic, Walmart honed its ability to use its stores as mini-distribution centers, where shoppers drive to retrieve their purchase “curbside,” a far less costly way to fulfill online orders than delivery. On Tuesday, Walmart said it expected to generate $75 billion in total online sales this year. The company has been expanding its effort to build its own marketplace, but the vast majority of its online sales still come from its own inventory, Mr. Kaziukenas said.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ウォルマートはパンデミックの間、店舗を物流拠点として整備しており、顧客は購入した商品を curbside と呼ばれる場所に車で取りに来る。今年のオンライン販売総額は&lt;strong&gt;750億ドル&lt;/strong&gt;と予想している…とある。これは日本円にすると8兆円を超える金額で、&lt;a href=&quot;https://www.meti.go.jp/press/2020/07/20200722003/20200722003.html&quot;&gt;日本全体の BtoC - EC 市場における物販系分野&lt;/a&gt;の約8割に相当する規模だ。&lt;/p&gt;
&lt;p&gt;つまり、アマゾンが凄すぎるだけでウォルマートもオンラインのビジネスを十分に成長させていると言える。ウォルマートの事業がどうなっているのかが気になったので、決算を読んでみることにした。&lt;/p&gt;
&lt;p&gt;数字は基本的に Form 10-K と 四半期の Presentation から拾っていく。以下、金額の単位として $1M = $1Million（百万ドル）、 $1B = $1Billion（十億ドル）とする。&lt;/p&gt;
&lt;h2 id=&quot;ウォルマートの決算概況&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%82%A6%E3%82%A9%E3%83%AB%E3%83%9E%E3%83%BC%E3%83%88%E3%81%AE%E6%B1%BA%E7%AE%97%E6%A6%82%E6%B3%81&quot; aria-label=&quot;ウォルマートの決算概況 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;ウォルマートの決算概況&lt;/h2&gt;
&lt;p&gt;ウォルマートは決算期を1月にしている。日本の小売業は2月決算が多いが、これは日本と US で繁忙期が少しだけずれているからかもしれない。US だと11月-12月、日本だと12月-1月が忙しいのでその後に決算期を置いていると考えられる。&lt;/p&gt;
&lt;h3 id=&quot;財政状態&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%B2%A1%E6%94%BF%E7%8A%B6%E6%85%8B&quot; aria-label=&quot;財政状態 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;財政状態&lt;/h3&gt;
&lt;p&gt;まずは BS を FY2017-FY2021 の5年分並べてみた。金額の単位は $1M。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/1eff08f9a1e22737dd6b6a890a2fb07d/6db71/walmart-bs.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 55.69620253164557%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACd0lEQVQoz42SyWsUQRjF5+bJP8F/QfGqFxEkh3gQMSYYFzBIjFFQ3KIkh7igqEjwoLhGVNTgjhqMqGEUjUhilCS4jFnGTKad6S2T7pnuqurun3SLUW8++KiiqHr1fe+9FICrFFnDwDQtVHGUkqGTtw0mLI1pu4RwJpi2NOzpEkVdx9GLOFM5dMsgb0m0goHwPaIoIhUTVjwPu1RCKUUo/WSVSuEriVIBgfIRUiRncQVSoqQgQURy33EcPM8jFbP+jSCKCPk/DBgTvDeNf+4nHQZBgJQy+e03wjBEBSrZf58x6JnMUFHQMdLNmvRDdC+krruNZU/u48iIKFBJpykhBG65jKh4WP4M9elLXB/N8cnOsqi7g6d5h0djj5nX1UqPHtHb187Su6cYKoM+sJyGVw/QJYiym0iXMk0z0SfRslyg6UoNTUN5KsV+mi/WcmRKwWAXp0+uo8dy4dIJevdUYZQ0nDMN9J6swReVPyNbloXrOshYO9vG2LiY4o2NhF+/kaldQKa/E+fZa4zquTDcydS5q7AqBVof2T37YfMcqPzAVyCFIBXP7XsenlIoy+bL6irGLu7F/zbGcPVCtKcXcNNpPq6YjzHSi3XhLG83LKFUzJJv3cm9lr2UPZ9YOt/3f5ky64b9g5f1m2i6C2QGuLxyF4feAS9ucriug5vjwNmDNG55zuA0mPuaWd8+jiH/sCSxiSuInS1Okd7QSMttHz73c231DjreAM9vcXztMe5kQJw/yu6td/igg9a2nW0HBii4MZsiTuBsDuOYxIE1J3MUrAqh8NHGv2M6AlV2yE3kcLwAYZtksxq+DHELGrm8hQzC5H1syk8Z9A9PuKirjwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;walmart-bs&quot;
        title=&quot;walmart-bs&quot;
        src=&quot;/static/1eff08f9a1e22737dd6b6a890a2fb07d/f058b/walmart-bs.png&quot;
        srcset=&quot;/static/1eff08f9a1e22737dd6b6a890a2fb07d/c26ae/walmart-bs.png 158w,
/static/1eff08f9a1e22737dd6b6a890a2fb07d/6bdcf/walmart-bs.png 315w,
/static/1eff08f9a1e22737dd6b6a890a2fb07d/f058b/walmart-bs.png 630w,
/static/1eff08f9a1e22737dd6b6a890a2fb07d/6db71/walmart-bs.png 659w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;流動資産は現金を除くとほぼ全てが在庫で、固定資産は大部分（8割以上）が店舗等の設備となっている。&lt;/p&gt;
&lt;p&gt;典型的な小売業の BS の特徴として、売上に対する売掛金の額が小さいことがある（顧客はその場で対価を支払うため）。一方で、取引先に対して仕入の対価を支払うときは月締め翌月末払いという支払いサイクルが一般的なので、その分だけ会社は現金を留保できる。&lt;/p&gt;
&lt;p&gt;ウォルマートでは売上に対する売掛金の割合は 1% 強であるのに対し、仕入に対する買掛金の割合は 11 - 12% 程度となっている。たかが 1 - 2 ヶ月分とはいえウォルマートの規模だと $30B - $40B という大金になる。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/ad7c43f2376be99bec94c4668cbd9955/6e9ba/receivable-payable.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 50.632911392405056%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAACEUlEQVQoz02STWsUQRCG938pKGjixYOCgngKGshBBcEfoheVfAlB8CB4ED3kJCa6u2MSQhI1njSfmkx2Z3ZmdrunP+eR6YEkfSiK7q6HqvetFoDWGuccUFFIx79egZUxWZagpaLIcgrhkVKQSUVWKIQY4irCMUZjjAl5q6oqlFJYa6kqjwd8Bd5K7GAN7z2uPMYcfaCuN/Ei6vfTkNv+Mq7YRpQ2QAOwDmVZYq1pCg5f4+UBlU5RnYvgFD6NUO0LocDuvkSt3w252pxE7zxHaHBWn3XYjGzDRRmNY/tLlLpg0BlD6iEiiRh0r6GAYneO4eZUA/zxCLM3F4DWqAaY5zlSiNMOk5VbpPFnRDkg7VxFqJxhv0Naw2vgzgzp+j2yOt+YwuzNBqDRZZCulSRJADrXAOXqDVzSprIS1b3SjDxYRUVjzch78+jN++Fv+f0BencWaWrZRhRFQUtKGcjONi6ptZvYpA1OIKOrVK6EfAUZjYd3fziP3Jhs4D8fBuBIgXfmzJQaWos6MlB0r+OTLwzFCNm+hDUlJwcRKrocNDzZnsZtTZBVEH+bwu1PN6a4c2vjfPCXV0uer28n8EfLzLzfZ3/xNvHfE54tfEJ177D1B17MTsOvJ3xchXcLj+H4DYU853Idaqj3jiRXpGmM94Y4FRRZjHWe435OOepRmoqjuIdVGaPS0+vFOCPQxpxuyX8eyeKqGPyAOQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;receivable-payable&quot;
        title=&quot;receivable-payable&quot;
        src=&quot;/static/ad7c43f2376be99bec94c4668cbd9955/f058b/receivable-payable.png&quot;
        srcset=&quot;/static/ad7c43f2376be99bec94c4668cbd9955/c26ae/receivable-payable.png 158w,
/static/ad7c43f2376be99bec94c4668cbd9955/6bdcf/receivable-payable.png 315w,
/static/ad7c43f2376be99bec94c4668cbd9955/f058b/receivable-payable.png 630w,
/static/ad7c43f2376be99bec94c4668cbd9955/6e9ba/receivable-payable.png 731w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3 id=&quot;損益&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%90%8D%E7%9B%8A&quot; aria-label=&quot;損益 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;損益&lt;/h3&gt;
&lt;p&gt;PL を FY2017 - FY2021/1 の5年分並べてみた。金額の単位は $1M。&lt;/p&gt;
&lt;p&gt;FY2021 の売上は $559,151M で、2020年度の日本の税収（608,216億円）とほぼ等しい。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/7d82fc3b49cec905173796ef6e2a8c97/e9beb/walmart-pl.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 50.632911392405056%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABy0lEQVQoz02S607bQBBG/f4PQlVVpdALalFbSAgkJA2tUJUEwo8mUAm5MbbXTrL3U+3apbG00pnZ2W808znZas99WqOylKfHlFqkSPHAKiuotmvKSpDnOaKqMHKNyDOKoqCu10ijqERBKQR1XWOtJfEeNpsNSinA471BGQ24GFvrntk7h7HNCfFDZnnMbWRtDMYYEna+5crx8GTwSM7mFde/a2DL8UQwWlSRP1wLzu4a3rssOf65iW+dbzQS7z2iCg8V+yNNZ6rjxYsLydlMx+6Bu9OGXw0Up5OG340VnZal0mitScqyjEEsuNKc35ooGMQHdy0PNf15wwffNL2bhkN9Z9pwWI1zjiTLMrSxMfl2rDlvi18PFYP5f+63jQ5Gmt6s4fdXmu4/QRf270mCIUUp4sih48lEhmv2LiUnNzs8k9GclyPFl4mKvD9WfG35eeTdhR6ODRfz4KBm/6JkOJfPPLjdxqZv+gXd2TbmDwc53XYiv2uKjYqWjz8U3dMp2HuORoJ+bwr+kaNRyXlnAqR8Ggt6gd2Cz98rOqFep0htceE/bNQ9zlk20rBaLjDbnLWCP8slWgo2OvA9RtaR08Uv9HrV5heRTWvKX0Ou8s7x4YOAAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;walmart-pl&quot;
        title=&quot;walmart-pl&quot;
        src=&quot;/static/7d82fc3b49cec905173796ef6e2a8c97/f058b/walmart-pl.png&quot;
        srcset=&quot;/static/7d82fc3b49cec905173796ef6e2a8c97/c26ae/walmart-pl.png 158w,
/static/7d82fc3b49cec905173796ef6e2a8c97/6bdcf/walmart-pl.png 315w,
/static/7d82fc3b49cec905173796ef6e2a8c97/f058b/walmart-pl.png 630w,
/static/7d82fc3b49cec905173796ef6e2a8c97/e9beb/walmart-pl.png 730w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;BS よりも PL の方が金額が大きい典型的な小売業の PL と言える。在庫の金額が売上高の 8~9% なので、平均して1ヶ月で1回転する計算になる。売上高営業利益率は 4% 程度であり、特別マージンが大きいわけではない。&lt;/p&gt;
&lt;p&gt;売上は毎年 YoY で +2~3% を維持していたが、 FY2021/1 はコロナ禍の中で +6.7% と大きく伸びた。日本ではセブン&amp;#x26;アイグループが FY2021/2 で前年比 ▲13.2%、イオングループが同期間で ▲0.0% なので、ウォルマートは日本の小売業よりも COVID-19 の感染拡大にうまく対応していると言えそうだ。&lt;/p&gt;
&lt;p&gt;なお、ウォルマートの連結売上高では +6.7% だが、ウォルマート US とサムズクラブ（主に US で展開している）の売上は +10% 近く伸びている。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/6d8d8179f8a9d521a7abe90fea6b1736/6bff2/4-5-4-compare-sales.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 55.69620253164557%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACW0lEQVQoz4WRS2sTURiGs/cXuNFe6D8RF66KShURFXXrxo3gBaELQehCKV7oRUUUSynYFGorbY1UQ0qboq2W2jSZzCQzuadN55aZzOWRSXqx3fjBe87hO+c85z3fFyrrDaSaRXqrvq9MzaKoOyiqjbBtI9Zssjs2Uq1BSW8QhO+zO/uHFCqWK/xJCkhyDkGSETIKKTGDECgjs54U2EgKJASJ9c0Upu3sgjxU3eRohIINz3XB9/A9r3nQ89xmruG46JqOaRhouomuaQEKpbBFtrBDZFnGrFtYVgPbbrQc7pH9f77xvxiJCMzFs0zFRH5slFleLzC7KO459A+BjkIP6gOe5zVzQzMSo99k3s6JLP6SGfueZXAysQds+Qusr6UKgIfrujiOjec6B2DP3X/t1YzIWFTm3ReRD19FRqMKg1PJFjAYltZyfIrneTK+QfR3ntmVEuFYhqJqU1XrlGsmuZqFZTv4+Ax8FhmZz/JmVmR4RmJkXub5ROIAGF7IMRXPE15QGIsqjMcU3kckEnmdn+ltIqtFViWV1XSVFaFCOKYwHc8zEZObdyaXcnyMZtnWDEJOo0GlWsWs19F1A8MwMEwT0zTRDRPDMNF1E1VrdVrVTOp1q9nVQJZl4zit0jwYmiYk54pspgTSYoaUkCaZTJFMpZrrfKFIqVKlWA5UoViqUCiVyeULTRM7qkZN1ZByZXoHxjl2+j6hrp5e2rvv0tZ9j7azD2nveUTHpT46rvTTce0lnTeG6bz5uqXrQ3RcfUH75aecvPCYE+d6OXP7Gadu9dN1/g7HL/bxF2gREeq2zluzAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;4-5-4-compare-sales&quot;
        title=&quot;4-5-4-compare-sales&quot;
        src=&quot;/static/6d8d8179f8a9d521a7abe90fea6b1736/f058b/4-5-4-compare-sales.png&quot;
        srcset=&quot;/static/6d8d8179f8a9d521a7abe90fea6b1736/c26ae/4-5-4-compare-sales.png 158w,
/static/6d8d8179f8a9d521a7abe90fea6b1736/6bdcf/4-5-4-compare-sales.png 315w,
/static/6d8d8179f8a9d521a7abe90fea6b1736/f058b/4-5-4-compare-sales.png 630w,
/static/6d8d8179f8a9d521a7abe90fea6b1736/40601/4-5-4-compare-sales.png 945w,
/static/6d8d8179f8a9d521a7abe90fea6b1736/6bff2/4-5-4-compare-sales.png 957w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;上図は &lt;a href=&quot;https://s2.q4cdn.com/056532643/files/doc_downloads/Factbook/2021/FY21-Fact-Book-FINAL.pdf&quot;&gt;FY2021 の Financial Factbook&lt;/a&gt; の5ページより引用した&lt;sup id=&quot;fnref-1&quot;&gt;&lt;a href=&quot;#fn-1&quot; class=&quot;footnote-ref&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;。&lt;/p&gt;
&lt;h4 id=&quot;covid-19-の影響&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#covid-19-%E3%81%AE%E5%BD%B1%E9%9F%BF&quot; aria-label=&quot;covid 19 の影響 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;COVID-19 の影響&lt;/h4&gt;
&lt;p&gt;より詳しく見ていくと、事業セグメントごとに COVID-19 の影響が異なることが分かる。&lt;/p&gt;
&lt;p&gt;ウォルマート US では Transactions（取引数）が大きく減っているが、 Average Ticket（平均単価）はそれ以上に増えており、結果として 10% 近く売上が伸びている。サムズクラブ（コストコみたいなやつ）の方は平均単価よりも取引数の伸びの方が大きい。&lt;/p&gt;
&lt;p&gt;つまり、それだけまとめてたくさん買う人が増えたということになる。サムズクラブは元々まとめ買いする人が行くところなので。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/5d965985fe620633f8cdca13743a2bb1/6bff2/4-5-4-covid-effect.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 56.32911392405063%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACjklEQVQoz32SS28TVxiGZ99f0AVtIeWfVN1UCAmBRKWqRW3X3XSRRdkQdlwqoRAnokGoF9LiJOIWIQT8ATBxUtuJ44ztuc+ZMzc74/HEMYmfaiZtlxzp0fd+33vOkV6do8TZO3ajEUb/ALl/iNw/Ihod0X83IRgdYaeHiOwQf/8Id3hIbzzhfUvJRmP6aUa4N2TxcZ1rf1S486jGbLnKzaV1fv5znRv33zK3sklpdZObS28pLVeZK1eZX9ng17U6t8vH/V56gOL7Pq2dJoMkwXJ8WqpBR7dpdy3UjklL1dFMQUez6WgWmiFo7uq0Naegozuoms1O22A0OkAJw5DqxgbD4ZDBIMG2TFzXwfMEQrjYtkkcR/i+REqPOAoRwiEMfcLAJwyDonrCJcuGKNLzqFQqpGlKstfDdSx8KQqk5+LYJlHoF31+KNeuYxP4HoEvC3JPuDZZlqEM0hRN00iSAYYbsaVaNNv2/zRaBjsdh23VKvhP516uW12XpmqzrdoMsxFKflGvFxPFfX5f+5tSucLyyy1+e7pZ6PlyhTur6zx4Xmf5RZ3Fh1XmHrxhYWWdpWc1Vl81uP+sxuxfrxkMD1C63S6GYTAej9nr/xvZE4RFJA/bMoo4eXTT0PCEg6F3i5ll6gWmqeOYGroboIRBQC+OYTIhSRKCIMD3A+I4Lsh/QTGT+aNIoigqahhGhSelX+ybjFKmS09QLMdjs9agsd2k3tiiVm+gttt0NR1HeAgZ4MoAIcNj7Ulc4R17ufYkquEw88tjPvj8MsqnF67w0ZlpTuSc/YkT52Y4+eUNpr6eZerSAlPf3WXq+3vHfLvIqW/mOfnVLT65eI2Pz1/lix9LfPbDLKfPT/Phxev8A+8g+S66HRLaAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;4-5-4-covid-effect&quot;
        title=&quot;4-5-4-covid-effect&quot;
        src=&quot;/static/5d965985fe620633f8cdca13743a2bb1/f058b/4-5-4-covid-effect.png&quot;
        srcset=&quot;/static/5d965985fe620633f8cdca13743a2bb1/c26ae/4-5-4-covid-effect.png 158w,
/static/5d965985fe620633f8cdca13743a2bb1/6bdcf/4-5-4-covid-effect.png 315w,
/static/5d965985fe620633f8cdca13743a2bb1/f058b/4-5-4-covid-effect.png 630w,
/static/5d965985fe620633f8cdca13743a2bb1/40601/4-5-4-covid-effect.png 945w,
/static/5d965985fe620633f8cdca13743a2bb1/6bff2/4-5-4-covid-effect.png 957w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;上図は Financial Factbook の7ページより引用した。&lt;/p&gt;
&lt;h4 id=&quot;売上の-ec-比率&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%A3%B2%E4%B8%8A%E3%81%AE-ec-%E6%AF%94%E7%8E%87&quot; aria-label=&quot;売上の ec 比率 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;売上の EC 比率&lt;/h4&gt;
&lt;p&gt;ウォルマートは EC の売上を直接開示してはいない（見逃してたらすみません）ものの、既に開示されている数値からある程度推測することができる。&lt;/p&gt;
&lt;p&gt;最新の四半期決算である &lt;a href=&quot;https://s2.q4cdn.com/056532643/files/doc_financials/2022/q2/CORRECTED-TRANSCRIPT_-Walmart,-Inc.(WMT-US),-Q2-2022-Earnings-Call.pdf&quot;&gt;FY2022/Q2 の Management Call&lt;/a&gt; において、ウォルマート CFO の Brett M. Biggs 氏はこう述べている。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;… eCommerce sales grew 6% in Q2 and 103% on a two-year stack. We continue to build a very sizable eCommerce business around the world. In fact, we’re on track to deliver $75 billion in global eCommerce sales this year and on our way to $100 billion in the near term.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;FY2022 の年間 EC 売上が連結で $75B に達する見込みであるとのこと。FY2020/Q2 → FY2022/Q2 の2年間の比較では成長率が +103%（最初の1年で +97%, 次の1年で +6%）だった。&lt;/p&gt;
&lt;p&gt;決算説明会資料（Financial Presentation）で開示されているここ3年の四半期ごとの EC 売上成長率を並べると次のグラフになる。ここには含めなかったがウォルマートの海外事業の EC 成長率はこれより高く、例えば FY2021/Q4 はメキシコ/中央アメリカで前年比 +171% 、カナダで +229% と急激に成長している。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/8c7db37885f22e7a3c4076934f0d0362/f941f/walmart-ec-growth.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABIklEQVQoz22Si5LDIAhF+//f2mmb+Fbg7GCaNNtU5w4iAhfkpqqY2QVgtGHElGi1oDWTc6L3jq9fPo5ba20+csWD7zBV+lDcnkpnCY2QKirj8vbw8YBn5TdLSA1EITc/G0M+9gtDEUE8q34xNKV1Zc0yzzvaUGI1QlFEzUP+Z+jljjHYlh1w41oMte1Gd4szU6E3b0NH93btDPfItXRC7MTUyWUQQqOsEcsRSVdYTtQ1sj4CGgMmMhPenN0suw9aiPQQKUukhoTJQMcX3NEZvWuqg5lca9kCOkMZ26Ntc8jZm/1Hv6X7iYApuTlsnmfAnDOv14uUEq/nc5NvfVmWw+5y18/3pWQej+ccv9ub+cx4lp/RYX7a/X6fjP6PFSe5+f0BG0sToo34OBwAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;walmart-ec-growth&quot;
        title=&quot;walmart-ec-growth&quot;
        src=&quot;/static/8c7db37885f22e7a3c4076934f0d0362/f058b/walmart-ec-growth.png&quot;
        srcset=&quot;/static/8c7db37885f22e7a3c4076934f0d0362/c26ae/walmart-ec-growth.png 158w,
/static/8c7db37885f22e7a3c4076934f0d0362/6bdcf/walmart-ec-growth.png 315w,
/static/8c7db37885f22e7a3c4076934f0d0362/f058b/walmart-ec-growth.png 630w,
/static/8c7db37885f22e7a3c4076934f0d0362/f941f/walmart-ec-growth.png 736w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;FY2021 に年平均で +80% 程度の成長、 FY2022 の Q1/Q2 で平均 +20% 程度の成長があって $75B に達するということは、FY2020 の GMV は $35B くらいで FY2021 の GMV は $63B くらいと推測することができる。&lt;/p&gt;
&lt;p&gt;なお、&lt;a href=&quot;https://www.forbes.com/sites/greatspeculations/2020/03/02/how-much-in-online-revenue-can-walmart-generate-in-2020/&quot;&gt;Forbes はウォルマートの FY2020 における EC の GMV を $37.6B と推測している&lt;/a&gt;ので、上記の予測は少し控えめかもしれない。&lt;/p&gt;
&lt;p&gt;ここで、自分の予測をウォルマート全体の売上高と比較してみる。金額単位は $1B（10億ドル）。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 599px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/d30d14cec92024f8003d9e7f37fb26cd/43142/walmart-ec-rate.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 62.0253164556962%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACHElEQVQoz32Sy2oUQRSG+xVci0ZcJIokCzHJ0idw497HcONtkyC4E1FJkFy2QZKASpZCEJMBXYiEccaEqBOT1um27z1T3VXVv5xTVQNBsKCaOqervvr/c8prmgZuuLUfawRRDhFHED+P0A//oMxj1CJFkqQIwxB1XZ8649YeLQaDAYqi4ITWGqJSkLQB4JgOKymhtIaUysRK8T+aWZahqiqGegShmef5aAONuv8L+fttVMdHHGtFeY3B5x18v3UTwYtn9kIDdko9tyjL0iiUkuN4cw17F84gWHzKsSp8ugZF6x3ak+dx8uC2sanUaYX0EUIgTVMDtLWJX2/iy9WLCFcfo8EQShScLz600Jm9DH/+nlWu2L4bXhRFXJORZQtMtl6iM3MW4apVWNUWuIvO9ARO5u6avJTsjhQSxwuCgEGUZKC1nLxZZ2vh8qJRYi2xwukJ+BaobXOoqWTd6/f7DMuzzNbQWd5Ae3IM4crCf4GkcDgc8kuh6TmpRKebyBr1M3q1jvbUGIKVBdPNSjBg8HEXnZlLbLmxQGKMuuyK6bqMxhS43NpA+8o5hMtGYS1qJA0Q7rTQvTYOf+6O6TK9WyFGz42BFMRJSjLQ7RVYagHbz9fQnR3H8ZKp4af9DDeeVHj08C0Ork+hN38fVJxKiH+BpIxsay0R5xJ7PYH9r0cof3xDlab8eMuhxOHvGgeHPnLKxxGkUpC2hg74F33FdIzU2VesAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;walmart-ec-rate&quot;
        title=&quot;walmart-ec-rate&quot;
        src=&quot;/static/d30d14cec92024f8003d9e7f37fb26cd/43142/walmart-ec-rate.png&quot;
        srcset=&quot;/static/d30d14cec92024f8003d9e7f37fb26cd/c26ae/walmart-ec-rate.png 158w,
/static/d30d14cec92024f8003d9e7f37fb26cd/6bdcf/walmart-ec-rate.png 315w,
/static/d30d14cec92024f8003d9e7f37fb26cd/43142/walmart-ec-rate.png 599w&quot;
        sizes=&quot;(max-width: 599px) 100vw, 599px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;このように、 FY2021 にはウォルマートの売上の約 11% が EC から生まれたと考えられる。 EC の成長率は売上全体の成長率を上回っているので、この比率はさらに上がっていくことが予想される&lt;sup id=&quot;fnref-2&quot;&gt;&lt;a href=&quot;#fn-2&quot; class=&quot;footnote-ref&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;。&lt;/p&gt;
&lt;h4 id=&quot;walmart-connect&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#walmart-connect&quot; aria-label=&quot;walmart connect permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Walmart Connect&lt;/h4&gt;
&lt;p&gt;ウォルマートは店舗や EC を通じて商品を販売する以外にも様々な事業をやろうとしているようだが、その中でも &lt;a href=&quot;https://walmartconnect.com/&quot;&gt;Walmart Connect&lt;/a&gt; という広告事業&lt;sup id=&quot;fnref-3&quot;&gt;&lt;a href=&quot;#fn-3&quot; class=&quot;footnote-ref&quot;&gt;3&lt;/a&gt;&lt;/sup&gt;が急激に成長している。売上の数字は開示されていないものの、 Management Call の Transcript を読むと前年比で +95% の成長をしているとのことだった。&lt;/p&gt;
&lt;p&gt;Walmart Connect において、広告主が出した広告が表示される場所は大きく分けて3つある。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ウォルマートの EC サイトやアプリのトップ画面や商品一覧、検索結果などの画面。&lt;/li&gt;
&lt;li&gt;実店舗に設置されたディスプレイ。実店舗のディスプレイとしては、 4,700+ 店（US 国内の店舗の約 88%）に 170,000+ 個のデジタルスクリーンがある。&lt;/li&gt;
&lt;li&gt;Facebook や Instagram, Pinterest 等の SNS で、ウォルマートが自社の顧客情報を基にリタゲ・リエンゲージメントする。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;よく考えれば合理的な話で、ウォルマートはアメリカ最大の小売企業であり、会員カードや EC サイトのアカウントと紐づいた豊富な購買データを保有している。消費者に商品を売りたい会社にとってはとても魅力的な情報なので、広告事業をやるというのは理にかなっている。&lt;/p&gt;
&lt;p&gt;広告事業としては Walmart Connect に加えて The Trade Desk 社と協同して DSP の立ち上げを進めており、2021年末のホリデーシーズンに間に合うように提供する予定らしい。ウォルマートの購買データを基に顧客のセグメントを行うというのは中々おもしろい取り組みだと思う。&lt;/p&gt;
&lt;p&gt;ちなみにウォルマートもしくはその EC サイトで買い物をする顧客は毎週 1.5 億人いるそうで、アメリカ人の9割が直近1年でウォルマートで買い物したことがあるらしい。売上規模はまだまだ開示するほどでもないようだが、今後が楽しみな分野といえそう。&lt;/p&gt;
&lt;h4 id=&quot;収益構造&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%8F%8E%E7%9B%8A%E6%A7%8B%E9%80%A0&quot; aria-label=&quot;収益構造 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;収益構造&lt;/h4&gt;
&lt;p&gt;ウォルマートの FY2021 の PL を見ると売上原価が $420B あり、売上の 75% 程度を占めている。これは製品の原価と物流施設・店舗への輸送費が含まれている。&lt;/p&gt;
&lt;p&gt;販管費には店舗や配送拠点の維持費用および人件費が含まれている。ウォルマートは売上原価および販管費の詳細な内訳を公開していないが、主にこの2つが含まれていると考えてよさそうだ。インターネットのサービス業だと広告宣伝費が販管費の中で大きな位置を占めることが多いが、 Form 10-K によればウォルマートの FY2021 の広告宣伝費は $3.2B なので販管費の 3% 程度に過ぎない。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 617px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/f9152db1231e133742285c7e15588506/bc962/walmart-pl-breakdown.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 60.12658227848101%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAAB80lEQVQoz42TzWvUQBjG98/wWFQQD3ULRaEoFcS/xZsIerFIwYNKb/akeLAXD548e5GqXT+Q0k9X46rrfgVFdpl0kuzmYybzk0lStdhdHJgQyLy/PM/7zFuJooh+v4+UEuF5dLou7U6POEmxyyiF0QpjDP+zKvagJwTS90niEVkiMXbrlOyvgxaXaU2WZWO3ZVXyw+XPXWG490yx/DThUx9oN/hxd4mfy0sknVYBLgvH7VxhVgK3O5rTiz4nr3msfgM2XlKvHsOpTjHcXC+AWk+2bB+jKAaTUu8pLt4JmVuUrFlBW69w5mdpzM8w3NnMC7RSky3bMHIgUO9pLtwOOHNDUmtbya9xzs3QODvNqARahRMtCyF+J1oAwz/AnTc45wuFo92tApimhe0xqVcGgwFS+tYM7y3wVqFwzQLXX1CvHuXjqSnCjXcHCvPUD7OstSZJlf1c9jAoeti0KTt0F67iLlwh7rZJBn1k7Tn+2xo6DHLofuoHrs1+yrvdjLmbQ6avh6x+UP/Y2XvyGOfEERqzx0lazUNTz4E6Mxid8OV7zOUVwaUHgo1mBCZBentIIUiNIfz6mc7D+/QerRB7AhkEtFotXNcljuNcZXmxDUoVU6DSCJ3GuRXbDt/387G073ZygswwzBsESinCMMSOry6n6BdCQHZbqlhIbAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;walmart-pl-breakdown&quot;
        title=&quot;walmart-pl-breakdown&quot;
        src=&quot;/static/f9152db1231e133742285c7e15588506/bc962/walmart-pl-breakdown.png&quot;
        srcset=&quot;/static/f9152db1231e133742285c7e15588506/c26ae/walmart-pl-breakdown.png 158w,
/static/f9152db1231e133742285c7e15588506/6bdcf/walmart-pl-breakdown.png 315w,
/static/f9152db1231e133742285c7e15588506/bc962/walmart-pl-breakdown.png 617w&quot;
        sizes=&quot;(max-width: 617px) 100vw, 617px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;人件費については気になる傾向がある。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://s2.q4cdn.com/056532643/files/doc_financials/2021/q4/CORRECTED-TRANSCRIPT_-Walmart,-Inc.(WMT-US),-Investment-Community-Meeting,-18-February-2021-8_00-AM-ET_.pdf&quot;&gt;FY2021 決算の投資家向け Meeting の Transcript&lt;/a&gt; によれば、ウォルマートは段階的に US 国内の賃金を上げていっており、 FY2022 には平均賃金が $15.25/hour になるらしい。FY2015 は $10 程度だったので、6年で 50% 以上も上昇するということになる。&lt;/p&gt;
&lt;h4 id=&quot;販売カテゴリ&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%B2%A9%E5%A3%B2%E3%82%AB%E3%83%86%E3%82%B4%E3%83%AA&quot; aria-label=&quot;販売カテゴリ permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;販売カテゴリ&lt;/h4&gt;
&lt;p&gt;ウォルマート US では売上の約 56% が Grocery と呼ばれる生鮮食品や飲料、紙製品などの日用品から構成されている。ウォルマートが別のブランドとして運営しているサムズクラブというコストコのような超大型スーパーでは、燃料とタバコの売上割合が高いようだ。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/786f52bf22ba8603bc40b1720b3db66d/b97f6/sales-by-categories.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 56.32911392405063%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACrUlEQVQoz3WS22sUdxTH59n/QB9yKfT/KIgi4pOEVlRU4oP2wSe1N6EleEHaoGK8oaYRo8aWKlXaxpaoQRRi05irmewluzvZ2etsdmdnd3bm95vLp+x4fdAD34fDOYfzhc9XMWyPJcMhUxNkTMFy1UX4AR+qMAzf6mMzpeVKqg0HR0iaLZemK6OFIAhxXRfpebhCIIR8e9z+5zgC25bYLUmr5RK8/qF4nk/TqpPWS1gNG0IfKQXlUp5SsUgirpLJpCgWctTNKiDxZRrTzFHIz1EqzmMYKwg3E82U0Jc8eTjKuXtT9D82kSGkEipDlwcwykVuDv/M1OQEU5PPuXV9EE3PcuCHPqYXF7kycpsLwzd4mYhz+MRxsoU8yvD9/7hw/UFkd2C8wviyw9PZLBsP3Wc6YbD92EMG/1Ij7Tg+xmSsSueeMe4+y7Pv/AK7Ts3waMHks6MLqLqNcm00zs4zs2hmQN+feWayNv9qDp8P6SwWBV/+WmBkyuL2C4v9vxSIG5LeEZ0JzeH0eIX+RxUmVxx238iSWpUobWejqk3faJl7843I6YsVm+9+z6LVPE7+XeAf1WJsqcHJBwUyq5Kv7urM6g7XJqpceVZhPu9y6I5OzvRQXFcQegJfCvDbNEVErN5sYdatCFTdamBUVqk3mrRh2o6L1bAoV6rUrWbUt9OQLtbaDkOCIHhP/ptkRbRD3yPwJVK4EL7LZ61Wo2KUaTYsfO9VpL6+9AdKeiXH9NxLZuYWmJ6dR43FiSWSqLEEsWSKpUQKNb5MLJlmMZYkmdYoVWpouSJaNoem54llchw5/xtrNhxB6d76PWs3HWTd5sOs2/ItHT3H6Nz2E107z9K1+xLdvYN8sneI7rZ6r9K16yKd28/Q8cWPdPQcZfPBi6w/MMCnPd+wdls//wMv2vh/VgN+kwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;sales-by-categories&quot;
        title=&quot;sales-by-categories&quot;
        src=&quot;/static/786f52bf22ba8603bc40b1720b3db66d/f058b/sales-by-categories.png&quot;
        srcset=&quot;/static/786f52bf22ba8603bc40b1720b3db66d/c26ae/sales-by-categories.png 158w,
/static/786f52bf22ba8603bc40b1720b3db66d/6bdcf/sales-by-categories.png 315w,
/static/786f52bf22ba8603bc40b1720b3db66d/f058b/sales-by-categories.png 630w,
/static/786f52bf22ba8603bc40b1720b3db66d/40601/sales-by-categories.png 945w,
/static/786f52bf22ba8603bc40b1720b3db66d/b97f6/sales-by-categories.png 958w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;上図は Financial Factbook の8ページより引用した。&lt;/p&gt;
&lt;h3 id=&quot;キャッシュフロー&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%82%AD%E3%83%A3%E3%83%83%E3%82%B7%E3%83%A5%E3%83%95%E3%83%AD%E3%83%BC&quot; aria-label=&quot;キャッシュフロー permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;キャッシュフロー&lt;/h3&gt;
&lt;p&gt;PL を FY2017 - FY2021/1 の5年分並べてみた。金額の単位は $1M。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/6e9063f8ce88d8229a7ef2dda02bd271/889a4/walmart-cf.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 55.69620253164557%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB0klEQVQoz2WT2W7TUBCG8/5vAC/AFRIXIHGBhOhNG4m0LCJr0yx2GzV1FsdxfNb5qnNOSFMYaTyjWe35f7cAmqahqioE8CJ471/sue9cstYmDQ1GUY3/UGy2iHhaIkLQIG6zxu330fdaxwXiXFJeRE/vMIuH1OMaZlmHotggCK0QNEZjBJpBF/2Qx8Lm5/fUnGeo2ST6athLuWEPnU2jb3TNbHLDarXBWXscqDXKedSoT5XlHAys221UWDK9Q40HGODx2wWVQNEdUk7naaDz5OuSPMvY7Xa0yrLEGpM2D3r4xye0h037Og5Zjyas+hNqD7vLq1hX97s02QNjdezTjkNdY4yhVRQFWiusgF2Oufz1jlJD3n3PaNlDyjXzwceYv+9/5kd+hd/VXHfeMlwtQc6vC63tdhtvmC5c8On3Gzxw+9ShvegCFl18ien7csTN4jr6F7cfKJoqAXgENmi8oVKKKqArwmg9j9RYHiqmuxXYPXr5NVLEOkE7j3ihMgZlDQH+gO5fppxoE5X/RcSBq1/HXuX/+eRIDa0juUPSBsJ6j3MO64IvOCdnsUTulPOngac3DI8wJCAUCgL0wYYF+/0+FkYmWJtOU1WnOnNkx/nP8QzNWVKFdkwFRgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;walmart-cf&quot;
        title=&quot;walmart-cf&quot;
        src=&quot;/static/6e9063f8ce88d8229a7ef2dda02bd271/f058b/walmart-cf.png&quot;
        srcset=&quot;/static/6e9063f8ce88d8229a7ef2dda02bd271/c26ae/walmart-cf.png 158w,
/static/6e9063f8ce88d8229a7ef2dda02bd271/6bdcf/walmart-cf.png 315w,
/static/6e9063f8ce88d8229a7ef2dda02bd271/f058b/walmart-cf.png 630w,
/static/6e9063f8ce88d8229a7ef2dda02bd271/889a4/walmart-cf.png 658w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;税引後利益 + 店舗設備の減価償却がそのまま営業 CF になり、毎年 $20B - $40B 程度のキャッシュフローが生まれている。&lt;/p&gt;
&lt;p&gt;投資 CF は毎年店舗設備など BS 上の資産となる支出におよそ $10B をつぎ込んでいる。また、 FY2019 にはインドの EC 企業である Flipkart の株式の 77% を $16B で取得した&lt;sup id=&quot;fnref-4&quot;&gt;&lt;a href=&quot;#fn-4&quot; class=&quot;footnote-ref&quot;&gt;4&lt;/a&gt;&lt;/sup&gt;。&lt;/p&gt;
&lt;p&gt;財務 CF は主に社債での調達と償還で、大規模な投資にあわせて調達を行っている。Flipkart を買収した FY2019 には買収に要した金額とほぼ同じ &lt;a href=&quot;https://www.bloomberg.co.jp/news/articles/2018-06-21/PANHGG6K50XZ01&quot;&gt;$16B を社債で調達した&lt;/a&gt;。また、毎年 $7B ~ $8B 程度の自己株式の買い入れを行っている。&lt;/p&gt;
&lt;p&gt;これらのキャッシュフローを足し引きしてだいたい毎年 $7B ~ $8B の現預金が手元に残るという運用がされているようだ。&lt;/p&gt;
&lt;h4 id=&quot;capital-expenditures&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#capital-expenditures&quot; aria-label=&quot;capital expenditures permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Capital expenditures&lt;/h4&gt;
&lt;p&gt;ウォルマートが毎年およそ $10B をつぎ込んでいる資本支出（Capital expenditures）については、 Factbook に大まかな内訳が記載されている。&lt;/p&gt;
&lt;p&gt;これを見ると、FY19 までは Remodel （店舗改装: 什器の導入、搬入、設置などを指している）と eCommerce/supply chain にほぼ同額の $4B 程度が使われているが、 FY20 以降は前者がほぼ半分になり、その分が後者に充てられている。&lt;/p&gt;
&lt;p&gt;これだけでも日本円にすると毎年 2,000 ~ 3,000 億円程度の投資がされているということになる。なおこれは BS 上の資産になる支出のみなので、 EC に関わる運用コストや大部分の EC 開発者の人件費は含まれていない&lt;sup id=&quot;fnref-5&quot;&gt;&lt;a href=&quot;#fn-5&quot; class=&quot;footnote-ref&quot;&gt;5&lt;/a&gt;&lt;/sup&gt;。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/5b3e026dff6e6071b549f9f519fa7ca8/b97f6/capital-expenditures.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 56.32911392405063%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACkklEQVQoz32Sy2sTURSHs/Y/cGNrFbcudCm4EUFQRJEiFd8KLhQVlEqR+kKw0oVQqaj4XghubIUqpIoi4gNqpW2aNJ1MJsk0M3MnmclM3o9JPsmk1Y144cDhnt/97j33/AJmsU5IlEg5NSSrSjxXY9GqkXLrtIBWqx3t7P9rRROoey0KNQ9NmGhCkFCXSKop1LSGlRW0mnVf2Gy20EQeXVhouiCeNNE0A03PYmQKK1QC0CHrmTwp3cZxS3ydlnEKFWKqjaTay29oQPkX1AWNqk1R+4RXK0AtDZX59pV+N4GG1/Tlh298YMupMaYjOjtPP+PzT4Wro5OcG3rj1x3X5cjZ8wQ/fmJqLsrW/aeRkmnG301w8eoVisVip+VmswN89XqC+09esrSU4vmTeyiyRDAY5M34uF/P5BtsHlzgxReLH/EyGwclFo0qI0GT7bdjOCWvA2y1Okk53E9+qo+6/QM9uImqmCQzfQHj+/H25+BWPK5MLPFNKSGZFfrHVIyCx/togVuTOqXaMtCHVT3SiVkMdYZiPoupTuHaOjkzimNG/Am2w3YKCDNLqVxGMzLYto0wM9hO3h/aH6Dj5AjNLxCVFAzDRGQcdMPEsvPUGn9t4TWbaLpOuVymWi2RTqcRQlBvdERJkesA29aQ5RgLkTCJhEIyoZBKJVHVJEpc9vesbBbbssjlbFzX/acXBx68JeAWKziFElEpxszsHLNzIebDYcKRBULhCJGoRCgSZTGmEE+kiMUTyEoCSZaRYrJ/LhxLcu3BGKu2Xyawofc6Xbsu0b17gK49g6ztvUlP3zA9B0dYd/Q+6088Zv3Jp/Qce0TP0YesPTRK94E7dPUOsWbvdXacv8u2MyNs2NfP6v3D/AYkdQDcnuIXQgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;capital-expenditures&quot;
        title=&quot;capital-expenditures&quot;
        src=&quot;/static/5b3e026dff6e6071b549f9f519fa7ca8/f058b/capital-expenditures.png&quot;
        srcset=&quot;/static/5b3e026dff6e6071b549f9f519fa7ca8/c26ae/capital-expenditures.png 158w,
/static/5b3e026dff6e6071b549f9f519fa7ca8/6bdcf/capital-expenditures.png 315w,
/static/5b3e026dff6e6071b549f9f519fa7ca8/f058b/capital-expenditures.png 630w,
/static/5b3e026dff6e6071b549f9f519fa7ca8/40601/capital-expenditures.png 945w,
/static/5b3e026dff6e6071b549f9f519fa7ca8/b97f6/capital-expenditures.png 958w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;上図は Financial Factbook の10ページより引用した。&lt;/p&gt;
&lt;h2 id=&quot;amazon&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#amazon&quot; aria-label=&quot;amazon permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Amazon&lt;/h2&gt;
&lt;p&gt;ウォルマートの FY2021/1 の BS/PL とアマゾンの FY2020/12 の BS/PL を並べてみた。&lt;/p&gt;
&lt;p&gt;商品取扱高ではアマゾンが上回ったようだが、アマゾンはマーケットプレイスの商品売上のうち手数料のみを売上として計上しているので、売上はウォルマートの方が大きい。しかし、アマゾンの FY2019/12 の売上は $280,522M で FY2020/12 は $386,064M（+37.6%）なので、ウォルマートよりも遥かに早く成長している。ここまで成長率に差があると、3年くらいで追いつきそうだ。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/6f0fac3744fc1d9ccfa40c60511da09e/d6a46/amazon-vs-walmart.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 36.708860759493675%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABZ0lEQVQoz02Rz2pTQRjF80IFX8FdiyvfQnyFrrrrsuLOpZuILnIpAWkFqX8S1ITbYEJbYkIRW0uoNBNz587/+cmd3JocGPi+w+F8hzONwliEmGMLgSgLpFJYvUApSSklZrmkVJo7UaBUidIGqX3idVmgygVSGWIMxBhpAGlYYUXeb7F+95v3nhACmxj8DHw4d2n2IdKoREopQvCspR5CrB0DMQS0MUnnrGYhAzPh05GP55asb9LsfKQhhPhv82N6wLPRW07uKmvLxEhuau8Kzq1MumPHmy8mcZ8uHO3crhNWPaWEQPFqh2z/Afmow59ZzouXj3n+vom2FmssslQQNd8mjqxva0NL+9SuE252eP30CYePthn2etDvMHi4RXNvF6v1RkLojj2vO2XFcHLmaH1Vq46rhMSYirbes/z8jvbRlPwWuLnkLDumlYMyjhg8vvqQ6Pg9D3zPJ7AYczWPDE8n+L+/UsJ/rvEOernkxpAAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;amazon-vs-walmart&quot;
        title=&quot;amazon-vs-walmart&quot;
        src=&quot;/static/6f0fac3744fc1d9ccfa40c60511da09e/f058b/amazon-vs-walmart.png&quot;
        srcset=&quot;/static/6f0fac3744fc1d9ccfa40c60511da09e/c26ae/amazon-vs-walmart.png 158w,
/static/6f0fac3744fc1d9ccfa40c60511da09e/6bdcf/amazon-vs-walmart.png 315w,
/static/6f0fac3744fc1d9ccfa40c60511da09e/f058b/amazon-vs-walmart.png 630w,
/static/6f0fac3744fc1d9ccfa40c60511da09e/40601/amazon-vs-walmart.png 945w,
/static/6f0fac3744fc1d9ccfa40c60511da09e/d6a46/amazon-vs-walmart.png 1008w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;アマゾンの事業セグメント別売上構成は以下の通り。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/00197806b0e24dfe787b73cd3fe25026/889a4/amazon-segment.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 56.32911392405063%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACI0lEQVQoz3WSSU8UQRiG+2r8Ddzx6HLScPEPGE8e0RNGDxqXGHE5KDdNVBLCqAdCJDGRAx6MIoaIW4IYEsQDMogMDJnpoZleZnqp7q7qx3TNTECJX/KlllQ99b7fVwZAGIY0Gg2yLEMptSdRikDBsoKShAxwQ58tu46Skk7k943OZC8s04dlIvRhe3OJqfsnmX12FSVTXGcTs7qOEAlJ0so8NDBfCCFaIJmiZKLHXIlqv15Z/cLQ5f2MP+whTRI8bwWzWsQ0LUzTxLIszdDAOI617RyYQ7I2ZH3tB5/fP6dcWsW253g5sY+ZmR7SLCCoOWxXqtRtG7/p71jOa5e25SolWfs5z+LsW4RIWZy8y8hZg2+v7oA3B6MGvO6C1MMT0AgEURSSJOkO0HEcPM/F9wPSJGJy7DgjAwaV0ixbqwN8HTeoFS+wUWpw8/wjCvdeEIaCfyOH6RrW63VtWStMI7yJY1iDBqr2gdL0BO/OHaX6psB3Ew7cyDhVAF+0CqPazezAtEIpJVEUEQQ+cSK5/WCZE33zrPxyefoRui7C4BSsVBKO9LucGW7iR1IDd8M6oZsiZau7cZpxekTRfUuyUM4Y+xTRfcXj8XREsSo52O/TWwgJhGL3d/sLuCNX4YcxfU8cDl2zWPgdMjrj031pm+GpJktlweHrdXqHXDw/bivk/8Dcep6bVkBxw0EkErcZs1SysRsxcar0frnW1I60OvYC/wASpSR7OPFtugAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;amazon-segment&quot;
        title=&quot;amazon-segment&quot;
        src=&quot;/static/00197806b0e24dfe787b73cd3fe25026/f058b/amazon-segment.png&quot;
        srcset=&quot;/static/00197806b0e24dfe787b73cd3fe25026/c26ae/amazon-segment.png 158w,
/static/00197806b0e24dfe787b73cd3fe25026/6bdcf/amazon-segment.png 315w,
/static/00197806b0e24dfe787b73cd3fe25026/f058b/amazon-segment.png 630w,
/static/00197806b0e24dfe787b73cd3fe25026/889a4/amazon-segment.png 658w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Third-party seller services（マーケットプレイスの手数料や梱包・配送に関する収入）が前年比 +50.5% で Other（そのほか全ての事業、主に広告）が前年比 +52.3% と急激な成長をしている。主力の Online stores セグメントも前年比で +39.7% と大きく成長した。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/941f1a55d7709f446009dd5d26f6571d/ea7fb/amazon-seg-sheet.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB9ElEQVQoz22M53LaQBhF9f5vk+IhjRhTjI1RL1gdgYRAAiEXwCX4ZLT2OJlMfpy557uze6VZDdbsBj2uMKYN23dvejOpBU3fdGpYogQFY3fJpZO+Msmw0zvC9TOStdhh5geuN0fczVHkZP3rvzjFE0NvRcdMGFzntC4cWpcO5+6SrjVn6BdIzqKiLVsMnAhnWRPfPjHfQ/ovB0jujyKN+Ro735I/gpasiOpHprfPYkNKtgd62gTZT1DDFHdVkx9gsX9hcfiLt7sZMecldroWPg7mRNWBdP9Cz3CRvOqJCz/HLvaEdzDdQ3T/h6ZraNyvj3jFLQPTY+TGeMUNp7KJOVthpyWt/gjJzvbIUUXfylDiGiPdYczvRZrpDmtxwMz2WNnhtY9LFDdD9XP0cMl4MseICsy4xIzXSEZS077y6CghP2Wf75cTkaeyT/vK5VQJ+DG6fsOlo8b8lEPacsi3kUtbDjhVY4GV7ZH0aSUeN0PNh2akPfb4MrT5OrRF31FDMXymRoy8FWpcoUQbtOkWJdyIW40q7GyH1DcTPvd0PnZUPnU1TvoGJz2dDx2F1rkl7q6RcKZN6epNxrTHvvCRV3Dll4yDNXK4wckfkLRgSV8LGOihyK7iCZe9HCup0MICI16jR6Vwe7YlLB/fCYqHd483z/wG0tjOM8FuJJQAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;amazon-seg-sheet&quot;
        title=&quot;amazon-seg-sheet&quot;
        src=&quot;/static/941f1a55d7709f446009dd5d26f6571d/f058b/amazon-seg-sheet.png&quot;
        srcset=&quot;/static/941f1a55d7709f446009dd5d26f6571d/c26ae/amazon-seg-sheet.png 158w,
/static/941f1a55d7709f446009dd5d26f6571d/6bdcf/amazon-seg-sheet.png 315w,
/static/941f1a55d7709f446009dd5d26f6571d/f058b/amazon-seg-sheet.png 630w,
/static/941f1a55d7709f446009dd5d26f6571d/ea7fb/amazon-seg-sheet.png 788w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;FY2020 に限っては、 AWS は社内で Physical stores の次に成長率の低いセグメントになっている。しかし、これは他が高すぎるだけで事業として大きな問題があるわけではない。&lt;/p&gt;
&lt;p&gt;AWS の事業については以前書いた記事「&lt;a href=&quot;https://lyohe.github.io/post/2021-02-06-google-cloud-comprehensive-loss/&quot;&gt;Google クラウド巨大赤字の話&lt;/a&gt;」で少し触れたのだが、長期間にわたって安定して成長し単体で利益を出している。&lt;/p&gt;
&lt;h3 id=&quot;amazon-の広告事業&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#amazon-%E3%81%AE%E5%BA%83%E5%91%8A%E4%BA%8B%E6%A5%AD&quot; aria-label=&quot;amazon の広告事業 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Amazon の広告事業&lt;/h3&gt;
&lt;p&gt;実はアマゾンも広告事業をやっている。上図だと「Other」にまとめられているがこの中身はほぼ（Primarily）広告事業とのことなので、だいたい $20B の売上があると考えることができそうだ。&lt;/p&gt;
&lt;p&gt;これがどれくらい凄いかというと、 Facebook の FY2020/12 の連結売上が $86B なので、 Facebook/Instagram 等から生じる広告売上の合計の 1/4 に相当する金額を稼いでいるということになる。なお、 Facebook の売上が年間で 20% 程度の成長をしているのに対して Amazon の広告事業は年間 +50% とはるかに成長率で上回っている。さすがにどこかで落ちつきそうだが、仮にこのままのペースで拡大すると6年後に追いつく計算になる。&lt;/p&gt;
&lt;p&gt;小売業と広告事業は相性がいいのかもしれない。&lt;/p&gt;
&lt;h2 id=&quot;セブンアイグループの-ec&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%82%BB%E3%83%96%E3%83%B3%E3%82%A2%E3%82%A4%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%AE-ec&quot; aria-label=&quot;セブンアイグループの ec permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;セブン&amp;#x26;アイグループの EC&lt;/h2&gt;
&lt;p&gt;US と比べて日本はどうだろうか。&lt;/p&gt;
&lt;p&gt;日本で最大の小売業といえばイオングループだが EC 関連の開示がほぼ無いので、国内2位のセブン&amp;#x26;アイグループの EC について調べてみることにした。セブン&amp;#x26;アイは「決算補足資料」という名前の資料で四半期ごとに EC の売上想定額を、そして年度決算ごとに詳細な内訳を開示している（参考: &lt;a href=&quot;https://www.7andi.com/ir/file/library/kh/pdf/2021_0408kh_02.pdf&quot;&gt;FY2021/2 の決算補足資料&lt;/a&gt;）。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/f157c49a9ead000edc147a88e1e83142/8ce52/seven-i-ec.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 39.87341772151899%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABc0lEQVQoz0WSW2+CQBCF+f8/xr4Zm5RES6wxGsQHL1QRBeS+VFME76c5Y7QPk90Zdme+cxbtcrkgCHxkWY66rlFVFfb7PVarFdbrNTxvIytjs9nA87zX6vsMH0EQYDweQykF7XQ6YbvdoigK7HY7aRbHMXq9HgzjE7quo9/v46vbha5/wDAMqb23Wmg2m+h0Omi323hrNGSIRqJv20YUxciyDGmSCiWb8gCn/xSFEIdhKPXhcIjZfI7ZbCaEDNd1BUo7Ho9IkgRpmgod8/P5jCiKRFoUhigKhaXjoFBKzo1ME5PJBNPpVGQShMPrqno0ZHcWwjAS2WX5KzmpAt+XgbZtizWsk9CyLIk8z6VGAPbSjnUt6JRM5LIsQV8p1XGWsqpcYbFYiGQ+zmAwwMiyYJqmfGed5HxU8ZD4LHIaaSiBXq1dF47jyHT6REJeJNG/qse9V0P6xYT+sEl5OLx8ZHD/DP5i9/sdt9tN4rm/Xq8SzP8A5J1M6+X7218AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;seven-i-ec&quot;
        title=&quot;seven-i-ec&quot;
        src=&quot;/static/f157c49a9ead000edc147a88e1e83142/f058b/seven-i-ec.png&quot;
        srcset=&quot;/static/f157c49a9ead000edc147a88e1e83142/c26ae/seven-i-ec.png 158w,
/static/f157c49a9ead000edc147a88e1e83142/6bdcf/seven-i-ec.png 315w,
/static/f157c49a9ead000edc147a88e1e83142/f058b/seven-i-ec.png 630w,
/static/f157c49a9ead000edc147a88e1e83142/8ce52/seven-i-ec.png 681w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/6b026c6299a5315784d75da60f10af49/e7dce/seven-ec-detail.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 56.9620253164557%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACXUlEQVQoz22TS0hVURSGb+CksTQpEZoETQsqKAgCB1IUQhBCINUww0Fws0ENLJNw4gMblESDrJTsgQ6UUFHEzCQyX9cUvb7tPs4993je+5zzxdnXaxYtWCz2Zq2Pf6+1dgTAsiw0TcMPAgKQ7gfgCYEnXDzPw/c9/MDF9wW+72Oqy2QyaTzPDxEEQSBjZO9BOA5zo5+ZHhrE1LRc4o4LAbaTi0Hgs7WqkUqlcRyHvIUcCTQMA9Mw0fQMVc3nqXh0kuXEPBuzMb71dJNNJln6MU73kzpmRvpl8db6HInEFqqqouu6VL2r0Ns5pCyN4vabFDwvJ6YlaOm8Q0l1EV9jA3wYb+PUvYO09NbK3HVlFsPYxjBMbNv+o9A0TUzLwjEtkqZG0aub7HtWzoK6yZX+RiJNJbxf+kL9ZC+RpotcH34hi7NLE2TSKVQ1K4GhQglMp8M+2LJRmqVS+foS5a2nSakrXB5oINJ8js74GG2znRQ+PUbNaGNOYcpF2zZkbdjHcLASqCgKpqFjOi5eViF14yy/yo4SrMbp6rlN3cNCYgt9qMOtTFQVsPHx7s4EBP+zXA+FQAQBQs2wWFbKzzPHsdZWMe9XohzZjzvUi/bmJcuHD6A8rsnxPCEV/esSGEp2bIttXXCrboar1d9ZTwv6GtupL40SH5umf3CFaxXv6OiYlEDfD3bXLR+lwmBnmcEnmXW40GBx4oFJPOEQfetyKOryadqlbcShOGpT2xVOVBDuc17VX0/OX4S/QQiPxbUsc3EFV/hsJnWm5hPohktGs5maT5LMWHKx9z5zL/A3q3oPRIZ9k8oAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;seven-ec-detail&quot;
        title=&quot;seven-ec-detail&quot;
        src=&quot;/static/6b026c6299a5315784d75da60f10af49/f058b/seven-ec-detail.png&quot;
        srcset=&quot;/static/6b026c6299a5315784d75da60f10af49/c26ae/seven-ec-detail.png 158w,
/static/6b026c6299a5315784d75da60f10af49/6bdcf/seven-ec-detail.png 315w,
/static/6b026c6299a5315784d75da60f10af49/f058b/seven-ec-detail.png 630w,
/static/6b026c6299a5315784d75da60f10af49/e7dce/seven-ec-detail.png 653w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;EC 全体では FY2021 で前年比 +3.9% の成長をしている。内訳をみると、イトーヨーカドー（+38.2%）とロフト（+52.8%）が大きく成長している。&lt;/p&gt;
&lt;p&gt;「イトーヨーカドー」と「ネットスーパー」は何が違うのかというと、どうやらセブン&amp;#x26;アイの EC サービスである「オムニ7」の中でイトーヨーカドーが2種類あるようだ。前者は通販で、後者は実店舗の商品を購入できるらしい。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 401px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/56a1bd8dbebabeb43863f6315c8f202e/9144d/omni7.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 160.75949367088606%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAgCAYAAAASYli2AAAACXBIWXMAAAsTAAALEwEAmpwYAAAD7klEQVRIx7VV2VJiVxTlK33wwTdf0n+QzptaVlm+amkajVYU0mq3A8YmqIEWBJxFkRmVCA6IzONlWKm18dqotOmYzq46dYB77mbttdfZSwMAjUZDlqIoUKNWq+E1oXE6nejt7cXi4iK2trZwdnYGt9uN7e1tnJ+fI5lMIhQK4ebmBnd3d4hEIrJfXFzIuZOTE3knm8kIKE08HofH40E0GkWxWJTFJJVK5QF1oVBAtVoV1Le3t8jn80gkEpL08vISibs7lJR6M2E72DzscDgQCAQEBZFzPz4+/kqhNeAvY7NkZq3Xm9m5M0LBEHp6ejA2NoaZmRn09/djYmIC4+Pj2N3dxc7ODqxWKxx2O+xOJ3ZtViSMH+X9B4RqYxjZbBZra2vY39+XBGazGXt7ezg8PITFYoHRaMTGxgZsNhus1g14vAE4XBePE6pJ/2toniZjA66vr4X8WCwmTSKnV1dX0l02jA3kzu+5XBbJTB6f3VePm6Ly5/P5hDc2ZWRkBEdHR1I6f1NLHRoaEg5Jh8/vw1k4guPPITTqjecImZhSaV18RsmUy2WRj7rUKCk1OMMJMMX/z6Ha7dbFoNDJHRGTOyqBPCficWRLCizR3NeF3ZpY5XZ0dBTd3d3CZWdnJ/p6+9DR0YEf3rxB0OtF4sT7XDZP9ahyxyCaVColyHhd0+l087dMBko+j/LBwT8j/DdRvwfyIkJqjdfs9PQUfr9fJEWUuVxO+CSvsctLxCIR5O3bqCnKywk5SaampjA4OCgcarVaTE5OQqfTYWBgQK5nb18fVpYMqAbCqFYq7UtWE6r8tZZPVLw91CGRVhQFtXIFBbcfjVqtPcJ2+7fyqmnX2Zc0qcqIs9Fms+Lnd1rs79oR8y81ZaMeUtfT7yy79Zl65WgZXV1d+PHtT5ie+gUuh17Oal57xWgD9Jl8voBUMg4g1pQNTYeGxMUxT8OhxxwcHMgAXV9fRzAYlOFKGfG51+uV6/dYh/cc8vDq6qqMIzoYX+Sy2+1YXl7GwsKCOF04HEYsGpWdeuSsZIh5kZJ7zjX4XpEONhG2ks/gZDYYDDI8SYPJZJKdzvfb1K8wzH/EmvETJrXvYFw24E/TKn5fnoPTr//S5VapZDIZuFwusVCWRg6ZjHwaFhfwYeY9VgwGvNdNw7Fpg8VshsX0CSGr8dtMin+gmn+pXH7wklKphEKxiFQ63TyoVJjg+0zsagMIpctotJvYREQONzc3sbKygtnZWTGppaUlDA8PQ6/XY25uTnY+101PI3p1g63TaxlhzxKyPDaBEqLzUT6UDT/Pz8+L6XOkieN5vfD4fCin08ia/ngum1ebFK9rsSiy+RsXCFn9rfLSIQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;omni7&quot;
        title=&quot;omni7&quot;
        src=&quot;/static/56a1bd8dbebabeb43863f6315c8f202e/9144d/omni7.png&quot;
        srcset=&quot;/static/56a1bd8dbebabeb43863f6315c8f202e/c26ae/omni7.png 158w,
/static/56a1bd8dbebabeb43863f6315c8f202e/6bdcf/omni7.png 315w,
/static/56a1bd8dbebabeb43863f6315c8f202e/9144d/omni7.png 401w&quot;
        sizes=&quot;(max-width: 401px) 100vw, 401px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;売上の EC 化率は次の通り。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/303aeb4636177a906b9beb7550dcd3f8/e7dce/seven-ec-rate.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 56.9620253164557%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB4UlEQVQoz2WSu25TQRCG/VjUIRUFLpAowqVIuEiQNNSBAiUpCEoTXoE+gAIFNc+AkO04No4dx/j4HJ/b3j+0e+xjLFaa1c7u7L/f7EwDwFqL1hprHeDIhOPqJqfIU8rfPeI4ocwTZBFX67IkRDoXzN/35kfDTz4gSRKMMeHAWIfxDwFGG4zWlYD3ja3itMT6fecQQgQLgn5jOZyzeNdqRfbjO/Kqg0MFIdHvIkeXOJthxRRHdW9JxoI4EBZFQRRFgcQf63RO+84tZp8/4rA4BP0X9xm+fVWLiOGAovUriPgMRVlWhHqBvQwMaWUpneYm8bcv9ev9vR1Gh29q//rkiO7je//9ZWM2m5GmafWH/xB2mhvE52dVKl5wd5vhwX7tj0/f03v2MKylEGRZFqzhhTxlCFwj3CD++mlFuLvN6HC/9senx/SebrGsgJKSOI5p+Ir5CuV5XhMq/4fN27VgINxbCbpa8EFFKGWwkHJQVyoUxhpTPVdkXNxdJxx4woMV4eTDMb0nW2HtMzSLLNfaxmNn0jC6ivjZ3GR6foYCIgWtlzsMjl7jr8UauifvuHj+COVcoNNKrQuGhtYaqSzjyZxpu4XOUrS1RPOSm3Yb+WcSmj7JJePLHuX1EGNtEFQLwb+QtzMwfM43WgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;seven-ec-rate&quot;
        title=&quot;seven-ec-rate&quot;
        src=&quot;/static/303aeb4636177a906b9beb7550dcd3f8/f058b/seven-ec-rate.png&quot;
        srcset=&quot;/static/303aeb4636177a906b9beb7550dcd3f8/c26ae/seven-ec-rate.png 158w,
/static/303aeb4636177a906b9beb7550dcd3f8/6bdcf/seven-ec-rate.png 315w,
/static/303aeb4636177a906b9beb7550dcd3f8/f058b/seven-ec-rate.png 630w,
/static/303aeb4636177a906b9beb7550dcd3f8/e7dce/seven-ec-rate.png 653w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;なお、セブン&amp;#x26;アイグループの売上は特に国内でフランチャイズ加盟店が多く&lt;sup id=&quot;fnref-6&quot;&gt;&lt;a href=&quot;#fn-6&quot; class=&quot;footnote-ref&quot;&gt;6&lt;/a&gt;&lt;/sup&gt;、そこから生じる売上はセブン&amp;#x26;アイグループの売上には含まれておらず、加盟店が支払う手数料収入のみが売上に含まれる。つまり、フランチャイズ加盟店の売上を加算すると実質的な EC 化率は更に落ちると考えられる。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.7andi.com/ir/file/library/kh/pdf/2021_0408kh_02.pdf&quot;&gt;決算補足資料&lt;/a&gt;の11ページによると、FY2021/2 のセブンイレブンのチェーン全店売上は4兆8,706億円だが、このうち4兆7,875億円が加盟店での売上だった。&lt;/p&gt;
&lt;h2 id=&quot;食品の-ec-化&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E9%A3%9F%E5%93%81%E3%81%AE-ec-%E5%8C%96&quot; aria-label=&quot;食品の ec 化 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;食品の EC 化&lt;/h2&gt;
&lt;p&gt;アマゾンは書籍や電化製品、日用品などが強く、ウォルマートは食品に強そうだ。両者の EC 事業の成長率が大きく異なる原因は、サービスの違いというよりは得意分野にあるのかもしれない&lt;sup id=&quot;fnref-7&quot;&gt;&lt;a href=&quot;#fn-7&quot; class=&quot;footnote-ref&quot;&gt;7&lt;/a&gt;&lt;/sup&gt;。&lt;/p&gt;
&lt;p&gt;その点では、ウォルマートのように「&lt;strong&gt;顧客がインターネットを通じて商品を購入し、実店舗に取りに行く&lt;/strong&gt;」というモデルは商品の保管や流通のコストが従来と大きく変わらないという点でよくできているように見える。ただし、顧客がオンラインで購入した商品を受け取る拠点を広げたり店舗やバックヤードから引き渡す商品を効率的にピックすることを考えると、店舗などの施設に多少の投資は必要だろうが…&lt;/p&gt;
&lt;p&gt;一方の日本では、冒頭で挙げた&lt;a href=&quot;https://www.meti.go.jp/press/2020/07/20200722003/20200722003.html&quot;&gt;経産省による市場調査&lt;/a&gt;を読むと他分野に比べて食品の EC 化率が非常に低いことが見て取れる。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/c4a2e1633a42fd803333909b9e36084d/f53a0/ec-market.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 72.15189873417721%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB00lEQVQ4y2WTzW6jQBCEef/3yBvsIfdI2cOuD7F8s3ywwcaYPwOG4b+ib5QhxBmpPbjpqa6qHrxpmtT3/a8YhkFVVSkMQwVBoCiKdLlc1HedKmN0rirdJSXjqHSalM2zummSl6ap4jhW0zR6PB6q63oJ/pP3fV+bzUZZniv0fe3jWH+iSC8fH3ofBr0Zo9ckUTqO8hxQ27YyxliAdZCD6W63E83DINClrvWvbfW63+tvUeh/XestSVTMs7yu65RlmS3O81xY4GIcRxs8J0lilWDH/X7XSM0863Q6qTFGZVXZ5h4/rvh6vVq2eFaWpeZ5XkBdQ9iyswDHV9M0NodKCwgYB2CKTAeyDmoIGsKQZv0wWH85Q84CIhk2JBgEi2LCSecZsNvtZlnBkkUj1DjvwfJAhRmy3XA4tPaRHTBAOby2A4YQKYviWzJg3Dd2unAH10NxHhJrydThIewgZQHXDGEAILn1tAlAqOFdURSLJRABENaLh0zI+QhjXjx7CDu+FuyApfPweDxaQGT/mDIsnTfPcvnPe3x0bFwNQwGMQS2AxZehrqsDcd85XrnL33zdORb58/lsVTl13hrg+e7BlmYwOBwOlg1M8JIF0+12a5uQY/8EVs02MkFVXK0AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;ec-market&quot;
        title=&quot;ec-market&quot;
        src=&quot;/static/c4a2e1633a42fd803333909b9e36084d/f058b/ec-market.png&quot;
        srcset=&quot;/static/c4a2e1633a42fd803333909b9e36084d/c26ae/ec-market.png 158w,
/static/c4a2e1633a42fd803333909b9e36084d/6bdcf/ec-market.png 315w,
/static/c4a2e1633a42fd803333909b9e36084d/f058b/ec-market.png 630w,
/static/c4a2e1633a42fd803333909b9e36084d/40601/ec-market.png 945w,
/static/c4a2e1633a42fd803333909b9e36084d/f53a0/ec-market.png 1062w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.meti.go.jp/press/2020/07/20200722003/20200722003-1.pdf&quot;&gt;この報告書&lt;/a&gt;を詳細に読んでいくと、面白いデータがあった。日本は US/UK に比べて飲食料品やアパレル店舗1つあたりの人口が非常に少ないようだ。つまり実店舗へのアクセスが良いと言える。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/3e16f1945eb61b26cd0b1664ccf86845/17a7a/ec-compare.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 86.0759493670886%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAAChElEQVQ4y52UW2/aQBCF8///Sl/6kEhJGpEmEIeUxBACOBhjc8f4bsCY+4nOJCBUt1JVS6OdtdffzpmdnbP9fg8+q9VKbLPZYLFYIE1TJEmC+XyORZrKnN84zpNE1qzXa7HtdisMss4OQM91YRht2JMJPM+T0XVdDAYDOI6L4XAI27bhOI58o891nBOaAWK/x2a9wm67wf88B84RmKQruFECL14gmC6hmwPcKSWoVQ3XtwVc5fL49v0Cd8ozzL4NJ0ww9mLY/gzp8iTC3RfQ6Ds4LzRwnq/hqthE7sXCRb6GXPENl/cqfhQquFGqyBVruH2q41kbfPkNuEGcldwbTnCdf0FOKaPw0sBjWYeivsN1HMRRAL35jo5lIgx8GK0mojBA4Ltot3TMZtMs0PZi3Jc0gd6XGqjoIyjlJnw/RBiGUJRH9Ho9OQhVVeH7PuJ4imr1DUEQ/BmolFt4UN/xoDbx9GYiX6rDnjiIogivr68wTRNxHEPTNDnd6XQKXdflewY4ciPcFmu4eahIhMVqG5c/S/D8QBYahoFWqyW1SOB4PBbfsiyJNgN0wykqWgdqzZCxrFm4yf+CaVlSj/V6He12Wwq70+mIdBZ3v9+XqDNA3gguYr5YuGEQII4iiYJrdrtdpuYO70/nRyB3m0wmkngabwhvB6V1u92j73u+SOTmpzckU9gEjm1bQJRBKPNDGN/xQOhT/gFINbPZLBvhMY+ui9FoJDmiMWeE80eeKo2RUgl9jjQ2lYzk5XL5Kcn3JZ/sNNyd75knGrsKc0qf41ry+5e7zB/ZcT5lcXcHg34f3W7vCOZpUgU35MaM8rR1/QZMEQShtCXmjFIo93AL/qXTUPIHQdIEIS3BUawAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;ec-compare&quot;
        title=&quot;ec-compare&quot;
        src=&quot;/static/3e16f1945eb61b26cd0b1664ccf86845/f058b/ec-compare.png&quot;
        srcset=&quot;/static/3e16f1945eb61b26cd0b1664ccf86845/c26ae/ec-compare.png 158w,
/static/3e16f1945eb61b26cd0b1664ccf86845/6bdcf/ec-compare.png 315w,
/static/3e16f1945eb61b26cd0b1664ccf86845/f058b/ec-compare.png 630w,
/static/3e16f1945eb61b26cd0b1664ccf86845/17a7a/ec-compare.png 753w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;報告書では店舗へのアクセスの良さを EC 化率の低さの一因と推測しているが、個人的にはそれほど重要な要素ではないと思う。UK より店舗アクセスが遥かに悪い US は EC 化率が UK の半分未満だし、UK と店舗アクセスに大きな違いがない日本は EC 化率が遥かに低い。&lt;/p&gt;
&lt;p&gt;一方で、逆に効率的な流通ネットワークがあれば EC が普及するとも言い切れないとは思う。私は以前の会社で一瞬だけ UK の EC 事業の財務経理に関わったことがあるが、配送業者のコストパフォーマンスは日本の方が圧倒的に上だという印象を受けた。US と比べても日本の方が配送のコストパフォーマンスは優れている印象がある。しかしながら、それらの国々は日本より EC 化率が高い。&lt;/p&gt;
&lt;p&gt;購入した商品を配達してもらうかピックアップするかの選択については配達品質や送料、店舗アクセスの良さが影響しそうだが、そもそも商品をオンライン/オフラインのどちらで購入するかという選択は結局のところオンラインの強みである「手軽にパーソナライズされた購入体験を低コストで」消費者に提供できるかどうかによるのではと思った。&lt;/p&gt;
&lt;p&gt;個人的な意見として、日本の EC 化率が低い原因はオフラインの購入体験が（値段の割に）良すぎることにあるのではと思う。やる気がなくて不機嫌な店員とか見ないし、店の中は清潔で分かりやすくレイアウトされてるし、ヨドバシの店員は何でも知ってるし。&lt;/p&gt;
&lt;h2 id=&quot;まとめ&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%81%BE%E3%81%A8%E3%82%81&quot; aria-label=&quot;まとめ permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;まとめ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;ウォルマートは EC でも頑張っていた&lt;/li&gt;
&lt;li&gt;Amazon はすごい&lt;/li&gt;
&lt;li&gt;小売の広告事業は面白そう&lt;/li&gt;
&lt;li&gt;日本の EC 化率は非常に低い（特に食料品）が、逆に考えると伸び代がありそう&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;おまけ&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%81%8A%E3%81%BE%E3%81%91&quot; aria-label=&quot;おまけ permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;おまけ&lt;/h2&gt;
&lt;p&gt;最近 10X というベンチャー企業がイトーヨーカドーと協同でネットスーパーを立ち上げて（&lt;a href=&quot;https://signal.diamond.jp/articles/-/264&quot;&gt;記事&lt;/a&gt;）勢いがあるらしいという話を聞いた。採用情報は&lt;a href=&quot;(https://jobs.10x.co.jp/)&quot;&gt;こちら&lt;/a&gt;。&lt;/p&gt;
&lt;div class=&quot;footnotes&quot;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&quot;fn-1&quot;&gt;4-5-4 という数字は見慣れないかもしれない。これは小売業特有のやり方で、3ヶ月ごとだと日数の違いが影響してくるので1年を52週としてそれを13週ずつに分け、4週+5週+4週で1四半期ということにする…という方法らしい。もちろん決算は他の会社と同じように3ヶ月で区切るので、 SEC Filings の実績とは期間がずれることになる。&lt;a href=&quot;#fnref-1&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;li id=&quot;fn-2&quot;&gt;FY2022 の売上が前年並の成長をした上で EC 売上が目標の $75B を達成すると、売上の EC 化率は約 13% となる。&lt;a href=&quot;#fnref-2&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;li id=&quot;fn-3&quot;&gt;昨年までは Walmart Media Group と呼ばれていたが、2021年1月28日に改名された（&lt;a href=&quot;https://corporate.walmart.com/newsroom/2021/01/28/walmart-announces-expanded-vision-and-new-name-for-its-media-business&quot;&gt;プレスリリース&lt;/a&gt;）。現在は US だけで提供されているようだ。&lt;a href=&quot;#fnref-3&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;li id=&quot;fn-4&quot;&gt;ちなみにこのときソフトバンクの Vision Fund が保有株式（約20%）を全て売却し 1,467 億円の売却益を得ている（&lt;a href=&quot;https://group.softbank/system/files/pdf/ir/financials/financial_reports/financial-report_q2fy2018_01_ja.pdf&quot;&gt;FY2019/3 第2四半期決算短信&lt;/a&gt;）。&lt;a href=&quot;#fnref-4&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;li id=&quot;fn-5&quot;&gt;一般的に人件費の一部をソフトウェア資産として計上することはあるが、 BS に掲記されていないのであったとしても僅少な額だと考えられる。&lt;a href=&quot;#fnref-5&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;li id=&quot;fn-6&quot;&gt;FY2021 で国内店舗数が 21,085 で直営店が 453 なので構成比は 2.1%、国外の店舗数は 9,884 で直営店が 2,399 なので 24.3%&lt;a href=&quot;#fnref-6&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;li id=&quot;fn-7&quot;&gt;Amazon Fresh の Google トレンドを見ると世界のどこでも流行ってなさそうなので、 Amazon といえど食料品には苦労していると思う。&lt;a href=&quot;#fnref-7&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content:encoded></item><item><title><![CDATA[非技術者がテック企業でプログラミングとか SQL とかを始めることの価値]]></title><description><![CDATA[…]]></description><link>https://lyohe.github.io/2021-08-21-programming-tanosii/</link><guid isPermaLink="false">https://lyohe.github.io/2021-08-21-programming-tanosii/</guid><pubDate>Sat, 21 Aug 2021 01:18:21 GMT</pubDate><content:encoded>&lt;p&gt;…を偉そうに書けるような立場でもないのだが、経験談としてどこかに書いてこの話は忘れようと思ったのでここに書く。&lt;/p&gt;
&lt;p&gt;ここでいう「テック企業」とは主にインターネットを通じてソフトウェアを提供することで何らかの金銭的価値を生み出す会社を、「非技術者」とはその会社に雇用されている者のうちソフトウェアの設計・開発に直接携わらない従業員を指すものとする。&lt;/p&gt;
&lt;h2 id=&quot;自分自身の経験&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%87%AA%E5%88%86%E8%87%AA%E8%BA%AB%E3%81%AE%E7%B5%8C%E9%A8%93&quot; aria-label=&quot;自分自身の経験 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;自分自身の経験&lt;/h2&gt;
&lt;p&gt;私は元々いわゆるテック企業で経理をやっていて今はプログラミングの仕事をしているのだが、その最初のきっかけになったのは経理の仕事の一環で SQL の勉強をしたことだった。&lt;/p&gt;
&lt;p&gt;なぜそうなったかというと、当時会社が運営するサービスで本番DB（のレプリカ）から会計処理に必要なデータを集めて SQL と PHP で集計しレポートとして出力するシステムがあったのだが、そのシステムが出力する数字を集めて足し引きするとどうも辻褄が合わない…という問題があり、決算を締めるためにシステムの調査が必要になったという理由がある。&lt;/p&gt;
&lt;p&gt;それまでほぼ経理しかやってこなかった当時の自分ができる仕事ではなく、データ分析を専門にやってる人やそのシステムを作った人にお願いするべき仕事ではあった。しかし、社内的な事情で短期的に会計の調査に人を割けないという話になり、何やかんやあって周りの支援を受けつつ自分がその仕事をすることになった。&lt;/p&gt;
&lt;p&gt;この過程で社内外のたくさんの人にご迷惑をかけてしまった（何なら辞めた後も自分が作った負債が残っている気がする…）が、結果としてサービスを支えるデータ構造やそれがいつどんなタイミングで変化するか、何がどうなると会社の債権債務に影響があるのかをほぼ理解できるようになった。&lt;/p&gt;
&lt;p&gt;やる前はあまり理解していなかったのだが、業務を支えるデータに関する知識があって簡単な SQL が扱えると経理の仕事でも役に立つことはある。例えば…&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;月次決算の推移のうち、サービス内のデータに紐付いている売上や費用をより詳細に分析できる&lt;/li&gt;
&lt;li&gt;投資家や経営向けの資料に用いる KPI を自分で取得したり、その変動要因を自分で調査できる&lt;/li&gt;
&lt;li&gt;新たなサービスや機能、施策が財務に与える影響を自分で予測できる&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;SQL がある程度分かるようになるとデータの収集や加工、集計、しかるべき場所への投稿などを自動化したくなり、簡単な Python や JavaScript を書いたり Zapier 等のノーコードツールを使うようになった。&lt;/p&gt;
&lt;p&gt;書いていたのは今考えると本当に恥ずかしいプログラムでもう全部捨てたのだが、当時は簡単に業務を自動化できて楽しいという感覚があった。環境としては自分の仕事用 PC や AWS Lambda、Google Apps Script、Zapier（実質的には AWS Lambda）、BigQuery の UDF 等を使っていた。&lt;/p&gt;
&lt;p&gt;その後も会計のシステムやそういった簡単なデータ分析に関わるうちにもっと根本から自分の仕事を何とかしたいなと思うようになり、気がついたらプログラマーに転職していた。&lt;/p&gt;
&lt;h2 id=&quot;周囲の経験&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%91%A8%E5%9B%B2%E3%81%AE%E7%B5%8C%E9%A8%93&quot; aria-label=&quot;周囲の経験 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;周囲の経験&lt;/h2&gt;
&lt;p&gt;急成長する会社では必ずと言っていいほど採用が遅れるので、逆に考えると個人の成長機会が豊富にあるということになる。&lt;/p&gt;
&lt;p&gt;自分と同じような経験をした人は社内の様々な部署にいて、その人達が定期的に集まってデータ分析の過程や結果、業務自動化のやり方を共有する緩やかなコミュニティがあった。&lt;/p&gt;
&lt;p&gt;例えばカスタマーサポートをやっている人が問い合わせに対応するだけではなく、積極的にデータを抽出・分析して「どのような人が困っていて問い合わせに発展しそうか」を調べたり、問い合わせの対応や体制を変更したときの効果を検証したり、対応の効率が高いメンバーの傾向について仮説を建ててそれをデータで検証したり…&lt;/p&gt;
&lt;p&gt;他にもマーケティングや人事、広報、他にも様々な職種の人がプログラミングや SQL を始めていた。また、自分の業務を自動化する内にソフトウェアエンジニアとして社内転職してしまった人もいた。&lt;/p&gt;
&lt;h2 id=&quot;プログラミングや-sql-をやることの価値&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0%E3%82%84-sql-%E3%82%92%E3%82%84%E3%82%8B%E3%81%93%E3%81%A8%E3%81%AE%E4%BE%A1%E5%80%A4&quot; aria-label=&quot;プログラミングや sql をやることの価値 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;プログラミングや SQL をやることの価値&lt;/h2&gt;
&lt;p&gt;テック企業ではプログラミングや SQL ができると仕事の幅が広がりやすいと思う。自分がそう考える理由を洗い出してみた。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;仮説検証サイクルの高速化&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;多くの会社では仕事の多くは顧客の行動から発生している&lt;/li&gt;
&lt;li&gt;日々の仕事の根拠となる顧客の行動を記録したデータを自分で取得・加工できるので、仮説と検証のサイクルを速く回すことができる&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;社内の他のチームから信頼してもらいやすい&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;少し勉強すればできそうな仕事をたくさん投げてくる人より、自分で解決しようとする人の方が信頼できる&lt;/li&gt;
&lt;li&gt;多くの人に名前を覚えてもらうと、新しい仕事がいろいろ舞い込んでくる&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;上達の早さ&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;周囲に専門家（ソフトウェアエンジニア）が沢山いるのでその仕事の様子を見ることで自分がどう行動すべきかの指針になり、完全独学より効率がよい&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;いろいろ書いたが、自分が働いている会社の商材に詳しくなると仕事の幅が広がる、と言い換えると至極当然のことかもしれない。&lt;/p&gt;
&lt;h3 id=&quot;注意すべき点など&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%B3%A8%E6%84%8F%E3%81%99%E3%81%B9%E3%81%8D%E7%82%B9%E3%81%AA%E3%81%A9&quot; aria-label=&quot;注意すべき点など permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;注意すべき点など&lt;/h3&gt;
&lt;p&gt;プログラミングや SQL を始めるにあたって注意すべき点もある。&lt;/p&gt;
&lt;p&gt;当たり前のことではあるのだが、サービスの本番環境のアプリケーションやデータベースは絶対に素人が触ってはいけない。そもそも普通は触れないようになっていると思うが…&lt;/p&gt;
&lt;p&gt;というのも、それらは顧客の情報を加工・保存して必要に応じて出し入れするという重要なミッションがあって、それを扱う能力がある限られた人が運用することを前提に様々な人が協力して日々仕事をしているわけで、その前提をぶち壊す可能性があるからだ。&lt;/p&gt;
&lt;p&gt;例えば自分がソフトウェアエンジニアだったとして、プロ意識を持って作ったシステムが素人に壊されたりデータベースの障害を起こされたらいい気はしない。逆の立場で自分が経理やってたとして、チーム外のよく知らない人に勝手に仕訳入れられたら嫌だし。&lt;/p&gt;
&lt;p&gt;逆に言うと、（本番で保存されている個人情報が取り除かれているという前提で）本番と切り分けられたアプリケーションやデータベースの環境があるのなら自由に遊んでもいいということになる。&lt;/p&gt;
&lt;p&gt;もう一つ、社外（顧客、メディア、投資家…）に出すデータやアウトプットは必ず社内の専門家にチェックしてもらうというのがある。当たり前のことかもしれないが、誤ったデータを出してしまうと会社の信用に関わるので…&lt;/p&gt;
&lt;h2 id=&quot;結論&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%B5%90%E8%AB%96&quot; aria-label=&quot;結論 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;結論&lt;/h2&gt;
&lt;p&gt;結論としては、プログラミングや SQL ができるとテック企業では様々な新しい機会があるので楽しく仕事ができるよ、ということが言いたかった。&lt;/p&gt;
&lt;p&gt;プログラミングに興味があればまず手元でできることをやって、それから同じような考えを持っている人や一緒に仕事をする社内のソフトウェアエンジニアに声をかけてみれば世界が広がっていくと思う。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Fastly の財務諸表を読んだ話 その2]]></title><description><![CDATA[昨年の年始に「Fastly の財務諸表を読んだ話」というブログを書いたことを思い出し、その続きを書くことにした。 ちょっと前に例の件で話題になって「そういえば上場から2年経ったけど調達した資金は何に使ったのかな？」と気になったことがきっかけである。 数字は主に FY202…]]></description><link>https://lyohe.github.io/2021-07-11-fastly-2/</link><guid isPermaLink="false">https://lyohe.github.io/2021-07-11-fastly-2/</guid><pubDate>Mon, 12 Jul 2021 15:00:00 GMT</pubDate><content:encoded>&lt;p&gt;昨年の年始に「&lt;a href=&quot;https://lyohe.medium.com/fastly-%E3%81%AE%E8%B2%A1%E5%8B%99%E8%AB%B8%E8%A1%A8%E3%82%92%E8%AA%AD%E3%82%93%E3%81%A0%E8%A9%B1-310cc00fa7ca&quot;&gt;Fastly の財務諸表を読んだ話&lt;/a&gt;」というブログを書いたことを思い出し、その続きを書くことにした。&lt;/p&gt;
&lt;p&gt;ちょっと前に&lt;a href=&quot;https://www.fastly.com/blog/summary-of-june-8-outage&quot;&gt;例の件&lt;/a&gt;で話題になって「そういえば上場から2年経ったけど調達した資金は何に使ったのかな？」と気になったことがきっかけである。&lt;/p&gt;
&lt;p&gt;数字は主に &lt;a href=&quot;https://investors.fastly.com/financials/sec-filings/sec-filings-details/default.aspx?FilingId=14761111&quot;&gt;FY2020 の Form 10-K&lt;/a&gt; から拾っていく。以下、数字を省略する記号として M = millions（100万）、 B = billions（10億）とする。&lt;/p&gt;
&lt;h2 id=&quot;資産と負債&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%B3%87%E7%94%A3%E3%81%A8%E8%B2%A0%E5%82%B5&quot; aria-label=&quot;資産と負債 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;資産と負債&lt;/h2&gt;
&lt;p&gt;まずは Fastly のバランスシートを同一縮尺で FY2017 ~ FY2020 の4年分並べてみる。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 598px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/b7ce22246c9a8fb166de1e1f3326e0e5/0c69d/fastly-bs.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 61.39240506329114%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACAklEQVQoz42SS2sTURSA81P8G/4DNy66dC9IaNONC8Gi4MKFQncF0Z3+AHeWYlFiFyJWiiA+iDFpkkYzj5vMTJrMnfv69M4ktr6oFw53zszcj++cc2vHxjCYJIRhjIp7TINDhEjopt8YhCF5NiJP2gRhTJomjIKASRxBEDAXMeNkxiCSiDjCOUfNAsd5ThTFyNkUoyRaG+ZKUiiF0QVGzVFao7VGle80b4ZtmsEIUWhkroiiCCklNfxyDmstjj+X+0d2sL/C1r0VvnQPy1wbXRn6pCgKhBDl7hbwv4cpd+O52xe5fesBr1olgTgWJ4YeYkz1s38+M4Dw2jqXGy9o9ks/CmUqwyRJyt6kafofhlUYIN5Ypd54yl7PAyXjSVJ+q/lSl80+y9BajfFle+D1NeqN3QVQk0tVGYZhWJplWVZCfzc0RlftcCcDqYCrp4CSJM0qw+VB31B/0E/cWQ91v4zY6Jxe/wkHn98iLYiNximgYj6XJ1P2QG/o75fvj1lckZmZ82H8HpFEoEImz89Rv7tDOIPsxipX1nbZ61dTTtJpZeiWpThbbsPWNo/uX+XZ6wAZ7fN48zybD1+is4D+1gUu3ekwnIK42aC+vkOzUxkui/kJtMagnUOPQ7rvPjEYG8hniI9dOqMCqzVxq0+nF6OMZfr1iHZ7yDTXWKOrFv0Afgc5HoeiHVEU+wAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;fastly-bs&quot;
        title=&quot;fastly-bs&quot;
        src=&quot;/static/b7ce22246c9a8fb166de1e1f3326e0e5/0c69d/fastly-bs.png&quot;
        srcset=&quot;/static/b7ce22246c9a8fb166de1e1f3326e0e5/c26ae/fastly-bs.png 158w,
/static/b7ce22246c9a8fb166de1e1f3326e0e5/6bdcf/fastly-bs.png 315w,
/static/b7ce22246c9a8fb166de1e1f3326e0e5/0c69d/fastly-bs.png 598w&quot;
        sizes=&quot;(max-width: 598px) 100vw, 598px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3 id=&quot;資産の伸び&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%B3%87%E7%94%A3%E3%81%AE%E4%BC%B8%E3%81%B3&quot; aria-label=&quot;資産の伸び permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;資産の伸び&lt;/h3&gt;
&lt;p&gt;上記のバランスシート推移を見ると、 FY2019 と FY2020 に大きな変化が見てとれる。FY2019 は原因が分かりやすく、2019年5月に IPO したことで多額の現金（$192M）を市場から調達し、それで市場性のある有価証券を購入していたため、流動資産と純資産が増えている。&lt;/p&gt;
&lt;p&gt;一方で FY2020 を見ると、固定資産が物凄い伸び方をしている。これはなぜだろうか。&lt;/p&gt;
&lt;p&gt;Fastly のような CDN ビジネスを運営するには、地理的に分散したエッジサーバーやネットワーク機器、それらを管理するデータセンターのような施設が必要になる。&lt;/p&gt;
&lt;p&gt;もちろんそれらの固定資産も加わっているだろうが、実際に中身を見るとこの大幅な資産の増加の8割以上は &lt;a href=&quot;https://www.signalSciencess.com/&quot;&gt;Signal Sciences&lt;/a&gt; という会社を買収したことによる無形資産（のれん含む）の増加だった。&lt;/p&gt;
&lt;h3 id=&quot;signal-sciences&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#signal-sciences&quot; aria-label=&quot;signal sciences permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Signal Sciences&lt;/h3&gt;
&lt;p&gt;Fastly は2020年10月1日付けで Signal Sciences という会社を $759.4M （約800億円）で買収している。このとき現金で $223.0M を支出しており、残りは Fastly の Class A 普通株式の新規発行で賄われた。&lt;/p&gt;
&lt;p&gt;実は Fastly が2019年5月21日に IPO した時に調達した資金が underwriting discount を除いて $192.5M なので、上場時に調達した額以上の現金 + 残りは株式をつぎ込んで買収したということになる&lt;sup id=&quot;fnref-1&quot;&gt;&lt;a href=&quot;#fn-1&quot; class=&quot;footnote-ref&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;。何も知らない部外者である自分から見ると、経営陣はなかなか大胆な決断をしたと思う。それだけこの買収が Fastly という会社にとって重要だと言えそうだ。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.signalsciences.com/blog/today-signal-sciences-and-fastly-join-forces-and-our-customers-are-our-first-priority/&quot;&gt;買収時点の発表&lt;/a&gt;では、 Signal Science 社の従業員は Fastly のセキュリティサービスである &lt;a href=&quot;https://www.fastly.com/products/cloud-security&quot;&gt;Secure@Edge&lt;/a&gt; の立ち上げ及びその &lt;a href=&quot;https://www.fastly.com/products/edge-compute/serverless&quot;&gt;Compute@Edge&lt;/a&gt; への統合に関する開発に関わることになっている。同社は買収時点で創業6年半のスタートアップ企業で、従業員はおよそ 150 人だった。&lt;/p&gt;
&lt;p&gt;Signal Sciences は Web アプリケーションの API のセキュリティに関する製品を開発している企業。顧客は同社の「エージェント」を自分が運用する Web サーバー、ゲートウェイ、プロキシ等にインストールし、そのエージェントが検知した攻撃のデータを Signal Sciences のサーバーに送ることで情報を集約し、 PagerDuty や Datadog 、 Slack 等各種の Toolchain と統合して可視化することができる。&lt;/p&gt;
&lt;p&gt;セキュリティ版の &lt;a href=&quot;https://sentry.io/welcome/&quot;&gt;Sentry&lt;/a&gt; と考えるとよさそう。&lt;/p&gt;
&lt;h4 id=&quot;etsy-と-signal-sciences&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#etsy-%E3%81%A8-signal-sciences&quot; aria-label=&quot;etsy と signal sciences permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Etsy と Signal Sciences&lt;/h4&gt;
&lt;p&gt;Signal Sciences の経営陣と初期メンバーの大半は同社の設立前に Etsy で働いていたらしい。 Etsy は一般の人がハンドメイドの製品を売り買いするマーケットプレイスを開発・運営しており、アメリカやヨーロッパを中心に展開している。2020年の流通総額は $10.3B （約1兆円）で売上は $1.7B なので、メルカリの日本事業と米国事業を足して一回り大きくしたくらいの規模の会社だ。&lt;/p&gt;
&lt;p&gt;これは事実ではなく私の推測に過ぎないが、もともと Etsy の社内で Signal Sciences で取り組んでいるのと同じようなセキュリティの問題があり、 API への潜在的な攻撃の兆候（HTTP のエラー、不審なトラフィック、攻撃に発展する可能性があるリクエスト等）を検出する社内システムやそれを可視化するダッシュボードを作っていて、同じようなことをビジネスとして実現するために独立したように見える。Etsy は同社の最初の顧客であり設立時には advisory board に Etsy の CEO が入っていたとのことなので、関係は良好そうだ。&lt;/p&gt;
&lt;p&gt;Etsy との関係については Signal Sciences 社自身による Fastly への売却を告知する記事にも記載されている。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.signalsciences.com/blog/fastly-to-acquire-signal-sciences/&quot;&gt;https://www.signalsciences.com/blog/fastly-to-acquire-signal-sciences/&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;akamai-との比較&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#akamai-%E3%81%A8%E3%81%AE%E6%AF%94%E8%BC%83&quot; aria-label=&quot;akamai との比較 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Akamai との比較&lt;/h3&gt;
&lt;p&gt;Fastly の同業他社として最大の会社はおそらく Akamai だろう。どれくらいの差があるのか、同一縮尺で FY2020 のバランスシートを比較してみる。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 599px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/eaed1714b76aaab2ccba6f232296a485/43142/bs-fastly-vs-akamai.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 61.39240506329114%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACPklEQVQoz42Tz2oTURTG5wEEH0G7UioUpNoi+AC+g2uR4kYQrAtBrau2G7vzT22xBUWxVVA36s5KpQvbhTFVJI2ZSDOTySQzyWTu3Ll3fjI3JtXShQOXwz1zvu+c75xzrUgp7FYL1/WQXoWOU6bRaFEOalRdlzh0EMEPao6HaHeImyGy6cOuje/WqDcjqnVBw6uTZRmWBoJOB8dxEVEbJQVpmtKVgkRKVJqQyohMaUqBxzu7yEbDZ91PcOOETCmCdhfXcRBCYPEfX5ZpY78VZnj9xOLeygUuzU9TqBR7/8kGsYYwSRKCIEBKacrWWv97lMRQbt+ANxbMHYbzFmw+M/4k7g7whlApRRzHxuaE+49WqcneeHqX4rlhwsvH4aJFtrlqasvb1MdbrVbL9Cy/5NUcRJj3yRA+mufrqZPUJ0aJJizk1ivj16k0HDne8n2fKIrIbS79QMmpNEB3+SGV8SHmrj7mzM0m64W28XdjMcBbjuMY0L4pgFZkhnCvwvryIvbYUaYnXzI8BWvFXiK9NxOsvKJcv+d5iCRBa2Uanf2dQKfm7i4tYI8PMTu5yshUxlqhayKjrujh+2vTl8mf9eg436l9esB24TPvt3ZxvLAneWmB6ukjzE6+4MQt+FhMjF9pBv03FfZJZT4poLayTHnsEHeu3GfkesjbjYaJqS4tsnP2GDPXnjN6W/LhSweQiKS3bgPJRpXWZlKp1sj8idm/qOzsUvUVUZyitEKGIe2fJcqlKrYne36VGlyf8DesXXNm6XF7WAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;bs-fastly-vs-akamai&quot;
        title=&quot;bs-fastly-vs-akamai&quot;
        src=&quot;/static/eaed1714b76aaab2ccba6f232296a485/43142/bs-fastly-vs-akamai.png&quot;
        srcset=&quot;/static/eaed1714b76aaab2ccba6f232296a485/c26ae/bs-fastly-vs-akamai.png 158w,
/static/eaed1714b76aaab2ccba6f232296a485/6bdcf/bs-fastly-vs-akamai.png 315w,
/static/eaed1714b76aaab2ccba6f232296a485/43142/bs-fastly-vs-akamai.png 599w&quot;
        sizes=&quot;(max-width: 599px) 100vw, 599px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;あれだけ急速に成長している Fastly も資産の規模では約6倍の大差があることが分かる。これでも差は縮まってきていて、上場前には20倍以上の差があった。&lt;/p&gt;
&lt;p&gt;Akamai がどれくらい大きい会社かというと、 Akamai のバランスシートに載っているのれん（Goodwill, 買収時の評価額と買収先の時価評価純資産の差額）だけで Fastly のバランスシートよりも大きい。&lt;/p&gt;
&lt;p&gt;余談だが、この「同一縮尺で財務諸表を比較する」という図はその会社のお金の流れを掴んだり同業他社と比較するとき視覚的に規模を捉えられるので非常に便利で、決算を読むときには強くおすすめしたい。&lt;/p&gt;
&lt;h2 id=&quot;損益&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%90%8D%E7%9B%8A&quot; aria-label=&quot;損益 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;損益&lt;/h2&gt;
&lt;p&gt;Fastly の損益計算書を4年分並べてみる。売上は YoY で&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;FY2017 → FY2018: +37.8%&lt;/li&gt;
&lt;li&gt;FY2018 → FY2019: +38.9%&lt;/li&gt;
&lt;li&gt;FY2019 → FY2020: +45.1%&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;と急速に成長している。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 598px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/0738180e9906dd09df33cc8fed31015a/0c69d/fastly-pl.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 62.0253164556962%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAAB70lEQVQoz11T0WoUMRSd//DP9G8q6IMg6KsPglUUBN3KKghSitR9seiDYtnStbpbujvbzuzMrDOZ5N7kyE0m09FAJjeZ5NyTe04S5xxiixExML8iNNsKajHHKr1EXaXQ1QzL1RpVVeL6FDCAQCKftm2R5zmICM5aMFsozWAisFIwMpIGmwbakN8HWFzkhN+XIZYzQi4JGRysDQuxR77W/cteGtsw7h0Z7B7qbs1dAwrDzWbjMwvwsEt258J4VTE+fDOejaQYf9F4MdE+JvqPITMPmDnYLv40JWTbAPAzZdx+rfqijb+aDnDAsCgKKKWQbwpZxsEPwuGUepl2XimcrNjPztaMe+O2Y+484HMPaEGxhlmWhev5pBZPPiq8nDSiNeAYd0c1Zhetn58uDe7sNX0tR58Vnk2Mjw2F0iRpmnaCAGxanBcWszfvoI92QLbB9ExhNXoEnu+icsD3/WNkj2/CFu+xVMDx0xHqt7eg9bkXKxEwEaNpmu4qQtR4i7ioLbWw1Ia4rqFOD8DNLz/NHt7H+sENAAu/24sigHVdw1rury8/JWZh35nXsoUdmFnidrEArU9EZ7/WA4ow0YuieIw96HDOYnjjH4BPjgDshj40xnQMwyFRXrwZk4lHZY80KU1Zlv0DKIsCf7YVov3+AtM6m8kBSCdvAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;fastly-pl&quot;
        title=&quot;fastly-pl&quot;
        src=&quot;/static/0738180e9906dd09df33cc8fed31015a/0c69d/fastly-pl.png&quot;
        srcset=&quot;/static/0738180e9906dd09df33cc8fed31015a/c26ae/fastly-pl.png 158w,
/static/0738180e9906dd09df33cc8fed31015a/6bdcf/fastly-pl.png 315w,
/static/0738180e9906dd09df33cc8fed31015a/0c69d/fastly-pl.png 598w&quot;
        sizes=&quot;(max-width: 598px) 100vw, 598px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3 id=&quot;売上の-cohort&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%A3%B2%E4%B8%8A%E3%81%AE-cohort&quot; aria-label=&quot;売上の cohort permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;売上の Cohort&lt;/h3&gt;
&lt;p&gt;売上の Cohort を見ると、2019年から使い始めた顧客の伸びが大きそうだ。&lt;/p&gt;
&lt;p&gt;2019年から使い始めた顧客から生じた売上は FY2019 は $9.1M だったが FY2020 は $47.4M で、 YoY+424% の急成長ということになる。&lt;/p&gt;
&lt;p&gt;なお、この Cohort には Signal Sciences の売上は含まれていない。単位は百万ドル。Form 10-K 63ページより引用した。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/0edf37793ac8fcfa2ad98fd999a2faea/45a30/fastly-cohort.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 63.291139240506325%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAMBAgQF/8QAFgEBAQEAAAAAAAAAAAAAAAAAAQAC/9oADAMBAAIQAxAAAAHvqrjmBoa//8QAGxAAAgIDAQAAAAAAAAAAAAAAAAECAwQREhT/2gAIAQEAAQUCLLYVpZPRLtnnbax9H//EABURAQEAAAAAAAAAAAAAAAAAABAR/9oACAEDAQE/AYf/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAdEAABAwUBAAAAAAAAAAAAAAAAAQIhESIyM4Gh/9oACAEBAAY/Ai5SEcQ6nDZ4Zn//xAAaEAEBAQADAQAAAAAAAAAAAAABEQBBUYFx/9oACAEBAAE/IdRGdHLhpjvzCoZ9ZYVXvGMt83//2gAMAwEAAgADAAAAELMv/8QAGhEAAgIDAAAAAAAAAAAAAAAAAAERYaGx0f/aAAgBAwEBPxBW3xk2sn//xAAWEQEBAQAAAAAAAAAAAAAAAAAAARH/2gAIAQIBAT8QZH//xAAfEAACAgEEAwAAAAAAAAAAAAABEQAxIVFhcYGRweH/2gAIAQEAAT8QFTM87nALMIrRB00gyg2HeSfULEHdp7bhqTRbP1P/2Q==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;fastly-cohort&quot;
        title=&quot;fastly-cohort&quot;
        src=&quot;/static/0edf37793ac8fcfa2ad98fd999a2faea/828fb/fastly-cohort.jpg&quot;
        srcset=&quot;/static/0edf37793ac8fcfa2ad98fd999a2faea/ff44c/fastly-cohort.jpg 158w,
/static/0edf37793ac8fcfa2ad98fd999a2faea/a6688/fastly-cohort.jpg 315w,
/static/0edf37793ac8fcfa2ad98fd999a2faea/828fb/fastly-cohort.jpg 630w,
/static/0edf37793ac8fcfa2ad98fd999a2faea/45a30/fastly-cohort.jpg 912w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;なお、 Form 10-K によると&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Our 10 largest customers generated an aggregate of 38% and 29% of our revenue in the trailing 12 months ended December 31, 2020 and 2019, respectively.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;とのことなので、 Fastly の売上の4割近くは上位10社から生じているらしい。FY2019 - FY2020 でこの上位10社の売上割合が10ポイント近く増えているのは気になるところだ。&lt;/p&gt;
&lt;h3 id=&quot;地域別の売上&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%9C%B0%E5%9F%9F%E5%88%A5%E3%81%AE%E5%A3%B2%E4%B8%8A&quot; aria-label=&quot;地域別の売上 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;地域別の売上&lt;/h3&gt;
&lt;p&gt;地域別の売上を見ると United States が圧倒的に大きいが、ここ2年で Asia Pacific も大きく成長している。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/21c19f5be069f177df29116232433f7e/7762d/fastly-revenue-by-location.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 62.0253164556962%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACT0lEQVQoz22T30sUURTHB3qO/pOk6Jfaq7L9CxX0UPQiPlRgCbkraZm1ICpCYSToWptSUVu0lm8husUiWQYrptgmaW7bzN75tXPPnW/MmR3cwgtn7uUzd77ne8+ZqwGAUgqkKFhixzFQLJdA1jacygZM04G7WYRhGLAsC8WShGHoqFo26ofv+zxrwcO2bQghGBIRJBEUSRAHgWRtJoInCfCB/PYGUis5TBQWkNtaR2RMi5Trs/D6v+zKJygVhMds6cs1TD/bh6mnGvKLbTVB71/BvcZe7wMi0wm4Zw/APb0fcuxyyEmGRw5qU6lUQieBC/I4iEI3q38KyHybxsvVKeQ23zPLP3iOR7F2TLa24cNwOnQoCZqu61ybmh3OruoiGOV8H1YGNBQGNBRftDAbnPVwuJfQ0EO49SbcKcmHViqVuJhR1fTfc1j+eIZj7Ws3s4W3n3Hzwhh6zz/Ek+FZZiNZG80JA41dBpIZZ1cwcBh02TRNhsv5RSSvdiLZ0YnUyD1m4/MKDT0+Dt4A2tM+Jx/KumhMCByPC9xhQT8UZGUp4bgeH/L1J+BQIoxzo2ELHs+5OJkw0BzX0TEZJh6ecdHULXAiLnD3VZ1g1MWolzNLHpoSOsfFUcFscs7DsS6Bo10CV1Lh8QazVWZHrgv0Z1xmpLArWPUkAA/vllyc6heI9QtcmrAC/5iadxC7LdDaJxCftpndnw1ZS5/AUNbmbz1Z92NHN8KuKvzYcbC2aaBsKr4tpqvw/ZeN9Z8CuuXzLRKOwsaWyazi+LxPKR9/AeRTWuKxjF96AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;fastly-revenue-by-location&quot;
        title=&quot;fastly-revenue-by-location&quot;
        src=&quot;/static/21c19f5be069f177df29116232433f7e/f058b/fastly-revenue-by-location.png&quot;
        srcset=&quot;/static/21c19f5be069f177df29116232433f7e/c26ae/fastly-revenue-by-location.png 158w,
/static/21c19f5be069f177df29116232433f7e/6bdcf/fastly-revenue-by-location.png 315w,
/static/21c19f5be069f177df29116232433f7e/f058b/fastly-revenue-by-location.png 630w,
/static/21c19f5be069f177df29116232433f7e/7762d/fastly-revenue-by-location.png 649w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Asia Pacific から生じた売上は FY2018 で $7,194K だったのが FY2020 には $44,060K となり、2年間で6倍以上に成長している。&lt;a href=&quot;https://www.fastly.com/network-map/&quot;&gt;fastly の network map&lt;/a&gt; を見る限りでは Asia Pacific で現在稼働している POP は日本、オーストラリア、ニュージーランド、香港、シンガポール、インド、UAE の6カ国なので、その辺で需要が高まっているのかもしれない。&lt;/p&gt;
&lt;h3 id=&quot;enterprise-customers&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#enterprise-customers&quot; aria-label=&quot;enterprise customers permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Enterprise customers&lt;/h3&gt;
&lt;p&gt;Fastly の売上の大部分は、1年間で10万ドル以上を支払う顧客（同社は “Enterprise customers” と呼んでいる）から生じている。&lt;/p&gt;
&lt;p&gt;下記の表は Form 10-K 107ページより引用した。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/42e59b77fab6c4842398e594bc7151a5/ea7fb/fastly-enterprise.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 20.88607594936709%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAuElEQVQY022I62rCQBgF8/5v1b9FWtqgUqupScy3m809uruayk5poCChBwbOTOSsRWuNUmpGRM3+2H6/iKBEMMbgnMdai/ce7938/zxiuRAe5V/O48g4DGRZymazpmtb+r5jmiairO55SYQ4MxyHG+KhcIHCsSBQeMgvd7a653mXEp9qnt4+WEvLKhHSsiWqRsc2Lzk2Z5T9prqCuQaqBXO7gbZ39qrhdffFoeyIk5xPqXk/5JxMww/sey98m/6dewAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;fastly-enterprise&quot;
        title=&quot;fastly-enterprise&quot;
        src=&quot;/static/42e59b77fab6c4842398e594bc7151a5/f058b/fastly-enterprise.png&quot;
        srcset=&quot;/static/42e59b77fab6c4842398e594bc7151a5/c26ae/fastly-enterprise.png 158w,
/static/42e59b77fab6c4842398e594bc7151a5/6bdcf/fastly-enterprise.png 315w,
/static/42e59b77fab6c4842398e594bc7151a5/f058b/fastly-enterprise.png 630w,
/static/42e59b77fab6c4842398e594bc7151a5/ea7fb/fastly-enterprise.png 788w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Enterprise customer が売上に占める割合は徐々に上昇しており、 FY2020 で実に 88.2% に上る。企業向けのサービスとしてはかなり高い割合だと思う。分野は全く異なるが、&lt;a href=&quot;https://lyohe.github.io/post/2021-04-04-uipath-ipo/&quot;&gt;以前 UiPath について調べたとき&lt;/a&gt;は1年で10万ドル以上を払う顧客からの売上が全体に占める割合はおよそ 75% だった。&lt;/p&gt;
&lt;h3 id=&quot;コスト構造&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%82%B3%E3%82%B9%E3%83%88%E6%A7%8B%E9%80%A0&quot; aria-label=&quot;コスト構造 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;コスト構造&lt;/h3&gt;
&lt;p&gt;Fastly のコスト構造は以下の通り。これは FY2020 の数字だが、この3年間でそれぞれのコストの売上に対する割合はほぼ変わっていない。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/d09a2b9fe64e4396bc8264c9ddf35ba1/e9beb/fastly-cost.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 58.86075949367089%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAAB5klEQVQoz52Tz2oUQRDG9wl8BK8eBPERBG+iB0Hw4DssiKB7EvGg4EFPvkAunoSYg4oBifHgQQOJZtUYEsE/MbKzO9szPT3d039+0j27m6gRxYGaaqarvqrvq5qOlBIhBEoplKrIRxlGa/736RhjGAwGFEIgpObTrqCQNb4saMQY7xze+3+yEAKdiOp8i/5ozXLyRsWLrUB+7SJbF87iZJnuQrQQ/moJsCgrQDP/quHIJcHyh0B+tcvmuVPYQuCMxmnddts0f+x6BqiNjX2ysNJwrFfw/L2FcoAZDjE7X9k+f5rdOzd/0ioEf3CHcRilVIDhwYrl6OWS5Xc2JUUlvKoQC/ep19eo+q/ZuXWdenOjvbf2d8DRaDTR0DH/UnG8l/OsXwMNujbYSG+iYXZvjjeHD5EvPkzfYllrLc7a1jtHJ8/zCQePqCwfvzdIZfHeYa1rg41JwU0+Qm+8xUrJt7u3+dzrIocZj58ssrq62q5NfEXaerZ7aZ74X/WJou/T8MuVLttnTlANM54uLdFfX98DjNWjhcDEwoFLGyYBqYBSBFmm6TZNkyjPpjztMILGc/R1XadzXPzpnxSTiqJo47SmVCoxmeq3t9j79ioCRx+BppZlGWVZpsR4jl6MxwyzLOVOASPlH3RXkSs4ML+4AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;fastly-cost&quot;
        title=&quot;fastly-cost&quot;
        src=&quot;/static/d09a2b9fe64e4396bc8264c9ddf35ba1/f058b/fastly-cost.png&quot;
        srcset=&quot;/static/d09a2b9fe64e4396bc8264c9ddf35ba1/c26ae/fastly-cost.png 158w,
/static/d09a2b9fe64e4396bc8264c9ddf35ba1/6bdcf/fastly-cost.png 315w,
/static/d09a2b9fe64e4396bc8264c9ddf35ba1/f058b/fastly-cost.png 630w,
/static/d09a2b9fe64e4396bc8264c9ddf35ba1/e9beb/fastly-cost.png 730w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;売上原価（Cost of revenue）には主に以下の費用が含まれている。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ネットワークプロバイダに帯域幅に応じて支払う利用料&lt;/li&gt;
&lt;li&gt;third-party のデータセンターに支払う利用料&lt;/li&gt;
&lt;li&gt;ネットワークの運用や構築、サポートの従業員給与&lt;/li&gt;
&lt;li&gt;ネットワーク機器の減価償却費&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Research &amp;#x26; development には同社の edge cloud platform の開発者の人件費が含まれている。&lt;/p&gt;
&lt;p&gt;Sales &amp;#x26; marketing には新規顧客の獲得や既存顧客の利用拡大を推進する営業チームの人件費やマーケティングの費用が含まれている。&lt;/p&gt;
&lt;p&gt;General &amp;#x26; administrative には主に Accounting、Finance、Legal、Human Resource、Administrative Support の従業員や役員の人件費が含まれている。&lt;/p&gt;
&lt;h3 id=&quot;akamai-との比較-1&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#akamai-%E3%81%A8%E3%81%AE%E6%AF%94%E8%BC%83-1&quot; aria-label=&quot;akamai との比較 1 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Akamai との比較&lt;/h3&gt;
&lt;p&gt;FY2020 の損益を比較すると、売上にはおよそ11倍の差がある。 Akamai の売上は $3,198M なので、日本円だと3,500億円くらいある。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 599px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/1d3798c8819ded1c6fe85567423932ba/43142/pl-fastly-vs-akamai.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 62.0253164556962%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABr0lEQVQoz4WSS24TQRCG50zsWaAg1qwRh0GRwgm4CQeIskGwMDtiFBSRl3A8iT32vPpZ/aHq8cQ2jkRJNT0zqq766q8qUkrsWyJEuHkMmKbG3N1wP3+gq+e4+pLZfcl6vR4iD+5CoQ/nHIvFAmNMDopRMC4SQyAYg/eBGBzR94QQEFGXA9e7xVgpxpjP0ZV0n3uwKNC5hGjMTvzoT4TL5RK7IXyueggCCF9/ed596ijXMX9rN88SDq3IQcXRowyMp+eBl8cNs0ryt8g/hKvVKmunp7X2P4SJs3PP648ts2VQAbJUe4Q6DKVT39VRiYbqkj3EgfBs6jk6aZh3g6aS2CcsyzKTKaFquV2HIYFsLukqZcJp4Oik5fbiD9QPSOxJO1IVijqaEuqqGBv4PLFc3TbQVYh7xDmTWzz9YXl1vODL2/fMP7ygnbzB91XuQCQOQxktt+491nq+X3nm1yUy+420U7ytc8Gqcfy8M6wvLjHXE+ziG94Nu6pwxZiobducbNPzlnrTfEoc7Of4lnZ0LMZWNaH3fjvlBH3f0zT10z8djg5Kd29VVfRdS0r7U/4LFYOh+CglpP8AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;pl-fastly-vs-akamai&quot;
        title=&quot;pl-fastly-vs-akamai&quot;
        src=&quot;/static/1d3798c8819ded1c6fe85567423932ba/43142/pl-fastly-vs-akamai.png&quot;
        srcset=&quot;/static/1d3798c8819ded1c6fe85567423932ba/c26ae/pl-fastly-vs-akamai.png 158w,
/static/1d3798c8819ded1c6fe85567423932ba/6bdcf/pl-fastly-vs-akamai.png 315w,
/static/1d3798c8819ded1c6fe85567423932ba/43142/pl-fastly-vs-akamai.png 599w&quot;
        sizes=&quot;(max-width: 599px) 100vw, 599px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Akamai のコスト構造を見ると、 Fastly に比べて Research &amp;#x26; development の割合が小さいことが分かる。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/30497794ee657ab9b9bf1f4069f7aa69/cc8d6/akamai-cost.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 52.53164556962025%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABnElEQVQoz52TP2sUQRiH99PY2KiN3yF+iTQ2FjaCYKxsBAu1sbuvEEQLEfEEsTNBI3KGYLiwFne7uYTN7b/5P/vIzN4Ft1A4B4Yd3l2eed7fzCZFUVBVFW3bEtbL5ZIwuq7jf0ZSlmWEGGMRQiKlpPMO7xze+41mkEj+ZRPqm86kFQKjGtKF49FLxTQzlKPnFK93I9QbvZmh873dlxPLlXs1n48t2a2bpHdvD229D8pr9b9nWNUNOMm31HLjYc3+1NKMnnL+ahedzynfvcEp1XOCcczW9S2urAYtC6nipwep5dqDKgJjq4A5zVA/j9DZjF93tqk+fRjmu3oOWg4ni1cReH2nXgEd1ljWjTkpI8ycLTgbvSB/9ji+sxcF3tnBJok2oWA4SB1X79fsTV1v2K2yCtn9MeqP76nHb/FSoI6PYhw/Dg+ZzWZ9hn2+nu+pYuvJkq8nvXErJEqpeC+N1kgh0Eph4vZgjEE7j9aa8XjMZDJZA/sww8W+KBuU0jRNc/nnzOfzCM7zPNbOFwtO8ywC26aJ2QWoc/1B/QazRkiTAM6gKwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;akamai-cost&quot;
        title=&quot;akamai-cost&quot;
        src=&quot;/static/30497794ee657ab9b9bf1f4069f7aa69/f058b/akamai-cost.png&quot;
        srcset=&quot;/static/30497794ee657ab9b9bf1f4069f7aa69/c26ae/akamai-cost.png 158w,
/static/30497794ee657ab9b9bf1f4069f7aa69/6bdcf/akamai-cost.png 315w,
/static/30497794ee657ab9b9bf1f4069f7aa69/f058b/akamai-cost.png 630w,
/static/30497794ee657ab9b9bf1f4069f7aa69/cc8d6/akamai-cost.png 791w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;FY2020 の Revenue に対する Research &amp;#x26; development の割合は Faslty の 25.7% に対し Akamai は 8.4% だった。&lt;/p&gt;
&lt;h2 id=&quot;キャッシュフロー&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%82%AD%E3%83%A3%E3%83%83%E3%82%B7%E3%83%A5%E3%83%95%E3%83%AD%E3%83%BC&quot; aria-label=&quot;キャッシュフロー permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;キャッシュフロー&lt;/h2&gt;
&lt;p&gt;Fastly のキャッシュフロー計算書を4年分並べてみる。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 598px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/2184de35cfcdf77a6e9550cbf89f840c/0c69d/fastly-cf.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 62.0253164556962%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABjElEQVQoz42T646UQBCFef+3MfsAJhrXS/xhdLM6Eted2YG5wDQN0wzQdPGZboZ10Yxrke464XLqdNUhAmjbFqUUfd8jIs8uJw7nHAIM+w0qTTD1yVMR+W0YhvCiz/+znkapv7FaLagqMxJOZL5i+OBc4F8ksU7JmzLgfRZzv4zJsvy3wq7r0FrPjhyOJC5gX0WdKnQzqnid3HCnNwHnakeSrlmvE+q6JvJkfyqYwveoExvwh/yOL4dlwNe77zyYUVHVQ6Y0+902CIvyPD+rEWxrKbIH3qxv6TuIV595ny7Awqcfb3mVxkgnfPz5jsUhQfowlpmIR0LfPdc7rNqi6hO6BrX5SlE36LIju33BwTToqsXcX3FsDb0MvuGzXkdFUQTC50L8JdA7wWxegnRMDpkp/NuHo8eck3Me8TisgcFZ+u0VztbIaImZE6JLA7kUwyDIaQmDu6zQWkttzONwnubJnzMsBNUT2Uyh3/xRvYc8SdM0VFUVHvp7ZTka+Hg8hhX+jlJjjJmRTYS/AGoZqXgFecqJAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;fastly-cf&quot;
        title=&quot;fastly-cf&quot;
        src=&quot;/static/2184de35cfcdf77a6e9550cbf89f840c/0c69d/fastly-cf.png&quot;
        srcset=&quot;/static/2184de35cfcdf77a6e9550cbf89f840c/c26ae/fastly-cf.png 158w,
/static/2184de35cfcdf77a6e9550cbf89f840c/6bdcf/fastly-cf.png 315w,
/static/2184de35cfcdf77a6e9550cbf89f840c/0c69d/fastly-cf.png 598w&quot;
        sizes=&quot;(max-width: 598px) 100vw, 598px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;FY2017 - FY2018 には目立った動きは無い。上場以前は外部から資金を調達して開発や設備、販売活動に投資している。FY2019 に上場し市場から $192.5M を調達しているが、この年は有価証券を売ったり買ったりする程度で大きな投資は行っていない。&lt;/p&gt;
&lt;p&gt;FY2020 には大きな動きが見て取れる。この年はさらに市場から $274.9M を新たに調達し $759.4M で Signal Sciences 社を買収した（現金支出は $223.0M）。&lt;/p&gt;
&lt;p&gt;Signal Sciences の買収に多額の資金が使われている他には大きな動きはないが、営業キャッシュフロー上の加算&lt;sup id=&quot;fnref-2&quot;&gt;&lt;a href=&quot;#fn-2&quot; class=&quot;footnote-ref&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;項目として株式報酬（Stock-based compensation）が大きく増えているのが気になった。ここ3年で $4.0M → $12.1M → $64.4M と約16倍になっている。&lt;/p&gt;
&lt;h3 id=&quot;stock-based-compensation&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#stock-based-compensation&quot; aria-label=&quot;stock based compensation permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Stock-based compensation&lt;/h3&gt;
&lt;p&gt;一口に「株式報酬」と言っても様々な形態がある。よくあるのは下の2つだと思う。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;新株予約権 (SO)&lt;/li&gt;
&lt;li&gt;譲渡制限付株式ユニット Restricted Stock Unit (RSU)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;どちらの場合でも、従業員側のメリットとしては将来のキャピタルゲインが見込める（給与賞与より税率が低く、会社の成長次第で金額が大きくなる可能性がある）こと、会社側のメリットとしては現金の支出なく多額の報酬を支払えるので優秀な人材を雇うための材料になることがある。株式報酬の設計はどういうインセンティブを与えたいかや IPO のタイミングによって異なる。&lt;/p&gt;
&lt;p&gt;SO は基本的に無償で&lt;sup id=&quot;fnref-3&quot;&gt;&lt;a href=&quot;#fn-3&quot; class=&quot;footnote-ref&quot;&gt;3&lt;/a&gt;&lt;/sup&gt;付与され、行使期間の到来後に予め定められた行使価額&lt;sup id=&quot;fnref-4&quot;&gt;&lt;a href=&quot;#fn-4&quot; class=&quot;footnote-ref&quot;&gt;4&lt;/a&gt;&lt;/sup&gt;を支払って行使することで普通株式に転換でき、その売価と行使価額の差額がキャピタルゲインとなる。いろいろな事情から上場前の会社の株式報酬はこれが中心になっている。&lt;/p&gt;
&lt;p&gt;RSU は Unit と呼ばれる「一定の条件&lt;sup id=&quot;fnref-5&quot;&gt;&lt;a href=&quot;#fn-5&quot; class=&quot;footnote-ref&quot;&gt;5&lt;/a&gt;&lt;/sup&gt;を満たした場合にまとまった株式を受け取る権利」が付与され、対象者はその条件を満たしたとき株式を得ることができ、その売価と取得価額との差額がキャピタルゲインとなる。&lt;/p&gt;
&lt;p&gt;両者の最大の違いとしては、株式報酬を付与する会社側の費用負担がある。SO に関しては（設計以外には）会社が負担する費用は無いが、 RSU は Vest 時の株価 * 付与株式数が会社の費用となる。つまり、 RSU は「Vest 時の株価で支払われるボーナス」とみなすことができる（間違ってたらすみません）。もっとも現金で支払っている訳ではないので、財務諸表において会社の損失にはなるが現金は出ていかない。本当は RSA とか PSU とかいろいろあるけどキリが無いし本質的にはあまり変わらないので細かい違いは無視する。&lt;/p&gt;
&lt;p&gt;Fastly の損益計算書上の株式報酬が急増している背景には、上場前後で株式報酬の体系を切り替えたことがありそうだ。&lt;/p&gt;
&lt;h4 id=&quot;株式報酬の内訳&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%A0%AA%E5%BC%8F%E5%A0%B1%E9%85%AC%E3%81%AE%E5%86%85%E8%A8%B3&quot; aria-label=&quot;株式報酬の内訳 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;株式報酬の内訳&lt;/h4&gt;
&lt;p&gt;報酬の内訳を見ると、 General and administrative の割当が非常に大きい。役員の RSU がたくさん Vest したのかもしれない。下記の表は Form 10-K 130ページから引用した。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/42acd2335150946954d96f3f54fe8621/898f6/fastly-stock-based-compensation.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 28.48101265822785%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABDUlEQVQY03WKTW+CQBRF+f+/qqsuumkTG8VGUFBxEBg+ZgbsDMxpRNvooi85OTf3vuAkBOJOnudYa3HOPfHY2Yd+HMenv+sFTV2jtWboe3pjMFqjug6tFEp1M13bzp1Sas7XrW0aaimRskJWFcYYvPcE1o2Mk8eOE+7OBPh/uG6lrGd2acoyXM85L0r64ULwHh0IjwWbc0NcdERFx0E5xACn3nMa/M33nJmRfWeJK0NUaRbpmaS5kLTfFPpC8LLY8Lrasco79gOkPaQGEuNJZv/i/7zTE2+bw/z7mdWsS8OXHIhFRZAVkly21HrAOI92frZxPPiW+xGawbI9Cj6WIakoWUVb4qMg3KbsM8EPZ2jK07UQVS4AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;fastly-stock-based-compensation&quot;
        title=&quot;fastly-stock-based-compensation&quot;
        src=&quot;/static/42acd2335150946954d96f3f54fe8621/f058b/fastly-stock-based-compensation.png&quot;
        srcset=&quot;/static/42acd2335150946954d96f3f54fe8621/c26ae/fastly-stock-based-compensation.png 158w,
/static/42acd2335150946954d96f3f54fe8621/6bdcf/fastly-stock-based-compensation.png 315w,
/static/42acd2335150946954d96f3f54fe8621/f058b/fastly-stock-based-compensation.png 630w,
/static/42acd2335150946954d96f3f54fe8621/898f6/fastly-stock-based-compensation.png 798w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.signalsciences.com/about-us/news/fastly-to-acquire-signal-sciences/&quot;&gt;Signal Sciences 社の買収時の Fastly 側のプレスリリース&lt;/a&gt;によると、同社の従業員向けの RSU 保有プールが新たに 5,000 万ドル設定された、と書かれている。これは FY2020 には Vest されていないだろうし、今後も株式報酬は増えていきそうだ。&lt;/p&gt;
&lt;h3 id=&quot;akamai-との比較-2&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#akamai-%E3%81%A8%E3%81%AE%E6%AF%94%E8%BC%83-2&quot; aria-label=&quot;akamai との比較 2 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Akamai との比較&lt;/h3&gt;
&lt;p&gt;FY2020 で Fastly と Akamai のキャッシュフロー計算書を比較すると、営業 CF と投資 CF に大きな差があることが分かる。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 599px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/26efaac8f10d73e62c5b218ef1feb6a9/43142/cf-fastly-vs-akamai.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 61.39240506329114%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABpElEQVQoz3WSTYvUQBCG89s9+Qc8iKCC4EVPiq4gePIgCOLJZT9x1yFONB8zSWfSSbr6kepO5mOdbWhIuqufeqveSgDGcaQsS7quw3uPiBzdHrbfzgl4YbmCNCv5ky0ZhoFEgQpxzsVH3v+/NcY5+l83B+dBzOKS9PqCar0O/8mssKoqrLUHCp3EJOJBbEfx/PGeQodmytdn3C4uaJp2B1SIlqtgXaLZJwWzkk1ryV48w/upCpFwnmfn/Lw+I02X4S7RujVj0zShBxHgUXTRGUQi8OM3w+eHT6YkbIF/jSFfVcGDtm1J8jyP8oG+7+l7y6p2LNIfvDz9gOkGveHT95Yvj55S1FeUTU1nbRBwdyVFUWyBsT8DeQvm5hW2PmX04MYe1dOn7zj5+oBqiCYdMzFRMzTTvilacuiV+MmkMTg9Zu+R5dsp+bjt777ryaxMYbPSGLAL9BLNGn+/YUhfxxhx9wPV3bquQw+PD7YLJTtziWvOw7dMI3UUqMrUodnlec7mYd9u7afsYPcq1IfGmL2xgc1mE87mluiytqOqygMz7gL/AQqJp1a2u5swAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;cf-fastly-vs-akamai&quot;
        title=&quot;cf-fastly-vs-akamai&quot;
        src=&quot;/static/26efaac8f10d73e62c5b218ef1feb6a9/43142/cf-fastly-vs-akamai.png&quot;
        srcset=&quot;/static/26efaac8f10d73e62c5b218ef1feb6a9/c26ae/cf-fastly-vs-akamai.png 158w,
/static/26efaac8f10d73e62c5b218ef1feb6a9/6bdcf/cf-fastly-vs-akamai.png 315w,
/static/26efaac8f10d73e62c5b218ef1feb6a9/43142/cf-fastly-vs-akamai.png 599w&quot;
        sizes=&quot;(max-width: 599px) 100vw, 599px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Fastly と異なり Akamai はここ3年くらい大規模な買収を行っておらず、キャッシュフロー計算書を読んだ限りでは営業活動で稼いだお金で有価証券を買ったり売ったりしているだけなので、有望な投資先を見つけられていないのかもしれない。&lt;/p&gt;
&lt;p&gt;ちなみに Akamai の財務 CF がマイナスになっている理由は自社株買いによるもの。Akamai は Fastly と比べて財務基盤は盤石であるものの、将来の成長可能性に投資できているのか？という点では疑問が残る（Akamai の方からしたらうるせえよ！って思うかもしれませんが…）。&lt;/p&gt;
&lt;h2 id=&quot;edge-cloud-platform&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#edge-cloud-platform&quot; aria-label=&quot;edge cloud platform permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Edge Cloud Platform&lt;/h2&gt;
&lt;p&gt;実は Fastly 自身は自社のビジネスのことを &lt;code class=&quot;language-text&quot;&gt;CDN&lt;/code&gt; ではなく &lt;code class=&quot;language-text&quot;&gt;edge cloud platform&lt;/code&gt; と呼んでいる。一方で同じ CDN の事業を行っている Akamai も自社のビジネスを表現するのに &lt;code class=&quot;language-text&quot;&gt;CDN&lt;/code&gt; ではなく &lt;code class=&quot;language-text&quot;&gt;intelligent edge platform&lt;/code&gt; という名前を使っている。&lt;/p&gt;
&lt;p&gt;edge cloud とは（Fastly によると）一種の IaaS - Infrastructure as a Service であり、 content delivery network に加えて application delivery controller や web application firewalls、 bot 検知、 DDoS 攻撃対策など、従来ハードウェアを中心に提供されていた機能を IaaS として使うことを指すそうだ。エンドユーザーから地理的に近い場所に計算能力を移動させるので、時間的に素速く処理することが求められるデータを扱うのに適している。&lt;/p&gt;
&lt;p&gt;つまり CDN（あえてこう呼ぶ）を運営している会社は、本質的には「地理的に分散した品質の良いネットワークと計算資源を顧客が使いやすい要件（価格、効率性、可用性…）で提供する」サービスと考えることができる。CDN を利用する顧客の要求は多岐にわたるので、単純に資金力が大きい、拠点をたくさん作れる会社が勝つ事業とも言えない。実際、 Fastly の売上は YoY+40% の成長を続けているが、上場時点で総資産額は Akamai の 1/20 程度に過ぎなかった。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://lyohe.github.io/post/2021-02-06-google-cloud-comprehensive-loss/&quot;&gt;以前 AWS と GCP の話をブログに書いた&lt;/a&gt;が、まさにこれと同じで市場そのものが急速に拡大して多様なユースケースが生まれているので、ハードウェアとソフトウェアを組み合わせて拡大する市場により適したサービスを作った会社がより速く成長すると言えそう。&lt;/p&gt;
&lt;p&gt;単にデータセンターを建ててサーバーやネットワーク機器のリソースを貸すだけのサービスなら規模の経済で Fastly は Akamai でよくね？GCP は AWS でよくね？となるが、現実にはそういうことにはならなかった。それだけ現実世界ではエッジ側で高度な処理をしたいユースケースが多岐にわたるのかもしれない。そもそも単純な CDN においてすら、リクエスト-レスポンスのレイテンシーを減らしたいのかコンテンツのキャッシュヒット率を上げたいのかなど解決すべき要求は単純ではなさそうだし、レイテンシーを減らす…といってもアプローチはいろいろあるはずだ。&lt;/p&gt;
&lt;p&gt;Fastly と Akamai のエッジ戦略の違いについては Fastly の VP の方が書いているブログ ”&lt;a href=&quot;https://www.fastly.com/blog/why-having-more-pops-isnt-always-better&quot;&gt;Why having more POPs isn’t always better&lt;/a&gt;” が分かりやすく書かれていると思う。名前を出してはいないけど、この記事は Akamai を意識しているように見える。&lt;/p&gt;
&lt;p&gt;ちなみに、「&lt;a href=&quot;https://www.amazon.co.jp/dp/B00MIFE3BC&quot;&gt;アカマイ 知られざるインターネットの巨人&lt;/a&gt; という書籍によると、 Akamai は ISP の施設内に Akamai の設備を置かせてもらったり電力費用を負担してもらったり有利な扱いを受けているそうだ。ISP にとっては Akamai のおかげで負荷が減るのでお互いにメリットがある関係と言える。Akamai の創業ストーリーやビジネスの仕組みはとても面白いので気になる人は買って読んでみてほしい。個人的に DNS の名前解決の時点でアクセス元によって応答を動的に変更する仕組みは単純ながらよくできてるな〜！と感動した。&lt;/p&gt;
&lt;h2 id=&quot;最後に&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%9C%80%E5%BE%8C%E3%81%AB&quot; aria-label=&quot;最後に permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;最後に&lt;/h2&gt;
&lt;p&gt;Fastly は今後も面白そうな会社だった。&lt;/p&gt;
&lt;p&gt;自分自身は個別の株は買わない主義なので1株も持ってないけど、10年後にはより大きく伸びている会社だと考えている。これ書いてから思ったけど株持ってない人が言っても説得力ないな…投資は自己責任で！&lt;/p&gt;
&lt;p&gt;ちなみに東京にもオフィスがあって採用しているようなので、腕に覚えがある人は応募してみるといいかもしれない。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.fastly.com/about/careers/&quot;&gt;https://www.fastly.com/about/careers/&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;footnotes&quot;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&quot;fn-1&quot;&gt;なお、 Fastly は FY2020 にも Public Offering で市場から $274.9M を調達している&lt;a href=&quot;#fnref-1&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;li id=&quot;fn-2&quot;&gt;会社の費用として計上されているが実際には現金支出を伴わない項目、を意味すると考えてよい。&lt;a href=&quot;#fnref-2&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;li id=&quot;fn-3&quot;&gt;有償でも付与できるけど上場前の会社では見たことない&lt;a href=&quot;#fnref-3&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;li id=&quot;fn-4&quot;&gt;基本的には割当時の普通株式の時価&lt;a href=&quot;#fnref-4&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;li id=&quot;fn-5&quot;&gt;通常は一定の日までの勤務&lt;a href=&quot;#fnref-5&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content:encoded></item><item><title><![CDATA[プログラミングを初めて1年ちょっとで指摘されたこと、ミスしたこと]]></title><description><![CDATA[去年の4月頃からプログラマーとして働きはじめて1年と3ヶ月が経ち、202…]]></description><link>https://lyohe.github.io/2021-07-02-review-comment/</link><guid isPermaLink="false">https://lyohe.github.io/2021-07-02-review-comment/</guid><pubDate>Fri, 02 Jul 2021 00:12:09 GMT</pubDate><content:encoded>&lt;p&gt;去年の4月頃からプログラマーとして働きはじめて1年と3ヶ月が経ち、2021年も半分が終わった。今でも会社で経理や労務の仕事をしたりビールサーバーを洗ったりする仕事も続けているが、プログラムを書く時間は次第に増え楽しくなってきた。&lt;/p&gt;
&lt;p&gt;未経験で転職したこともあり自分が（趣味以外で）書いたコードのほぼ 100% が上司にレビューされているのだが、振り返るといろいろ初歩的なミスをやらかしてきたような気がする。&lt;/p&gt;
&lt;p&gt;せっかく時間を割いてもらっているので、印象に残ったコードレビューやプログラミング、仕事に取り組む姿勢に関する指摘を書き残しておくことにした。&lt;/p&gt;
&lt;p&gt;この記録がいつかどこかで誰かの役に立つと嬉しい。なお、この記事は私自分の認識に基づいているので、上司の知識や情報を完全に反映していない、もしくは誤った解釈をしている可能性がある。&lt;/p&gt;
&lt;h2 id=&quot;基本&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%9F%BA%E6%9C%AC&quot; aria-label=&quot;基本 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;基本&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;何をするにしても公式ドキュメントを読む&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;よくある落とし穴（例: &lt;a href=&quot;https://www.nginx.com/resources/wiki/start/topics/tutorials/config_pitfalls/&quot;&gt;Nginx&lt;/a&gt;）とかだいたい書いてある&lt;/li&gt;
&lt;li&gt;初学者が踏みそうな穴は既に誰かが踏んでいると考えてよい&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;タスクを分解し、変更を確実に動作する小さな単位で積み重ねていく&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;例えば React でフォームを作るなら…
&lt;ol&gt;
&lt;li&gt;クライアント
&lt;ul&gt;
&lt;li&gt;ボタンを押したときにモーダルが出るようにする&lt;/li&gt;
&lt;li&gt;モーダルが出たらフォームを表示してみる&lt;/li&gt;
&lt;li&gt;フォームを submit したら &lt;code class=&quot;language-text&quot;&gt;console.log&lt;/code&gt; するだけの Hook を作ってみる&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;サーバー
&lt;ul&gt;
&lt;li&gt;フォームの送付先のルーティングを追加し、 ok だけを返す API を作る&lt;/li&gt;
&lt;li&gt;↑ が動いていることを curl 等で確認&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;再びクライアント
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;console.log&lt;/code&gt; を↑で作った API に切り替える&lt;/li&gt;
&lt;li&gt;レスポンスが ok であることを確認する&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;↑ここまでできたら一通り動いたことになるので、フォームの要件に応じてビジネスロジックを作り込んでいく&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;gitgithub&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#gitgithub&quot; aria-label=&quot;gitgithub permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Git/GitHub&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;コミットや PR は小さな単位で行う&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;Diff が大きすぎるとレビューに大きな時間的・精神的コストがかかる&lt;/li&gt;
&lt;li&gt;指摘があったときに軌道修正しやすい&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;不要なコミットは &lt;code class=&quot;language-text&quot;&gt;squash&lt;/code&gt; でまとめてから出すべし&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;基本は所属する開発チームの流儀に従うのがいいらしい&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;コミットメッセージは命令形で書く&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;流派はいろいろあるので開発チームの流儀に従うのがいいらしい&lt;/li&gt;
&lt;li&gt;参考: Git は命令形でやっている &lt;a href=&quot;https://git.kernel.org/pub/scm/git/git.git/tree/Documentation/SubmittingPatches?id=HEAD&quot;&gt;https://git.kernel.org/pub/scm/git/git.git/tree/Documentation/SubmittingPatches?id=HEAD&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;原則的に履歴改変はしない&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;例えば &lt;code class=&quot;language-text&quot;&gt;rebase&lt;/code&gt; して履歴を書き換えると、その branch を他の人が触ってた場合 pull できなくなる&lt;/li&gt;
&lt;li&gt;改変はその branch を誰も触ってないという確信があるときのみやっても可
&lt;ul&gt;
&lt;li&gt;例えばまだ remote に &lt;code class=&quot;language-text&quot;&gt;push&lt;/code&gt; してないとき&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;OSS に PR を出すときはまず Fork して自分のアカウント配下で修正版を作り、 upstream に PR を出す&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;「Pull」を「Request」するから PR&lt;/li&gt;
&lt;li&gt;GitLab だと Merge Request と呼ばれている
&lt;ul&gt;
&lt;li&gt;ワークフローが GitHub と違い、同一リポジトリ内でブランチを作成するから（GitHub も同じリポジトリでブランチ作る場合はあるけど、それはまぁ気にしなくていいらしい）&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;上司の Git のワークフローの基本的な考え方は下記の記事に近いので読むようにと言われた。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://songmu.jp/riji/entry/2021-05-19-my-git-workflow.html&quot;&gt;https://songmu.jp/riji/entry/2021-05-19-my-git-workflow.html&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;セキュリティ&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3&quot; aria-label=&quot;セキュリティ permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;セキュリティ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;パスワードは何があろうと平文で保存してはいけない&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;入力を受け取ってからできるだけ早い段階で暗号化しなければならない&lt;/li&gt;
&lt;li&gt;世間的に実績のあるハッシュ関数を使って暗号化・ストレッチングする&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;SSH の port は well known port を避ける&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;本質的にはめちゃくちゃ有効な対策ではない（パスワードログイン禁止して強度の高い rsa 鍵をきちんと管理するとかの方がよほど重要だ）が、余計な口を開けておく必要はない
&lt;ul&gt;
&lt;li&gt;けど、 SSH はだいたい何でもできてしまうので特に気をつける&lt;/li&gt;
&lt;li&gt;他にも使わない port があったら積極的に閉じる&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;あえて自分の開発環境で脆弱性を作ってそれを攻撃してみる&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;気づかぬ内に脆弱性を作り込んでしまう可能性はいたるところにあるので、基本的な概念やどういう状態が危険かは理解しておく
&lt;ul&gt;
&lt;li&gt;たとえば SQL 組み立てるときにはプレースホルダを使うべき、とか&lt;/li&gt;
&lt;li&gt;ログインが必要なページでは CSRF トークンを作るべき、とか&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;一見ちゃんと動いているように見えて実は穴だらけ、というケースはよくある
&lt;ul&gt;
&lt;li&gt;脆弱性のあるバージョンの WordPress で動いているウェブサイトとか…&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;きちんと対策をするには HTTP/HTTPS の仕組みとかブラウザが何をするかとか基本的な知識が重要&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;命名&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%91%BD%E5%90%8D&quot; aria-label=&quot;命名 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;命名&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;プログラミング言語ごとの習慣やチームのやり方に合わせる&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;JavaScript であれば変数や関数の名は基本的に lowerCamelCase でクラス名は UpperCamelCase&lt;/li&gt;
&lt;li&gt;他の人が読んで感じる「この関数はこう動きそう、この変数にはこういうデータが入ってそう」という直感を裏切らないような名前にする
&lt;ul&gt;
&lt;li&gt;プロジェクト内で命名の法則に整合性がないと、読みづらいコードになってしまう&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;設計&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%A8%AD%E8%A8%88&quot; aria-label=&quot;設計 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;設計&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;利用者が UI 上で何らかの入力をしてデータを取得・変更するまでの流れを意識しながら、責務ごとに層を分割する&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;例えば…
&lt;ul&gt;
&lt;li&gt;認証や入力値のチェックを行う層&lt;/li&gt;
&lt;li&gt;実現したいビジネスロジックを書く層&lt;/li&gt;
&lt;li&gt;ビジネスロジックからデータを受け取ってデータベースに save する層&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;実装にあたっては層ごとに何を引数として受け取って何を解決するかの役割を常に意識する&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;設計の早い段階でレビューを受ける&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;例えば…
&lt;ul&gt;
&lt;li&gt;データベースや API のスキーマを作ったらレビューしてもらう&lt;/li&gt;
&lt;li&gt;ビジネスロジックやデータの操作をする関数をシグネチャだけ作ってレビューしてもらう&lt;/li&gt;
&lt;li&gt;こうしておけば、何か見落としや勘違いがあったとき早めに軌道修正できる&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;コーディング&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%82%B3%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0&quot; aria-label=&quot;コーディング permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;コーディング&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;エディタやシェル、ターミナル環境は自分で使いやすいようにカスタマイズする&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;使い込んでる人の様子を後ろから、もしくは画面共有してもらって眺める&lt;/li&gt;
&lt;li&gt;他人の設定ファイル（.vimrc とか .zshrc とか .tmux.conf のようにdot &lt;code class=&quot;language-text&quot;&gt;.&lt;/code&gt; で始まるので dot files と呼ばれる）を参考にして自分のをメンテナンスしていく&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;キーボードから手を離さずにあらゆる操作ができることを目指す&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;次の単語や特定の行にジャンプするとか、n行削除するとか&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;上司は Vim を使っていたので当初は Vim を使うことにした。Vim には &lt;code class=&quot;language-text&quot;&gt;vimtutor&lt;/code&gt; というターミナルから起動できる公式チュートリアルがあって、30分くらいで基本的な操作を学ぶことができる。&lt;/p&gt;
&lt;p&gt;いまは VSCode を Vim キーバインドで使っているが、コードを編集するスピードをどうやって上げるかを考えるとき「Vim を少しでも触っててよかった」と思うことが多い。Vim にしろ他のエディタにしろ無限に機能があるので、自分が使うところから学んでいくのがよさそう。&lt;/p&gt;
&lt;h2 id=&quot;デバッグ&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%83%87%E3%83%90%E3%83%83%E3%82%B0&quot; aria-label=&quot;デバッグ permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;デバッグ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;エラーで動かないときは Stack Trace から自分が書いた行を拾う&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ライブラリがバグってるより自分の書いたコードがバグってる可能性の方が高いので、まずは自分が書いた行を読む&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;開発中は変数に何が入っているかをコンソールに出しながら進めるとよい&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;JavaScript なら &lt;a href=&quot;https://www.npmjs.com/package/debug&quot;&gt;debug&lt;/a&gt; を使うとどこで出してるデバッグのログなのかがコンソール上できれいに色分けされて見られるので便利&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;テスト&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%83%86%E3%82%B9%E3%83%88&quot; aria-label=&quot;テスト permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;テスト&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;カバレッジを目的にしない&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;全ての行にテストを書く必要はないけど、テストを書いたほうが変更しやすいのは間違いないのでどんどん書きましょう&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ミスした箇所や複雑なビジネスロジックのテストを重点的に書く&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;css&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#css&quot; aria-label=&quot;css permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;CSS&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;画面のレイアウトには flexbox を使う&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://css-tricks.com/snippets/css/a-guide-to-flexbox/&quot;&gt;この記事&lt;/a&gt;が分かりやすい&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;とにかく練習あるのみ&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;Chrome Dev Tools で既存の Web サイトの CSS を書き換えたりすると楽しい&lt;/li&gt;
&lt;li&gt;デザインに自信が無い場合はルールだけ覚えておくとよい（xxとyyの間はzz以上開ける…とか）&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;javascripttypescriptその他一般的なプログラミングに関する指摘&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#javascripttypescript%E3%81%9D%E3%81%AE%E4%BB%96%E4%B8%80%E8%88%AC%E7%9A%84%E3%81%AA%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0%E3%81%AB%E9%96%A2%E3%81%99%E3%82%8B%E6%8C%87%E6%91%98&quot; aria-label=&quot;javascripttypescriptその他一般的なプログラミングに関する指摘 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;JavaScript/TypeScript、その他一般的なプログラミングに関する指摘&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;配列の繰り返し処理をするときは C 言語っぽい for 文ではなく map や filter 等の Array インスタンスに用意されたメソッドを使う&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;非同期処理を書くときは Promise そのままではなく async/await を使う&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;Promise 自体を理解しているという前提&lt;/li&gt;
&lt;li&gt;ほぼ async/await でいいけど、何でもかんでも async/await で書けばよいという訳ではない
&lt;ul&gt;
&lt;li&gt;複数の非同期処理を並列で実行したい場合は Promise.all を使うだろうし&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;繰り返し処理の中で SQL を発行するようなコードは N+1 Problem という典型的なアンチパターンなので避けるべき&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;例えば、あるオブジェクトの配列から id というフィールドを取り出してそれで SELECT するなら、オブジェクトの map で SQL を発行するのではなく、まず id を map で取り出してからそれをまとめて一つの文で SELECT するのがよい&lt;/li&gt;
&lt;li&gt;このケースに限らず、無駄に効率の悪い SQL 文を発行してないかは常に気にした方がよい&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;react&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#react&quot; aria-label=&quot;react permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;React&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;コンポーネントは原則的にクラスではなく関数で書く&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;つまり、引数 props を受け取って JSX を返す関数として実装する&lt;/li&gt;
&lt;li&gt;クラスが有効なケースは例外的・限定的（ほぼ無いと考えてよい）なので、それを理解できるまでは関数で書く&lt;/li&gt;
&lt;li&gt;バケツリレーしない（特定の範囲に閉じている）状態の管理は Hooks を使う
&lt;ul&gt;
&lt;li&gt;グローバルの状態管理には Context API や Redux 等のライブラリを使う&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;データは基本的にコンポーネントの階層関係における「上」から渡していく&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;Flux Architecture と呼ばれている体系的な考え方があるらしい
&lt;ul&gt;
&lt;li&gt;以下のようにデータを管理して流れる方向を統一する
&lt;ul&gt;
&lt;li&gt;何かしらのユーザーの行動（ボタンをクリックしたり）に応じて何らかの処理を行う&lt;/li&gt;
&lt;li&gt;それにより何かしらのデータが更新される&lt;/li&gt;
&lt;li&gt;更新されたデータに応じて画面の見た目を更新する&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;機能的にはこの方針に従わなくても実現は可能だが、 Flux Architecture に従うことで、どこで何をやってるかが分かりやすくなる&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;コンポーネントはその役割や責務に応じて適切なサイズに分割する&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;例えば…
&lt;ul&gt;
&lt;li&gt;同じ画面を構成するコンポーネントであっても、「ビジネスロジックを呼び出すコンポーネント」と「データを受け取って描画するコンポーネント」は分ける&lt;/li&gt;
&lt;li&gt;ちょっと古い記事だけど&lt;a href=&quot;https://medium.com/@dan_abramov/smart-and-dumb-components-7ca2f9a7c7d0&quot;&gt;この記事&lt;/a&gt;が分かりやすい&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;その他&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%81%9D%E3%81%AE%E4%BB%96&quot; aria-label=&quot;その他 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;その他&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;できるだけスペックの高いマシンを使う&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;例えば Docker for Mac はデフォルトで 2GB のメモリ（変更可）が割り当てられておりその範囲内で動くけど、メモリが足りなくてコンテナやサービスの起動に失敗するケースがあったりする&lt;/li&gt;
&lt;li&gt;アプリやコンテナをたくさん立ち上げても余裕で動くような高いスペックのマシンを求めましょう&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;いい資料&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%81%84%E3%81%84%E8%B3%87%E6%96%99&quot; aria-label=&quot;いい資料 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;いい資料&lt;/h2&gt;
&lt;p&gt;ここ1年半くらいで特に勉強になった本や資料を挙げておく。いいエンジニアの人はいい資料を知っているのでどんどん教えてほしい。&lt;/p&gt;
&lt;p&gt;まず MDN Web Docs。Web に関係することがだいたい何でも書いてある。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://developer.mozilla.org/ja/&quot;&gt;https://developer.mozilla.org/ja/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;転職当初、これは絶対に読めと言われた「ふつうのLinuxプログラミング」という本。強く勧められたので印象に残っている。 &lt;code class=&quot;language-text&quot;&gt;head&lt;/code&gt; とか &lt;code class=&quot;language-text&quot;&gt;grep&lt;/code&gt; のコマンドを作るのが楽しかった。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.amazon.co.jp/dp/4797386479/&quot;&gt;https://www.amazon.co.jp/dp/4797386479/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;IPA（情報処理推進機構）の「安全なウェブサイトの作り方」という資料。 XSS、CSRF、SQL インジェクション等の一般的な脆弱性の仕組みやそれを防ぐ方法が書かれている。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.ipa.go.jp/security/vuln/websecurity.html&quot;&gt;https://www.ipa.go.jp/security/vuln/websecurity.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;JavaScript の Promise が全く理解できなかったときに読んだ「Promise の本」という Web サイト。これが無かったら挫折していたかもしれない。&lt;a href=&quot;https://github.com/azu&quot;&gt;著者の azu さんという方&lt;/a&gt;に細々と毎月 GitHub Sponsor しています。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://azu.github.io/promises-book/#introduction&quot;&gt;https://azu.github.io/promises-book/#introduction&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;↑と同じ著者の方が書いている JavaScript Primer という Web サイトも素晴らしい。 JavaScript はアップデートが早いので、ググって出てきた情報が古いことがよくあり、初心者にとって信頼できる情報源はとても重要。これ無料でいいのか！？という気持ちが強い。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://jsprimer.net/&quot;&gt;https://jsprimer.net/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;React の公式ドキュメント。単に API の仕様だけでなく、 React がどのように動作するかの仕組み（例えばコンポーネントのライフサイクル等）が詳しく記述されている。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://reactjs.org/docs/getting-started.html&quot;&gt;https://reactjs.org/docs/getting-started.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Shopify の GraphQL Design Tutorial。 GraphQL のスキーマをどうやって作ればいいか全く分かってなかったので勉強になった。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/Shopify/graphql-design-tutorial/blob/master/TUTORIAL.md&quot;&gt;https://github.com/Shopify/graphql-design-tutorial/blob/master/TUTORIAL.md&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;最近みつけた「仕事ですぐに使えるTypeScript」という Web サイト。1日で一通り読める分量で、一般的な JavaScript 周りの環境構築（テスト、フォーマッター/リンター、CI、Docker イメージ作成、React/Vue/Electron などの環境）の情報がまとまっているのがよい。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://future-architect.github.io/typescript-guide/&quot;&gt;https://future-architect.github.io/typescript-guide/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;HTTP の進化をたどる「Real World HTTP」。Go で簡単なクライアント/サーバーを実装しながら HTTP/HTTPS の仕組みを一通り学べる。分厚い本なので、連休中などで一気に進めてどこに何が書いてあるかを把握してから辞書的に使うのがよさそう。&lt;a href=&quot;https://lyohe.github.io/post/2021-05-12-real-world-http2/&quot;&gt;感想を前回のブログで書いた&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.amazon.co.jp/dp/4873119030&quot;&gt;https://www.amazon.co.jp/dp/4873119030&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;印象に残ったミス&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%8D%B0%E8%B1%A1%E3%81%AB%E6%AE%8B%E3%81%A3%E3%81%9F%E3%83%9F%E3%82%B9&quot; aria-label=&quot;印象に残ったミス permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;印象に残ったミス&lt;/h2&gt;
&lt;p&gt;自分が開発中にやった恥ずかしいミスたちの例。これ以外にも無限にあるけど思い出したやつを書いた。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Array.prototype.find メソッドを使って配列から特定の条件を満たす要素だけを返す処理を実装していたときに比較（&lt;code class=&quot;language-text&quot;&gt;===&lt;/code&gt;）を代入（&lt;code class=&quot;language-text&quot;&gt;=&lt;/code&gt;）で書いてしまった
&lt;ul&gt;
&lt;li&gt;if や while であれば ESLint の &lt;a href=&quot;https://eslint.org/docs/rules/no-cond-assign&quot;&gt;no-cond-assign&lt;/a&gt; で気づける&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;練習用の Web サイトを .dev ドメインで作ったが HTTPS 専用であることを知らず、強制的に HTTPS にされるのをがんばって HTTP でアクセスできるようにしようとした（できなかった）&lt;/li&gt;
&lt;li&gt;Node.js の LTS （偶数バージョンの Long Term Support）の概念を理解しておらず、数字が大きいほど良いやつだと勘違いして LTS でない奇数バージョンを積極的に使っていた&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;終わりに&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%B5%82%E3%82%8F%E3%82%8A%E3%81%AB&quot; aria-label=&quot;終わりに permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;終わりに&lt;/h2&gt;
&lt;p&gt;何とかクビにならずにやっています。リモートワークで物理的に人間に会うのが2週間に1回くらいなので、もともと低い社会性が更に落ちてきました。&lt;/p&gt;
&lt;p&gt;これからもがんばります。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Real World HTTP（第2版）を読んだ話]]></title><description><![CDATA[5月の連休中に Real World HTTP（第2版）を通読したので、簡単に感想をメモしておく。 https://www.amazon.co.jp/dp/487311903…]]></description><link>https://lyohe.github.io/2021-05-12-real-world-http2/</link><guid isPermaLink="false">https://lyohe.github.io/2021-05-12-real-world-http2/</guid><pubDate>Wed, 12 May 2021 13:59:32 GMT</pubDate><content:encoded>&lt;p&gt;5月の連休中に Real World HTTP（第2版）を通読したので、簡単に感想をメモしておく。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.amazon.co.jp/dp/4873119030&quot;&gt;https://www.amazon.co.jp/dp/4873119030&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;なお、この本の要約版が無料で公開されているので、買う前にまずはこちらを読むのがいいかもしれない。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.oreilly.co.jp/books/9784873118789/&quot;&gt;https://www.oreilly.co.jp/books/9784873118789/&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;背景&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%83%8C%E6%99%AF&quot; aria-label=&quot;背景 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;背景&lt;/h2&gt;
&lt;p&gt;なぜこの本を読むことにしたかというと、自分自身がプログラミング初心者であり、仕事や趣味でプログラムを書いていて HTTP に関する知識が不足している（…というか、あらゆる点が全部不足してるんだけど）と感じることが多かったからだ。&lt;/p&gt;
&lt;p&gt;プログラミングしていると、言語の標準ライブラリやそれをラップしたパッケージ等で気軽に HTTP 通信を扱うことがよくある。そうすると自分で書くプログラムは少なくて済むのだが、実際にどういう仕組みで動いているのかが分からないので問題が起きたときにどこを調べればいいか分からなくなってしまう。あと単純にどう動いてるかの概要が自分で分かってないと気持ち悪い。&lt;/p&gt;
&lt;p&gt;インターネットを通じて何かを提供するためのプログラムを書いてお金をもらう仕事をしていく以上は HTTP の勉強を避けては通れないと思ったし、連休何もすることがなかったので、時間をかけて読んでみることにした。&lt;/p&gt;
&lt;h2 id=&quot;書籍の概要&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%9B%B8%E7%B1%8D%E3%81%AE%E6%A6%82%E8%A6%81&quot; aria-label=&quot;書籍の概要 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;書籍の概要&lt;/h2&gt;
&lt;p&gt;本書を一言で表すと「HTTP の歴史書」と言えると思う。&lt;/p&gt;
&lt;p&gt;1ページ目の「まえがき」にはこうある。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;本書では、変化が大きくない領域である、HTTP（Hypertext Transfer Protocol）というウェブの転送用のプロトコルにフォーカスして紹介します。CGIとウェブアプリケーションサーバー、または最近でてきたサーバーレスアーキテクチャなど、ウェブサービスの裏で実装に使われる言語や仕組みはここ20年で大きく移り変わりましたが、実際にブラウザとサーバーの通信に関わる部分のコンセプトは20年近く、あまり変わっていません。コンピュータ業界は、日進月歩で新しい技術などが出続けるため、学び続けないといけないとよく言われます。それは半分正しくて半分間違っています。コンピュータサイエンスにあたるような内容、業界標準のプロトコル、テストしやすく見通しの良いコードの書き方、アルゴリズム、データベースなどは、一度学んでも無駄になることはありません。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;HTTP は「送信側（クライアント）」と「受信側（サーバー）」の両方がルールに従ってメッセージをやり取りする仕組みであり、この基本は誕生以来変わっていない。しかし一方で、ウェブの発展に伴って主なクライアントであるブラウザに様々な機能が追加されたり、それが仕様として標準化されたりしてきた。&lt;/p&gt;
&lt;p&gt;最新の仕様を読むと巨大なプロトコルだが、歴史を辿っていくと最初は特定の課題を解決するためのシンプルなプロトタイプから始まり、それぞれの段階（HTTP/0.9 や 1.0、2など…）で状況に応じて現実のユースケースに対応するための改善がされていったという経緯があることが分かる。&lt;/p&gt;
&lt;p&gt;その経緯を実際に手元で試しながら体系的に学ぶことで、新しい技術であっても何からどのように発展しているのかを知ることができ理解の促進に繋がる。ここに歴史を学ぶ意義がある。&lt;/p&gt;
&lt;p&gt;原典といえる RFC への参照もあるので、気になった仕様をいくらでも深堀りできる。とても分厚い（約450ページ）本なので内容を全て覚えることは不可能だが、一度通読してどこに何が書いてあるか何となく把握できれば困ったことが起きる度に辞書的に引けて非常に便利になると思う。&lt;/p&gt;
&lt;p&gt;そのため、思い立ったらすぐにめくれる紙媒体で買うのをおすすめしたい。&lt;/p&gt;
&lt;h2 id=&quot;章ごとの大まかな構成と一言感想&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%AB%A0%E3%81%94%E3%81%A8%E3%81%AE%E5%A4%A7%E3%81%BE%E3%81%8B%E3%81%AA%E6%A7%8B%E6%88%90%E3%81%A8%E4%B8%80%E8%A8%80%E6%84%9F%E6%83%B3&quot; aria-label=&quot;章ごとの大まかな構成と一言感想 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;章ごとの大まかな構成と一言感想&lt;/h2&gt;
&lt;h3 id=&quot;第1章第2章&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%AC%AC1%E7%AB%A0%E7%AC%AC2%E7%AB%A0&quot; aria-label=&quot;第1章第2章 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;第1章〜第2章&lt;/h3&gt;
&lt;p&gt;HTTP の先祖といえる電子メールやニュースグループから始まり、メソッドとパス、ヘッダー、ボディ、ステータス等の HTTP の基本概念やコンテントネゴシエーション、クッキー、セッション、キャッシュなどブラウザの裏側を支える仕組みを説明する。&lt;/p&gt;
&lt;p&gt;今まで「何となくこういうものかな」と考えていた技術が体系的に整理されており、それぞれの関係性や複数の技術や機能の組み合わせでどのようなユースケースが実現されているかが分かりやすく解説されていて面白かった。&lt;/p&gt;
&lt;h3 id=&quot;第3章&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%AC%AC3%E7%AB%A0&quot; aria-label=&quot;第3章 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;第3章&lt;/h3&gt;
&lt;p&gt;第1章〜第2章の内容を簡単におさらいしながらそれを実現する HTTP クライアントを Go 言語で実装する。&lt;/p&gt;
&lt;p&gt;私はここで初めて Go 言語に触れたのだが、文法がシンプルで読みやすくて驚いた。仕事で使うレベルにするには修行が必要だろうが、読んで何をしているか把握するだけなら C や JavaScript 、または似たような言語を書いたことがあれば困らないと思う。&lt;/p&gt;
&lt;h3 id=&quot;第4章第5章&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%AC%AC4%E7%AB%A0%E7%AC%AC5%E7%AB%A0&quot; aria-label=&quot;第4章第5章 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;第4章〜第5章&lt;/h3&gt;
&lt;p&gt;主に HTTP/1.1 時代の新機能を紹介する。&lt;/p&gt;
&lt;p&gt;Keep-Alive の仕組みや TLS の仕組み（鍵交換や通信手順によって何を守るか）、追加されたメソッド（CONNECT など）、さらには HTTP/1.1 時代に用途として追加されたファイルのダウンロード、XMLHttpRequest、ウェブサイト間の共通認証認可プラットフォーム（SAML や OAuth、OpenID など）がどのように実現されているかを解説する。&lt;/p&gt;
&lt;p&gt;個人的に面白かったのが XMLHttpRequest の名前の由来だった。以前から変な名前だなぁとは思っていた（XML 要素はどこに？）。&lt;/p&gt;
&lt;p&gt;実はこれは元々 Exchange 2000 のメールサーバーにブラウザからアクセスする機能を実現するために Internet Explorer 5 のβ版に搭載されたのだが、開発中に問題がたくさん起きたことで Microsoft 社内のリリースの期限に間に合いそうになかったので、どうしても出したかった開発者の Alex さんは同僚が作っていた XML 処理ライブラリに無理やり混ぜ込んで出荷することにした（そのため XML とほぼ関係ない機能なのに言い訳として XML という名前をつけた）とのことだった。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://web.archive.org/web/20160304055328/http://www.alexhopmann.com/xmlhttp.htm&quot;&gt;Web Archive で読める Alex さんのブログ&lt;/a&gt;の言葉を借りれば&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;doesn’t have any specific tie to XML other than that was the easiest excuse for shipping it&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Microsoft みたいな大企業でそんなことやっていいのか？とも思うが、結果としてはこの行動によって Exchange 2000 のリリース前にそれにウェブから接続できるクライアント、つまり XMLHttpRequest を使えるブラウザ）が普及しきっている状態を作れた。ビジネス的には成功だったと言えそうだ。&lt;/p&gt;
&lt;h3 id=&quot;第6章&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%AC%AC6%E7%AB%A0&quot; aria-label=&quot;第6章 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;第6章&lt;/h3&gt;
&lt;p&gt;第4章〜第5章で登場した機能を備えた HTTP/1.1 のクライアントを Go 言語で実装する。&lt;/p&gt;
&lt;p&gt;基本的には標準ライブラリを通じて TLS 通信をするための簡単なクライアントとサーバーを作るのだが、証明書の作り方から説明されていて初心者にも優しかった。&lt;/p&gt;
&lt;h3 id=&quot;第7章第8章&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%AC%AC7%E7%AB%A0%E7%AC%AC8%E7%AB%A0&quot; aria-label=&quot;第7章第8章 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;第7章〜第8章&lt;/h3&gt;
&lt;p&gt;HTTP/2 や HTTP/3 時代におけるプロトコルの再定義や新しく登場したユースケースを紹介する。SPDY や QUIC（これは厳密には HTTP ではないが）の仕組みについても解説されている。&lt;/p&gt;
&lt;p&gt;この時代の新たなユースケースとしてはセマンティックウェブ、モバイルの DeepLink、HTTPライブストリーミングによる動画再生などがある。&lt;/p&gt;
&lt;p&gt;個人的には WebRTC （Real-Time Communication）が興味深かった。HTTP は基本的にブラウザとサーバーの間の通信だが、 WebRTC はブラウザ同士の P2P 通信（例えば1対1もしくは複数人でのシンプルなビデオ通話システムやスクリーンの共有）にも使うことができるし1対多のリアルタイム映像配信にも使える。トランスポート層には通常の HTTP 通信と同様に TCP を使うこともできるが、通常は UDP を使う。このプロトコルはヘッダサイズが少なく TCP と比べて信頼性が低い代わりに転送速度が速い。&lt;/p&gt;
&lt;p&gt;HTTP の上でリアルタイム配信を行う HLS（HTTP Live Streaming）では（ストリーミングという名前がついているものの）実際にはチャンクごとにダウンロードが完了しないと再生が始められないため、どうしても30秒程度の遅延が発生してしまう。また、 HLS はサポートされている環境が少ないというデメリットもある。&lt;/p&gt;
&lt;h3 id=&quot;第9章&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%AC%AC9%E7%AB%A0&quot; aria-label=&quot;第9章 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;第9章&lt;/h3&gt;
&lt;p&gt;第7章〜第8章で登場した HTTP/2 のいくつかの実装を Go 言語で行う。&lt;/p&gt;
&lt;p&gt;WebSocket を使って簡単なリアルタイム通信のチャットルームを作ったりする。&lt;/p&gt;
&lt;h3 id=&quot;第10章第13章&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%AC%AC10%E7%AB%A0%E7%AC%AC13%E7%AB%A0&quot; aria-label=&quot;第10章第13章 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;第10章〜第13章&lt;/h3&gt;
&lt;p&gt;REST API の考え方や現実世界での実装例、利用方法、JavaScript の XMLHttpRequest や FetchAPI をつかった動的な HTTP アクセス、ウェブアプリケーションの基本的なリクエスト-レスポンスのフローやインフラ構成等をかんたんに紹介している。&lt;/p&gt;
&lt;p&gt;個人的に興味を惹かれたのは CDN 関連の記述だった。CDN はユーザーから物理的に近くに位置する高機能なプロキシサーバーで、 Akamai やら CloudFront やら Fastly やら様々な製品が存在する。コンテンツをキャッシュしてレスポンスを高速化することもできるが、キャッシュをしなくてもインターネット上でクライアントからサーバーへのホップ数を削減する効果がある。&lt;/p&gt;
&lt;p&gt;どちらの使い方であってもサーバーの負荷軽減やユーザー体験の向上に大きな役割を果たすので非常に有用ではあるものの、ユーザーごとに同じ URL で異なる内容を見せなければならないケース（例えば会員制サイトのマイページとか）では Cache-Control ヘッダで適切なディレクティブが設定されていないと同じ URL を開いた別のユーザーが前のユーザーの画面を見ることになってしまうケースがあるので注意しなければならない。&lt;/p&gt;
&lt;p&gt;本書では事例としてメルカリのインシデントが紹介されていた。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://engineering.mercari.com/blog/entry/2017-06-22-204500/&quot;&gt;https://engineering.mercari.com/blog/entry/2017-06-22-204500/&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;第14章&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%AC%AC14%E7%AB%A0&quot; aria-label=&quot;第14章 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;第14章&lt;/h3&gt;
&lt;p&gt;最後の1章はまるまるセキュリティに割かれている。 XSS や中間者攻撃、セッションハイジャック、 CSRF 、リスト型アカウントハッキング等さまざまな攻撃手法を紹介しつつ、ブラウザや HTTP の機能を使ってそれらをどう防ぐかが解説されている。実装例というよりは、このような仕組みが用意されているからこういう考え方でセキュリティ対策をしようという説明が並んでいた。&lt;/p&gt;
&lt;p&gt;同じような内容は IPA （ビールじゃない方）の「安全なウェブサイトの作り方」という無料の PDF にも書かれていたので、どちらも読むと理解が深まっていいかもしれない。このようなセキュリティ対策はやらかすと一発アウトなので何回読んでもいい。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.ipa.go.jp/security/vuln/websecurity.html&quot;&gt;https://www.ipa.go.jp/security/vuln/websecurity.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;この章で興味深かった仕組みとして、古のセッション管理とセッション固定化攻撃の話があった。私はその昔携帯電話向けにゲームを作る会社で働いていたことがあって、その頃は素人なりに URL にセッションID出てるの大丈夫なのだろうかと思っていたが、どうやらフィーチャーフォンでは Cokkie が使えない機種があったからそうせざるを得なかったらしい。&lt;/p&gt;
&lt;h2 id=&quot;まとめ&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%81%BE%E3%81%A8%E3%82%81&quot; aria-label=&quot;まとめ permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;まとめ&lt;/h2&gt;
&lt;p&gt;自分の感想を書いたが、なにぶん私自身が初心者なのでこの本の魅力を紹介しきれていない気がする。&lt;/p&gt;
&lt;p&gt;この本の最大の長所は HTTP の歴史を体系的に一冊にまとめたことにあると思っている。今は既に使われていない技術がなぜ生まれなぜ消えたか、という記述も豊富で、各技術や仕様の歴史の中での位置づけを確認しながら読めるので理解が進みやすい。&lt;/p&gt;
&lt;p&gt;初心者は体系的に整理された HTTP の知識を一冊で得られるので、プログラミングを始めたけどウェブの仕組みがよく分かってない、という人には特におすすめしたい。自分がまさにそうだったように。&lt;/p&gt;
&lt;p&gt;幸い冒頭で挙げたようにミニ版（本書の要約）が無料で公開されているので、気になる方はぜひダウンロードしてみてください。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.oreilly.co.jp/books/9784873118789/&quot;&gt;https://www.oreilly.co.jp/books/9784873118789/&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[UiPath が上場するので Form S-1 をさらっと読む]]></title><description><![CDATA[有名な RPA のユニコーン である UiPath が上場するらしい。 未上場で企業価値10億ドル以上の企業 https://jp.techcrunch.com/2021/03/29/2021-03-26-a-first-look-at-uipaths-ipo-filing…]]></description><link>https://lyohe.github.io/2021-04-04-uipath-ipo/</link><guid isPermaLink="false">https://lyohe.github.io/2021-04-04-uipath-ipo/</guid><pubDate>Sun, 04 Apr 2021 04:02:58 GMT</pubDate><content:encoded>&lt;p&gt;有名な RPA のユニコーン&lt;sup id=&quot;fnref-1&quot;&gt;&lt;a href=&quot;#fn-1&quot; class=&quot;footnote-ref&quot;&gt;1&lt;/a&gt;&lt;/sup&gt; である UiPath が上場するらしい。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://jp.techcrunch.com/2021/03/29/2021-03-26-a-first-look-at-uipaths-ipo-filing/&quot;&gt;https://jp.techcrunch.com/2021/03/29/2021-03-26-a-first-look-at-uipaths-ipo-filing/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;自分は UiPath を使ったことがない（Zapier はよく使う）のだが、せっかくなので Form S-1 を軽く読んでみた。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.sec.gov/Archives/edgar/data/1734722/000119312521094920/d98556ds1.htm&quot;&gt;https://www.sec.gov/Archives/edgar/data/1734722/000119312521094920/d98556ds1.htm&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;主要な指標&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%B8%BB%E8%A6%81%E3%81%AA%E6%8C%87%E6%A8%99&quot; aria-label=&quot;主要な指標 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;主要な指標&lt;/h2&gt;
&lt;p&gt;2021年1月期の主要な指標は以下の通り。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/ebc2e9f8aca540dee2017dc5a7b0daae/715a3/uipath-kpi.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 88.60759493670886%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC6UlEQVQ4y21UaU8TURTtr1EQAW1BhLLKVmRpWdqylULoQpoWQ6CQIKBCRAiLcUFU0BiiQQyamBgl8d905k33lha/H/PuTIdp9cPNe+276znnjo6N14FNtUCa7oQUuEvGPHcgjlZDsFyHaNVD6L8BceCmeoqDt8iEvvJ/3nRCbxmYw4js9w84P9pF+t0mMp9f4fzoKS5+fEJiaw6hriIKYGN1yJzsI/V6Dem364g99EC0V14WooT8h81ATsntIJI780jtryKxE0T6cAOx++MQuovlhMPVSD5fQvyxH5GZAcTXfJAmmyFYSgsS8pZ7SyGYS8ActZAmW+ge6rqqOst+ekiedoS9JkjuNjBnAzWT16E4UgXmbQZz1soPVgNEW4XsYNWrydQgewWNST78HNDnJ2TuJkiBDki+NqomUlL9pRUm1JKjMZUUceQ2scycRmKVj06jctzMJXnJOIGqT3eR/K6BhJuOd8SdOCactci9PqReriCxPYfYAzeNRAGWUkiuFnqPzg8jubuAxJNpRGftVOgSQ4UQaaIRsaUJJDZncPHrBNmvh8S8OFQlV+dFPe1IvVhGYjuIzOkBMsd7iK9OyXpVCuvU+a0GhKc6EPb3QHK10p0zzsWr4sQLe9oRCVjIh9/ZSA2E/vL/yEYRLndgznq6a7ckhyGXVGTWhmhwCJK7VelOi6GGIQKdr1NfmWyaYmpiYl6vYTh/NXWFQWRK4kJJ0P98AXhRfuYa0BTMw5Cq2wzyyKNGwiaHDw/kO8/GG4gogsdhhOQzyR8TZWNUlmnxj/eQ+fIG6YN1Mi4jSmgzINR5BYmtWVycnZBf9tt7/Pl9iuzPj5D8JoiOGiqq044bXRhFbHkSsRUXwn4zYotOeXu4j7mEPgjJZ4ukP67T+CMv4hsBMFcjRLumQ5VlR50sHW8HSYKLWSsJ2pKea5AmmsDG6gnDUHexCkleh7wTvi1hX6eS1EQw5MjJY1nBOoc7vQ1WQhyrwV9EUo30j6yukQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;uipath-kpi&quot;
        title=&quot;uipath-kpi&quot;
        src=&quot;/static/ebc2e9f8aca540dee2017dc5a7b0daae/f058b/uipath-kpi.png&quot;
        srcset=&quot;/static/ebc2e9f8aca540dee2017dc5a7b0daae/c26ae/uipath-kpi.png 158w,
/static/ebc2e9f8aca540dee2017dc5a7b0daae/6bdcf/uipath-kpi.png 315w,
/static/ebc2e9f8aca540dee2017dc5a7b0daae/f058b/uipath-kpi.png 630w,
/static/ebc2e9f8aca540dee2017dc5a7b0daae/715a3/uipath-kpi.png 830w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;ARR （Annualized Renewal Run-Rate または Annual Reccurring Revenue の略）は毎年繰り越される収益のことで、一般的には以下を意味する。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;ARR = 前年の収益 + 新規契約やアップグレードで得る収益 - 解約やダウングレードで失う収益&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;新規顧客を獲得しつつ既存顧客との関係を維持・拡大する能力を示す指標なので、収益の積み上げが重要になる SaaS 企業の開示でよく使われる。&lt;/p&gt;
&lt;p&gt;UiPath における ARR の定義は Form S-1 の 75 ページに書いてある（実は同じ ARR という用語を使っていても各社定義が異なるので単純比較は難しい）。クソ長いので一部だけ引用すると&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;We define ARR as annualized invoiced amounts per solution sku from subscription licenses and maintenance obligations assuming no increases or reductions in their subscriptions. ARR does not include the costs we may incur to obtain such subscription licenses or provide such maintenance, and does not reflect any actual or anticipated reductions in invoiced value due to contract non-renewals or service cancellations other than for specific bad debt or disputed amounts.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;とのことなので、 UiPath のライセンスと保守契約による売上を含み、将来の解約予定を含まないようだ。&lt;/p&gt;
&lt;h3 id=&quot;customers--100k-arr&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#customers--100k-arr&quot; aria-label=&quot;customers  100k arr permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Customers &gt;= $100k ARR&lt;/h3&gt;
&lt;p&gt;UiPath を見てまず最初に気になったのは、 &lt;code class=&quot;language-text&quot;&gt;Customers &gt;= $100k ARR&lt;/code&gt; つまり年間 10 万ドル以上を支払う顧客が 1,002 社いて全体の約 13 % を占めていることだった。米国で上場している企業向けソフトウェア開発企業はこの指標をよく出している。&lt;/p&gt;
&lt;p&gt;開示する理由は会社によるだろうが、この指標が安定して成長することは&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;大きな企業の課題を解決できている&lt;/li&gt;
&lt;li&gt;Paid Customer が成長に従って他のサービスに乗り換えない&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ことを意味している。&lt;/p&gt;
&lt;p&gt;昔 Slack が上場したときに同じ指標を出していた（&lt;a href=&quot;https://lyohe.medium.com/slack-%E3%81%8C%E4%B8%8A%E5%A0%B4%E3%81%99%E3%82%8B%E3%81%AE%E3%81%A7%E7%9B%AE%E8%AB%96%E8%A6%8B%E6%9B%B8%E3%82%92%E8%AA%AD%E3%82%80-34cf76cd7375&quot;&gt;昔書いたブログ&lt;/a&gt;）のだが、 Slack は2019年1月期で Paid Customer 88,000 に対し $100k/year 以上の支払いを行う顧客は 575 で、これは全体の 1% にも満たない。この指標は企業間で比較するというよりは「同じ会社の」時系列で比較して評価する（安定して伸びていれば OK）のが正しい使い方だと思うが、この 13% という数字はかなり高いのではないか。&lt;/p&gt;
&lt;p&gt;実際に、 UiPath は大企業から多くの収益を得ている。 78 ページを読むと、&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;For example, as of January 31, 2019, we had 305 customers with ARR of $100,000 or more and 21 customers with ARR of $1.0 million or more, which accounted for 69% and 27% of our revenue, respectively, for the fiscal year then ended. As of January 31, 2020, we had 597 customers with ARR of $100,000 or more and 43 customers with ARR of $1.0 million or more, which accounted for 69% and 25% of our revenue, respectively, for the fiscal year then ended. As of January 31, 2021, we had 1,002 customers with ARR of $100,000 or more and 89 customers with ARR of $1.0 million or more, which accounted for 75% and 35% of our revenue, respectively, for the fiscal year then ended.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;とのことなので、2020年1月期は売上の 69%、2021年1月期は実に 75% が $100k 以上の ARR の顧客から生じている。なお、 78 ページの記載によれば Fortune 10 の 80％ と Fortune Global 500 の 63％ が UiPath の顧客であるとのことだ。&lt;/p&gt;
&lt;h3 id=&quot;dollar-based-net-retention-rate&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#dollar-based-net-retention-rate&quot; aria-label=&quot;dollar based net retention rate permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Dollar-based Net Retention Rate&lt;/h3&gt;
&lt;p&gt;これは新規契約を含まない、既存顧客のみからの売上の伸びを示す指標としてよく使われる。 78 ページを読むと、&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Further evidence of our land-and-expand business model is our dollar-based net retention rate, which was 153% and 145% as of January 31, 2020 and 2021, respectively. We calculate dollar-based net retention rate as of a period end by starting with the ARR from the cohort of all customers as of 12 months prior to such period-end, or the Prior Period ARR. We then calculate the ARR from these same customers as of the current period-end, or the Current Period ARR. Current Period ARR includes any expansion and is net of contraction or attrition over the last 12 months, but does not include ARR from new customers in the current period. We then divide the total Current Period ARR by the total Prior Period ARR to arrive at the point-in-time dollar-based net retention rate.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;とのことなので、既存顧客からの売上が FY2019 → 2020 と FY2020 → 2021 でそれぞれ約 1.5 倍ずつ増えていることが分かる。&lt;/p&gt;
&lt;p&gt;また、同じページによると解約によらない ARR の割合が 96 ~ 97% とのことなので、ほとんど全ての顧客は満足して UiPath を使っているようだ。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Furthermore, our dollar-based gross retention rate, which is the percentage of ARR from all subscription customers as of the year prior that is not lost to customer churn, was 96% and 97% as of January 31, 2020 and 2021, respectively. We calculate our dollar-based gross retention rate as of a period end by starting with the ARR from the cohort of all subscription customers as of 12 months prior to such period-end, or the Prior Period ARR. We then deduct from the Prior Period ARR any ARR from subscription customers who are no longer customers as of the current period end, or the Current Period Remaining ARR. We then divide the total Current Period Remaining ARR by the total Prior Period ARR to arrive at the point-in-time dollar-based gross retention rate. Because our dollar-based gross retention rate reflects only customer losses and does not reflect customer expansion or contraction, it demonstrates that the vast majority of our customers continue to use our platform and renew their licensed software.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;既存顧客からの売上の伸び&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%97%A2%E5%AD%98%E9%A1%A7%E5%AE%A2%E3%81%8B%E3%82%89%E3%81%AE%E5%A3%B2%E4%B8%8A%E3%81%AE%E4%BC%B8%E3%81%B3&quot; aria-label=&quot;既存顧客からの売上の伸び permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;既存顧客からの売上の伸び&lt;/h3&gt;
&lt;p&gt;UiPath は初回導入後、サポートを通じて顧客の engagement を高めることで収益を伸ばしている。 77 ページの記載によると&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;For example, the 2016 cohort includes all customers that had their initial purchase within the fiscal year 2016. This cohort increased their ARR from $395,368 as of January 31, 2016 to $22.7 million as of January 31, 2021, representing a multiple of approximately 57x since fiscal year 2016.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;とのことで、2016年1月期に使い始めた顧客の ARR は5年後の2021年1月期には約57倍となっている。&lt;/p&gt;
&lt;p&gt;また、2021年1月期の売上上位50社からの売上は（その顧客の初月時点での契約から計算した仮想的な ARR と比べて）中央値で約 81 倍に伸びているそうだ。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 605px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/cc0ff5abf7137bc8bd7e93645d6cd977/3cb18/uipath-cohort.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 43.67088607594937%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAJABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMFAf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAG2p2E0qkv/xAAYEAADAQEAAAAAAAAAAAAAAAAAAQMCEP/aAAgBAQABBQI1VZHWjb7/AP/EABYRAQEBAAAAAAAAAAAAAAAAAAAiUf/aAAgBAwEBPwFOP//EABURAQEAAAAAAAAAAAAAAAAAAAAh/9oACAECAQE/AVf/xAAZEAABBQAAAAAAAAAAAAAAAAAAASBBUYH/2gAIAQEABj8CLITWf//EABoQAAMBAAMAAAAAAAAAAAAAAAABETEQUWH/2gAIAQEAAT8hdumVX6RcJ+Awhcf/2gAMAwEAAgADAAAAEPcv/8QAGREAAQUAAAAAAAAAAAAAAAAAAAERIUHx/9oACAEDAQE/EIsfRT//xAAYEQACAwAAAAAAAAAAAAAAAAAAIUGBkf/aAAgBAgEBPxBwUw//xAAcEAEAAgIDAQAAAAAAAAAAAAABAHEhQRARMYH/2gAIAQEAAT8QxUAXO+CGn6uIoB60cT0VHVT/2Q==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;uipath-cohort&quot;
        title=&quot;uipath-cohort&quot;
        src=&quot;/static/cc0ff5abf7137bc8bd7e93645d6cd977/3cb18/uipath-cohort.jpg&quot;
        srcset=&quot;/static/cc0ff5abf7137bc8bd7e93645d6cd977/ff44c/uipath-cohort.jpg 158w,
/static/cc0ff5abf7137bc8bd7e93645d6cd977/a6688/uipath-cohort.jpg 315w,
/static/cc0ff5abf7137bc8bd7e93645d6cd977/3cb18/uipath-cohort.jpg 605w&quot;
        sizes=&quot;(max-width: 605px) 100vw, 605px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 id=&quot;売上の内訳&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%A3%B2%E4%B8%8A%E3%81%AE%E5%86%85%E8%A8%B3&quot; aria-label=&quot;売上の内訳 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;売上の内訳&lt;/h2&gt;
&lt;p&gt;UiPath の売上の大部分は &lt;code class=&quot;language-text&quot;&gt;License&lt;/code&gt; と &lt;code class=&quot;language-text&quot;&gt;Maintainance and Support&lt;/code&gt; で構成されている。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/5021d22bf8a508051da7af7afcd5ac0f/561da/uipath-revenue-details.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 36.075949367088604%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABEUlEQVQoz32P626CQBCFff9X6x8jJRq1UkCXOyyCssCyXwPiLW06ybdnspNzMrPAGAxgRn0FUEohhMC2bSzLYr//QogArfVo+1Wjb2FuHX9VqxpkkZNn6aRFnk297rtprpordVVxqSoGrae/xfj0esD2QvZphVe2iKshaCBUEHeQ9De9c58tnYCVF2H5CTuRzoHzeW5Sstw6uIkkayFV5l/yDjZ+iJueOZUNa8d/bqiNYe2FrA4+4qxIW0geZmaeYeMs68DLa47ySlD3+Kl833AX5nxsHOxjgrgMRArCxhCO571hJuIWbD9mGxa4UvF5eN1QD5xSiShqokqRqwHZgezMrK+YibKH7yh7eNwgngJ/ACIWGtD8mJHpAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;uipath-revenue-details&quot;
        title=&quot;uipath-revenue-details&quot;
        src=&quot;/static/5021d22bf8a508051da7af7afcd5ac0f/f058b/uipath-revenue-details.png&quot;
        srcset=&quot;/static/5021d22bf8a508051da7af7afcd5ac0f/c26ae/uipath-revenue-details.png 158w,
/static/5021d22bf8a508051da7af7afcd5ac0f/6bdcf/uipath-revenue-details.png 315w,
/static/5021d22bf8a508051da7af7afcd5ac0f/f058b/uipath-revenue-details.png 630w,
/static/5021d22bf8a508051da7af7afcd5ac0f/40601/uipath-revenue-details.png 945w,
/static/5021d22bf8a508051da7af7afcd5ac0f/561da/uipath-revenue-details.png 969w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;2021年1月期決算では License による売上が $346,035k （売上の 57%）で Maintainance and Support が $232,542k（売上の 38%）だった。その前年は License が $201,648k （売上の 60%）で Maintainance and Support が $119,612k（売上の 36%）だ。&lt;/p&gt;
&lt;p&gt;このそれぞれが具体的に何を指しているのかは &lt;code class=&quot;language-text&quot;&gt;Revenue Recognition&lt;/code&gt; の箇所を読むと書いてある。&lt;/p&gt;
&lt;h3 id=&quot;revenue-recognition&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#revenue-recognition&quot; aria-label=&quot;revenue recognition permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Revenue Recognition&lt;/h3&gt;
&lt;p&gt;自分が US の会社の開示を読むときはまず &lt;code class=&quot;language-text&quot;&gt;Revenue Recognition&lt;/code&gt; で検索してそれを読むようにしている。 UiPath の Form S-1 でいうと 94 ページのあたり。&lt;/p&gt;
&lt;p&gt;これの何がいいかと言うと、その会社が得る収益の内容や収益獲得のプロセス、適用される会計基準が 1 ~ 2 ページで簡潔に記載されていることにある。英語を何百ページも読むのは疲れるので、必要な箇所だけ読みたい。&lt;/p&gt;
&lt;p&gt;ここを読むと &lt;code class=&quot;language-text&quot;&gt;License&lt;/code&gt; は文字通り UiPath のソフトウェア・ライセンスで、期間限定のものと無制限の永久ライセンスがあり、顧客がそのソフトウェアを使用して便益を獲得できる状態になった（ライセンス対象期間が開始した）時点で収益を認識している、と書いてある。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Maintainance and Support&lt;/code&gt; は期間限定ライセンスと永久ライセンスの双方について技術サポート（stand-ready 型の契約で、提供期間に応じて認識される）やアップグレードを提供した売上とある。&lt;/p&gt;
&lt;p&gt;売上の残り 5% 程度を占める &lt;code class=&quot;language-text&quot;&gt;Services and Other&lt;/code&gt; は顧客へのトレーニングサービスの提供等を含んでいるらしい。&lt;/p&gt;
&lt;h3 id=&quot;地域別の売上&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%9C%B0%E5%9F%9F%E5%88%A5%E3%81%AE%E5%A3%B2%E4%B8%8A&quot; aria-label=&quot;地域別の売上 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;地域別の売上&lt;/h3&gt;
&lt;p&gt;全地域で売上が大きく伸びているが、全体に占める割合は南北アメリカが 43% で最も多い。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/cd1aa2031cf6493a7eb72aa6679328aa/c1328/uipath-geographical-revenue.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 33.54430379746836%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABIklEQVQoz42RW2+CQBCF+f9/rQ9tY1oraq0oioDAAnvhtl+zq6SNL+0kJ3PmZGY2OydIkoQ4jj3KsqTrOowxaK1RSnlureWvmHuCYRhomsajvue2banrGiGE59M0MVnLOI5+0D1UVZXPszYvDfhH2GmiuF5J05TtZsN6HZJnGYdDdMtRRBTt/fJg8XUmvAi2V8muMpyUJX6A0152J97jnGVSen7W+HqxT9jkDU/rA6U0BK/hJ8t9zKXtyNSAGKEafiAGKDrL2+7okeuRME45CcXqeOH5Y0sqe1bHlKKRBEpKRFVhjMZohZItWkm0M0QrtNOUJM9SyqKgqYX/Zi2Er938OA7ItsH5EbiD931/c/fusOMeTu97b5TrcQO/s7vZY3wDNjcawAe8FUwAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;uipath-geographical-revenue&quot;
        title=&quot;uipath-geographical-revenue&quot;
        src=&quot;/static/cd1aa2031cf6493a7eb72aa6679328aa/f058b/uipath-geographical-revenue.png&quot;
        srcset=&quot;/static/cd1aa2031cf6493a7eb72aa6679328aa/c26ae/uipath-geographical-revenue.png 158w,
/static/cd1aa2031cf6493a7eb72aa6679328aa/6bdcf/uipath-geographical-revenue.png 315w,
/static/cd1aa2031cf6493a7eb72aa6679328aa/f058b/uipath-geographical-revenue.png 630w,
/static/cd1aa2031cf6493a7eb72aa6679328aa/c1328/uipath-geographical-revenue.png 866w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;下に小さく書いてあるが日本での売上が FY2020 で全体の 17%、 FY2021 で全体の 14% あるらしい。それぞれ売上にかけると、金額としては FY2020 で $57M、 FY2021 で $85M になる。ちなみに $85M は規模感でいうと freee の FY2020/6 とマネーフォワードの FY/2020/11 の売上を足した数字より大きい。&lt;/p&gt;
&lt;h2 id=&quot;bsplcf-を貼っておく&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#bsplcf-%E3%82%92%E8%B2%BC%E3%81%A3%E3%81%A6%E3%81%8A%E3%81%8F&quot; aria-label=&quot;bsplcf を貼っておく permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;BS/PL/CF を貼っておく&lt;/h2&gt;
&lt;p&gt;さらっと読んだだけで特筆すべきことはないのだが、 BS と CF を見ると派手にお金使ってるなぁという印象がある。&lt;/p&gt;
&lt;p&gt;FY2021 の Cash は $357,690k だが、これは FY2020 の営業 CF のマイナスと同じくらいだ。今回の IPO に加えて2021年2月に Series F で $750M の大金を調達してるのでお金はたくさんあるのだが、自分が経営者だったらこんなに派手にお金使えないと思う。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/2dec9171aebcc5045973169d29f4b124/58bb7/uipath-bs.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 90.50632911392405%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC70lEQVQ4y32U6W7rNhBG8/5P059F0QJt0SVxkpvG8RrLlrdYsvaFokRR0ilEXy8I0go4msEM58OMRPIOoOu6T5xiTdOQZRmj0cgQxTG6aWj7BZ+ec+iu+yIJvWJLKSVpEuN7R0MSR5SyoG00ulaoqjI0dW1qeq27vlzIktnWwckqgqoj1hAqiGpINKTtid7vc75ssL2Y+YfH8hixdCMKpU8d9i+pW34cDPnhtwee10cWscIW3X+yLjB823h81PC09nCj9CzY0XSwcnxe50usD49DnBOrjqTvsD7bqx9VLfsoY7Y9EEhtbJyLa4dxlnM/emcwsVi4EftM4coOt/wKcGTHNlXMDqGJTfY+YXYj6McJPw9euZ+uWIYCp+KCq8Dt/RIOsuPQ2xK2uWa4cU1+uDnixdlVUBQSa3fAS3LCoiIUpSHIJX5WGJJSk2nIGwgLhe362I6PE+fMtwdyWd4IVjV/DGc8zWzG2yNvG5dVkLOOJatQYIeCfV6bLi+dFi2Wn+GUHXYsSUt1Fayajse5zS+Df/hrtGDmxGxSxVFx4TR2dxKVHauo4Pl9Y/x+9CC9+YaZKHieLHgczRnbe8JPezE62+/08UNWMt0czFrLDUmEvBlZlrwtbOxjxC7McFKJX9QGTyi8775BavxCs48FGz/mKBQrN0TcjhymOT89T/h1aPH7eMWfsw0P1ofh7/cd94u94WUX8LILmUUVy7xjFilWBUyjmrRqroKlbnkYL7h/m/M0XfI4XfI0WzKYLBiMTzxOLb7NbRNfBRlBDa5s8fqtVXbmtF1Oiu7gdbHmYThhvvdY+Qn7ROIVGlfUOHnFIavMWe99v2xw84qlExBULZYTkOTFtcNaN2zcgPl6j7VzcBPBMRV4aUFad2bvnREthFLzvnMYW2s+opyX6YI4za+CbdtSqhqlG6q6plI1RVmZn1XVGtW0p5xuLraPm5xuTG3Ttv93H0LTaKQsqMoSkecIkSOlpCgEtVJf1vT34b/W61xArmYjSwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;uipath-bs&quot;
        title=&quot;uipath-bs&quot;
        src=&quot;/static/2dec9171aebcc5045973169d29f4b124/f058b/uipath-bs.png&quot;
        srcset=&quot;/static/2dec9171aebcc5045973169d29f4b124/c26ae/uipath-bs.png 158w,
/static/2dec9171aebcc5045973169d29f4b124/6bdcf/uipath-bs.png 315w,
/static/2dec9171aebcc5045973169d29f4b124/f058b/uipath-bs.png 630w,
/static/2dec9171aebcc5045973169d29f4b124/40601/uipath-bs.png 945w,
/static/2dec9171aebcc5045973169d29f4b124/58bb7/uipath-bs.png 985w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/cb837c4f4a10ccda6547a97a75e8ad35/a2b88/uipath-pl.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 78.48101265822784%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAACaUlEQVQ4y3WU527bMBCA/f6v1L9Fi7ZJG6fxSDy1LFsSKWpvfQUlrwQNgQ+3eMdxEid933ODMz2X0XUdaZoipaSu62vsfd6NySXx4uAuQQjBYrHg4eEXj4+PPE+nrFYr8jznszHRiW3XXR26XNdD2/WUVU3dNDRtO8ypm5aqbqjqepibZTme7+MHAUKGdJcdzgyXh43DW5CyVRVWDlYGdgG21u+42Do2cxXfXw1eg4xvrwYnlY4FvaTk6W3H0jgQlB2iAlH1n1P2yBrsMGNhOIQNzPcH/DAaC26Ogj9rCysqORWc6e90Pvh7TiU4Sc3GU4O98WPCtBgLnuKC6drgZedgqxxRQ1D2BJWGD/RDTJ/iEJfMDXfQl7aHp3eom3IUit3Bw1UpQVqSNBDXPXGj4QP9EEtbcETEm2ETVR3LnYWM4nGHT2uLLz+nPKxMzLjBKcDJe5ycT+g5FGBEFXNHcChh7ob4cTYWVFXH343Jj+cF871zPdKtEdwx+nQjTJEMVyUreN6YnKRior+d173Fy9bCyxtOaT0kyLuuygHO8lywBksmvGzMoeuzvTN2WRecrvZ8nS552liYqsDNO44lHAvOsn+Hq7tcwU7m/F6bg2+6dzn4kon+V3eHE6YXYgdquGgvzgnL7oqqIWpuXOy9FzLbmgR5w2xrcQzk2GVXKCw/xPZDHKEGafsSOwixPEmQVYi8QeT1IGXRkHawto8s9zZ+WjJ92yJUPBbMsowkSUiSlDTLUEoRhmp4YaQMCcMRbQspB71pmvO8UT95HmVZ3l6b+9G27bCIflX0JL1YFEUURXn1a/m/1+YfmOzKMNxi680AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;uipath-pl&quot;
        title=&quot;uipath-pl&quot;
        src=&quot;/static/cb837c4f4a10ccda6547a97a75e8ad35/f058b/uipath-pl.png&quot;
        srcset=&quot;/static/cb837c4f4a10ccda6547a97a75e8ad35/c26ae/uipath-pl.png 158w,
/static/cb837c4f4a10ccda6547a97a75e8ad35/6bdcf/uipath-pl.png 315w,
/static/cb837c4f4a10ccda6547a97a75e8ad35/f058b/uipath-pl.png 630w,
/static/cb837c4f4a10ccda6547a97a75e8ad35/a2b88/uipath-pl.png 908w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/7274f8bf356b851509db9c1cdaaf24bc/b7877/uipath-cf.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 105.0632911392405%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsTAAALEwEAmpwYAAADjUlEQVQ4y3WViXLbNhCG9f4P1LSN3SZpnDqy60i2ZMkSdZHiIZEU75vElwEoXzMpZv7ZBQgs9/ixGAgh+BXkqKqKKIowTRPXdUnTlLqu1bdfn4MBL0O8SmVQEJxOzOczxuMRj9Mp2nJJEsf8/xAM2rajajpaAU0naAS09JBm5VyikvvaTq1LeYpiDNPCPhyxnANxmvUeemHM5x+PDGdrrqcaM9ND8xI0N2Hpxqy8FDMXWAU9csE+7diGJTdLg5kTsvJzfmwsqqZlkDeCz6M5H65u+ePfOz7dTbl+XHFvuGrz7BBhpB37HPbSmALYJWyCAiNtsSuY7D3KupEGO76Mn/jw9YbPoxlPx1h5Yhb9IasEM0d52cvesFyfWj4rP1P6zA56g0lZKw8vb+6514+sg1IZe/VGvDEm3hl80A+9wQLGG4uyrhnkreDv0Zzfv93x5X7BWHcxS1RYRiYwpMyf5XktE1gVXD/tWLip0odPO4qyYlB1MN2a3D4umOkOWy/GSWucrMGrwCvFGWe9ArfosNOah/WenZ9gJxWTtUElQy7qhpXpMNW2TJYbNo6H4UdYQUrUQFQLopozej2sBF5WszuecNNKQXcD2q7rq3w1WXIxHHE5HHP1sGAdFKxOOXrS9gV6k0NL5jDr0JOGu9UezUvZRBXXs3UfctN2HE4hG8Nks7fYmDZenBKXDVkjyFuQeX4FpHVHmFfozpFTmuMnOYbjIi/JIK0aPo1mfPw+UpWWFBptbXZJoyr5zLtX9JVX3DN9VqdC6VPT74ldtIKv9wsuhmMuvo+4WcjKyVuSop0pYb5Q5y19xAuxpT5aWxRVzaDtBG4Qq3C3ps3+6OFGqQorqdp3IT+nQH6Te3b2UYV7CGLWhkkjPYySjIeVzmSlc6/tWNoemu1hhjl+xRniDXraSGrNdZt9mGHFJdO1Qd3Iq1eUbPcWumlj2Ad20lPD5OAHVAJkSnr0etmBzLvjy0JaeFGC5foqOlWUMCv46/aBy+GI4XzDeGsrPB0iRZ33+eu7jqSMzN36lCtIXXYnVRT5t4/DMb/9M+TP6zuuJhrfphr/aYZqX04FdvEKOTeSBjPrWPvZS3vbhSW19FA2z619ZLE1WO726I6LEyS4SUFQ1ARF8yJPeU2Q13hpSVS2JA2EZUNcd5yyEsnpwfP78Xa0bUue5wpFURBGkXpP5DzLMiW7rlMdXTy/GOfxE3gJN2bsV+zxAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;uipath-cf&quot;
        title=&quot;uipath-cf&quot;
        src=&quot;/static/7274f8bf356b851509db9c1cdaaf24bc/f058b/uipath-cf.png&quot;
        srcset=&quot;/static/7274f8bf356b851509db9c1cdaaf24bc/c26ae/uipath-cf.png 158w,
/static/7274f8bf356b851509db9c1cdaaf24bc/6bdcf/uipath-cf.png 315w,
/static/7274f8bf356b851509db9c1cdaaf24bc/f058b/uipath-cf.png 630w,
/static/7274f8bf356b851509db9c1cdaaf24bc/b7877/uipath-cf.png 891w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 id=&quot;rpa-に対する個人的な意見&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#rpa-%E3%81%AB%E5%AF%BE%E3%81%99%E3%82%8B%E5%80%8B%E4%BA%BA%E7%9A%84%E3%81%AA%E6%84%8F%E8%A6%8B&quot; aria-label=&quot;rpa に対する個人的な意見 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;RPA に対する個人的な意見&lt;/h2&gt;
&lt;p&gt;私は RPA と呼ばれる製品やサービスに頼りすぎるのは良くないと考えている。&lt;/p&gt;
&lt;p&gt;プログラミングせずとも様々な作業を自動化できて便利ではあるが、仕事の改善をし続けていくためにはその作業の背後にあるデータモデルやワークフローについてしっかり考えてそれを形にする必要があって、現状の RPA 製品・サービスの機能はそれらを考えなくていいほど進歩しているとは思えないからだ。&lt;/p&gt;
&lt;p&gt;役割や限界を意識して道具として使うのはいいと思うけど、これさえあれば万事解決！というものではない。これは何にでも言えることかもしれないが…&lt;/p&gt;
&lt;div class=&quot;footnotes&quot;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&quot;fn-1&quot;&gt;未上場で企業価値10億ドル以上の企業&lt;a href=&quot;#fnref-1&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content:encoded></item><item><title><![CDATA[React と Redux における immutability の重要性、あるいは JavaScript を何も理解してなかった話]]></title><description><![CDATA[JavaScript は奥が深い。以前このブログに「JavaScript はそれほど難しくないと思う」と書いたが、全くそんなことはなかった。 発端 React と Redux のドキュメントや関連するブログを読んでいると、しつこいくらい immutable…]]></description><link>https://lyohe.github.io/2021-03-17-javascript-nanimo-wakaranai/</link><guid isPermaLink="false">https://lyohe.github.io/2021-03-17-javascript-nanimo-wakaranai/</guid><pubDate>Wed, 17 Mar 2021 05:14:14 GMT</pubDate><content:encoded>&lt;p&gt;JavaScript は奥が深い。&lt;a href=&quot;https://lyohe.github.io/post/2021-02-04-programming-taihenda/&quot;&gt;以前このブログに「JavaScript はそれほど難しくないと思う」と書いた&lt;/a&gt;が、全くそんなことはなかった。&lt;/p&gt;
&lt;h2 id=&quot;発端&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%99%BA%E7%AB%AF&quot; aria-label=&quot;発端 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;発端&lt;/h2&gt;
&lt;p&gt;React と Redux のドキュメントや関連するブログを読んでいると、しつこいくらい &lt;em&gt;immutable&lt;/em&gt; や &lt;em&gt;immutability&lt;/em&gt; という単語が登場する。&lt;/p&gt;
&lt;p&gt;&lt;em&gt;immutable&lt;/em&gt; は &lt;em&gt;mutable&lt;/em&gt; の対義語。 &lt;em&gt;mutable&lt;/em&gt; は &lt;em&gt;mutate&lt;/em&gt; + &lt;em&gt;-able&lt;/em&gt; で、 &lt;em&gt;mutate&lt;/em&gt; は「ミュータント - mutant」という言葉に使われるように「変異する」という意味。ちなみにこの単語はニューヨークの下水道で暮らす亀が忍者に変異して悪と戦うアニメで覚えた。&lt;/p&gt;
&lt;p&gt;&lt;em&gt;immutable&lt;/em&gt; はその対義語なので「不変性」を意味しており、要は「あるオブジェクトの中身を直接書き換える（&lt;em&gt;mutate&lt;/em&gt;）のではなくて、そのコピーを作ってそれを書き換えなさい」ということを指している。一般的に、 JavaScript において object を immutable update することにはいくつかのメリットがある。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Glossary/Immutable&quot;&gt;https://developer.mozilla.org/en-US/docs/Glossary/Immutable&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;実は &lt;a href=&quot;https://ja.reactjs.org/tutorial/tutorial.html#why-immutability-is-important&quot;&gt;React のチュートリアルでも immutability の重要性について説明されている&lt;/a&gt;のだが、私はなぜそれが必要なのかを深く理解しないままやり過ごしてきた。&lt;/p&gt;
&lt;p&gt;しかし、どうも気になる…なんでわざわざこんな事をしなければならんのか。ということで、調べてブログに書くことにした。&lt;/p&gt;
&lt;h2 id=&quot;javascript-における-immutability&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#javascript-%E3%81%AB%E3%81%8A%E3%81%91%E3%82%8B-immutability&quot; aria-label=&quot;javascript における immutability permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;JavaScript における immutability&lt;/h2&gt;
&lt;p&gt;React や Redux における immutability の重要性について調べる前に、まずは JavaScript の基本を学ぶ。&lt;/p&gt;
&lt;p&gt;JavaScript において、値は必ず &lt;code class=&quot;language-text&quot;&gt;primitive&lt;/code&gt; か &lt;code class=&quot;language-text&quot;&gt;object&lt;/code&gt; のいずれかになる。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures&quot;&gt;https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;primitive は以下の7種類のデータ型で、これらに該当しない値が object となる。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;string&lt;/li&gt;
&lt;li&gt;number&lt;/li&gt;
&lt;li&gt;bigint&lt;/li&gt;
&lt;li&gt;boolean&lt;/li&gt;
&lt;li&gt;undefined&lt;/li&gt;
&lt;li&gt;symbol&lt;/li&gt;
&lt;li&gt;null&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Glossary/Primitive&quot;&gt;https://developer.mozilla.org/en-US/docs/Glossary/Primitive&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;primitive は「immutable」で object は「mutable」という互いに異なる性質を持つ。&lt;/p&gt;
&lt;h3 id=&quot;primitive-の-immutability&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#primitive-%E3%81%AE-immutability&quot; aria-label=&quot;primitive の immutability permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;primitive の immutability&lt;/h3&gt;
&lt;p&gt;primitive である文字列 &lt;code class=&quot;language-text&quot;&gt;Hello&lt;/code&gt; に別の文字列 &lt;code class=&quot;language-text&quot;&gt;, World!&lt;/code&gt; を連結すると、新しくできた文字列 &lt;code class=&quot;language-text&quot;&gt;Hello, World!&lt;/code&gt; は元々の2つの文字列とは全く別の新しい文字列として作られる。文字列 &lt;code class=&quot;language-text&quot;&gt;Hello&lt;/code&gt; が直接 mutate されるわけではない。これはC言語とは異なる。&lt;/p&gt;
&lt;p&gt;実際の例を見てみる。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; immutableString &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Hello&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

immutableString &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; immutableString &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;, World!&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// update&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;上記のコードで変数 immutableString の update 時には&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;変数 immutableString の値 &lt;code class=&quot;language-text&quot;&gt;Hello&lt;/code&gt; を取得し&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;, World!&lt;/code&gt; という値を &lt;code class=&quot;language-text&quot;&gt;1.&lt;/code&gt; の値に追加し&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;2.&lt;/code&gt; の結果を新しく確保されたメモリに割当て&lt;/li&gt;
&lt;li&gt;変数 immutableString が &lt;code class=&quot;language-text&quot;&gt;3.&lt;/code&gt; のメモリを参照し&lt;/li&gt;
&lt;li&gt;ガベージコレクション（以下 GC と呼ぶ）が update 前の参照先である &lt;code class=&quot;language-text&quot;&gt;1.&lt;/code&gt; のメモリを解放して利用可能にする&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;という処理が行われる。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Glossary/Mutable&quot;&gt;https://developer.mozilla.org/en-US/docs/Glossary/Mutable&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;object-の-mutability&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#object-%E3%81%AE-mutability&quot; aria-label=&quot;object の mutability permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;object の mutability&lt;/h3&gt;
&lt;p&gt;object は mutable であり、そのプロパティ（や Array の要素）は変更することができる。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; book1 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; title&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;The Road of the Rings&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
book1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;title &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;The Lord of the Rings&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;book1&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// { title: &apos;The Lord of the Rings&apos; }&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;object は値への参照とみなすこともできる。下記のように、ある object がそのプロパティとして持つ値が等しくても、 object の参照先が等しくなければそれは異なる object となる。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; book1 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; title&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;The Lord of the Rings&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; book2 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; title&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Harry Potter&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

book2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;title &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;The Lord of the Rings&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;book1 &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; book2&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// false&lt;/span&gt;
console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;book1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;title &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; book2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;title&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// true &lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;下記の例では book1 と book3 は同じ参照先を持つ object なので、 book3.title を mutate すると book1.title も同時に mutate される。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; book1 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; title&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;The Lord of the Rings&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; book3 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; book1&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;book1 &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; book3&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// true&lt;/span&gt;

book3&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;title &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;The Chronicles of Narnia&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;book1 &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; book3&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// true&lt;/span&gt;

console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;book1&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// { title: &apos;The Chronicles of Narnia&apos; }&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;このように、「object は mutable である」とは「object の参照先を変えないまま参照先の値を書き換えることができる」と言い換えることができる。&lt;/p&gt;
&lt;h2 id=&quot;react-における-immutability-の重要性&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#react-%E3%81%AB%E3%81%8A%E3%81%91%E3%82%8B-immutability-%E3%81%AE%E9%87%8D%E8%A6%81%E6%80%A7&quot; aria-label=&quot;react における immutability の重要性 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;React における immutability の重要性&lt;/h2&gt;
&lt;p&gt;本記事の冒頭で挙げたように、 React において「なぜ immutability が重要なのか」という理由はチュートリアルに書いてある。それによると、 object を immutable update することで&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;変更履歴を活用するような機能を簡単に実装できる&lt;/li&gt;
&lt;li&gt;（React が）簡単にオブジェクトの変更を検出できる&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;2.&lt;/code&gt; によって（React が）コンポーネントをいつ再描画するかを決定しやすくなる&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;というメリットがあるそうだ。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://ja.reactjs.org/tutorial/tutorial.html#why-immutability-is-important&quot;&gt;https://ja.reactjs.org/tutorial/tutorial.html#why-immutability-is-important&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;上記のうち 1. は自明だが 2. と 3. については React 内部の動作を知らないと納得がいかないと思う。自分はここを深く理解せず思考停止で immutable update をしていた。&lt;/p&gt;
&lt;p&gt;React.Component では shouldComponentUpdate() という API を通じて、いつ再描画すべきかをコンポーネントに伝えている。この shouldComponentUpdate() はコンポーネントの引数（props）か状態（state）が更新される度に render() の前に呼び出されて真偽値（デフォルトは true）を返し、これが false を返す場合は render() が実行されず再描画されない。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://ja.reactjs.org/docs/react-component.html#shouldcomponentupdate&quot;&gt;https://ja.reactjs.org/docs/react-component.html#shouldcomponentupdate&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/5b364e3cd846b982e8f3384824a1aabe/22c86/lifecycle-diagram.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 67.08860759493672%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAACLklEQVQ4y22TiXKjMAyG8/4vt2m3uZoLkkC4AzY+MCTfjt1NZo9qRiMw8udfspjx2x6PB99ZcVNkWU5V1ZRlRZKkVHXNNE3f5s/+hN3vd8ZxZJwmpumOcyNC9nSdoO97RNfR1A1CCIZhCFDvft8zzjzsCfRJ7a3mFEfcmgqtFEqpsJ4XBXF8Cu/W2nCAlJLLJSGKYuqmwTn3pfBp2jj2meF9V7C9aqSyGCXRqsdqhehuaCVD7HuJMQatdYD7GIBenbUD0ziizMD2allEHbts4FIq4qQiSirSUpAUgrzRxNeWVvQvoFft4+CBfvFwiLheM5QeiApHXDriauQz6Xk/dvyMJMvEsk4dh2JknzuaTmON/gsYFA6DI88Lbrc29MpZhdWS0WqmQXMqej6ODcvNlUXUfG00IrRBa/M/8M8ehpIzxya17DLHLnesLoaPWPF5MuxLgq/Tkboz3yv0N9a2XfBeaWoxULY2xKobqOqCPD9zzVPOl5gsT2iaHCG6l8LnpfgKZ8ZYirKkrhuGwcLoy21f8aFjJvmJaVboeoHrNqC3ONMyTQ/u9ynM7nMmZ16mn7G6uXEfLQ8dMcpDAMlyRVtsENUW3R6Z1AlswkOfcVa+WuUH2tsLmKZX6qrBOsvivOLH7p2P0xKhFbnMOVQHlucl8/0bq8uaY3NEasmpjHk7zJnv5mySNW7851L8CVKJL9ciJPjnuq3JipZWdvRaomwfvmmrESFX0us+/Hq/ANBt5LY6rnCpAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;component-lifecycle-diagram&quot;
        title=&quot;component-lifecycle-diagram&quot;
        src=&quot;/static/5b364e3cd846b982e8f3384824a1aabe/f058b/lifecycle-diagram.png&quot;
        srcset=&quot;/static/5b364e3cd846b982e8f3384824a1aabe/c26ae/lifecycle-diagram.png 158w,
/static/5b364e3cd846b982e8f3384824a1aabe/6bdcf/lifecycle-diagram.png 315w,
/static/5b364e3cd846b982e8f3384824a1aabe/f058b/lifecycle-diagram.png 630w,
/static/5b364e3cd846b982e8f3384824a1aabe/40601/lifecycle-diagram.png 945w,
/static/5b364e3cd846b982e8f3384824a1aabe/22c86/lifecycle-diagram.png 1143w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;上の図は↓から引用した。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://projects.wojtekmaj.pl/react-lifecycle-methods-diagram/&quot;&gt;https://projects.wojtekmaj.pl/react-lifecycle-methods-diagram/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;shouldComponentUpdate() の詳細な動作についてはドキュメントで説明されている。これによると、ツリー状に連なったコンポーネントにおいて shouldComponentUpdate() の結果が true かつ描画される React 要素が等しいかどうかで Reconciliation （差分を検出する処理）を実行するかを判定している。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://ja.reactjs.org/docs/optimizing-performance.html#shouldcomponentupdate-in-action&quot;&gt;https://ja.reactjs.org/docs/optimizing-performance.html#shouldcomponentupdate-in-action&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Reconciliation の詳細な仕組みについてもドキュメントに記載されている。ツリー構造の全体で差分比較をすることは計算コストが高すぎる（ドキュメントによるとツリーの要素数を n として O(n^3) らしい）ので、 React ではツリーの差分検出を O(n) 程度の計算量で行うためにいくつかの前提を置いているそうだ。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://ja.reactjs.org/docs/reconciliation.html&quot;&gt;https://ja.reactjs.org/docs/reconciliation.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Reconciliation の結果として「差分がある」ということになれば、 React は render() が返す JSX &lt;sup id=&quot;fnref-1&quot;&gt;&lt;a href=&quot;#fn-1&quot; class=&quot;footnote-ref&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;を使って生成した DOM で実 DOM を更新する。&lt;/p&gt;
&lt;p&gt;このようなコンポーネントのライフサイクルを見ると、 React において immutability が重要である詳細な理由が見えてくる。それは、「&lt;strong&gt;props や state の更新が行われるたびに&lt;/strong&gt;」 shouldComponentUpdate() が呼び出されることにある。shouldComponentUpdate() が呼び出されれば、それはデフォルトで true を返す。すると React は render() を呼び出し JSX を得る。React はその結果を使って Reconciliation を行い、差分があれば実 DOM を更新する。ここで、ライフサイクルの最初で props や state が変わったことをどのように検出するかという問題がある。JavaScript の object は mutable で、その参照先を書き換えた上で書き換え前の object と比較しても等しいままなのであった。&lt;/p&gt;
&lt;p&gt;論理的には object のプロパティを辿ってその一つ一つを比較することで object が更新されたかどうかを検出することは可能ではあるものの、現実的には計算コストが高そうで、要素数が n なら &lt;strong&gt;O(n)&lt;/strong&gt; の計算量になるはずだ。この点、 immutable な更新を行えば参照が異なるというだけで中身を見なくても変更されていることが分かるので、この前提を守るだけで非常に少ない計算コスト &lt;strong&gt;O(1)&lt;/strong&gt; で変更を検出できることが分かる。&lt;/p&gt;
&lt;p&gt;具体例としては、 React では state object の中身を（setState 関数を使わずに）直接 mutate しても DOM は再描画されないという仕様がある。これは、 setState が state object の immutable な更新を行っているが、この state object を直接書き換えるとその参照先は同じなので（React からすると）変わったように見えないからだ。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://ja.reactjs.org/docs/state-and-lifecycle.html#do-not-modify-state-directly&quot;&gt;https://ja.reactjs.org/docs/state-and-lifecycle.html#do-not-modify-state-directly&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;redux-における-immutability-の重要性&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#redux-%E3%81%AB%E3%81%8A%E3%81%91%E3%82%8B-immutability-%E3%81%AE%E9%87%8D%E8%A6%81%E6%80%A7&quot; aria-label=&quot;redux における immutability の重要性 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Redux における immutability の重要性&lt;/h3&gt;
&lt;p&gt;実世界で React コンポーネントを作るときはクラスで状態を持つことは少なく、多くのコンポーネントは props を受け取り JSX を返す関数として構成され、少数の閉じたコンポーネントで使う状態は React Hooks で、コンポーネントツリー内のあちこちで共通の状態を使い回すのであれば Redux 等のライブラリで状態を管理することになると思う。&lt;/p&gt;
&lt;p&gt;Redux で管理する状態は Store と呼ばれるグローバルな単一の object に統一されている。この Store は Reducer と呼ばれる、 Action と現在の状態を引数に取り新しい状態を返す関数によってのみ更新される。 Action は Reducer が識別に使うための type 要素を持つ単なる JavaScript object で、 UI 等から呼び出される Dispatch と呼ばれる関数によって Store に送られる。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://redux.js.org/tutorials/essentials/part-1-overview-concepts&quot;&gt;https://redux.js.org/tutorials/essentials/part-1-overview-concepts&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/c98922b5a476e12b853576324f12f5c4/ReduxDataFlowDiagram-49fa8c3968371d9ef6f2a1486bd40a26.gif&quot; alt=&quot;redux-dataflow-diagram&quot;&gt;&lt;/p&gt;
&lt;p&gt;Redux において immutability が重要になるのは、 object を直接 mutate するようなコードが React-Redux のような Redux の Store に依存するライブラリにおいて様々な問題を引き起こすためとドキュメントには書かれている。 React-Redux では root state object を shallow check することで state をラップするコンポーネントの再描画が必要かどうかを検出するため、直接 mutate していると再描画がトリガーされない。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://redux.js.org/faq/immutable-data#does-shallow-equality-checking-with-a-mutable-object-cause-problems-with-redux&quot;&gt;https://redux.js.org/faq/immutable-data#does-shallow-equality-checking-with-a-mutable-object-cause-problems-with-redux&lt;/a&gt;&lt;/p&gt;
&lt;h4 id=&quot;redux-toolkit-を使う&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#redux-toolkit-%E3%82%92%E4%BD%BF%E3%81%86&quot; aria-label=&quot;redux toolkit を使う permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Redux-Toolkit を使う&lt;/h4&gt;
&lt;p&gt;上記のように、 Redux においても object を immutable update することが重要だ。&lt;/p&gt;
&lt;p&gt;しかし、実世界で Redux アプリケーションを作る際に使うであろう Redux Toolkit の createSlice や createReducer は内部で &lt;a href=&quot;https://github.com/immerjs/immer&quot;&gt;Immer&lt;/a&gt; を使っていて、その中では object を mutate するようなコードを書いたとしても Immer が immutability を担保してくれるので開発者側からすると意識しないかもしれない…これを知らずに自力で state の immutable update を試みるとかえって余計なバグを生み出しそうだ。つまり、 immutability は重要だが、必ずしもそれを担保するコードを自分で書く必要はない。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://redux.js.org/tutorials/fundamentals/part-8-modern-redux#writing-slices&quot;&gt;https://redux.js.org/tutorials/fundamentals/part-8-modern-redux#writing-slices&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Immer は現在の状態と次の状態の間を取り持つ proxy を用意し、開発者が試みた全ての変更を追跡し安全に immutable update をしてくれる。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://hackernoon.com/introducing-immer-immutability-the-easy-way-9d73d8f71cb3&quot;&gt;https://hackernoon.com/introducing-immer-immutability-the-easy-way-9d73d8f71cb3&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ちなみに Immer の名前は immutable から取ってるのかなと思ったら、（それもあるだろうけど）ドイツ語で「いつも」という意味でもあるらしい。名前の付け方がおしゃれだ…&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://immerjs.github.io/immer/docs/introduction&quot;&gt;https://immerjs.github.io/immer/docs/introduction&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;おまけ-javascript-のメモリ管理&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%81%8A%E3%81%BE%E3%81%91-javascript-%E3%81%AE%E3%83%A1%E3%83%A2%E3%83%AA%E7%AE%A1%E7%90%86&quot; aria-label=&quot;おまけ javascript のメモリ管理 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;おまけ: JavaScript のメモリ管理&lt;/h2&gt;
&lt;p&gt;プログラミングを始めたばかりの頃にC言語を使って libc の再実装をやっていた時期があって、そのときは malloc や calloc でメモリを確保して free で解放するプログラムを書いていた。普段 JavaScript や TypeScript を書いているとメモリ管理について意識することが少ないのだが、この機会にどうなっているのか調べてみた。&lt;/p&gt;
&lt;p&gt;JavaScript では object の生成時に自動的にメモリを割り当て、それが “不要” になると GC によって自動的にメモリが解放される。 GC が既に割り当てられたメモリを “不要” とするアルゴリズムはいろいろある。&lt;/p&gt;
&lt;p&gt;例えば、 Reference-counting と呼ばれるやり方では、「ある object が他の object から参照されていない（つまり reference-count が 0 である）」ことを以てその object を “不要” とみなす。これは一見うまく行くように見えるが、 object 間に循環参照がある場合 GC の対象にならないという欠点がある。&lt;/p&gt;
&lt;p&gt;Mark-and-sweep algorithm と呼ばれるやり方では、 root と呼ばれる global object からスタートして参照を辿り、そこから到達不可能な object を “不要” とみなしてメモリを解放する。 root から到達可能かどうかによって GC の必要性を判断するので、お互いにお互いを参照する object が存在してもそれが root から到達不可能であれば GC の対象となる。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/JavaScript/Memory_Management&quot;&gt;https://developer.mozilla.org/en-US/docs/Web/JavaScript/Memory_Management&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;gc-があってもメモリ管理は必要&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#gc-%E3%81%8C%E3%81%82%E3%81%A3%E3%81%A6%E3%82%82%E3%83%A1%E3%83%A2%E3%83%AA%E7%AE%A1%E7%90%86%E3%81%AF%E5%BF%85%E8%A6%81&quot; aria-label=&quot;gc があってもメモリ管理は必要 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;GC があってもメモリ管理は必要&lt;/h3&gt;
&lt;p&gt;何を今更という話かもしれないが、上記の通り JavaScript はメモリの割当や解放を勝手にやってくれるだけで、それはメモリ管理についての配慮が不要であることを意味しない。&lt;/p&gt;
&lt;p&gt;例えば GC のアルゴリズムでは “不要” とみなされないが開発者や利用者の視点からは “不要” なメモリをたくさん確保しそれらを解放しないまま動作し続けるようなプログラムを実行したらクラッシュするだろう。&lt;/p&gt;
&lt;p&gt;家にゴミ箱があっても、ちゃんとゴミ箱に捨てて収集日にゴミ出しする習慣が無いと家がゴミだらけになってしまう。&lt;/p&gt;
&lt;h3 id=&quot;gc-以外のメモリ管理方法-rust&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#gc-%E4%BB%A5%E5%A4%96%E3%81%AE%E3%83%A1%E3%83%A2%E3%83%AA%E7%AE%A1%E7%90%86%E6%96%B9%E6%B3%95-rust&quot; aria-label=&quot;gc 以外のメモリ管理方法 rust permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;GC 以外のメモリ管理方法: Rust&lt;/h3&gt;
&lt;p&gt;最近ちょっとだけ Rust の勉強をした。といっても &lt;a href=&quot;https://doc.rust-jp.rs/book-ja/title-page.html&quot;&gt;The Rust Programming Language 日本語版&lt;/a&gt;を一通り読んだだけだが…&lt;/p&gt;
&lt;p&gt;Rust には JavaScript のような GC が存在しない。ではどうやって “不要” なメモリを OS に返却し再割当可能にしているかというと、「所有権 - Ownership」という独特な仕組みが用意されている。 Rust の値は「所有者 - Owner」と呼ばれる変数と対応している。所有者は必ず1つの変数で、その変数がスコープを抜けたらメモリは自動的に解放される。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://doc.rust-jp.rs/book-ja/ch04-01-what-is-ownership.html&quot;&gt;https://doc.rust-jp.rs/book-ja/ch04-01-what-is-ownership.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Rust は所有権を中心に様々な特殊な文法を持っていて、解放されたメモリにアクセスしたり確保されたメモリを二重に解放してしまうようなメモリ関連のバグを強制的に防ぐことができる。つまり言語仕様のレベルでメモリの安全性が担保されている。コンパイルの段階つまりプログラムの実行前にそれを知ることができるので、とても便利だ。&lt;/p&gt;
&lt;p&gt;仕事で使うことは無さそうだが、面白かったので引き続き勉強して趣味で使おうと思う。&lt;/p&gt;
&lt;h2 id=&quot;プログラミングは奥が深い&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0%E3%81%AF%E5%A5%A5%E3%81%8C%E6%B7%B1%E3%81%84&quot; aria-label=&quot;プログラミングは奥が深い permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;プログラミングは奥が深い&lt;/h2&gt;
&lt;p&gt;プログラミング、たぶん一生理解できないまま寿命かやる気のどっちかが尽きるんだろうな〜という思いがある。&lt;/p&gt;
&lt;p&gt;今回はドキュメントベースで勉強していったけど、直接いじりながら動かした方がドキュメント化されていない挙動を確認したり詳細を理解できるので勉強になりそうだ。 &lt;a href=&quot;https://preactjs.com/&quot;&gt;preact&lt;/a&gt; という小さな React があるので、時間があるときに触ってみたい。&lt;/p&gt;
&lt;p&gt;あと私は初心者なのでこの記事に間違いあったらすみません。各自の責任で調べて下さい。&lt;/p&gt;
&lt;div class=&quot;footnotes&quot;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&quot;fn-1&quot;&gt;実は &lt;a href=&quot;https://ja.reactjs.org/docs/react-without-jsx.html&quot;&gt;JSX を使わずに React を使うこともできる&lt;/a&gt;&lt;a href=&quot;#fnref-1&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content:encoded></item><item><title><![CDATA[電子取引証憑の紙出力による保存が NG になる、税制改正大綱に基づく電子帳簿保存法改正の話]]></title><description><![CDATA[↑これ本当か？と思ったので東京国税局調査開発課（電子帳簿保存に詳しいところ）に電話で聞いてみた。 結論から言うと、制度上の取り扱いについてはこの Tweet に書いてあることが正しい。Tweet…]]></description><link>https://lyohe.github.io/2021-03-12-dencho/</link><guid isPermaLink="false">https://lyohe.github.io/2021-03-12-dencho/</guid><pubDate>Fri, 12 Mar 2021 03:12:12 GMT</pubDate><content:encoded>&lt;blockquote class=&quot;twitter-tweet&quot;&gt;&lt;p lang=&quot;ja&quot; dir=&quot;ltr&quot;&gt;そして、電子データで保存する際には「受領後すぐにタイムスタンプを付す」など、受け手側で一定の処理をする必要があります。現行制度では、PDFでもらったのをプリントしておけばオケなんですが、それではダメになります。最悪の場合、青色申告承認の取り消しになるリスクを取引先に負わせることに。&lt;/p&gt;&amp;mdash; 米津良治／BASE(ベイス)総合会計事務所 (@zeiri4z) &lt;a href=&quot;https://twitter.com/zeiri4z/status/1368676836121608192?ref_src=twsrc%5Etfw&quot;&gt;March 7, 2021&lt;/a&gt;&lt;/blockquote&gt; &lt;script async src=&quot;https://platform.twitter.com/widgets.js&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;
&lt;p&gt;↑これ本当か？と思ったので東京国税局調査開発課（電子帳簿保存に詳しいところ）に電話で聞いてみた。&lt;/p&gt;
&lt;p&gt;結論から言うと、制度上の取り扱いについてはこの Tweet に書いてあることが正しい。Tweet の中身に対してはちょっと言いたいことがあるが、主旨から外れるので最後に書いた。&lt;/p&gt;
&lt;p&gt;なお、この記事に書いてあることは既に電子帳簿保存の承認を受けている会社には大きな影響がないのでそういう人は読まなくてもよい。&lt;/p&gt;
&lt;h2 id=&quot;問題点&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%95%8F%E9%A1%8C%E7%82%B9&quot; aria-label=&quot;問題点 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;問題点&lt;/h2&gt;
&lt;p&gt;この米津さんによる冒頭の Tweet が真であれば、電子取引については2022年1月以降、請求書や領収書の授受を行う双方で電子帳簿保存法に即した対応をしなければならない。&lt;/p&gt;
&lt;p&gt;つまり、&lt;a href=&quot;https://www.nta.go.jp/law/joho-zeikaishaku/sonota/jirei/07denshi/01.htm#a002&quot;&gt;電子取引に該当する&lt;/a&gt;取引についてはその根拠となる電子データの保存について&lt;a href=&quot;https://www.nta.go.jp/law/joho-zeikaishaku/sonota/jirei/07denshi/02.htm#a009&quot;&gt;一定の要件&lt;/a&gt;を満たさなければならない。&lt;/p&gt;
&lt;p&gt;電子取引の幅は広く、例えば下記の例は電子取引に該当する。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;電子メールで請求書や領収書の PDF ファイルを受領し、紙の請求書を受け取らない&lt;/li&gt;
&lt;li&gt;インターネット上の管理画面などから PDF や CSV 等で請求データをダウンロードし、紙の請求書を受け取らない&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;これらは現行の電子帳簿保存法の下で、国税関係帳簿・書類 &lt;sup id=&quot;fnref-1&quot;&gt;&lt;a href=&quot;#fn-1&quot; class=&quot;footnote-ref&quot;&gt;1&lt;/a&gt;&lt;/sup&gt; の電子データによる保存には所轄税務署長の承認が必要（一定の&lt;a href=&quot;https://www.nta.go.jp/law/joho-zeikaishaku/sonota/jirei/07index.htm&quot;&gt;保存要件&lt;/a&gt;あり）であり、電子取引については（所轄税務署長の承認は必要なく）紙と保存要件を満たした電子データのどちらで保存してもいいということになっている。&lt;/p&gt;
&lt;p&gt;よって現行制度では、電子帳簿保存の承認申請を行っていなければ、電子取引の請求書や領収書について&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;原則的に全ての証憑を紙で保存する&lt;/li&gt;
&lt;li&gt;電子取引に該当する場合（例: 電子メールで送られてきた PDF 等）は、印刷して保存する&lt;/li&gt;
&lt;li&gt;電子取引の保存要件を満たしている場合は印刷しなくてよい&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;という対応が可能だが、今回の税制改正で電子取引については 2. の対応が不可能となり、電子取引に該当する場合は必ず保存要件を満たさなければならなくなってしまう。つまり訂正削除履歴を残したり認定事業者によるタイムスタンプを押す等の対応をしなければならない。&lt;/p&gt;
&lt;p&gt;これが真ならそれなりに経理実務に影響がありそう…ということで気になったので、調査開発課に質問してみることにした。&lt;/p&gt;
&lt;h2 id=&quot;質問の内容&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%B3%AA%E5%95%8F%E3%81%AE%E5%86%85%E5%AE%B9&quot; aria-label=&quot;質問の内容 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;質問の内容&lt;/h2&gt;
&lt;p&gt;電子帳簿保存法（電子計算機を使用して作成する国税関係帳簿書類の保存方法等の特例に関する法律）第10条には、こう書いてある。&lt;/p&gt;
&lt;p&gt;——
（電子取引の取引情報に係る電磁的記録の保存）
第十条　所得税（源泉徴収に係る所得税を除く。）及び法人税に係る保存義務者は、電子取引を行った場合には、財務省令で定めるところにより、当該電子取引の取引情報に係る電磁的記録を保存しなければならない。ただし、財務省令で定めるところにより、当該電磁的記録を出力することにより作成した書面又は電子計算機出力マイクロフィルムを保存する場合は、この限りでない。
——&lt;/p&gt;
&lt;p&gt;ところで、&lt;a href=&quot;https://www.mof.go.jp/tax_policy/tax_reform/outline/fy2021/20201221taikou.pdf&quot;&gt;令和3年度税制改正大綱&lt;/a&gt;の98ページを読むと以下のような記述がある。&lt;/p&gt;
&lt;p&gt;——
（4）国税関係書類に係るスキャナ保存制度並びに申告所得税、法人税及び消費税 における電子取引の取引情報に係る電磁的記録の保存制度について、次のとお り電磁的記録の適正な保存を担保するための措置を講ずる。
（中略）
② スキャナ保存が行われた国税関係書類の電磁的記録並びに申告所得税及び 法人税における電子取引の取引情報に係る電磁的記録について、次のとおりとする。
（中略）
ロ 申告所得税及び法人税における電子取引の取引情報に係る電磁的記録の保存義務者が行う当該電磁的記録の出力書面等の保存をもって当該電磁的記録に代えることができる措置は、廃止する。
（中略）
——&lt;/p&gt;
&lt;p&gt;この「②ロ」には「申告所得税及び法人税における電子取引の取引情報に係る電磁的記録の保存義務者が行う当該電磁的記録の出力書面等の保存をもって当該電磁的記録に代えることができる措置は、廃止する。」とあるが、これはあらゆる会社の電子取引に適用されるのか。&lt;/p&gt;
&lt;p&gt;だとすると、例えば電子メールの添付ファイルのみで請求書を受け取る場合、これは電子取引に該当すると考えられるが、税制改正の施行後は紙への出力による保存ができなくなり、電子取引の電磁的記録の保存に関する要件を満たす必要があるのか。&lt;/p&gt;
&lt;p&gt;つまり、来年1月以降の電子取引については例えばタイムスタンプを付す、または訂正削除の記録を残す等の対応をしなければならないのか。&lt;/p&gt;
&lt;h2 id=&quot;回答&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%9B%9E%E7%AD%94&quot; aria-label=&quot;回答 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;回答&lt;/h2&gt;
&lt;p&gt;（原文ままではなく、（）内は著者による補足）&lt;/p&gt;
&lt;p&gt;昨年12月に閣議決定された税制改正大綱に沿って（国税は財務省、地方税は総務省によって）改正法案が作成され、国会へ提出され、そして通過すれば、質問の通り電子取引の証憑を紙で保存することはできず、保存要件を守っていただかなければならないということになる。&lt;/p&gt;
&lt;p&gt;その場合、電子取引の証憑については（ディスプレイ等の見読可能装置の備え付けや検索機能の確保等の要件に加えて）次の4つのいずれかが必要となる。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;（発行側で）タイムスタンプが付された後の授受&lt;/li&gt;
&lt;li&gt;（受領側で）授受後に遅滞なく&lt;sup id=&quot;fnref-2&quot;&gt;&lt;a href=&quot;#fn-2&quot; class=&quot;footnote-ref&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;タイムスタンプを付す&lt;/li&gt;
&lt;li&gt;データの訂正削除を行った場合にその記録が残る、または訂正削除できないシステムを利用する&lt;/li&gt;
&lt;li&gt;（上記3つをいずれも行わない場合は）訂正削除の防止に関する事務処理規程の備え付けを行う&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;（要は&lt;a href=&quot;https://www.nta.go.jp/law/joho-zeikaishaku/sonota/jirei/07denshi/02.htm#a009&quot;&gt;これ&lt;/a&gt;をやって下さいということ）&lt;/p&gt;
&lt;h3 id=&quot;補足&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%A3%9C%E8%B6%B3&quot; aria-label=&quot;補足 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;補足&lt;/h3&gt;
&lt;p&gt;上記の回答はちょっと冷たいように見えるかもしれないが、税務当局の職員が法律を作ってるわけではないので、まぁ今の税制改正大綱の通りに法律が作られて運用されるとおっしゃる通りの運用になりますね…というトーンだった。そりゃそうだ。&lt;/p&gt;
&lt;p&gt;ちなみに税制に関して分からないことがあったら、税理士よりも税務当局に聞いた方が良い場合が多い。なぜなら当局の担当者はたぶん日本で一番その税制に詳しく、しかも無料で聞けるからだ。&lt;/p&gt;
&lt;p&gt;一方で、具体的に自分の会社はどうすべきかを考えたい場合は税理士に相談するのが良い。税制を考慮した実務については当局職員より税理士の方が詳しい。&lt;/p&gt;
&lt;h3 id=&quot;税制改正大綱について&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%A8%8E%E5%88%B6%E6%94%B9%E6%AD%A3%E5%A4%A7%E7%B6%B1%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6&quot; aria-label=&quot;税制改正大綱について permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;税制改正大綱について&lt;/h3&gt;
&lt;p&gt;税制改正大綱は政治家で構成される与党の税制調査会が各省庁や経済界、地方自治体からの要望を聞いて作成することになっている。これは政府の税制調査会とは別。政府税調はより中長期的な視点で税制のあり方を検討する組織で、メンバーは租税法や経済学の学者が多い。&lt;/p&gt;
&lt;p&gt;毎年度の税制改正では、この税制改正大綱に沿って法律の改正案が作られ、国会の決議を経てそれが施行される。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.mof.go.jp/tax_information/qanda016.html&quot;&gt;https://www.mof.go.jp/tax_information/qanda016.html&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;自分の経験と-disclaimer&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%87%AA%E5%88%86%E3%81%AE%E7%B5%8C%E9%A8%93%E3%81%A8-disclaimer&quot; aria-label=&quot;自分の経験と disclaimer permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;自分の経験と disclaimer&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;税理士や公認会計士ではなく、税務当局への勤務経験もなく、簿記の資格も一切持ってない&lt;/li&gt;
&lt;li&gt;経理の仕事をしていたことはある（いちおう2015年度税制改正後に電子帳簿保存の導入、調査対応経験あり）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;私はこの記事に関して一切の責任を負わないので、自分の会社で具体的にどうすべきかは自分の責任で調べて下さい。自分も調べないといけないんだよなぁ。&lt;/p&gt;
&lt;h2 id=&quot;以下自分用のメモ&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BB%A5%E4%B8%8B%E8%87%AA%E5%88%86%E7%94%A8%E3%81%AE%E3%83%A1%E3%83%A2&quot; aria-label=&quot;以下自分用のメモ permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;以下自分用のメモ&lt;/h2&gt;
&lt;p&gt;会計 freee を使っていれば、受け取った請求書をファイルボックスにアップロードするだけで認定事業者によるタイムスタンプを付けてくれる。「遅滞なく」の要件を満たす必要はあるが、freee を使っている方はこれで十分だろう。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.freee.co.jp/func/houjin/e-account-book/book-keeping/&quot;&gt;https://www.freee.co.jp/func/houjin/e-account-book/book-keeping/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;自分が働いてる会社は freee を使ってるので MF クラウド会計とか弥生とか他社の会計ソフトは調べてないけど、同じようなファイルを保存してタイムスタンプを押してくれる機能はありそう。&lt;/p&gt;
&lt;p&gt;それなりに大きい会社なら、会計ソフトというよりは稟議決裁とか経費精算とか支払依頼するシステムでタイムスタンプ押したり訂正削除履歴を管理できるような仕組みがあるかもしれない。&lt;/p&gt;
&lt;p&gt;最近だと下記のような請求書を受け取るための便利な SaaS があるから、会計ソフト側でファイルへのタイムスタンプの付与や訂正削除履歴の記録に対応していない場合はこういうのを使ってみるのもよいと思う。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://sweeep.ai/&quot;&gt;sweeep&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.layerx.jp/invoice&quot;&gt;LayerX Invoice&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://bill-one.com/&quot;&gt;Bill One&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;冒頭の-tweet-に対する個人的意見&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%86%92%E9%A0%AD%E3%81%AE-tweet-%E3%81%AB%E5%AF%BE%E3%81%99%E3%82%8B%E5%80%8B%E4%BA%BA%E7%9A%84%E6%84%8F%E8%A6%8B&quot; aria-label=&quot;冒頭の tweet に対する個人的意見 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;冒頭の Tweet に対する個人的意見&lt;/h3&gt;
&lt;p&gt;冒頭の Tweet で税理士の方が「青色申告承認の取り消しになるリスクを取引先に負わせることに」って書いてあるけど、帳簿や書類を管理する責任はその取引先にあるから気にしなくていいのではと思った。&lt;/p&gt;
&lt;p&gt;それに、もし電子取引に該当する場合は請求書や領収書のデータを授受する双方で電子取引の保存要件を満たさなければならないので、取引先だけの問題ではないかもしれない。&lt;/p&gt;
&lt;div class=&quot;footnotes&quot;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&quot;fn-1&quot;&gt;要は会計帳簿や取引の内容を記した注文書、契約書、領収書、請求書、見積書のこと&lt;a href=&quot;#fnref-1&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;li id=&quot;fn-2&quot;&gt;現行では3日以内、令和3年度税制改正後は記録事項の入力期間（最長2ヶ月）以内&lt;a href=&quot;#fnref-2&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content:encoded></item><item><title><![CDATA[東日本大震災から10年]]></title><description><![CDATA[東日本大震災から10年が経った。 当時の私は卒業が決まった大学4年生で、就職先の会社の近く（西新宿と中野坂上の間あたり）に引っ越して一人暮らしを始めたばかりだった。 地震が起きたときは確か PC でゲームをしていたと思う。今振り返るとあり得ない行動だとは思うが、東京に4 ~…]]></description><link>https://lyohe.github.io/2021-03-11-ten-years-after/</link><guid isPermaLink="false">https://lyohe.github.io/2021-03-11-ten-years-after/</guid><pubDate>Thu, 11 Mar 2021 06:52:42 GMT</pubDate><content:encoded>&lt;p&gt;東日本大震災から10年が経った。&lt;/p&gt;
&lt;p&gt;当時の私は卒業が決まった大学4年生で、就職先の会社の近く（西新宿と中野坂上の間あたり）に引っ越して一人暮らしを始めたばかりだった。&lt;/p&gt;
&lt;p&gt;地震が起きたときは確か PC でゲームをしていたと思う。今振り返るとあり得ない行動だとは思うが、東京に4 ~ 5年住んでて地震はちらほらあったので「また地震かー今回のは大きいな」くらいの認識で、特にニュースを見ることもなく地震が収まった後に昼寝してしまった。&lt;/p&gt;
&lt;p&gt;地震発生から 3 ~ 4 時間後、外が暗くなってから九州に住んでいた親からの電話で目を覚ました。後から着信履歴を見ると何十回も電話してきていたようで、心配をかけてしまったかもしれない。&lt;/p&gt;
&lt;p&gt;親からは「早く電話に出なさい」「仙台が大変なことになってるからニュースを見なさい」「何かあったら必ず連絡しなさい」といわれた。&lt;/p&gt;
&lt;p&gt;実際には仙台以外も被害を受けていたのだが、近所に住んでいた同級生の一家が引っ越して仙台に住んでいたので仙台のことが気になっていたのかもしれない。&lt;/p&gt;
&lt;p&gt;私の家にはテレビは無かったのだが、ネットニュースを見ると東北地方の各地で甚大な被害が出ていることがすぐに分かった。津波の映像も見たのだが、あまりに衝撃的で現実感がなかった。&lt;/p&gt;
&lt;p&gt;当時はニコニコ生放送で NHK が24時間ミラーされていて、眠気で倒れるまでディスプレイにかじりついて見ていた気がする。原発事故のときも NHK の映像をずっと見ていた。&lt;/p&gt;
&lt;p&gt;3 ~ 4日くらい経つとだんだん現実が飲み込めてきて、就職先のことが心配になってきた。私の就職先は東京ビッグサイトのような大規模コンベンションセンターで商業展示会を主催する事業を営んでいた。ビッグサイトの建物自体には大きな損傷はなかったものの、震災後の混乱や様々な事情でビッグサイトのイベントは次々と中止になっていった。&lt;/p&gt;
&lt;p&gt;気になってしまい毎日朝起きたらビッグサイトのホームページを見て中止になったイベントを調べていたが、結局その会社のイベントは開催された。後から聞いたところでは社内外でいろいろな意見があったらしいが、阪神大震災の直後にも数々の展示会が中止になる中開催を強行して出展社から感謝されたという過去があったらしく、そのときも「こんなときこそ商売の機会を中止してはいけない」という思いがあったらしい。&lt;/p&gt;
&lt;p&gt;個人的には会社の方針に疑問を抱くことが多かった（結局すぐ辞めた）ものの、今では確かにそういう考え方もあるなと思うようになった。昨今の新型コロナヴィルス感染症拡大の中で開催強行してたのはどうかと思うけど。&lt;/p&gt;
&lt;p&gt;自分は幸いにして震災によって自分の家族や大事なものが失われてしまうという体験はなかったけど、震災やその後の混乱で亡くなった人や苦労している人の話を聞くといつか自分にもそういうときが来るのではと考える。&lt;/p&gt;
&lt;p&gt;災害でなくても生きていると何かしら大きな損害を受けるリスクはあるし、そういう人に手を差し伸べられるような人間でありたいなと思う。逆に自分が困ったとき手を差し伸べてくれる人がいることを期待しているのかもしれない。&lt;/p&gt;
&lt;p&gt;ということで、メルカリでゲーム売った金があったので被災地の自治体に1,000円ずつ寄付した。少ないけど継続的に寄付をやっていきたい気持ちがある。
&lt;a href=&quot;https://about.mercari.com/press/news/articles/20210310_mercari_kifu/&quot;&gt;https://about.mercari.com/press/news/articles/20210310_mercari_kifu/&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[会計とプログラミングの仕事をやっていきたい話]]></title><description><![CDATA[特に誰向けでもないが、自分が書きたくなったので書く。 私は経理に関連した仕事をいろいろやった後プログラマーに転職してもうすぐ…]]></description><link>https://lyohe.github.io/2021-02-21-sigoto/</link><guid isPermaLink="false">https://lyohe.github.io/2021-02-21-sigoto/</guid><pubDate>Sun, 21 Feb 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;特に誰向けでもないが、自分が書きたくなったので書く。&lt;/p&gt;
&lt;p&gt;私は経理に関連した仕事をいろいろやった後プログラマーに転職してもうすぐ1年経つのだが、将来的には会計に関する仕事をやっていきたいと考えている。&lt;/p&gt;
&lt;p&gt;プログラマーに転職してそれが今のところ続いている理由としては、個人的な興味関心とキャリアとしての可能性の2つがある。&lt;/p&gt;
&lt;h2 id=&quot;個人的な興味関心&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%80%8B%E4%BA%BA%E7%9A%84%E3%81%AA%E8%88%88%E5%91%B3%E9%96%A2%E5%BF%83&quot; aria-label=&quot;個人的な興味関心 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;個人的な興味関心&lt;/h2&gt;
&lt;p&gt;まずプログラミングは単純に楽しい。&lt;/p&gt;
&lt;p&gt;まだまだ初心者レベルだが何が楽しいかというと、とにかく自分の行動に対するフィードバックが多いという理由があるかもしれない。自分が書いたプログラムを動かしたり他人のレビューを受けたり、ログやインスペクタ、 Stack trace を眺めたりなど。フィードバックから機構や制約を理解していく過程がよくできたゲームみたいで楽しい。&lt;/p&gt;
&lt;p&gt;それから、自分が経理の仕事をやってきた中で自分が認識していた課題を解決するためにプログラミングが役に立ちそうだという印象が強まっている。&lt;/p&gt;
&lt;p&gt;複式簿記は会計主体に生じる債権債務関係の変化を記録するための技術で、現代の財務会計では複式簿記の基礎の上に様々な概念や体系、制約&lt;sup id=&quot;fnref-1&quot;&gt;&lt;a href=&quot;#fn-1&quot; class=&quot;footnote-ref&quot;&gt;1&lt;/a&gt;&lt;/sup&gt; が積み重なって最終的な財務諸表や開示書類が生まれている。&lt;/p&gt;
&lt;p&gt;日常的な実務としては、事業で起きる膨大な数のイベントを一つ一つその制約や性質を根拠に原因と結果という二つの面に切り分けて借方と貸方に記録していく。それが積み重なり一定の体系の下で集約されて財務諸表が生まれる。言い換えると、財務会計の日常的な仕事の多くは膨大な数のイベントを分類していく作業になる。&lt;/p&gt;
&lt;p&gt;会計処理が必要なイベントは日々様々な場所で発生していて（給与や賞与、取引先への売上や仕入、固定資産の償却、借入の返済、社員が立替払いした経費…）、経理の仕事ではそれらを手で入力したり、受け取ったデータを Excel で加工したり、会計ソフトに直接流し込んだりしている。&lt;/p&gt;
&lt;p&gt;そのような仕事に取り組む中で、自分で業務を効率化するぞ！と意気込んで Google スプレッドシートのマクロや GAS、それから Zapier のような RPA を使ったこともあった。しかしながら、非常に便利ではあるものの限界があるという印象を受けた。&lt;/p&gt;
&lt;p&gt;それらはデータを A 地点から B 地点に移すような仕事は得意だけど、元々のデータが十分でなかったり使いづらい形だったりして結局手で隙間を埋める作業することが多かった。自動化のツールというよりは、それを使う以前の問題や自分の能力不足で思ったような結果を出せなかった。&lt;/p&gt;
&lt;p&gt;その後いろいろあって、会計処理のデータを生み出すイベントのデータ構造やそのデータを会計に入力するワークフローとインターフェースに会計ソフト側から一定の制約を設けることで全体がより効率的に仕事できるようになるんじゃないかな〜と考えるようになった。&lt;/p&gt;
&lt;p&gt;しかしながら、自分はただただ漠然とアイデアを考えるだけで自分の思考を具現化する能力が無かった。そこでプログラミングとかソフトウェア開発の技法とかそういうやつを自分にインストールしたかった、というのが仕事でプログラムを書きたいと考えたきっかけだったかもしれない。&lt;/p&gt;
&lt;p&gt;ちなみに今の仕事では会計のプログラミングをしているわけではないけど、当たらずしも遠からずということをしているのでそこそこ楽しくやっている。&lt;/p&gt;
&lt;h2 id=&quot;キャリアとしての可能性&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%82%AD%E3%83%A3%E3%83%AA%E3%82%A2%E3%81%A8%E3%81%97%E3%81%A6%E3%81%AE%E5%8F%AF%E8%83%BD%E6%80%A7&quot; aria-label=&quot;キャリアとしての可能性 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;キャリアとしての可能性&lt;/h2&gt;
&lt;p&gt;会計 x プログラミングというのは面白いキャリアだと思う。&lt;/p&gt;
&lt;p&gt;何らかの活動を行う上で会計を一切やらなくていい組織は無いし、自分が働くこれから20 ~ 30年（…短ければ短いほどいい…）の間に会計の仕事でプログラミング的思考が必要になる場合が増えることはあっても減ることはないだろうから。&lt;/p&gt;
&lt;p&gt;Netscape の創業者 Marc Andreessen が &lt;a href=&quot;https://a16z.com/2011/08/20/why-software-is-eating-the-world/&quot;&gt;“Why Software Is Eating the World”&lt;/a&gt; という有名なエッセイを発表したのが10年前だが、まさに彼が書いた通りソフトウェアは世界を喰い続けている。それと並行してソフトウェアを通じて生み出される債権債務も増え続けている。&lt;/p&gt;
&lt;p&gt;付加価値の高いソフトウェアのインターフェースやアーキテクチャは外部環境の変化に応じて変わっていくけれども、会計の側ではその影響を人の脳と腕力で吸収することがある（時と場合と組織の判断による）。こういう状態は長続きしないので、環境の変化に適応しやすいよう会計データの保守性、拡張性、信頼性をソフトウェアを通じて維持・向上する能力の需要が高まる時代が近い内に来るのではないだろうか。会計で必要なデータの構造や要件は一般的なソフトウェアのそれと異なることが多い。&lt;/p&gt;
&lt;p&gt;ところで、仕事を取り巻く環境が次第に変わっていく中で会計に限らず「何かの仕事 x プログラミング」をやることで得られる知識や経験は付加価値が高い。そういった横断的な知識や経験は「システムと現実世界のインターフェースをどう設計するか」や「ビジネスのルールからシステムが解決するユースケースをどう抽出するか」という設計上の課題を理解するのに生きてくるはずなので。&lt;/p&gt;
&lt;p&gt;例えば医者がデータサイエンスや Web アプリケーションの開発を学んで遠隔医療のシステム開発に参加するとか、飲食店経営者がプログラミングを学んで店舗の管理に役立つアプリを開発するとか、そういう事例がたくさん出てくると予想している。というか、既にそういう例はたくさんあるのかもしれない。&lt;/p&gt;
&lt;p&gt;これは自分の仕事の話なので他人のキャリアを否定する気は一切無い。それぞれ自分自身が可能な範囲で環境に適応する努力をすればいいし、しなくてもいいと思う。&lt;/p&gt;
&lt;h2 id=&quot;当面の目標&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%BD%93%E9%9D%A2%E3%81%AE%E7%9B%AE%E6%A8%99&quot; aria-label=&quot;当面の目標 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;当面の目標&lt;/h2&gt;
&lt;p&gt;一言でいうと会計ソフトを作りたくて、その過程で財務会計のワークフローを少しずつ抽象化していきたい。&lt;/p&gt;
&lt;p&gt;ERP の会計部分の核だけを切り出して、状況に応じて様々な業務システムや SaaS から送られる会計処理データを受け取る（もしくは取得しにいく）ようなものをイメージしている。&lt;/p&gt;
&lt;p&gt;日本では freee やマネーフォワードのような主として銀行の入出金明細から会計の仕訳を生成する SaaS の成長によって、中小企業の会計業務が大きく変わった。自分はもともと経理をやっていたので、ユーザーの1人としてその中にいた。外国でも状況は似ていて、会計の仕事は大きく変わりつつある。主に仕訳を作るところで自動化が進んでいる。&lt;/p&gt;
&lt;p&gt;一方で、事業上のイベントから仕訳の生成を自動化することが進むと、それが意図通りに行われることを保証したくなる。そこで、イベントと仕訳の間にもう一つ層が欲しい。イベントと会計処理の関係を定義して仕訳を生成するような層。&lt;/p&gt;
&lt;p&gt;私は将来的に会計ソフトの主たる関心事は以下の5つになると考えている。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;事業に関連して増減する債権債務や収益費用のデータ構造を定義する&lt;/li&gt;
&lt;li&gt;事業が会計システムに送るべきデータの構造を定義する&lt;/li&gt;
&lt;li&gt;事業が生み出す会計処理イベントを受け取る&lt;/li&gt;
&lt;li&gt;受け取ったデータが事前の定義に沿っているかを検証する&lt;/li&gt;
&lt;li&gt;検証済みのデータを保存、集計、出力する&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;会計処理の根拠となるイベントは、事業運営上の課題を解決するユースケースに特化したソフトウェアが提供する。例えば給与計算ソフト、飲食店や小売店の POS レジ、請求書の発行や受取、固定資産の管理、銀行の入出金明細など。いわゆる基幹システム的なものもあるかもしれない。&lt;/p&gt;
&lt;p&gt;それが進むと、経理に関連する仕事の多くはそれらのイベントを受け渡す API や Pub/Sub と財務モデルの運用になるはず。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;イベントによって記録する会計上の分類項目を定義したり&lt;/li&gt;
&lt;li&gt;イベントが発火するタイミングを定義したり&lt;/li&gt;
&lt;li&gt;事前の定義通りに運用されているか監視したり&lt;/li&gt;
&lt;li&gt;保存したデータを使って何かしたり&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;そこで、まず自分の当面の目標としては会計処理イベントを定義したりそれを解析して財務諸表を組み立てるソフトウェアとイベントを発行する SDK のそれぞれ簡単なやつを作りたい。&lt;/p&gt;
&lt;h2 id=&quot;最後に&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%9C%80%E5%BE%8C%E3%81%AB&quot; aria-label=&quot;最後に permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;最後に&lt;/h2&gt;
&lt;p&gt;書いたら満足した。御託はいいからやれよっていう話ですね、これは。&lt;/p&gt;
&lt;p&gt;会計とプログラミングでお金を稼いで労働から引退し、自分の好奇心を満たすだけの怠惰な生活を長く続けることが今の人生の目標です。&lt;/p&gt;
&lt;div class=&quot;footnotes&quot;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&quot;fn-1&quot;&gt;会社法、金商法、租税法、各種の会計基準、証券取引所の規則、経営上の都合など、会社の状態や活動に応じて様々な制約が生まれる&lt;a href=&quot;#fnref-1&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content:encoded></item><item><title><![CDATA[「フロントエンド開発入門」を読んだ話]]></title><description><![CDATA[雰囲気でプログラムを書いてきたのでちゃんとフロントエンドの勉強をせねば…と思って読んだ。とても良い本だったので紹介したい。 フロントエンド開発入門 プロフェッショナルな開発ツールと設計・実装（秀和システム） 自分のレベル プログラミングを始めて1年くらい TypeScript…]]></description><link>https://lyohe.github.io/2021-02-18-frontend-beginner/</link><guid isPermaLink="false">https://lyohe.github.io/2021-02-18-frontend-beginner/</guid><pubDate>Thu, 18 Feb 2021 11:26:08 GMT</pubDate><content:encoded>&lt;p&gt;雰囲気でプログラムを書いてきたのでちゃんとフロントエンドの勉強をせねば…と思って読んだ。とても良い本だったので紹介したい。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.amazon.co.jp/dp/B08SQQWPDW/&quot;&gt;フロントエンド開発入門 プロフェッショナルな開発ツールと設計・実装（秀和システム）&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;自分のレベル&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%87%AA%E5%88%86%E3%81%AE%E3%83%AC%E3%83%99%E3%83%AB&quot; aria-label=&quot;自分のレベル permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;自分のレベル&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;プログラミングを始めて1年くらい&lt;/li&gt;
&lt;li&gt;TypeScript とか React とか Node.js とかその辺のやつを使うことが多い&lt;/li&gt;
&lt;li&gt;フロントエンドのツール群については名前を聞いたことあるレベル&lt;/li&gt;
&lt;li&gt;大抵は既に導入されておりその恩恵を享受しているが、自分で設定を触ったことは無い&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;本書の概要&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%9C%AC%E6%9B%B8%E3%81%AE%E6%A6%82%E8%A6%81&quot; aria-label=&quot;本書の概要 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;本書の概要&lt;/h2&gt;
&lt;p&gt;全体で三段階に分かれている。&lt;/p&gt;
&lt;h3 id=&quot;第一部-導入編1章4章&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%AC%AC%E4%B8%80%E9%83%A8-%E5%B0%8E%E5%85%A5%E7%B7%A81%E7%AB%A04%E7%AB%A0&quot; aria-label=&quot;第一部 導入編1章4章 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;第一部: 導入編（1章〜4章）&lt;/h3&gt;
&lt;p&gt;現在「フロントエンド」と呼ばれている領域の歴史から始まり、どのようなスキルが求められておりプロジェクト内でどういう働き方をするのかを取り上げる。&lt;/p&gt;
&lt;p&gt;個人的に素晴らしいと思ったのは第三章の「フロントエンドにおける一般的なツール群」で、 Node.js 周辺のツールやフレームワークについて簡単に基礎の基礎の説明がされていてよかった。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Babel&lt;/li&gt;
&lt;li&gt;webpack&lt;/li&gt;
&lt;li&gt;TypeScript&lt;/li&gt;
&lt;li&gt;Vue.js, React, Angular&lt;/li&gt;
&lt;li&gt;クライアントサイド MVC と Flux&lt;/li&gt;
&lt;li&gt;Redux&lt;/li&gt;
&lt;li&gt;CSS と CSS-in-JS&lt;/li&gt;
&lt;li&gt;フォーマッターとリンターPrettier と ESLint&lt;/li&gt;
&lt;li&gt;ユニットテストMocha, Jest, Karma&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;これらの一つ一つを解説するとそれなりの分量になってしまうが、80ページくらいの間に「何をしてくれるツールなのか、なぜ求められているのか、最初の最初はこうやって使う」という紹介が書かれていて、使い始める前に読む文章として分かりやすいと思った。&lt;/p&gt;
&lt;p&gt;実際に使うときは公式ドキュメントを読めばいいので、まずこういう書籍でまとめて全体像に触れるのが良さそうだ。一つ一つを習得しようとすると時間かかりそうなので、まずは感覚を掴むのが大事。&lt;/p&gt;
&lt;h3 id=&quot;第二部-実践編5章7章&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%AC%AC%E4%BA%8C%E9%83%A8-%E5%AE%9F%E8%B7%B5%E7%B7%A85%E7%AB%A07%E7%AB%A0&quot; aria-label=&quot;第二部 実践編5章7章 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;第二部: 実践編（5章〜7章）&lt;/h3&gt;
&lt;p&gt;jQuery で作られた簡単な書籍のレビューサイトを TypeScript + React で置き換えながら、ユニットテストや CI/CD の導入、パフォーマンスの計測と改善を進めていく。&lt;/p&gt;
&lt;p&gt;第一部で簡単なツールの使い方を知って、第二部でそれを実践していくという内容になっている。サンプルアプリは GitHub で公開されている。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/n05-frontend/shuwa-frontend-book-app&quot;&gt;https://github.com/n05-frontend/shuwa-frontend-book-app&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;これを clone してきて docker-compose で環境構築し、章ごとに branch を切り替えながら進めることで自分の手元で本と同じ環境を動かせる。&lt;/p&gt;
&lt;h3 id=&quot;第三部-応用編8章9章&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%AC%AC%E4%B8%89%E9%83%A8-%E5%BF%9C%E7%94%A8%E7%B7%A88%E7%AB%A09%E7%AB%A0&quot; aria-label=&quot;第三部 応用編8章9章 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;第三部: 応用編（8章〜9章）&lt;/h3&gt;
&lt;p&gt;Google アナリティクスの導入やユーザーモニタリング、エラーイベントの監視（Sentry）、チームやコミュニティへの貢献方法について取り上げている。&lt;/p&gt;
&lt;p&gt;Google アナリティクスは（説明不要かもしれないが）特定のイベントを特定のタイミングで送ることでアクセス解析をするためのツール。イベントの定義やアナリティクスに送るタイミングは開発者の側でカスタマイズできる。&lt;/p&gt;
&lt;p&gt;また、アプリケーションが付加価値を生み続けるにはユーザー側で期待通りに動作しなければならないが、ときにはエラーなどで画面が描画されないということがあるかもしれない。しかし、ブラウザ等のクライアント側の環境はユーザーによって異なる。&lt;/p&gt;
&lt;p&gt;Sentry はエラーイベントを監視、トラッキングするための SDK + SaaS で、ブラウザで起きたエラーや例外を捕捉してそれらを緊急度で分類したり一定のしきい値を設けてアラートを出したりできる。&lt;/p&gt;
&lt;p&gt;下記の紹介ページの1分程度の動画を見ると雰囲気がつかめると思う。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://sentry.io/welcome/&quot;&gt;https://sentry.io/welcome/&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;特によかったところ&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%89%B9%E3%81%AB%E3%82%88%E3%81%8B%E3%81%A3%E3%81%9F%E3%81%A8%E3%81%93%E3%82%8D&quot; aria-label=&quot;特によかったところ permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;特によかったところ&lt;/h2&gt;
&lt;p&gt;全体で250ページくらいで、適度な分量にフロントエンドのよく使いそうなツールや考え方が詰め込まれててよかった。&lt;/p&gt;
&lt;p&gt;自分はフロントエンド初心者だけど、知らなければならないと感じることがたくさんある。この書籍は「そもそもこいつは何のためにあるもので何処から来たのか」が1冊にまとまっていてとても分かりやすかったので、自分のような新人はまずこの本で全体像に触れてから各種の公式ドキュメントを読んでいくのがよさそうだと思った。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Fusuma でスライドを作るスライドを Fusuma で作る]]></title><description><![CDATA[Fusuma は Markdown でスライドを作る OSS で、最近大きなアップデートが行われた。 Markdownでスライドを作るツールのFusumaのv2をリリースをしました 上記の記事で Fusuma…]]></description><link>https://lyohe.github.io/2021-02-13-made-slides-with-fusuma-make-slides-with-fusuma/</link><guid isPermaLink="false">https://lyohe.github.io/2021-02-13-made-slides-with-fusuma-make-slides-with-fusuma/</guid><pubDate>Sat, 13 Feb 2021 08:33:47 GMT</pubDate><content:encoded>&lt;p&gt;&lt;a href=&quot;https://hiroppy.github.io/fusuma/&quot;&gt;Fusuma&lt;/a&gt; は Markdown でスライドを作る OSS で、最近大きなアップデートが行われた。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://blog.hiroppy.me/entry/fusuma-v2&quot;&gt;Markdownでスライドを作るツールのFusumaのv2をリリースをしました&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;上記の記事で Fusuma の存在を知り、自分でも試しに使ってみた。&lt;/p&gt;
&lt;p&gt;思ったより楽に良さげなスライドができたのでスライドを作る際の選択肢の一つとしてお勧めしたい。しかしながら、自分が作ったスライドが公開できないやつなので、別に Fusuma を使ってスライドを作る方法を説明するスライドを作りそれをブログに書くことにした。&lt;/p&gt;
&lt;p&gt;なお、本記事の Fusuma に関する情報のほぼ全ては &lt;a href=&quot;https://github.com/hiroppy/fusuma/blob/master/README.md&quot;&gt;README&lt;/a&gt; と&lt;a href=&quot;https://hiroppy.github.io/fusuma/intro/&quot;&gt;公式サイトの intro&lt;/a&gt; 、&lt;a href=&quot;https://github.com/hiroppy/fusuma/tree/master/site/docs/guides&quot;&gt;site/docs/guides&lt;/a&gt; を読めば書いてあることしか書いていない。そちらの方が正確かつ詳しいので、使ってみようかと思った方はそちらを読んだ方が有益そうだ。&lt;/p&gt;
&lt;p&gt;この記事には主に自分の動機や印象に残ったことを書いた。&lt;/p&gt;
&lt;p&gt;（Fusuma は Slide door だから Fusuma っていう名前なのかな…）&lt;/p&gt;
&lt;h2 id=&quot;自分の動機&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%87%AA%E5%88%86%E3%81%AE%E5%8B%95%E6%A9%9F&quot; aria-label=&quot;自分の動機 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;自分の動機&lt;/h2&gt;
&lt;p&gt;何故スライドを Markdown で作るのか？&lt;/p&gt;
&lt;p&gt;多くの人はスライドを作るとき Microsoft PowerPoint / Keynote / Google Slides を使うと思う。これらの製品は GUI で多彩な操作ができ、直感的でとても便利だ。人によって好みは分かれるだろうが、私は Google Slides が大好きでよく使っていた。&lt;/p&gt;
&lt;h3 id=&quot;既製のスライド作成ソフトへのちょっとした不満&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%97%A2%E8%A3%BD%E3%81%AE%E3%82%B9%E3%83%A9%E3%82%A4%E3%83%89%E4%BD%9C%E6%88%90%E3%82%BD%E3%83%95%E3%83%88%E3%81%B8%E3%81%AE%E3%81%A1%E3%82%87%E3%81%A3%E3%81%A8%E3%81%97%E3%81%9F%E4%B8%8D%E6%BA%80&quot; aria-label=&quot;既製のスライド作成ソフトへのちょっとした不満 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;既製のスライド作成ソフトへのちょっとした不満&lt;/h3&gt;
&lt;p&gt;Google スライドの機能に関しては大きな不満はないのだが、起動してスライドの体裁を整えて…みたいなのがちょっと面倒だなーと感じていた。&lt;/p&gt;
&lt;p&gt;そこで Markdown でやれば手軽にスライド作れるのでは！？と思ったのが Fusuma に手を出した理由だ。また、テキストなので Git 等の VCS でバージョン管理しやすいというメリットもある。&lt;/p&gt;
&lt;h2 id=&quot;スライドを作るスライド&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%82%B9%E3%83%A9%E3%82%A4%E3%83%89%E3%82%92%E4%BD%9C%E3%82%8B%E3%82%B9%E3%83%A9%E3%82%A4%E3%83%89&quot; aria-label=&quot;スライドを作るスライド permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;スライドを作るスライド&lt;/h2&gt;
&lt;p&gt;完成品はこちら ↓ で、ここの GitHub Pages にディレクトリ分けてデプロイした。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://lyohe.github.io/slide/fusuma-example&quot;&gt;https://lyohe.github.io/slide/fusuma-example&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;iframe で埋め込むこともできる（自分側の都合でサイズの調整がちょっと難しかった）。&lt;/p&gt;
&lt;iframe src=&quot;https://lyohe.github.io/slide/fusuma-example&quot; style=&quot;width:100%; height:45rem;&quot;&gt;&lt;/iframe&gt;
&lt;h3 id=&quot;最低限のスライドを動かすまで&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%9C%80%E4%BD%8E%E9%99%90%E3%81%AE%E3%82%B9%E3%83%A9%E3%82%A4%E3%83%89%E3%82%92%E5%8B%95%E3%81%8B%E3%81%99%E3%81%BE%E3%81%A7&quot; aria-label=&quot;最低限のスライドを動かすまで permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;最低限のスライドを動かすまで&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;とりあえずスライド用のディレクトリを作って &lt;code class=&quot;language-text&quot;&gt;npm init&lt;/code&gt; しておく&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;npm install fusuma -D&lt;/code&gt; で Fusuma をインストールする&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;npx fusuma init&lt;/code&gt; で今いるディレクトリにスライドのひな形を作る&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;npx fusuma start&lt;/code&gt; で development server を起動する&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;これだけでスライドのひな形ができ、ブラウザから &lt;code class=&quot;language-text&quot;&gt;localhost:8080&lt;/code&gt; で確認できる。サーバーを起動しっぱなしにしてファイルを編集することで変更が自動的に反映される。&lt;/p&gt;
&lt;p&gt;この初期状態のスライドは &lt;a href=&quot;https://hiroppy.github.io/fusuma/themes/&quot;&gt;demo&lt;/a&gt; で触ることができる。動かしてみると使用感が分かると思う。あとは自分のスライドか、できれば&lt;a href=&quot;https://hiroppy.github.io/fusuma/intro/&quot;&gt;公式サイトの intro&lt;/a&gt; を見てほしい。&lt;/p&gt;
&lt;p&gt;あとは自分で作ってみましょう！&lt;/p&gt;
&lt;h2 id=&quot;スライドを作成する際の注意点&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%82%B9%E3%83%A9%E3%82%A4%E3%83%89%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B%E9%9A%9B%E3%81%AE%E6%B3%A8%E6%84%8F%E7%82%B9&quot; aria-label=&quot;スライドを作成する際の注意点 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;スライドを作成する際の注意点&lt;/h2&gt;
&lt;p&gt;ここからは自分がスライド作る中で印象に残ったことを書いていく。&lt;/p&gt;
&lt;h3 id=&quot;pdf-出力前に-build-すべし&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#pdf-%E5%87%BA%E5%8A%9B%E5%89%8D%E3%81%AB-build-%E3%81%99%E3%81%B9%E3%81%97&quot; aria-label=&quot;pdf 出力前に build すべし permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;PDF 出力前に build すべし&lt;/h3&gt;
&lt;p&gt;Fusuma には &lt;code class=&quot;language-text&quot;&gt;npx fusuma pdf&lt;/code&gt; で PDF を出力する機能があるが、これは build した HTML を基に生成するので先に build しないと PDF export に失敗する。&lt;/p&gt;
&lt;p&gt;build や pdf export は&lt;a href=&quot;https://github.com/hiroppy/fusuma/blob/master/packages/fusuma/src/cli/index.js&quot;&gt;コマンドラインオプションでいろいろできる&lt;/a&gt;が特に理由なければデフォルトを使うのがいいと思う。&lt;/p&gt;
&lt;h3 id=&quot;シンタックスハイライト&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%82%B7%E3%83%B3%E3%82%BF%E3%83%83%E3%82%AF%E3%82%B9%E3%83%8F%E3%82%A4%E3%83%A9%E3%82%A4%E3%83%88&quot; aria-label=&quot;シンタックスハイライト permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;シンタックスハイライト&lt;/h3&gt;
&lt;p&gt;スライド上でプログラムをシンタックスハイライトするために &lt;a href=&quot;https://www.npmjs.com/package/prismjs&quot;&gt;Prism.js&lt;/a&gt; を使っている。&lt;/p&gt;
&lt;p&gt;そのため、 Prism で対応していない言語はハイライトできない。自分はそういう言語使ったことないが…ちなみに &lt;a href=&quot;https://zenn.dev/zenn/articles/markdown-guide#%E3%82%B3%E3%83%BC%E3%83%89%E3%83%96%E3%83%AD%E3%83%83%E3%82%AF&quot;&gt;Zenn も Prism.js を使っている&lt;/a&gt;ので、 Zenn でハイライトできる言語はだいたいハイライトできると考えてよさそう。&lt;/p&gt;
&lt;h3 id=&quot;デプロイ&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4&quot; aria-label=&quot;デプロイ permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;デプロイ&lt;/h3&gt;
&lt;p&gt;Deploy には &lt;a href=&quot;https://www.npmjs.com/package/gh-pages&quot;&gt;gh-pages&lt;/a&gt; を使っている。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;npx fusuma deploy&lt;/code&gt; を実行すると git の remote origin に &lt;code class=&quot;language-text&quot;&gt;gh-pages&lt;/code&gt; ブランチを作り、そこにスライドを build した結果（&lt;code class=&quot;language-text&quot;&gt;dist/&lt;/code&gt;）を push する。&lt;/p&gt;
&lt;p&gt;自分は Fusuma が提供する deploy コマンドを使わず、 &lt;code class=&quot;language-text&quot;&gt;dist/&lt;/code&gt; 以下を直接に自分の GitHub Pages 用リポジトリにぶち込んだ。&lt;/p&gt;
&lt;h3 id=&quot;presentation-モード&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#presentation-%E3%83%A2%E3%83%BC%E3%83%89&quot; aria-label=&quot;presentation モード permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Presentation モード&lt;/h3&gt;
&lt;p&gt;Presentation モードに入るとスピーカーノート、現在のスライド、次のスライドが見えるのだが、 Fusuma が提供する機能はこれだけではない。&lt;/p&gt;
&lt;p&gt;録音してくれたりページごとの時間を記録してくれたり、様々な便利機能がある。これ Google スライドにも欲しいんだよなぁ。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://hiroppy.github.io/fusuma/docs/modes/presenter&quot;&gt;https://hiroppy.github.io/fusuma/docs/modes/presenter&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;数式や図形フローチャートも書ける&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%95%B0%E5%BC%8F%E3%82%84%E5%9B%B3%E5%BD%A2%E3%83%95%E3%83%AD%E3%83%BC%E3%83%81%E3%83%A3%E3%83%BC%E3%83%88%E3%82%82%E6%9B%B8%E3%81%91%E3%82%8B&quot; aria-label=&quot;数式や図形フローチャートも書ける permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;数式や図形、フローチャートも書ける&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/mermaid-js/mermaid&quot;&gt;Mermaid.js&lt;/a&gt; を使って図形やチャートを描ける。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://hiroppy.github.io/fusuma/docs/guides/math-chart&quot;&gt;https://hiroppy.github.io/fusuma/docs/guides/math-chart&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;試しにシーケンス図を描いてみた（下図の右半分は VS Code）。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/c61848f106c19c387b39c1bf9f249b0d/74d4e/mermaid-sequence.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 43.67088607594937%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABWklEQVQoz32RjW6jMBAG87Khj3lXqbmrlAeImkQhCkmggGPANmB+MicbiWuVtit9QjbsYO8syrJFiIbbraUqa7RWVFXt126/kC3WdjwFAb9eXnA1jiP3+/0hrhY3MRKdDEkyoNRA0xi07knfR6KoJs+HGfh7NQG/qhmotcGYmiRJOBxCzuczx+OROI5RlUJrje0m4POfFU1nuV6uaGNo25amabDWztCFMdo3OcB+v2e32/lEUYQQAvfeNUwnXGGHnvBw4HQ6+Z+7uO/cGPwJjTEopYiiM9vtjjAMeXvb+oY0zXA36LqOIAj4+/rqm/q+ZxiGOZ9mWNeGspQIkRPHVzabDZfLhaKQSHnDGOWBy+WS9Xo9S/lujouqsqSp8pFSk+cZUiqEqMkyTVFMlj8CP57qwbIQk8047inLzluuSuute8vZZDkIPgO/q9myezo5/zPtK6UfrvwT8B/zKaN7Nu2ffAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;mermaid-sequence&quot;
        title=&quot;mermaid-sequence&quot;
        src=&quot;/static/c61848f106c19c387b39c1bf9f249b0d/f058b/mermaid-sequence.png&quot;
        srcset=&quot;/static/c61848f106c19c387b39c1bf9f249b0d/c26ae/mermaid-sequence.png 158w,
/static/c61848f106c19c387b39c1bf9f249b0d/6bdcf/mermaid-sequence.png 315w,
/static/c61848f106c19c387b39c1bf9f249b0d/f058b/mermaid-sequence.png 630w,
/static/c61848f106c19c387b39c1bf9f249b0d/40601/mermaid-sequence.png 945w,
/static/c61848f106c19c387b39c1bf9f249b0d/74d4e/mermaid-sequence.png 1157w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;他にもフローチャートやガントチャート、 ER 図などいろいろ書ける。記法は &lt;a href=&quot;https://github.com/mermaid-js/mermaid#examples&quot;&gt;Mermaid.js の README を見ると&lt;/a&gt;いろいろ書いてある。&lt;/p&gt;
&lt;h3 id=&quot;npm&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#npm&quot; aria-label=&quot;npm permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;npm&lt;/h3&gt;
&lt;p&gt;これは恥ずかしい話なのだが、 Fusuma 入れた後にそのプロジェクトで npm 使って手動でいろいろ入れたら何もしてないのに壊れて困った（いろいろ npm uninstall して一からやり直したらなおった）。&lt;/p&gt;
&lt;p&gt;実際 npm のこと何も分からず使ってる感があるのでちゃんと勉強しようと思う。&lt;/p&gt;
&lt;h2 id=&quot;結論&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%B5%90%E8%AB%96&quot; aria-label=&quot;結論 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;結論&lt;/h2&gt;
&lt;p&gt;もし Fusuma を知らない人がいたら、とりあえず &lt;a href=&quot;https://github.com/hiroppy/fusuma/blob/master/README.md&quot;&gt;README&lt;/a&gt; と&lt;a href=&quot;https://hiroppy.github.io/fusuma/intro/&quot;&gt;公式サイトの intro&lt;/a&gt; を見てほしい。私は今後さくっとスライド作りたいときはこれを使うことにした。&lt;/p&gt;
&lt;p&gt;そして&lt;a href=&quot;https://github.com/hiroppy&quot;&gt;作者の方&lt;/a&gt;に課金できるボタンが GitHub にあったので $5/month のコースを押した。&lt;/p&gt;
&lt;p&gt;あと今回の記事と関係ないが &lt;a href=&quot;https://azu.github.io/promises-book/&quot;&gt;Promise の本&lt;/a&gt;のおかげで Promise のことが分かるようになってきたので、著者の &lt;a href=&quot;https://github.com/azu&quot;&gt;azu&lt;/a&gt; さんにも $5/month 課金した。ちなみに私の Slack には azu さんの GitHub アクティビティが流れるチャンネルがある。&lt;/p&gt;
&lt;p&gt;自分自身はプログラミング初心者なので何やってるのか全く分からんのだが、やっていこうと思います。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Google クラウド巨大赤字の話]]></title><description><![CDATA[Google の Cloud セグメントが約5,880億円の巨額損失を出したというニュースを見かけた。 [TechCrunch] Google Cloudは2020年に約5880億円の損失
https://jp.techcrunch.com/2021/02/03/2021-0…]]></description><link>https://lyohe.github.io/2021-02-06-google-cloud-comprehensive-loss/</link><guid isPermaLink="false">https://lyohe.github.io/2021-02-06-google-cloud-comprehensive-loss/</guid><pubDate>Sat, 06 Feb 2021 02:56:34 GMT</pubDate><content:encoded>&lt;p&gt;Google の Cloud セグメントが約5,880億円の巨額損失を出したというニュースを見かけた。&lt;/p&gt;
&lt;p&gt;[TechCrunch] Google Cloudは2020年に約5880億円の損失
&lt;a href=&quot;https://jp.techcrunch.com/2021/02/03/2021-02-02-google-cloud-lost-5-6b-in-2020/&quot;&gt;https://jp.techcrunch.com/2021/02/03/2021-02-02-google-cloud-lost-5-6b-in-2020/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Form 10-K は&lt;a href=&quot;https://www.sec.gov/Archives/edgar/data/1652044/000165204421000010/goog-20201231.htm&quot;&gt;こちら&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;この赤字について身近で様々な意見を見かけたが、自分の印象と異なるものが多かったので個人的な意見を書いておきたい。&lt;/p&gt;
&lt;p&gt;以下、 $ 1B = $ 1 Billion（10億ドル）とする。&lt;/p&gt;
&lt;h2 id=&quot;gcp-は大丈夫か&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#gcp-%E3%81%AF%E5%A4%A7%E4%B8%88%E5%A4%AB%E3%81%8B&quot; aria-label=&quot;gcp は大丈夫か permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;GCP は大丈夫か？&lt;/h2&gt;
&lt;p&gt;このニュースを見て GCP 大丈夫かな？続くのかな？というのが気になる人がいると思う。むしろ何千億円の赤字なんて大丈夫かと思うのが普通だろう。&lt;/p&gt;
&lt;p&gt;しかしながら、Cloud で何千億円の赤字を出したところで Google がどうにかなるわけではない。Alphabet, Inc は純資産が $222B あって2020年12月期の包括利益は$ 40B 以上あるし、 Cloud セグメントは高い成長率のクラウド業界で全体の平均より大幅に高い成長率（YoY +47%）を出している。&lt;/p&gt;
&lt;p&gt;Cloud の売上は下記の通り増加し、2年間で2倍以上に成長している。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;2018 -&gt; 2019: $5.8B -&gt; $8.9B（YoY+53%）&lt;/li&gt;
&lt;li&gt;2019 -&gt; 2020: $8.9B -&gt; $13.0B（YoY+47%）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/2f3ec9dd63dc1022951141c78016a08b/00172/google_revenue_details.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 27.848101265822784%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABJklEQVQY023O226CQBSFYd7/edq7Jo2xpg3ag8Z4qIAiOFhgFGZGp8XK34CJaZpefFn7cLG3I41Fn2rMCcw1/1NjvqGwFVEqEbLAjxOex1O8SLDdK1bbDOf2YcAozlkf6lZ0xR810RFCfSY0Z57mIUFZsSwrBv6G2EI/SHDu3De6wxlerkk+YXOsEf9o5omF5d7iywO98YLJRjLbFm3dzPuLCOem6/I4DVibc3slPnLJ344XGwsr/c1KnXAXEd7OtnqToN0Pmg87gyFDb83LfMk0/iC1Z4SuEKZC6K9WYi59k+H+QJArOs8j5iLnPZHcu69EpcWdeDhhGOJ5HvPZDN/3EUKgtUYrRVmWlEWBMQatFUopdrsdWZqSZSlSSvI8J8+yVtP/AAPywNnHJ+HKAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;google_revenue_details&quot;
        title=&quot;google_revenue_details&quot;
        src=&quot;/static/2f3ec9dd63dc1022951141c78016a08b/f058b/google_revenue_details.png&quot;
        srcset=&quot;/static/2f3ec9dd63dc1022951141c78016a08b/c26ae/google_revenue_details.png 158w,
/static/2f3ec9dd63dc1022951141c78016a08b/6bdcf/google_revenue_details.png 315w,
/static/2f3ec9dd63dc1022951141c78016a08b/f058b/google_revenue_details.png 630w,
/static/2f3ec9dd63dc1022951141c78016a08b/40601/google_revenue_details.png 945w,
/static/2f3ec9dd63dc1022951141c78016a08b/00172/google_revenue_details.png 1044w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;なお、今週行われた Conference call では CEO によって Revenue backlog が Q3 -&gt; Q4 で $19B -&gt; $30B &lt;sup id=&quot;fnref-1&quot;&gt;&lt;a href=&quot;#fn-1&quot; class=&quot;footnote-ref&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;に増加し、増加要因のほぼ全てが Cloud セグメントであると述べられている。 backlog は未認識の収益で、つまり先の期でそれくらい収益を得られる契約があるということになる。これは GCP がプラットフォームとして多くの企業から信頼されていることを表しているし、今後の成長も期待できる。&lt;/p&gt;
&lt;p&gt;上記のように数字だけ見ると撤退する理由が無いし、むしろ撤退するなんて言い出したら株主は経営陣をクビにすべきだろう。既存のビジネスより成長可能性が高い投資機会があって資金も人材もあるなら、それに投資するのは経営者として当然の選択だと思う。&lt;/p&gt;
&lt;p&gt;しかし Google のことなので、やはり突然撤退するかもしれない笑&lt;/p&gt;
&lt;h2 id=&quot;google-workspace-の影響&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#google-workspace-%E3%81%AE%E5%BD%B1%E9%9F%BF&quot; aria-label=&quot;google workspace の影響 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Google Workspace の影響&lt;/h2&gt;
&lt;p&gt;ちなみに冒頭の記事にもある通りこの Cloud 事業には Google Workspace（旧 G Suite）と Google Cloud Platform の売上が両方含まれている。YoY+47% という成長率にもこれが含まれている。Workspace がそんな急成長しているとは思えない &lt;sup id=&quot;fnref-2&quot;&gt;&lt;a href=&quot;#fn-2&quot; class=&quot;footnote-ref&quot;&gt;2&lt;/a&gt;&lt;/sup&gt; ので、 GCP の成長率はこれより高いことになる。&lt;/p&gt;
&lt;p&gt;Workspace の paying business の数は&lt;a href=&quot;https://www.cnbc.com/2020/04/07/google-g-suite-passes-6-million-customers.html&quot;&gt;2020年3月に6 millionを超えた&lt;/a&gt;らしい。それぞれの business に何人のユーザーがいるかは開示されていない（されてたらすみません）。&lt;/p&gt;
&lt;p&gt;Microsoft の Office 365 が 250 ~ 300 million くらいで、ガートナーの調査によると Google のシェアは MS の 1/8 程度&lt;a href=&quot;https://www.cnbc.com/2020/10/06/google-g-suite-becomes-workspace-gets-new-pricing-tiers.html&quot;&gt;らしい&lt;/a&gt;ので雑に計算すると 30 million くらいか？これが単価 $100/year とすると Workspace だけで $3B/year の 売上がある計算になる。本当にこんな売上あるのか？書いてて自信がなくなってきた。&lt;/p&gt;
&lt;p&gt;上記の内容は推測が多すぎるが、 Workspace が混じってるので純粋な GCP の売上だけが計上されているわけではないということが言いたかった。&lt;/p&gt;
&lt;h2 id=&quot;microsoft-azure&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#microsoft-azure&quot; aria-label=&quot;microsoft azure permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Microsoft Azure&lt;/h2&gt;
&lt;p&gt;ちなみに Microsoft は ’Server Products and cloud services’ セグメントとして Azure, SQL Server, Windows Server, Visual Studio, System Center, そして GitHub の売上をまとめて開示している。&lt;/p&gt;
&lt;p&gt;Microsoft は Azure 単体での収益を開示していないが、成長率は開示している。2021年6月期Q2 の &lt;a href=&quot;https://microsoft.gcs-web.com/node/28966/html&quot;&gt;Form 10-Q&lt;/a&gt; では Azure 単体の前年同期比成長率が YoY+50% で、 Azure の属する Server Products セグメントは YoY+26% だった。&lt;/p&gt;
&lt;h2 id=&quot;amazon-web-services&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#amazon-web-services&quot; aria-label=&quot;amazon web services permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Amazon Web Services&lt;/h2&gt;
&lt;p&gt;Amazon は ‘AWS’ セグメントとして AWS の損益を開示している。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://d18rn0p25nwr6d.cloudfront.net/CIK-0001018724/5a60b19f-08ef-4231-ad6a-f4810eb38769.html#&quot;&gt;Form 10-K の Segment Information&lt;/a&gt; を見ると良さそうだ。2020年12月期の売上は $45.3B で利益は $13.5B、成長率は YoY+29% だった。&lt;/p&gt;
&lt;h2 id=&quot;amazon-google-のクラウド事業の収益規模&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#amazon-google-%E3%81%AE%E3%82%AF%E3%83%A9%E3%82%A6%E3%83%89%E4%BA%8B%E6%A5%AD%E3%81%AE%E5%8F%8E%E7%9B%8A%E8%A6%8F%E6%A8%A1&quot; aria-label=&quot;amazon google のクラウド事業の収益規模 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Amazon, Google のクラウド事業の収益規模&lt;/h2&gt;
&lt;p&gt;業界最大手の AWS と Google Cloud の売上と利益（損失）を比較してみる。2020年の成長率は Google が上回っているものの、規模では圧倒的な差がついているように見える。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 521px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/3bb3531a0cef7efc095b325d201f9a20/bb9c5/google_vs_amazon.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 72.78481012658227%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAACj0lEQVQ4y22T3WoTQRTH965gH8MXER/Bd/BWBKkX1itfQG+8UlBRtPUDxEqt2KqIIm21tKVNP0K7gaRJNskmu9nd7MfM7E9mkk3S4sDZmTkz57//c+b8LYA8z/UXx4ezlo/TrON5Hp1Oh27Xpef5EJ/gtus4rTa+59Fqtcx5FEUUGNqsCSD4bkj56ISNjXVOT0/Z39838+HBIeGgQqm0y/b2DrZtc3BQolwuU6nYU4AMAZMkwa5UiKPAHCqljBV/1WupiqBpv0Tp+4BUw3sGUEpJv98ny7Jz9M+bMgxMcfSshFkr5x2ydJ1c+GZvADWQ4zjEcWyCpWEoUSJBSTFinKNkiky7Q59MDTNxdIvss4WM62Y/Bmw2myNAhmA543SUTIZptZYQX2dRwd74XJbvItYuoZLmkKFmFgQB3W53BKiGlxMHeXIPFRxOghsLZB8tpL9lfLpA2fEdxNoMKp4C1PXT82AwIM8lIgfR+0P23kLVXwwfSlvzDfKTRd7fYTzsedLVmQnDWq1mekn3nX5tzdCMZBexYpE2XpOMYoWzSLhsEfbWaUYRr7Zy9n7OwY9ZZMFQN6hm1m63Tcog2bTh9/Ym7pKFV31KJ4WbCwkPFx4Rr1gk3jpnPbh8G549uQG/LNKoMXnlYmjgLBnwYDnm/ttdovWrxM53ogTmFwXPP3yBv1dIvWNanmDupeTb6mPynWuEfpM0U1hF4+q09WsXMtSWBxnS85E9FyJtAbKfIXs9VK8LoWuKm1+UngaqVqtjXaZmX8PttFBSmh/q+jbqdcLAJ9cqUop+P6Bi24Rhf6woq9Dx9NA+nX6SJmOd6/pq7epuYJSDVlgYhgghxnHW/6R2EbzIwnVd07PT/ov3/gENaWpTl/upLgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;google_vs_amazon&quot;
        title=&quot;google_vs_amazon&quot;
        src=&quot;/static/3bb3531a0cef7efc095b325d201f9a20/bb9c5/google_vs_amazon.png&quot;
        srcset=&quot;/static/3bb3531a0cef7efc095b325d201f9a20/c26ae/google_vs_amazon.png 158w,
/static/3bb3531a0cef7efc095b325d201f9a20/6bdcf/google_vs_amazon.png 315w,
/static/3bb3531a0cef7efc095b325d201f9a20/bb9c5/google_vs_amazon.png 521w&quot;
        sizes=&quot;(max-width: 521px) 100vw, 521px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;実は Amazon が AWS セグメントの開示を始めたのは2015年12月期から（直近3年開示するので実質的には2013年から）だが、このとき既にこのセグメントでは利益を出している。Amazon は北米の消費者向け通販と AWS で得た利益をグローバルの消費者向け通販に投資している。広告で儲けてクラウドに投資する Google とはクラウド事業の役割が対照的かもしれない。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/53923b800cc4b3003fae13effdcd41d8/1b19f/aws_figures.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 8.227848101265824%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAZ0lEQVQI1z1NSQrAIAzs/1/pQT24oOKGEZ2SFJrLJJntqbWCiLDWQoxRMOcM/s85EUL4udYaxhifjgjee9H13mXnnEcphVIKeBhTSjjnwForyGYu2HvDGIN7L5xzqK1JodZavMzx/QKhuJl3AH5q3AAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;aws_figures&quot;
        title=&quot;aws_figures&quot;
        src=&quot;/static/53923b800cc4b3003fae13effdcd41d8/f058b/aws_figures.png&quot;
        srcset=&quot;/static/53923b800cc4b3003fae13effdcd41d8/c26ae/aws_figures.png 158w,
/static/53923b800cc4b3003fae13effdcd41d8/6bdcf/aws_figures.png 315w,
/static/53923b800cc4b3003fae13effdcd41d8/f058b/aws_figures.png 630w,
/static/53923b800cc4b3003fae13effdcd41d8/40601/aws_figures.png 945w,
/static/53923b800cc4b3003fae13effdcd41d8/1b19f/aws_figures.png 991w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 598px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/d17d1282e9601e9aada7ee1f24f3de86/0c69d/aws_revenue_and_profit.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 61.39240506329114%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAAB+klEQVQoz42SXU8TQRSG+3u9MCYay4VKAolGi6KGxMQYTcUCET9QWuTCKyTeaiBiohRIYbvb/SjLlu50O7PzmNltKQiJnuTMJpOZd573PVvQWjMqjVSwYwt8r4XvB7iex3Gng4yOcByHIAjwfR/P8xjeTbXO2lTBLGEY4rputqFUikgUUvaRUmatlEJJSb8/2jOdpml2HvJOU50LJklCt9vNGbOXTlMP2c/XkHDha8LLL8mI0IgZSnPAvPqvlioni5OcbGw+5nI5zgWFEERRRLvd/i/BkUXNw0897td63FsWXJ8bCFqWhRE1toc2/u4s9FSfxLHZkPx2FJPvBGMLMaWq4FplIGiGYexeRGho5KnQ417+vb0kKM7HTFUFNxYFd6vJSNCMP47jLEcDkJGkGqWGw9FEsRHWvFpPuPOxx/Rqn1tvepRqCTcXOky/P6RYOT47lCBon5vijqfZslLKawnFecGTzwlXnh/x+EPIxKzHo0WXyVmX0tuQqxWRC+Y5GRDJtt1j7XvI+rc2z1Y8Xqz6XJppMrdqM/bUYnbFZrzsMLPkMvE65MFyxPhih6lal2IlytwUTsJPFU2vw8bWAfaBy+aPBm6zxe5uE8fv8LNu02gG1A8OabQitvd99p2Q+r7PnhXwa88dWb74tz1bUdjGtq3BgC4u4/QPI8eEqE5qm/IAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;aws_revenue_and_profit&quot;
        title=&quot;aws_revenue_and_profit&quot;
        src=&quot;/static/d17d1282e9601e9aada7ee1f24f3de86/0c69d/aws_revenue_and_profit.png&quot;
        srcset=&quot;/static/d17d1282e9601e9aada7ee1f24f3de86/c26ae/aws_revenue_and_profit.png 158w,
/static/d17d1282e9601e9aada7ee1f24f3de86/6bdcf/aws_revenue_and_profit.png 315w,
/static/d17d1282e9601e9aada7ee1f24f3de86/0c69d/aws_revenue_and_profit.png 598w&quot;
        sizes=&quot;(max-width: 598px) 100vw, 598px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;2013 -&gt; 2020年の7年間でなんと収益が15倍（！）になっている。なお、Google のクラウド事業を単純に収益だけで見ると2016年の AWS くらいの規模になる。Amazon はすごい。&lt;/p&gt;
&lt;p&gt;ちなみに AWS も今の GCP と同じくらいの規模のときは同程度の成長率を記録しているが、規模の拡大に従って成長率が落ち着いてきた。どの事業者にも言えることだけど、クラウドの新たなユースケースを掘り出したり既存顧客の成長に貢献するというところが重要になってくると思う。実際、 Google の Conference call ではその辺が強調されているように（自分には）聞こえた。&lt;/p&gt;
&lt;h2 id=&quot;個人的な意見&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%80%8B%E4%BA%BA%E7%9A%84%E3%81%AA%E6%84%8F%E8%A6%8B&quot; aria-label=&quot;個人的な意見 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;個人的な意見&lt;/h2&gt;
&lt;p&gt;単にサーバーをデータセンターに置いてそれを貸す、というだけのビジネスであれば価格や品質などの競争力は規模に比例すると考えられる。しかし、一口にクラウドといっても AWS や Azure や GCP はより抽象化の進んだマネージドサービスとして製品を提供しているわけで、ビジネスの本質的な付加価値を規模の経済だけでは測れない。&lt;/p&gt;
&lt;p&gt;コンピュータ資源を抽象化したマネージドサービスたち&lt;sup id=&quot;fnref-3&quot;&gt;&lt;a href=&quot;#fn-3&quot; class=&quot;footnote-ref&quot;&gt;3&lt;/a&gt;&lt;/sup&gt;を組み合わせてサービスを提供するというのが当たり前になっていくと、それはただサーバーを貸すより高い付加価値がある。そう考えるとクラウドの市場規模というのは本当に巨大だと思う。&lt;/p&gt;
&lt;p&gt;結局は顧客のユースケースによって何を選ぶか（または複数のクラウドを使い分けるか）という話になってくる。例えば Cloud Spanner や BigQuery と同じものが AWS にあるかって言われると、似ているのはある（Aurora とか Redshift とか）けど同じものはない。ネットワーク効果の強い winner takes all 的なビジネスだと話が全く違ってくると思うけど、実際には AWS も Azure も GCP も成長を続けている。市場はもっと大きくなる可能性が高い。&lt;/p&gt;
&lt;p&gt;そういう意味では収益の成長率が市場平均を大幅に上回ってるし今後の成長可能性もあるよ、というのは普通に良いニュースなんじゃないかと思いました。&lt;/p&gt;
&lt;div class=&quot;footnotes&quot;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&quot;fn-1&quot;&gt;正確に言うと $29.8B で、1年以内に終了する契約、キャンセル可能な契約、履行済みの未請求を含まない金額。これらは今後2年間で約半分を収益認識し、残りはそれ以降になる。詳しくは Form 10-K p66 Deferred Revenues and Remaining Performance Obligations 参照。&lt;a href=&quot;#fnref-1&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;li id=&quot;fn-2&quot;&gt;paying businesses が毎年 +1 million 増えていて、現状 6 ~ 7 million なので（既存顧客からの収益増があったとしても）成長率は高くて 30% くらいではないか&lt;a href=&quot;#fnref-2&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;li id=&quot;fn-3&quot;&gt;もしくはサーバーレス（サーバーはある）のコンテナ実行環境とか関数とか？&lt;a href=&quot;#fnref-3&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content:encoded></item><item><title><![CDATA[プログラミング1年くらいやってつまづいたこと]]></title><description><![CDATA[プログラミングを本格的に始めてから1年くらい経ったので、今まで印象に残ったつまづきポイントを書いておく。 C言語 去年の今頃は 42 Tokyo の Piscine に参加していた（そのときの記事）。 このときはC言語でひたすら libc…]]></description><link>https://lyohe.github.io/2021-02-04-programming-taihenda/</link><guid isPermaLink="false">https://lyohe.github.io/2021-02-04-programming-taihenda/</guid><pubDate>Thu, 04 Feb 2021 10:11:37 GMT</pubDate><content:encoded>&lt;p&gt;プログラミングを本格的に始めてから1年くらい経ったので、今まで印象に残ったつまづきポイントを書いておく。&lt;/p&gt;
&lt;h2 id=&quot;c言語&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#c%E8%A8%80%E8%AA%9E&quot; aria-label=&quot;c言語 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;C言語&lt;/h2&gt;
&lt;p&gt;去年の今頃は 42 Tokyo の Piscine に参加していた（&lt;a href=&quot;https://lyohe.medium.com/42-tokyo-%E3%81%A8%E3%83%94%E3%82%A2-%E3%83%A9%E3%83%BC%E3%83%8B%E3%83%B3%E3%82%B0-1baf5b63df95&quot;&gt;そのときの記事&lt;/a&gt;）。&lt;/p&gt;
&lt;p&gt;このときはC言語でひたすら libc の再実装をしていた。それまでは Python や JavaScript でちょっとしたスクリプトを書いただけでC言語を書いたことが無かったのでとても辛かった（毎日100回の Segmentation fault を見る生活を4週間続けた）が、コンピュータの基礎に近づけた気がした。メモリをいちいち人間が確保したり解放したりしなきゃいけないというのがとても面倒だった覚えがある。&lt;/p&gt;
&lt;p&gt;ところで、人間がコンピュータを使って何かしらの課題を解決しようとしたときに突き当たる壁として、ハードウェアやソフトウェアにそれぞれ多数の階層が積み重なっていて、どこで何が行われているかということを知らないと調査したり解決したりに時間がかかるという問題がある。&lt;/p&gt;
&lt;p&gt;そういう意味ではいわゆるシステムプログラミングというか低レイヤーのプログラミングにも興味がある。ただ、今の自分は初心者プログラマーに過ぎないし、レイヤーに限らずソフトウェアエンジニアリング的に難しい仕事を任せてもらえるような立場ではない。これはプログラミングを続けていくしかない。&lt;/p&gt;
&lt;p&gt;C言語は辛かったので最近 Rust を始めてみたが、これはこれで別の辛さがあった。ただコンピュータを使って問題を解決する仕事でお金をもらう以上、いずれ避けては通れない分野だと思っている。&lt;/p&gt;
&lt;h2 id=&quot;css&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#css&quot; aria-label=&quot;css permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;CSS&lt;/h2&gt;
&lt;p&gt;CSS って難しくないですか？&lt;/p&gt;
&lt;p&gt;そもそもどこに何を書いたらどうなるのか全然分からないし、どのプロパティが継承されるかも分からない。あと Web サイトを作るときにどこからどこまでが CSS の仕事なのかもよくわからない。&lt;/p&gt;
&lt;p&gt;今はとりあえず flexbox でひな形を作り、 Chrome の Dev Tools で Element を見てコピペしている。&lt;/p&gt;
&lt;p&gt;デザインのセンスが致命的に無いので自分で CSS を書くのが辛いが、これも結局書いて慣れるしかないと思っている。&lt;/p&gt;
&lt;h2 id=&quot;javascript&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#javascript&quot; aria-label=&quot;javascript permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;JavaScript&lt;/h2&gt;
&lt;p&gt;JavaScript は文法そのものはそれほど難しくないと思うが、 Promise の概念を理解するのに1ヶ月くらいかかった。Promise は非同期処理を抽象化したオブジェクトで、結果を使って成功と失敗を分岐させるのだが、その非同期処理という概念そのものがよく分からなかった。&lt;/p&gt;
&lt;p&gt;この変数が undefined になるのでなんでだろう〜と苦しんでいた記憶がある。結果としては、下記の Web サイトを上から下まで5回くらい読んでだいたい理解できた。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://azu.github.io/promises-book/&quot;&gt;https://azu.github.io/promises-book/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;プログラミングを始める前は「プログラムというものは人間が実現したい命令を予め決められた文法に従って記述した文や式である」と考えていたが、実際にはそれらの命令を抽象化する概念やそれを実装したオブジェクトや関数がたくさんあって、それらを知らないで文法だけ知っていてもやりたいことを実現するのは難しい。&lt;/p&gt;
&lt;p&gt;例えば人間の直感からすると同期的なプログラミングの方が分かりやすい（と信じている）が、コンピュータ資源やユーザー体験の側面から見てそれが適切だとは限らない（ので、非同期プログラミングが誕生した）。文法だけでなくそれが導入された背景とか今まで積み重ねてきたものを理解しないとなかなか自分のやりたいことができないという辛みがある。書いてて思ったけどこれプログラミングに限らないな。&lt;/p&gt;
&lt;p&gt;要はやっていくしかない。&lt;/p&gt;
&lt;h2 id=&quot;そもそもの話&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%81%9D%E3%82%82%E3%81%9D%E3%82%82%E3%81%AE%E8%A9%B1&quot; aria-label=&quot;そもそもの話 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;そもそもの話&lt;/h2&gt;
&lt;h3 id=&quot;データ構造とアルゴリズム&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%83%87%E3%83%BC%E3%82%BF%E6%A7%8B%E9%80%A0%E3%81%A8%E3%82%A2%E3%83%AB%E3%82%B4%E3%83%AA%E3%82%BA%E3%83%A0&quot; aria-label=&quot;データ構造とアルゴリズム permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;データ構造とアルゴリズム&lt;/h3&gt;
&lt;p&gt;再帰とかソートみたいな基本的なロジックから先にあるやつ（グラフ探索とか動的計画法とかなんとか優先探索とか）が全然分からない。&lt;/p&gt;
&lt;p&gt;競技プログラミングの AtCoder を半年くらいやってみたけど Rating 324 で止まった（灰色）。これも勉強してプログラムをひたすら書いていくしかない。&lt;/p&gt;
&lt;h3 id=&quot;どこに何を書くか&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%81%A9%E3%81%93%E3%81%AB%E4%BD%95%E3%82%92%E6%9B%B8%E3%81%8F%E3%81%8B&quot; aria-label=&quot;どこに何を書くか permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;どこに何を書くか&lt;/h3&gt;
&lt;p&gt;仕事のプログラムを書いていて、動くには動くんだけどこれここに書いていいんだっけ？という場面が無限にある。&lt;/p&gt;
&lt;p&gt;やるべきことはリクエストを解析して加工し ORM の関数を通じてデータベースに書き込むことで、極端にいうと一つのファイルに全部書くこともできるのだが、これはどこまでをビジネスロジックとして x に書き、どこまでをデータを操作する関数として y にまとめるか、どこでどうやって受けとったデータを validate するかみたいな整理がどうするのがいいのか分かったり分からなかったりする。&lt;/p&gt;
&lt;p&gt;これもひたすら書いてレビューしてもらって感覚を身に着けていくしかない。&lt;/p&gt;
&lt;h2 id=&quot;まとめ&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E3%81%BE%E3%81%A8%E3%82%81&quot; aria-label=&quot;まとめ permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;まとめ&lt;/h2&gt;
&lt;p&gt;要はプログラムをたくさん書き続ければ解決する問題だと思った。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Hugo + GitHub Pages でブログを作った話]]></title><description><![CDATA[このブログは Hugo + GitHub Pages で作った。 （追記: 2021年11月に Gatsby で作り直しました） Hugo Hugo は Go 製の静的サイトジェネレータで、 Markdown 等で書いた文章から Web サイトを生成してくれる。
生成した Web…]]></description><link>https://lyohe.github.io/2021-02-03-hugo-to-github-pages/</link><guid isPermaLink="false">https://lyohe.github.io/2021-02-03-hugo-to-github-pages/</guid><pubDate>Wed, 03 Feb 2021 00:27:07 GMT</pubDate><content:encoded>&lt;p&gt;このブログは Hugo + GitHub Pages で作った。&lt;/p&gt;
&lt;p&gt;（追記: 2021年11月に Gatsby で作り直しました）&lt;/p&gt;
&lt;h2 id=&quot;hugo&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#hugo&quot; aria-label=&quot;hugo permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Hugo&lt;/h2&gt;
&lt;p&gt;Hugo は Go 製の静的サイトジェネレータで、 Markdown 等で書いた文章から Web サイトを生成してくれる。
生成した Web サイトの中身はただの静的なファイルなので、 &lt;a href=&quot;https://www.netlify.com/&quot;&gt;Netlify&lt;/a&gt; や &lt;a href=&quot;https://pages.github.com/&quot;&gt;GitHub Pages&lt;/a&gt; その他さまざまなサービスで Hosting できる。&lt;/p&gt;
&lt;p&gt;Hugo には様々なテーマが用意されていて、見た目を簡単にカスタマイズできる。このブログでは &lt;a href=&quot;https://themes.gohugo.io/hugo-tania/&quot;&gt;Tania&lt;/a&gt; というテーマを利用している。テーマの適用は非常にかんたんで、 Hugo のプロジェクト内の themes ディレクトリにテーマをダウンロード（多くは GitHub で提供されてるので普通に clone してくればよい）し、設定ファイルで使用するテーマを指定するだけでよい。&lt;/p&gt;
&lt;p&gt;Hugo の仕組みや設定ファイルの書き方についてはさくらインターネットさんが公開している記事が分かりやすかったので、これを読んでから&lt;a href=&quot;https://gohugo.io/documentation/&quot;&gt;公式ドキュメント&lt;/a&gt;を読めば大抵のことは分かると思う。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://knowledge.sakura.ad.jp/22908/&quot;&gt;【さくらのナレッジ】静的サイトジェネレータ「Hugo」と技術文書公開向けテーマ「Docsy」でOSSサイトを作る&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ちなみに上記のサイトでは設定ファイルとして config.toml を使っているが、 TOML だけでなく YAML も設定ファイルとして使うことができる。&lt;/p&gt;
&lt;h2 id=&quot;github-pages-に-deploy-するまで&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#github-pages-%E3%81%AB-deploy-%E3%81%99%E3%82%8B%E3%81%BE%E3%81%A7&quot; aria-label=&quot;github pages に deploy するまで permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;GitHub Pages に deploy するまで&lt;/h2&gt;
&lt;p&gt;GitHub Pages を始めるのは非常に簡単で、ここに書いてある通りにやるだけでよい。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://pages.github.com/&quot;&gt;https://pages.github.com/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;リポジトリを作ったら &lt;code class=&quot;language-text&quot;&gt;hugo new post/ファイル名&lt;/code&gt; で新しくファイルを作り、 Markdown 等でコンテンツを書く。テーマによって書き方が異なるケースがあるので、テーマごとの Demo サイトと自分のサイトを見比べたり &lt;code class=&quot;language-text&quot;&gt;hugo server&lt;/code&gt; でローカルで動かしてチェックするのがよい。&lt;/p&gt;
&lt;p&gt;コンテンツを格納する場所は設定ファイルで変更できる。また、記事のひな形を作りたいときは &lt;code class=&quot;language-text&quot;&gt;archetypes/default.md&lt;/code&gt; を編集すると &lt;code class=&quot;language-text&quot;&gt;hugo new&lt;/code&gt; で生成するファイルの中身を変えることができる。&lt;/p&gt;
&lt;p&gt;デプロイするときは &lt;code class=&quot;language-text&quot;&gt;hugo&lt;/code&gt; コマンドで public/ 内に Web サイトを生成できるので、それを GitHub Pages 用に作った &lt;code class=&quot;language-text&quot;&gt;username.github.io&lt;/code&gt; という名前の repository に push すればよい（username のところには GitHub のユーザー名を入れる）。&lt;/p&gt;
&lt;p&gt;GitHub アカウントに二要素認証を設定している方は push するときにユーザー名とパスワードで認証できない場合があるので、 &lt;a href=&quot;https://docs.github.com/en/github/authenticating-to-github/creating-a-personal-access-token&quot;&gt;personal access token&lt;/a&gt; を作って password の代わりにそれを入力する。&lt;/p&gt;
&lt;p&gt;Hugo の公式ドキュメントにはデプロイ用のスクリプトの例もある。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://gohugo.io/hosting-and-deployment/hosting-on-github/&quot;&gt;https://gohugo.io/hosting-and-deployment/hosting-on-github/&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[ブログを作りました]]></title><description><![CDATA[はじめまして。 2020年4月にプログラマーとして働き始めて1年が経ち、アウトプットの場としてブログを作ってみました。 GitHub アカウント名は lyohe です。これは私の本名が「りょうへい（Ryohei…]]></description><link>https://lyohe.github.io/2021-02-02-introduction/</link><guid isPermaLink="false">https://lyohe.github.io/2021-02-02-introduction/</guid><pubDate>Tue, 02 Feb 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;はじめまして。&lt;/p&gt;
&lt;p&gt;2020年4月にプログラマーとして働き始めて1年が経ち、アウトプットの場としてブログを作ってみました。&lt;/p&gt;
&lt;p&gt;GitHub アカウント名は &lt;a href=&quot;https://github.com/lyohe&quot;&gt;lyohe&lt;/a&gt; です。これは私の本名が「りょうへい（Ryohei）」なんですが、何年か前に少しだけ一緒に仕事したポルトガル人の同僚に物凄い巻き舌で「お前の名前『ッりょへ』っていうのか。すごく呼びづらいな！（意訳）」って言われて R じゃなくて L なのかなと思ってつけました。その結果、より発音しづらくなったっぽいです。&lt;/p&gt;
&lt;p&gt;自分の名前に identity を感じないため Web サービスの ID はそのときの気分で決めています（Twitter: &lt;a href=&quot;https://twitter.com/rtsudar&quot;&gt;@rtsudar&lt;/a&gt;）が、アイコンにはいつも同じ写真を使うようにしています。この写真はトルクメニスタンの国会記事堂付近の地面に映った自分の影です。観光で行ったら夕方で影が長く伸びてたのが気に入って撮りました。議事堂の写真を撮るのは忘れました。&lt;/p&gt;
&lt;p&gt;このブログにはプログラミングの話を書こうと考えています。とはいえ、私はプログラミングに関しては素人同然で数学や情報科学の素養もなく31歳未経験でプログラマーに転職したので、技術的に面白いと思ってもらえるような話が書けるかは分かりません。しかし、学んだことや新しく知ったことを整理して書くことは必ず自分の理解の促進に繋がると考えています。つまり自分のためでもあります。&lt;/p&gt;
&lt;p&gt;元々は10年ほど経理の仕事をしていましたが、様々な仕事に触れる中で将来的に会計税務に関連する仕事でもプログラミングが重要になりそうだな〜と思って転職しました。&lt;/p&gt;
&lt;p&gt;これからよろしくお願いします。&lt;/p&gt;</content:encoded></item></channel></rss>